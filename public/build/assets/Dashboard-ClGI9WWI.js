import{r as f,d as X,A as w,D as Y,c as v,o as p,b as e,k as U,a as n,f as h,t as g,F as G,m as E,i as B,j as I,v as O,Q as H,E as Z,g as ee,P as q,u as d,h as te,w as m,q as se}from"./app-Cjoo8RUd.js";import{q as re}from"./index-CMWG4mbA.js";import{_ as ae}from"./index-CPXyK1vt.js";import{_ as T,c as M,a as F,b as N}from"./CardTitle.vue_vue_type_script_setup_true_lang-C80yJfjo.js";import{_ as Q}from"./CardDescription.vue_vue_type_script_setup_true_lang-BPQP61oj.js";import{_ as oe}from"./Checkbox.vue_vue_type_script_setup_true_lang-BGK07tHi.js";import{_ as ne}from"./Label.vue_vue_type_script_setup_true_lang-DeoerWgl.js";import{_ as ie}from"./Layout.vue_vue_type_script_setup_true_lang-BqWs_Q33.js";import{_ as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-B799O6ds.js";import{_,I as de}from"./useClientStore-BoQylqxa.js";import{C as R}from"./lock-BV2usLyP.js";import"./Presence-BsP-jd6a.js";import"./useForwardExpose-BSXma_-r.js";import"./VisuallyHidden-DeNkjLxy.js";import"./check-DNU_Bd_-.js";import"./createLucideIcon-BBTaRfmZ.js";import"./Heading.vue_vue_type_script_setup_true_lang-D2xo_oi2.js";import"./index-Cs1awvEI.js";import"./index-ObrdfWFb.js";import"./AppSidebarLayout.vue_vue_type_script_setup_true_lang-DSpAhAVJ.js";import"./x-Duzz6RyX.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-vDBg99XY.js";import"./globe-Cz_HD3ST.js";import"./loader-circle-FXg2oqlr.js";const x=c=>({url:x.url(c),method:"patch"});x.definition={methods:["patch"],url:"/settings/dashboard"};x.url=c=>x.definition.url+re(c);x.patch=c=>({url:x.url(c),method:"patch"});const V=c=>({action:x.url({[c?.mergeQuery?"mergeQuery":"query"]:{_method:"PATCH",...c?.query??c?.mergeQuery??{}}}),method:"post"});V.patch=c=>({action:x.url({[c?.mergeQuery?"mergeQuery":"query"]:{_method:"PATCH",...c?.query??c?.mergeQuery??{}}}),method:"post"});x.form=V;class ue{guests=f([]);invitations=f([]);permissions=f([]);getCompanyGuests(s){return this.guests.value.filter(r=>r.company_id===s)}getActiveGuests(s){return this.guests.value.filter(r=>r.company_id===s&&r.is_active&&(!r.expires_at||new Date(r.expires_at)>new Date))}getGuest(s){return this.guests.value.find(r=>r.id===s)||null}isGuest(s){return this.guests.value.some(r=>r.id===s)}hasProjectAccess(s,r){const t=this.getGuest(s);return t?t.projects.includes(r):!1}hasPermission(s,r){const t=this.getGuest(s);return t?t.permissions.some(u=>u.actions.includes(r)):!1}async createInvitation(s){const r={...s,id:Date.now(),invited_at:new Date().toISOString(),token:this.generateToken(),status:"pending"};return this.invitations.value.push(r),r}async acceptInvitation(s,r){const t=this.invitations.value.find(C=>C.token===s);if(!t||t.status!=="pending")return null;if(t.expires_at&&new Date(t.expires_at)<new Date)return t.status="expired",null;const u={id:Date.now(),email:r.email,name:r.name,company_id:t.company_id,invited_by:t.invited_by,invited_at:t.invited_at,expires_at:t.expires_at,is_active:!0,permissions:t.permissions,projects:t.projects};return this.guests.value.push(u),t.status="accepted",u}async revokeGuestAccess(s){const r=this.getGuest(s);return r?(r.is_active=!1,!0):!1}async updateGuestPermissions(s,r){const t=this.getGuest(s);return t?(t.permissions=r,!0):!1}async updateGuestProjects(s,r){const t=this.getGuest(s);return t?(t.projects=r,!0):!1}getAvailablePermissions(){return this.permissions.value}getPendingInvitations(s){return this.invitations.value.filter(r=>r.company_id===s&&r.status==="pending")}async resendInvitation(s){const r=this.invitations.value.find(t=>t.id===s);return r?(console.log("Resending invitation to:",r.email),!0):!1}async cancelInvitation(s){const r=this.invitations.value.find(t=>t.id===s);return r?(r.status="revoked",!0):!1}generateToken(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}setGuests(s){this.guests.value=s}setInvitations(s){this.invitations.value=s}setPermissions(s){this.permissions.value=s}getGuestStats(s){const r=this.getCompanyGuests(s),t=this.invitations.value.filter(u=>u.company_id===s);return{total:r.length,active:r.filter(u=>u.is_active).length,pending:t.filter(u=>u.status==="pending").length,expired:t.filter(u=>u.status==="expired").length}}}const b=new ue,ce={class:"guest-management"},me={class:"flex items-center justify-between mb-6"},ge={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},pe={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},ve={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},ye={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},xe={class:"text-2xl font-bold text-green-600"},be={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},fe={class:"text-2xl font-bold text-yellow-600"},_e={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},ke={class:"text-2xl font-bold text-red-600"},he={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},we={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ce={class:"flex items-center gap-3"},je={class:"w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center"},Ie={class:"font-medium text-gray-900 dark:text-gray-100"},Ge={class:"text-sm text-gray-600 dark:text-gray-400"},Se={class:"text-xs text-gray-500 dark:text-gray-400"},$e={class:"flex items-center gap-2"},Ae=["onClick"],Pe=["onClick"],De={class:"flex items-center gap-3"},Ee={class:"w-10 h-10 rounded-full bg-yellow-100 dark:bg-yellow-900/20 flex items-center justify-center"},Te={class:"font-medium text-gray-900 dark:text-gray-100"},Me={class:"text-sm text-gray-600 dark:text-gray-400"},Ue={class:"text-xs text-gray-500 dark:text-gray-400"},Oe={class:"flex items-center gap-2"},Be=["onClick"],He=["onClick"],qe={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},Fe={class:"p-6 border-b border-gray-200 dark:border-gray-700"},Ne={class:"flex justify-between items-center"},Qe={class:"p-6 overflow-y-auto max-h-[60vh]"},Re={class:"space-y-2 max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-lg p-2"},Xe=["value"],Ve={class:"text-sm text-gray-700 dark:text-gray-300"},Ke={class:"space-y-2"},Le=["value"],We={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},ze={class:"text-xs text-gray-500 dark:text-gray-400"},Je={class:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3"},Ye=["disabled"],Ze=X({__name:"GuestManagement",props:{companyId:{},projects:{}},setup(c){const s=c,r=f(!1),t=f({email:"",name:"",projects:[],permissions:[],message:""}),u=f([]),C=f([]),S=f([{id:1,name:"View Only",description:"Can view todos and comments",actions:["view"]},{id:2,name:"Comment",description:"Can view and add comments",actions:["view","comment"]},{id:3,name:"Edit",description:"Can view, comment, and edit todos",actions:["view","comment","edit"]}]),$=w(()=>b.getActiveGuests(s.companyId)),A=w(()=>b.getPendingInvitations(s.companyId)),i=w(()=>b.getGuestStats(s.companyId)),l=w(()=>s.projects),j=async()=>{if(!t.value.email||t.value.projects.length===0)return;await b.createInvitation({email:t.value.email,name:t.value.name,company_id:s.companyId,invited_by:1,expires_at:new Date(Date.now()+10080*60*1e3).toISOString(),permissions:S.value.filter(a=>t.value.permissions.includes(a.id)),projects:t.value.projects,message:t.value.message})&&(P(),D())},P=()=>{r.value=!1,t.value={email:"",name:"",projects:[],permissions:[],message:""}},K=y=>{console.log("Edit guest:",y)},L=async y=>{confirm("Are you sure you want to revoke this guest's access?")&&(await b.revokeGuestAccess(y),D())},W=async y=>{await b.resendInvitation(y)},z=async y=>{confirm("Are you sure you want to cancel this invitation?")&&(await b.cancelInvitation(y),D())},J=y=>new Date(y).toLocaleDateString(),D=()=>{u.value=b.getCompanyGuests(s.companyId),C.value=b.getPendingInvitations(s.companyId)};return Y(()=>{D()}),(y,a)=>(p(),v("div",ce,[e("div",me,[a[7]||(a[7]=e("div",null,[e("h2",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"Guest Access"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Manage external collaborators and their project access")],-1)),e("button",{onClick:a[0]||(a[0]=o=>r.value=!0),class:"inline-flex items-center gap-2 rounded-md px-4 py-2 text-sm font-medium border transition-colors cursor-pointer bg-black text-white hover:bg-gray-900 hover:border-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 dark:hover:border-gray-300"},[n(_,{name:"UserPlus",class:"w-4 h-4"}),a[6]||(a[6]=h(" Invite Guest ",-1))])]),e("div",ge,[e("div",pe,[e("div",ve,g(i.value.total),1),a[8]||(a[8]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Total Guests",-1))]),e("div",ye,[e("div",xe,g(i.value.active),1),a[9]||(a[9]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Active",-1))]),e("div",be,[e("div",fe,g(i.value.pending),1),a[10]||(a[10]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Pending",-1))]),e("div",_e,[e("div",ke,g(i.value.expired),1),a[11]||(a[11]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Expired",-1))])]),e("div",he,[a[14]||(a[14]=e("div",{class:"p-4 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"Guests & Invitations")],-1)),e("div",we,[(p(!0),v(G,null,E($.value,o=>(p(),v("div",{key:o.id,class:"p-4 flex items-center justify-between"},[e("div",Ce,[e("div",je,[n(_,{name:"User",class:"w-5 h-5 text-green-600 dark:text-green-400"})]),e("div",null,[e("div",Ie,g(o.name),1),e("div",Ge,g(o.email),1),e("div",Se," Access to "+g(o.projects.length)+" project"+g(o.projects.length!==1?"s":""),1)])]),e("div",$e,[a[12]||(a[12]=e("span",{class:"text-xs px-2 py-1 bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 rounded-full"}," Active ",-1)),e("button",{onClick:k=>K(o),class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[n(_,{name:"Settings",class:"w-4 h-4"})],8,Ae),e("button",{onClick:k=>L(o.id),class:"p-1 text-red-400 hover:text-red-600"},[n(_,{name:"UserX",class:"w-4 h-4"})],8,Pe)])]))),128)),(p(!0),v(G,null,E(A.value,o=>(p(),v("div",{key:o.id,class:"p-4 flex items-center justify-between"},[e("div",De,[e("div",Ee,[n(_,{name:"Mail",class:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})]),e("div",null,[e("div",Te,g(o.email),1),e("div",Me," Invited "+g(J(o.invited_at)),1),e("div",Ue," Access to "+g(o.projects.length)+" project"+g(o.projects.length!==1?"s":""),1)])]),e("div",Oe,[a[13]||(a[13]=e("span",{class:"text-xs px-2 py-1 bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 rounded-full"}," Pending ",-1)),e("button",{onClick:k=>W(o.id),class:"p-1 text-blue-400 hover:text-blue-600"},[n(_,{name:"RefreshCw",class:"w-4 h-4"})],8,Be),e("button",{onClick:k=>z(o.id),class:"p-1 text-red-400 hover:text-red-600"},[n(_,{name:"X",class:"w-4 h-4"})],8,He)])]))),128))])]),r.value?(p(),v("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:B(P,["self"])},[e("div",qe,[e("div",Fe,[e("div",Ne,[a[15]||(a[15]=e("h2",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"Invite Guest",-1)),e("button",{onClick:P,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[n(_,{name:"X",class:"w-6 h-6"})])])]),e("div",Qe,[e("form",{onSubmit:B(j,["prevent"]),class:"space-y-4"},[e("div",null,[a[16]||(a[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Email Address",-1)),I(e("input",{"onUpdate:modelValue":a[1]||(a[1]=o=>t.value.email=o),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"guest@example.com"},null,512),[[O,t.value.email]])]),e("div",null,[a[17]||(a[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Name (Optional)",-1)),I(e("input",{"onUpdate:modelValue":a[2]||(a[2]=o=>t.value.name=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"Guest Name"},null,512),[[O,t.value.name]])]),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Projects",-1)),e("div",Re,[(p(!0),v(G,null,E(l.value,o=>(p(),v("label",{key:o.id,class:"flex items-center gap-2 cursor-pointer"},[I(e("input",{"onUpdate:modelValue":a[3]||(a[3]=k=>t.value.projects=k),value:o.id,type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Xe),[[H,t.value.projects]]),e("span",Ve,g(o.name),1)]))),128))])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Permissions",-1)),e("div",Ke,[(p(!0),v(G,null,E(S.value,o=>(p(),v("label",{key:o.id,class:"flex items-center gap-2 cursor-pointer"},[I(e("input",{"onUpdate:modelValue":a[4]||(a[4]=k=>t.value.permissions=k),value:o.id,type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Le),[[H,t.value.permissions]]),e("div",null,[e("span",We,g(o.name),1),e("p",ze,g(o.description),1)])]))),128))])]),e("div",null,[a[20]||(a[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Message (Optional)",-1)),I(e("textarea",{"onUpdate:modelValue":a[5]||(a[5]=o=>t.value.message=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"Welcome message for the guest..."},null,512),[[O,t.value.message]])])],32)]),e("div",Je,[e("button",{onClick:P,class:"inline-flex items-center justify-center gap-2 rounded-md px-4 py-2 text-sm font-medium border transition-colors cursor-pointer bg-black/30 text-black dark:bg-white/30 dark:text-white"}," Cancel "),e("button",{onClick:j,disabled:!t.value.email||t.value.projects.length===0,class:"inline-flex items-center justify-center gap-2 rounded-md px-4 py-2 text-sm font-medium border transition-colors cursor-pointer bg-black text-white hover:bg-gray-900 hover:border-gray-900 dark:bg-white dark:text-black dark:hover:bg-gray-100 dark:hover:border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"}," Send Invitation ",8,Ye)])])])):U("",!0)]))}}),et={class:"space-y-6"},tt={key:0,class:"mb-6"},st={class:"flex items-center gap-2 text-green-700 dark:text-green-300"},rt={class:"text-sm font-medium"},at={key:1,class:"mb-6"},ot={class:"flex items-center gap-2 text-red-700 dark:text-red-300"},nt={class:"text-sm font-medium"},it={class:"flex items-start space-x-3"},lt={class:"grid gap-1.5 leading-none"},dt={class:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},ut={class:"flex items-center pt-4"},Mt=X({__name:"Dashboard",props:{user:{},company:{}},setup(c){const s=c,r=Z(),t=f(!1),u=ee({prune_completed_tasks:!1}),C=w(()=>{const i=s.company?.prune_completed_tasks;return console.log("CHECKBOX DEBUG: Raw prop value:",i,"Type:",typeof i),i===!0||i===1||i==="1"||i==="true"?(console.log("CHECKBOX DEBUG: Setting to TRUE"),!0):(console.log("CHECKBOX DEBUG: Setting to FALSE"),!1)});q(()=>s.company?.prune_completed_tasks,i=>{console.log("PROPS WATCH: New value:",i,"Type:",typeof i);const l=i===!0||i===1||i==="1"||i==="true";console.log("PROPS WATCH: Converted to:",l),u.prune_completed_tasks=l,t.value=l},{immediate:!0}),q(t,i=>{console.log("REF WATCH: Local ref changed to:",i),u.prune_completed_tasks=i});const S=()=>{u.patch(x().url,{preserveScroll:!0,onSuccess:()=>{}})},$=w(()=>r.props.errors||{}),A=w(()=>r.props.flash?.success||"");return(i,l)=>(p(),v(G,null,[n(d(te),{title:"Dashboard Settings"}),n(le,null,{default:m(()=>[n(ie,null,{default:m(()=>[e("div",et,[l[8]||(l[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Dashboard Settings"),e("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," Configure your dashboard preferences and automation settings. ")],-1)),A.value?(p(),v("div",tt,[n(d(T),{class:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20"},{default:m(()=>[n(d(M),{class:"p-4"},{default:m(()=>[e("div",st,[n(d(de),{class:"w-5 h-5 flex-shrink-0"}),e("p",rt,g(A.value),1)])]),_:1})]),_:1})])):U("",!0),$.value.error?(p(),v("div",at,[n(d(T),{class:"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"},{default:m(()=>[n(d(M),{class:"p-4"},{default:m(()=>[e("div",ot,[n(d(R),{class:"w-5 h-5 flex-shrink-0"}),e("p",nt,g($.value.error),1)])]),_:1})]),_:1})])):U("",!0),n(d(T),null,{default:m(()=>[n(d(F),null,{default:m(()=>[n(d(N),null,{default:m(()=>l[1]||(l[1]=[h("Task Management",-1)])),_:1,__:[1]}),n(d(Q),null,{default:m(()=>l[2]||(l[2]=[h(" Configure automatic task management and cleanup settings. ",-1)])),_:1,__:[2]})]),_:1}),n(d(M),{class:"space-y-4"},{default:m(()=>[e("div",it,[n(d(oe),{id:"prune_completed_tasks",checked:C.value,"onUpdate:checked":l[0]||(l[0]=j=>{console.log("CHECKBOX CLICKED:",j),t.value.value=j})},null,8,["checked"]),e("div",lt,[n(d(ne),{for:"prune_completed_tasks",class:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},{default:m(()=>l[3]||(l[3]=[h(" Prune all Completed tasks in the Done column (daily at midnight) ",-1)])),_:1,__:[3]}),l[4]||(l[4]=e("p",{class:"text-xs text-muted-foreground"}," Automatically delete all completed tasks and their comments daily at midnight. This helps keep your workspace clean and organized. ",-1))])]),e("div",dt,[n(d(R),{class:"w-5 h-5 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),l[5]||(l[5]=e("div",{class:"text-sm text-amber-700 dark:text-amber-300"},[e("p",{class:"font-medium mb-1"},"Important:"),e("p",{class:"text-xs"}," Once tasks are pruned, they cannot be recovered. Make sure you have exported any important data before enabling this feature. ")],-1))]),e("div",ut,[n(d(ae),{onClick:S,disabled:d(u).processing},{default:m(()=>[h(g(d(u).processing?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),i.company?(p(),se(d(T),{key:2},{default:m(()=>[n(d(F),null,{default:m(()=>[n(d(N),null,{default:m(()=>l[6]||(l[6]=[h("Guest Access",-1)])),_:1,__:[6]}),n(d(Q),null,{default:m(()=>l[7]||(l[7]=[h(" Manage external collaborators and their project access. ",-1)])),_:1,__:[7]})]),_:1}),n(d(M),null,{default:m(()=>[n(Ze,{"company-id":i.company.id,projects:[]},null,8,["company-id"])]),_:1})]),_:1})):U("",!0)])]),_:1})]),_:1})],64))}});export{Mt as default};
