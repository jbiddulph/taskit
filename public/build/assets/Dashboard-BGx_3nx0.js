import{r as f,d as Q,A as w,D as Y,c as v,o as p,e,i as U,a as n,j as h,t as m,F as j,k as E,f as B,g as G,v as O,_ as H,E as Z,u as ee,P as q,b as d,h as te,w as g,p as se}from"./app-BKl0Udqg.js";import{q as ae}from"./index-CMWG4mbA.js";import{_ as re}from"./index-2Sfk6CWg.js";import{_ as T,c as M,a as F,b as N}from"./CardTitle.vue_vue_type_script_setup_true_lang-C2dVOK5a.js";import{_ as R}from"./CardDescription.vue_vue_type_script_setup_true_lang-_-SP2EZe.js";import{_ as oe}from"./Checkbox.vue_vue_type_script_setup_true_lang-DfU1Sk9p.js";import{_ as ne}from"./Label.vue_vue_type_script_setup_true_lang-CZlmlfna.js";import{_ as ie}from"./Layout.vue_vue_type_script_setup_true_lang-Dy3DVcIK.js";import{_ as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-BjK55TeO.js";import{_,I as de}from"./realtimeService-C5hRmfS1.js";import{C as X}from"./lock-BtWNghi-.js";import"./Presence-D1VTh13H.js";import"./useForwardExpose-BiUCS5L3.js";import"./VisuallyHidden-B7pRtgG7.js";import"./check-CbEDVeZ2.js";import"./Heading.vue_vue_type_script_setup_true_lang-ER8Slx7U.js";import"./index-8O20627j.js";import"./index-ObrdfWFb.js";import"./AppSidebarLayout.vue_vue_type_script_setup_true_lang-DTSZsjfC.js";import"./x-OFu0pSS_.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-n9PU9u5I.js";import"./globe-BnEPGImI.js";import"./loader-circle-Cmf8ZXY6.js";const x=c=>({url:x.url(c),method:"patch"});x.definition={methods:["patch"],url:"/settings/dashboard"};x.url=c=>x.definition.url+ae(c);x.patch=c=>({url:x.url(c),method:"patch"});const V=c=>({action:x.url({[c?.mergeQuery?"mergeQuery":"query"]:{_method:"PATCH",...c?.query??c?.mergeQuery??{}}}),method:"post"});V.patch=c=>({action:x.url({[c?.mergeQuery?"mergeQuery":"query"]:{_method:"PATCH",...c?.query??c?.mergeQuery??{}}}),method:"post"});x.form=V;class ue{guests=f([]);invitations=f([]);permissions=f([]);getCompanyGuests(s){return this.guests.value.filter(a=>a.company_id===s)}getActiveGuests(s){return this.guests.value.filter(a=>a.company_id===s&&a.is_active&&(!a.expires_at||new Date(a.expires_at)>new Date))}getGuest(s){return this.guests.value.find(a=>a.id===s)||null}isGuest(s){return this.guests.value.some(a=>a.id===s)}hasProjectAccess(s,a){const t=this.getGuest(s);return t?t.projects.includes(a):!1}hasPermission(s,a){const t=this.getGuest(s);return t?t.permissions.some(u=>u.actions.includes(a)):!1}async createInvitation(s){const a={...s,id:Date.now(),invited_at:new Date().toISOString(),token:this.generateToken(),status:"pending"};return this.invitations.value.push(a),a}async acceptInvitation(s,a){const t=this.invitations.value.find(C=>C.token===s);if(!t||t.status!=="pending")return null;if(t.expires_at&&new Date(t.expires_at)<new Date)return t.status="expired",null;const u={id:Date.now(),email:a.email,name:a.name,company_id:t.company_id,invited_by:t.invited_by,invited_at:t.invited_at,expires_at:t.expires_at,is_active:!0,permissions:t.permissions,projects:t.projects};return this.guests.value.push(u),t.status="accepted",u}async revokeGuestAccess(s){const a=this.getGuest(s);return a?(a.is_active=!1,!0):!1}async updateGuestPermissions(s,a){const t=this.getGuest(s);return t?(t.permissions=a,!0):!1}async updateGuestProjects(s,a){const t=this.getGuest(s);return t?(t.projects=a,!0):!1}getAvailablePermissions(){return this.permissions.value}getPendingInvitations(s){return this.invitations.value.filter(a=>a.company_id===s&&a.status==="pending")}async resendInvitation(s){const a=this.invitations.value.find(t=>t.id===s);return a?(console.log("Resending invitation to:",a.email),!0):!1}async cancelInvitation(s){const a=this.invitations.value.find(t=>t.id===s);return a?(a.status="revoked",!0):!1}generateToken(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}setGuests(s){this.guests.value=s}setInvitations(s){this.invitations.value=s}setPermissions(s){this.permissions.value=s}getGuestStats(s){const a=this.getCompanyGuests(s),t=this.invitations.value.filter(u=>u.company_id===s);return{total:a.length,active:a.filter(u=>u.is_active).length,pending:t.filter(u=>u.status==="pending").length,expired:t.filter(u=>u.status==="expired").length}}}const b=new ue,ce={class:"guest-management"},ge={class:"flex items-center justify-between mb-6"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},pe={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},ve={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},ye={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},xe={class:"text-2xl font-bold text-green-600"},be={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},fe={class:"text-2xl font-bold text-yellow-600"},_e={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},ke={class:"text-2xl font-bold text-red-600"},he={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},we={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ce={class:"flex items-center gap-3"},Ie={class:"w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/20 flex items-center justify-center"},Ge={class:"font-medium text-gray-900 dark:text-gray-100"},je={class:"text-sm text-gray-600 dark:text-gray-400"},Se={class:"text-xs text-gray-500 dark:text-gray-400"},$e={class:"flex items-center gap-2"},Ae=["onClick"],Pe=["onClick"],De={class:"flex items-center gap-3"},Ee={class:"w-10 h-10 rounded-full bg-yellow-100 dark:bg-yellow-900/20 flex items-center justify-center"},Te={class:"font-medium text-gray-900 dark:text-gray-100"},Me={class:"text-sm text-gray-600 dark:text-gray-400"},Ue={class:"text-xs text-gray-500 dark:text-gray-400"},Oe={class:"flex items-center gap-2"},Be=["onClick"],He=["onClick"],qe={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},Fe={class:"p-6 border-b border-gray-200 dark:border-gray-700"},Ne={class:"flex justify-between items-center"},Re={class:"p-6 overflow-y-auto max-h-[60vh]"},Xe={class:"space-y-2 max-h-32 overflow-y-auto border border-gray-300 dark:border-gray-600 rounded-lg p-2"},Qe=["value"],Ve={class:"text-sm text-gray-700 dark:text-gray-300"},Ke={class:"space-y-2"},Le=["value"],We={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},ze={class:"text-xs text-gray-500 dark:text-gray-400"},Je={class:"p-6 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3"},Ye=["disabled"],Ze=Q({__name:"GuestManagement",props:{companyId:{},projects:{}},setup(c){const s=c,a=f(!1),t=f({email:"",name:"",projects:[],permissions:[],message:""}),u=f([]),C=f([]),S=f([{id:1,name:"View Only",description:"Can view todos and comments",actions:["view"]},{id:2,name:"Comment",description:"Can view and add comments",actions:["view","comment"]},{id:3,name:"Edit",description:"Can view, comment, and edit todos",actions:["view","comment","edit"]}]),$=w(()=>b.getActiveGuests(s.companyId)),A=w(()=>b.getPendingInvitations(s.companyId)),i=w(()=>b.getGuestStats(s.companyId)),l=w(()=>s.projects),I=async()=>{if(!t.value.email||t.value.projects.length===0)return;await b.createInvitation({email:t.value.email,name:t.value.name,company_id:s.companyId,invited_by:1,expires_at:new Date(Date.now()+10080*60*1e3).toISOString(),permissions:S.value.filter(r=>t.value.permissions.includes(r.id)),projects:t.value.projects,message:t.value.message})&&(P(),D())},P=()=>{a.value=!1,t.value={email:"",name:"",projects:[],permissions:[],message:""}},K=y=>{console.log("Edit guest:",y)},L=async y=>{confirm("Are you sure you want to revoke this guest's access?")&&(await b.revokeGuestAccess(y),D())},W=async y=>{await b.resendInvitation(y)},z=async y=>{confirm("Are you sure you want to cancel this invitation?")&&(await b.cancelInvitation(y),D())},J=y=>new Date(y).toLocaleDateString(),D=()=>{u.value=b.getCompanyGuests(s.companyId),C.value=b.getPendingInvitations(s.companyId)};return Y(()=>{D()}),(y,r)=>(p(),v("div",ce,[e("div",ge,[r[7]||(r[7]=e("div",null,[e("h2",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"Guest Access"),e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Manage external collaborators and their project access")],-1)),e("button",{onClick:r[0]||(r[0]=o=>a.value=!0),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},[n(_,{name:"UserPlus",class:"w-4 h-4 inline mr-2"}),r[6]||(r[6]=h(" Invite Guest ",-1))])]),e("div",me,[e("div",pe,[e("div",ve,m(i.value.total),1),r[8]||(r[8]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Total Guests",-1))]),e("div",ye,[e("div",xe,m(i.value.active),1),r[9]||(r[9]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Active",-1))]),e("div",be,[e("div",fe,m(i.value.pending),1),r[10]||(r[10]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Pending",-1))]),e("div",_e,[e("div",ke,m(i.value.expired),1),r[11]||(r[11]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Expired",-1))])]),e("div",he,[r[14]||(r[14]=e("div",{class:"p-4 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"Guests & Invitations")],-1)),e("div",we,[(p(!0),v(j,null,E($.value,o=>(p(),v("div",{key:o.id,class:"p-4 flex items-center justify-between"},[e("div",Ce,[e("div",Ie,[n(_,{name:"User",class:"w-5 h-5 text-green-600 dark:text-green-400"})]),e("div",null,[e("div",Ge,m(o.name),1),e("div",je,m(o.email),1),e("div",Se," Access to "+m(o.projects.length)+" project"+m(o.projects.length!==1?"s":""),1)])]),e("div",$e,[r[12]||(r[12]=e("span",{class:"text-xs px-2 py-1 bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-200 rounded-full"}," Active ",-1)),e("button",{onClick:k=>K(o),class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[n(_,{name:"Settings",class:"w-4 h-4"})],8,Ae),e("button",{onClick:k=>L(o.id),class:"p-1 text-red-400 hover:text-red-600"},[n(_,{name:"UserX",class:"w-4 h-4"})],8,Pe)])]))),128)),(p(!0),v(j,null,E(A.value,o=>(p(),v("div",{key:o.id,class:"p-4 flex items-center justify-between"},[e("div",De,[e("div",Ee,[n(_,{name:"Mail",class:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})]),e("div",null,[e("div",Te,m(o.email),1),e("div",Me," Invited "+m(J(o.invited_at)),1),e("div",Ue," Access to "+m(o.projects.length)+" project"+m(o.projects.length!==1?"s":""),1)])]),e("div",Oe,[r[13]||(r[13]=e("span",{class:"text-xs px-2 py-1 bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 rounded-full"}," Pending ",-1)),e("button",{onClick:k=>W(o.id),class:"p-1 text-blue-400 hover:text-blue-600"},[n(_,{name:"RefreshCw",class:"w-4 h-4"})],8,Be),e("button",{onClick:k=>z(o.id),class:"p-1 text-red-400 hover:text-red-600"},[n(_,{name:"X",class:"w-4 h-4"})],8,He)])]))),128))])]),a.value?(p(),v("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:B(P,["self"])},[e("div",qe,[e("div",Fe,[e("div",Ne,[r[15]||(r[15]=e("h2",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"Invite Guest",-1)),e("button",{onClick:P,class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[n(_,{name:"X",class:"w-6 h-6"})])])]),e("div",Re,[e("form",{onSubmit:B(I,["prevent"]),class:"space-y-4"},[e("div",null,[r[16]||(r[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Email Address",-1)),G(e("input",{"onUpdate:modelValue":r[1]||(r[1]=o=>t.value.email=o),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"guest@example.com"},null,512),[[O,t.value.email]])]),e("div",null,[r[17]||(r[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Name (Optional)",-1)),G(e("input",{"onUpdate:modelValue":r[2]||(r[2]=o=>t.value.name=o),type:"text",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"Guest Name"},null,512),[[O,t.value.name]])]),e("div",null,[r[18]||(r[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Projects",-1)),e("div",Xe,[(p(!0),v(j,null,E(l.value,o=>(p(),v("label",{key:o.id,class:"flex items-center gap-2 cursor-pointer"},[G(e("input",{"onUpdate:modelValue":r[3]||(r[3]=k=>t.value.projects=k),value:o.id,type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Qe),[[H,t.value.projects]]),e("span",Ve,m(o.name),1)]))),128))])]),e("div",null,[r[19]||(r[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Permissions",-1)),e("div",Ke,[(p(!0),v(j,null,E(S.value,o=>(p(),v("label",{key:o.id,class:"flex items-center gap-2 cursor-pointer"},[G(e("input",{"onUpdate:modelValue":r[4]||(r[4]=k=>t.value.permissions=k),value:o.id,type:"checkbox",class:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Le),[[H,t.value.permissions]]),e("div",null,[e("span",We,m(o.name),1),e("p",ze,m(o.description),1)])]))),128))])]),e("div",null,[r[20]||(r[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Message (Optional)",-1)),G(e("textarea",{"onUpdate:modelValue":r[5]||(r[5]=o=>t.value.message=o),rows:"3",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"Welcome message for the guest..."},null,512),[[O,t.value.message]])])],32)]),e("div",Je,[e("button",{onClick:P,class:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"}," Cancel "),e("button",{onClick:I,disabled:!t.value.email||t.value.projects.length===0,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"}," Send Invitation ",8,Ye)])])])):U("",!0)]))}}),et={class:"space-y-6"},tt={key:0,class:"mb-6"},st={class:"flex items-center gap-2 text-green-700 dark:text-green-300"},at={class:"text-sm font-medium"},rt={key:1,class:"mb-6"},ot={class:"flex items-center gap-2 text-red-700 dark:text-red-300"},nt={class:"text-sm font-medium"},it={class:"flex items-start space-x-3"},lt={class:"grid gap-1.5 leading-none"},dt={class:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg"},ut={class:"flex items-center pt-4"},Tt=Q({__name:"Dashboard",props:{user:{},company:{}},setup(c){const s=c,a=Z(),t=f(!1),u=ee({prune_completed_tasks:!1}),C=w(()=>{const i=s.company?.prune_completed_tasks;return console.log("CHECKBOX DEBUG: Raw prop value:",i,"Type:",typeof i),i===!0||i===1||i==="1"||i==="true"?(console.log("CHECKBOX DEBUG: Setting to TRUE"),!0):(console.log("CHECKBOX DEBUG: Setting to FALSE"),!1)});q(()=>s.company?.prune_completed_tasks,i=>{console.log("PROPS WATCH: New value:",i,"Type:",typeof i);const l=i===!0||i===1||i==="1"||i==="true";console.log("PROPS WATCH: Converted to:",l),u.prune_completed_tasks=l,t.value=l},{immediate:!0}),q(t,i=>{console.log("REF WATCH: Local ref changed to:",i),u.prune_completed_tasks=i});const S=()=>{u.patch(x().url,{preserveScroll:!0,onSuccess:()=>{}})},$=w(()=>a.props.errors||{}),A=w(()=>a.props.flash?.success||"");return(i,l)=>(p(),v(j,null,[n(d(te),{title:"Dashboard Settings"}),n(le,null,{default:g(()=>[n(ie,null,{default:g(()=>[e("div",et,[l[8]||(l[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Dashboard Settings"),e("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," Configure your dashboard preferences and automation settings. ")],-1)),A.value?(p(),v("div",tt,[n(d(T),{class:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20"},{default:g(()=>[n(d(M),{class:"p-4"},{default:g(()=>[e("div",st,[n(d(de),{class:"w-5 h-5 flex-shrink-0"}),e("p",at,m(A.value),1)])]),_:1})]),_:1})])):U("",!0),$.value.error?(p(),v("div",rt,[n(d(T),{class:"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"},{default:g(()=>[n(d(M),{class:"p-4"},{default:g(()=>[e("div",ot,[n(d(X),{class:"w-5 h-5 flex-shrink-0"}),e("p",nt,m($.value.error),1)])]),_:1})]),_:1})])):U("",!0),n(d(T),null,{default:g(()=>[n(d(F),null,{default:g(()=>[n(d(N),null,{default:g(()=>l[1]||(l[1]=[h("Task Management",-1)])),_:1,__:[1]}),n(d(R),null,{default:g(()=>l[2]||(l[2]=[h(" Configure automatic task management and cleanup settings. ",-1)])),_:1,__:[2]})]),_:1}),n(d(M),{class:"space-y-4"},{default:g(()=>[e("div",it,[n(d(oe),{id:"prune_completed_tasks",checked:C.value,"onUpdate:checked":l[0]||(l[0]=I=>{console.log("CHECKBOX CLICKED:",I),t.value.value=I})},null,8,["checked"]),e("div",lt,[n(d(ne),{for:"prune_completed_tasks",class:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},{default:g(()=>l[3]||(l[3]=[h(" Prune all Completed tasks in the Done column (daily at midnight) ",-1)])),_:1,__:[3]}),l[4]||(l[4]=e("p",{class:"text-xs text-muted-foreground"}," Automatically delete all completed tasks and their comments daily at midnight. This helps keep your workspace clean and organized. ",-1))])]),e("div",dt,[n(d(X),{class:"w-5 h-5 text-amber-600 dark:text-amber-400 mt-0.5 flex-shrink-0"}),l[5]||(l[5]=e("div",{class:"text-sm text-amber-700 dark:text-amber-300"},[e("p",{class:"font-medium mb-1"},"Important:"),e("p",{class:"text-xs"}," Once tasks are pruned, they cannot be recovered. Make sure you have exported any important data before enabling this feature. ")],-1))]),e("div",ut,[n(d(re),{onClick:S,disabled:d(u).processing},{default:g(()=>[h(m(d(u).processing?"Saving...":"Save Settings"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),i.company?(p(),se(d(T),{key:2},{default:g(()=>[n(d(F),null,{default:g(()=>[n(d(N),null,{default:g(()=>l[6]||(l[6]=[h("Guest Access",-1)])),_:1,__:[6]}),n(d(R),null,{default:g(()=>l[7]||(l[7]=[h(" Manage external collaborators and their project access. ",-1)])),_:1,__:[7]})]),_:1}),n(d(M),null,{default:g(()=>[n(Ze,{"company-id":i.company.id,projects:[]},null,8,["company-id"])]),_:1})]),_:1})):U("",!0)])]),_:1})]),_:1})],64))}});export{Tt as default};
