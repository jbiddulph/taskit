import{d as h,a as g,o as i,n as b,A as s,M as w,G as J,r as Y,c as E,l as z,f as a,L as W,q as n,b as r,e as v,p as x,t as _,g as k,F as I,j as N,N as L}from"./app-xCUKMQbx.js";import{C as j,c as Z,d as Q,b as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-C85alEJA.js";import{c as C,_ as X}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C0mBvCu2.js";import{C as B}from"./check-BK9qv9Np.js";import"./useForwardExpose-Bflna-CY.js";import"./index-C61bzdNy.js";const F=h({__name:"Card",props:{class:{}},setup(p){const d=p;return(f,u)=>(i(),g("div",{"data-slot":"card",class:b(s(C)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",d.class))},[w(f.$slots,"default")],2))}}),S=h({__name:"CardContent",props:{class:{}},setup(p){const d=p;return(f,u)=>(i(),g("div",{"data-slot":"card-content",class:b(s(C)("px-6",d.class))},[w(f.$slots,"default")],2))}}),q=h({__name:"CardDescription",props:{class:{}},setup(p){const d=p;return(f,u)=>(i(),g("p",{"data-slot":"card-description",class:b(s(C)("text-muted-foreground text-sm",d.class))},[w(f.$slots,"default")],2))}}),D=h({__name:"CardHeader",props:{class:{}},setup(p){const d=p;return(f,u)=>(i(),g("div",{"data-slot":"card-header",class:b(s(C)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",d.class))},[w(f.$slots,"default")],2))}}),M=h({__name:"CardTitle",props:{class:{}},setup(p){const d=p;return(f,u)=>(i(),g("h3",{"data-slot":"card-title",class:b(s(C)("leading-none font-semibold",d.class))},[w(f.$slots,"default")],2))}}),te={class:"max-w-6xl mx-auto p-6"},se={key:0,class:"mb-6"},oe={class:"flex items-center gap-2 text-red-700 dark:text-red-300"},re={class:"text-sm font-medium"},le={class:"flex items-center justify-between"},ae={class:"text-lg font-semibold"},ne={class:"text-gray-600 dark:text-gray-400"},ce={key:0,class:"mt-2"},ie={class:"text-sm text-gray-500"},de={class:"flex items-center gap-2"},ue={class:"mb-8"},ge={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},pe={class:"text-3xl font-bold text-gray-900 dark:text-gray-100"},fe={class:"text-sm text-gray-500"},me={class:"space-y-2 mb-6"},_e={key:1,class:"text-center"},we=h({__name:"Index",props:{user:{},company:{},plans:{},stripePublicKey:{}},setup(p){const d=p,f=J(),u=Y(!1),c=E(()=>d.company?.subscription_type||"FREE"),R=E(()=>d.company?.subscription_status==="active"),A=E(()=>f.props.errors||{}),U=E(()=>{if(c.value==="FREE")return d.plans;const e={...d.plans};return delete e.FREE,e});console.log("=== SUBSCRIPTION PAGE LOADED ==="),console.log("Props:",d),console.log("Current plan computed:",c.value),console.log("Loading state:",u.value),console.log("Component initial setup complete"),console.log("Component fully loaded at:",new Date().toISOString());const $=t=>`Â£${(t/100).toFixed(0)}`,H=t=>t===c.value?t==="MAXI"?"border-2 border-yellow-500 bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20":t==="MIDI"?"border-2 border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-2 border-gray-500 bg-gray-50 dark:bg-gray-900/20":"border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",T=t=>{const e=c.value,o=d.plans[t],l={FREE:0,MIDI:1,MAXI:2},m=l[e]||0,y=l[t]||0;return y>m?`Upgrade to ${o.name}`:y<m?`Downgrade to ${o.name}`:`Switch to ${o.name}`},O=t=>{console.log("=== BUTTON CLICKED ==="),console.log("Plan type:",t),console.log("Current time:",new Date().toISOString()),console.log("Loading state:",u.value),console.log("Current plan:",c.value),console.log("Function exists:",typeof P),console.log("About to call changePlan...");try{P(t),console.log("changePlan called successfully")}catch(e){console.error("Error calling changePlan:",e)}},P=async t=>{if(console.log("changePlan called with:",t),console.log("loading.value:",u.value),console.log("currentPlan.value:",c.value),u.value||t===c.value){console.log("Exiting early - either loading or same plan");return}u.value=!0,console.log("Setting loading to true, using Inertia router approach..."),L.post("/subscription/change-plan",{plan:t},{onBefore:()=>(console.log("Inertia request starting..."),!0),onSuccess:e=>{console.log("Inertia request successful:",e),console.log("Full page props:",JSON.stringify(e.props,null,2)),console.log("All page props keys:",Object.keys(e.props)),console.log("Direct redirect_url check:",e.props.redirect_url),console.log("Has redirect_url prop:","redirect_url"in e.props);const o=e.props.flash;console.log("Flash data:",o),console.log("Flash type:",typeof o),console.log("Flash keys:",o?Object.keys(o):"no flash");let l=null;if(o?.redirect_url)l=o.redirect_url,console.log("Found redirect_url in flash.redirect_url");else if(e.props.redirect_url)l=e.props.redirect_url,console.log("Found redirect_url in page.props.redirect_url");else if(o&&typeof o=="object"){for(const[m,y]of Object.entries(o))if(console.log(`Flash ${m}:`,y),m==="redirect_url"||typeof y=="string"&&y.includes("checkout.stripe.com")){l=y,console.log(`Found redirect URL in flash.${m}`);break}}l?(console.log("Redirecting to Stripe checkout:",l),window.location.href=l):(console.log("No redirect URL found, handling plan change"),(c.value==="MAXI"&&t==="MIDI"||c.value!=="FREE"&&t==="FREE")&&(console.log("Downgrade detected, emitting project reload event"),window.dispatchEvent(new CustomEvent("subscription-downgrade",{detail:{newPlan:t,oldPlan:c.value}}))),window.location.reload())},onError:e=>{console.error("Inertia request failed:",e),console.log("Error details:",JSON.stringify(e,null,2));let o="An error occurred while changing your plan. Please try again.";e.plan?o=e.plan:e.message&&(o=e.message),alert(o)},onFinish:()=>{console.log("Setting loading to false"),u.value=!1}})},V=()=>{const t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):""},G=async()=>{console.log("=== TESTING CSRF ===");const t=V();console.log("CSRF Token:",t?"Found":"Missing");try{const e=await fetch("/subscription/test-csrf",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(console.log("CSRF Test Response:",e.status,e.statusText),e.ok){const o=await e.json();console.log("CSRF Test Success:",o)}else console.log("CSRF Test Failed:",e.status)}catch(e){console.error("CSRF Test Error:",e)}};z(()=>{console.log("=== COMPONENT MOUNTED ==="),console.log("onMounted hook called at:",new Date().toISOString()),console.log("Final function check:",{handlePlanChange:typeof O,changePlan:typeof P}),console.log("Running automatic CSRF test..."),G()});const K=async()=>{confirm("Are you sure you want to cancel your subscription? Your account will be downgraded to the FREE plan.")&&(u.value=!0,L.post("/subscription/cancel-subscription",{},{onSuccess:()=>{},onError:t=>{console.error("Error cancelling subscription:",t),alert("An error occurred while cancelling your subscription. Please try again.")},onFinish:()=>{u.value=!1}}))};return(t,e)=>(i(),g(I,null,[a(s(W),{title:"Subscription Management"}),a(ee,null,{default:n(()=>[r("div",te,[e[7]||(e[7]=r("div",{class:"mb-8"},[r("h1",{class:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2"}," Subscription Management "),r("p",{class:"text-gray-600 dark:text-gray-400"}," Manage your TaskIT subscription and billing settings ")],-1)),A.value.subscription?(i(),g("div",se,[a(s(F),{class:"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"},{default:n(()=>[a(s(S),{class:"p-4"},{default:n(()=>[r("div",oe,[a(s(j),{class:"w-5 h-5 flex-shrink-0"}),r("p",re,_(A.value.subscription),1)])]),_:1})]),_:1})])):v("",!0),a(s(F),{class:"mb-8"},{default:n(()=>[a(s(D),null,{default:n(()=>[a(s(M),{class:"flex items-center gap-2"},{default:n(()=>[a(s(Z),{class:"w-5 h-5"}),e[0]||(e[0]=k(" Current Subscription ",-1))]),_:1,__:[0]})]),_:1}),a(s(S),null,{default:n(()=>[r("div",le,[r("div",null,[r("p",ae,_(t.plans[c.value].name),1),r("p",ne,_(c.value==="FREE"?"Free forever":`${$(t.plans[c.value].price)} per month`),1),t.company?.subscription_ends_at?(i(),g("div",ce,[r("p",ie,_(R.value?"Renews on":"Expires on")+": "+_(new Date(t.company.subscription_ends_at).toLocaleDateString()),1)])):v("",!0)]),r("div",de,[r("div",{class:b(["px-3 py-1 rounded-full text-sm font-medium",{"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300":R.value,"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":t.company?.subscription_status==="past_due","bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300":t.company?.subscription_status==="canceled","bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300":c.value==="FREE"}])},_(R.value?"Active":t.company?.subscription_status||"Free"),3)])])]),_:1})]),_:1}),r("div",ue,[e[2]||(e[2]=r("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6"}," Available Plans ",-1)),r("div",ge,[(i(!0),g(I,null,N(U.value,(o,l)=>(i(),x(s(F),{key:l,class:b(H(l))},{default:n(()=>[a(s(D),{class:"text-center"},{default:n(()=>[a(s(M),{class:"flex items-center justify-center gap-2"},{default:n(()=>[l==="MAXI"?(i(),x(s(Q),{key:0,class:"w-5 h-5 text-yellow-500"})):v("",!0),r("span",{class:b({"text-yellow-600 dark:text-yellow-400":l==="MAXI"})},_(o.name),3),l===c.value?(i(),x(s(B),{key:1,class:"w-5 h-5 text-green-500"})):v("",!0)]),_:2},1024),a(s(q),null,{default:n(()=>[r("div",pe,_(l==="FREE"?"Free":$(o.price)),1),r("div",fe,_(l==="FREE"?"Forever":"per month"),1)]),_:2},1024)]),_:2},1024),a(s(S),null,{default:n(()=>[r("ul",me,[(i(!0),g(I,null,N(o.features,m=>(i(),g("li",{key:m,class:"flex items-start gap-2 text-sm"},[a(s(B),{class:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),r("span",null,_(m),1)]))),128))]),l!==c.value?(i(),x(s(X),{key:0,onClick:m=>O(l),disabled:u.value,variant:l==="MIDI"||l==="MAXI"?"default":"outline",class:"w-full"},{default:n(()=>[k(_(T(l)),1)]),_:2},1032,["onClick","disabled","variant"])):(i(),g("div",_e,e[1]||(e[1]=[r("span",{class:"text-sm text-gray-500"},"Current Plan",-1)])))]),_:2},1024)]),_:2},1032,["class"]))),128))])]),c.value!=="FREE"&&t.company?.stripe_subscription_id?(i(),x(s(F),{key:1,class:"border-red-200 dark:border-red-800"},{default:n(()=>[a(s(D),null,{default:n(()=>[a(s(M),{class:"flex items-center gap-2 text-red-600 dark:text-red-400"},{default:n(()=>[a(s(j),{class:"w-5 h-5"}),e[3]||(e[3]=k(" Danger Zone ",-1))]),_:1,__:[3]}),a(s(q),null,{default:n(()=>e[4]||(e[4]=[k(" Cancel your subscription and downgrade to the FREE plan ",-1)])),_:1,__:[4]})]),_:1}),a(s(S),null,{default:n(()=>[a(s(X),{onClick:K,disabled:u.value,variant:"destructive"},{default:n(()=>e[5]||(e[5]=[k(" Cancel Subscription ",-1)])),_:1,__:[5]},8,["disabled"]),e[6]||(e[6]=r("p",{class:"text-xs text-gray-500 mt-2"}," Your subscription will remain active until the end of your current billing period. ",-1))]),_:1,__:[6]})]),_:1})):v("",!0)])]),_:1})],64))}});export{we as default};
