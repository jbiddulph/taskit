import{_ as G,a as Ao,t as ke,b as ih}from"./AppLayout.vue_vue_type_script_setup_true_lang-D8WUhlXL.js";import{d as oh}from"./index-C61bzdNy.js";import{d as qe,c as Et,a as P,o as A,b,e as X,n as On,t as z,f as U,g as Yr,w as Ae,F as Xe,r as dt,h as V,i as Bn,j as Mo,k as xr,l as cc,T as ah,m as lh,p as ch,q as uh,s as uc,u as dh,v as hh,x as Jt,y as fh,_ as Sr,z as ph,A as mh,B as Qr,C as dc,D as ye,E as ze,G as Yn,H as gh,I as oi,J as yh,K as bh}from"./app-K28OVK3a.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-LOxZqET0.js";import"./useForwardExpose-CtldU8E9.js";import"./check-BAHwj4XY.js";const vh={class:"flex items-start justify-between mb-2"},wh={class:"flex items-center gap-2"},kh={key:0,class:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},xh={key:0,class:"mb-3 flex items-start gap-3"},Sh=["src"],Th={key:1,class:"flex flex-wrap gap-1 mb-3"},Ch={class:"flex items-center justify-between text-sm"},_h={class:"flex items-center gap-2"},Eh={key:0,class:"w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white text-xs font-medium"},Oh={key:1,class:"text-gray-400"},Ah={class:"flex items-center gap-1 text-gray-500"},Mh={key:0},Ph={key:1},Ih={key:2,class:"absolute top-2 right-2"},Nh={class:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 text-xs font-medium text-gray-700 dark:text-gray-300"},Rh=qe({__name:"TodoCard",props:{todo:{}},emits:["edit","delete"],setup(r,{emit:e}){const t=r,n=e,s={Low:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-yellow-200",Medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",High:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",Critical:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"};let i=!1;const o=()=>{i||n("edit",t.todo),i=!1},a=f=>{const p=new Date(f),m=new Date,g=p.getTime()-m.getTime(),y=Math.ceil(g/(1e3*60*60*24));return y<0?`${Math.abs(y)}d overdue`:y===0?"Today":y===1?"Tomorrow":y<=7?`${y}d`:p.toLocaleDateString()},l=f=>{if(!f)return null;const p=f.match(/<img[^>]*src=["']([^"']+)["'][^>]*>/i);return p?p[1]:null},c=f=>f?f.replace(/<img[^>]*>/gi,"").replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim():"",u=f=>({Bug:"Bug",Feature:"Zap",Task:"CheckSquare",Story:"BookOpen",Epic:"Layers"})[f]||"Circle",d=Et(()=>l(t.todo?.description)),h=Et(()=>c(t.todo?.description));return(f,p)=>(A(),P("div",{class:"group relative bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",onClick:o},[b("div",vh,[b("div",wh,[b("span",{class:On(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",s[f.todo.priority]])},z(f.todo.priority),3),f.todo.type?(A(),P("span",kh,[U(G,{name:u(f.todo.type),class:"w-3 h-3"},null,8,["name"]),Yr(" "+z(f.todo.type),1)])):X("",!0)]),b("button",{onClick:p[0]||(p[0]=Ae(m=>f.$emit("delete",f.todo.id),["stop"])),class:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 transition-opacity"},[U(G,{name:"Trash2",class:"w-4 h-4"})])]),b("h3",{class:On(["font-medium text-gray-900 dark:text-gray-100 mb-2 line-clamp-2",{"line-through opacity-60":f.todo.status==="done"}])},z(f.todo.title),3),d.value||h.value?(A(),P("div",xh,[d.value?(A(),P("img",{key:0,src:d.value,alt:"attachment",class:"w-14 h-14 object-cover rounded border border-gray-200 dark:border-gray-700 flex-shrink-0"},null,8,Sh)):X("",!0),h.value?(A(),P("p",{key:1,class:On(["text-sm text-gray-600 dark:text-gray-400 line-clamp-2",{"line-through opacity-60":f.todo.status==="done"}])},z(h.value),3)):X("",!0)])):X("",!0),f.todo.tags&&f.todo.tags.length?(A(),P("div",Th,[(A(!0),P(Xe,null,dt(f.todo.tags,m=>(A(),P("span",{key:m,class:On(["inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",{"line-through opacity-60":f.todo.status==="done"}])},z(m),3))),128))])):X("",!0),b("div",Ch,[b("div",_h,[f.todo.assignee?(A(),P("div",Eh,z(f.todo.assignee.charAt(0).toUpperCase()),1)):(A(),P("span",Oh,"Unassigned"))]),b("div",Ah,[U(G,{name:"Calendar",class:"w-4 h-4"}),f.todo.due_date?(A(),P("span",Mh,z(a(f.todo.due_date)),1)):(A(),P("span",Ph,"No due date"))])]),f.todo.story_points?(A(),P("div",Ih,[b("span",Nh,z(f.todo.story_points),1)])):X("",!0)]))}}),Dh=Ao(Rh,[["__scopeId","data-v-5039c9e3"]]),$h={class:"flex flex-col h-full min-w-80"},Lh={class:"flex items-center justify-between mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700"},jh={class:"flex items-center gap-2"},Bh={class:"font-semibold text-gray-900 dark:text-gray-100"},Fh={class:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-600 text-xs font-medium text-gray-700 dark:text-gray-300"},zh={class:"flex items-center gap-2"},Uh={key:0,class:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400"},Vh={key:1,class:"absolute inset-0 bg-blue-100 dark:bg-blue-900/30 border-2 border-blue-300 rounded-lg flex items-center justify-center pointer-events-none"},Hh=["draggable","onDragstart"],Wh=qe({__name:"TodoColumn",props:{title:{},status:{},todos:{},showAddButton:{type:Boolean,default:!1},currentProjectId:{}},emits:["add","edit","delete","menu","drop"],setup(r,{emit:e}){const t=r,n=e,s=V(),i=V(!1),o=V(null),a=p=>!t.currentProjectId||p.project_id===t.currentProjectId,l=(p,m)=>{if(console.log("Drag start:",m.title,"Status:",m.status,"Column:",t.status),t.currentProjectId&&m.project_id!==t.currentProjectId){console.log("Cannot drag todo from different project:",m.project_id,"vs",t.currentProjectId),p.preventDefault();return}p.dataTransfer&&(p.dataTransfer.effectAllowed="move",p.dataTransfer.setData("text/plain",m.id),p.dataTransfer.setData("application/json",JSON.stringify(m)),o.value=m,console.log("Set draggedTodo:",o.value?.title))},c=()=>{console.log("Drag end in column:",t.status,"draggedTodo:",o.value?.title),i.value=!1,o.value&&o.value.status===t.status&&(console.log("Clearing draggedTodo in source column:",t.status),o.value=null)},u=p=>{p.preventDefault(),p.stopPropagation(),p.dataTransfer&&(p.dataTransfer.dropEffect="move"),i.value=!0,console.log("Drag over column:",t.status,"isDragOver:",i.value)},d=p=>{console.log("Drag leave column:",t.status),setTimeout(()=>{const m=p.relatedTarget;s.value?.contains(m)||(i.value=!1)},50)},h=p=>{console.log("Drop event triggered in column:",t.status),p.preventDefault(),p.stopPropagation(),i.value=!1;const m=p.dataTransfer?.getData("text/plain"),g=p.dataTransfer?.getData("application/json");if(console.log("Drop dataTransfer todoId:",m,"todoJson:",g),g)try{const y=JSON.parse(g);console.log("Parsed todo from dataTransfer:",y.title,"Status:",y.status),y.status!==t.status?(console.log("Emitting drop event:",y.title,"->",t.status),n("drop",y,t.status)):console.log("Cannot drop to same status")}catch(y){console.error("Failed to parse todo from dataTransfer:",y)}else console.log("No todo data in dataTransfer")},f=()=>{i.value=!1,o.value=null};return Bn(()=>{document.addEventListener("dragend",f)}),Mo(()=>{document.removeEventListener("dragend",f)}),(p,m)=>(A(),P("div",$h,[b("div",Lh,[b("div",jh,[b("h3",Bh,z(p.title),1),b("span",Fh,z(p.todos.length),1)]),b("div",zh,[p.showAddButton?(A(),P("button",{key:0,onClick:m[0]||(m[0]=g=>p.$emit("add")),class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors"},[U(G,{name:"Plus",class:"w-4 h-4"})])):X("",!0),b("button",{onClick:m[1]||(m[1]=g=>p.$emit("menu")),class:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors"},[U(G,{name:"MoreHorizontal",class:"w-4 h-4"})])])]),b("div",{ref_key:"dropZone",ref:s,class:On(["flex-1 p-2 bg-gray-50 dark:bg-gray-800 rounded-lg border-2 border-dashed border-gray-200 dark:border-gray-700 min-h-[400px] transition-colors relative",{"border-blue-300 bg-blue-50 dark:bg-blue-900/20":i.value,"border-gray-200 dark:border-gray-700":!i.value}]),onDragover:Ae(u,["prevent"]),onDragleave:d,onDrop:h,onDragenter:m[4]||(m[4]=Ae(()=>{},["prevent"]))},[p.todos.length===0?(A(),P("div",Uh,[U(G,{name:"Inbox",class:"w-12 h-12 mb-2 opacity-50"}),m[5]||(m[5]=b("p",{class:"text-sm text-center"},"No todos yet",-1)),m[6]||(m[6]=b("p",{class:"text-xs text-center opacity-75"},"Drag and drop here or click + to add",-1))])):X("",!0),i.value?(A(),P("div",Vh,m[7]||(m[7]=[b("div",{class:"text-blue-600 dark:text-blue-300 text-lg font-medium"}," Drop here to move todo ",-1)]))):(A(),xr(ah,{key:2,name:"todo-list",tag:"div",class:"space-y-3"},{default:cc(()=>[(A(!0),P(Xe,null,dt(p.todos,g=>(A(),P("div",{key:g.id,draggable:a(g),onDragstart:y=>l(y,g),onDragend:c,class:On(["transform transition-transform duration-200",{"hover:scale-[1.02]":a(g),"opacity-60 cursor-not-allowed":!a(g)}])},[U(Dh,{todo:g,onEdit:m[2]||(m[2]=y=>p.$emit("edit",y)),onDelete:m[3]||(m[3]=y=>p.$emit("delete",y))},null,8,["todo"])],42,Hh))),128))]),_:1}))],34)]))}}),ai=Ao(Wh,[["__scopeId","data-v-e3ad0472"]]);function fe(r){this.content=r}fe.prototype={constructor:fe,find:function(r){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===r)return e;return-1},get:function(r){var e=this.find(r);return e==-1?void 0:this.content[e+1]},update:function(r,e,t){var n=t&&t!=r?this.remove(t):this,s=n.find(r),i=n.content.slice();return s==-1?i.push(t||r,e):(i[s+1]=e,t&&(i[s]=t)),new fe(i)},remove:function(r){var e=this.find(r);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new fe(t)},addToStart:function(r,e){return new fe([r,e].concat(this.remove(r).content))},addToEnd:function(r,e){var t=this.remove(r).content.slice();return t.push(r,e),new fe(t)},addBefore:function(r,e,t){var n=this.remove(e),s=n.content.slice(),i=n.find(r);return s.splice(i==-1?s.length:i,0,e,t),new fe(s)},forEach:function(r){for(var e=0;e<this.content.length;e+=2)r(this.content[e],this.content[e+1])},prepend:function(r){return r=fe.from(r),r.size?new fe(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=fe.from(r),r.size?new fe(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var e=this;r=fe.from(r);for(var t=0;t<r.content.length;t+=2)e=e.remove(r.content[t]);return e},toObject:function(){var r={};return this.forEach(function(e,t){r[e]=t}),r},get size(){return this.content.length>>1}};fe.from=function(r){if(r instanceof fe)return r;var e=[];if(r)for(var t in r)e.push(t,r[t]);return new fe(e)};function hc(r,e,t){for(let n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;let s=r.child(n),i=e.child(n);if(s==i){t+=s.nodeSize;continue}if(!s.sameMarkup(i))return t;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)t++;return t}if(s.content.size||i.content.size){let o=hc(s.content,i.content,t+1);if(o!=null)return o}t+=s.nodeSize}}function fc(r,e,t,n){for(let s=r.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:t,b:n};let o=r.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){t-=l,n-=l;continue}if(!o.sameMarkup(a))return{a:t,b:n};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,t--,n--;return{a:t,b:n}}if(o.content.size||a.content.size){let c=fc(o.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}class x{constructor(e,t){if(this.content=e,this.size=t||0,t==null)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,s=0,i){for(let o=0,a=0;a<t;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&n(l,s+a,i||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,s+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,s){let i="",o=!0;return this.nodesBetween(e,t,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,t-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&n&&(o?o=!1:i+=n),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,s=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(n)&&(s[s.length-1]=t.withText(t.text+n.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new x(s,this.size+e.size)}cut(e,t=this.size){if(e==0&&t==this.size)return this;let n=[],s=0;if(t>e)for(let i=0,o=0;o<t;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,t-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,t-o-1))),n.push(a),s+=a.nodeSize),o=l}return new x(n,s)}cutByIndex(e,t){return e==t?x.empty:e==0&&t==this.content.length?this:new x(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let s=this.content.slice(),i=this.size+t.nodeSize-n.nodeSize;return s[e]=t,new x(s,i)}addToStart(e){return new x([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new x(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let s=this.content[t];e(s,n,t),n+=s.nodeSize}}findDiffStart(e,t=0){return hc(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return fc(this,e,t,n)}findIndex(e){if(e==0)return Ar(0,e);if(e==this.size)return Ar(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let t=0,n=0;;t++){let s=this.child(t),i=n+s.nodeSize;if(i>=e)return i==e?Ar(t+1,i):Ar(t,n);n=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,t){if(!t)return x.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new x(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return x.empty;let t,n=0;for(let s=0;s<e.length;s++){let i=e[s];n+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(t||(t=e.slice(0,s)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new x(t||e,n)}static from(e){if(!e)return x.empty;if(e instanceof x)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new x([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}x.empty=new x([],0);const li={index:0,offset:0};function Ar(r,e){return li.index=r,li.offset=e,li}function Xr(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;let t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(let n=0;n<r.length;n++)if(!Xr(r[n],e[n]))return!1}else{for(let n in r)if(!(n in e)||!Xr(r[n],e[n]))return!1;for(let n in e)if(!(n in r))return!1}return!0}let q=class Ui{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!n&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,s)),t.push(this),n=!0),t&&t.push(i)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Xr(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);let s=n.create(t.attrs);return n.checkAttrs(s.attrs),s}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Ui.none;if(e instanceof Ui)return[e];let t=e.slice();return t.sort((n,s)=>n.type.rank-s.type.rank),t}};q.none=[];class Zr extends Error{}class _{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=mc(this.content,e+this.openStart,t);return n&&new _(n,this.openStart,this.openEnd)}removeBetween(e,t){return new _(pc(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return _.empty;let n=t.openStart||0,s=t.openEnd||0;if(typeof n!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new _(x.fromJSON(e,t.content),n,s)}static maxOpen(e,t=!0){let n=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)n++;for(let i=e.lastChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.lastChild)s++;return new _(e,n,s)}}_.empty=new _(x.empty,0,0);function pc(r,e,t){let{index:n,offset:s}=r.findIndex(e),i=r.maybeChild(n),{index:o,offset:a}=r.findIndex(t);if(s==e||i.isText){if(a!=t&&!r.child(o).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(n!=o)throw new RangeError("Removing non-flat range");return r.replaceChild(n,i.copy(pc(i.content,e-s-1,t-s-1)))}function mc(r,e,t,n){let{index:s,offset:i}=r.findIndex(e),o=r.maybeChild(s);if(i==e||o.isText)return n&&!n.canReplace(s,s,t)?null:r.cut(0,e).append(t).append(r.cut(e));let a=mc(o.content,e-i-1,t,o);return a&&r.replaceChild(s,o.copy(a))}function qh(r,e,t){if(t.openStart>r.depth)throw new Zr("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new Zr("Inconsistent open depths");return gc(r,e,t,0)}function gc(r,e,t,n){let s=r.index(n),i=r.node(n);if(s==e.index(n)&&n<r.depth-t.openStart){let o=gc(r,e,t,n+1);return i.copy(i.content.replaceChild(s,o))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){let o=r.parent,a=o.content;return Yt(o,a.cut(0,r.parentOffset).append(t.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=Kh(t,r);return Yt(i,bc(r,o,a,e,n))}else return Yt(i,es(r,e,n))}function yc(r,e){if(!e.type.compatibleContent(r.type))throw new Zr("Cannot join "+e.type.name+" onto "+r.type.name)}function Vi(r,e,t){let n=r.node(t);return yc(n,e.node(t)),n}function Gt(r,e){let t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function Qn(r,e,t,n){let s=(e||r).node(t),i=0,o=e?e.index(t):s.childCount;r&&(i=r.index(t),r.depth>t?i++:r.textOffset&&(Gt(r.nodeAfter,n),i++));for(let a=i;a<o;a++)Gt(s.child(a),n);e&&e.depth==t&&e.textOffset&&Gt(e.nodeBefore,n)}function Yt(r,e){return r.type.checkContent(e),r.copy(e)}function bc(r,e,t,n,s){let i=r.depth>s&&Vi(r,e,s+1),o=n.depth>s&&Vi(t,n,s+1),a=[];return Qn(null,r,s,a),i&&o&&e.index(s)==t.index(s)?(yc(i,o),Gt(Yt(i,bc(r,e,t,n,s+1)),a)):(i&&Gt(Yt(i,es(r,e,s+1)),a),Qn(e,t,s,a),o&&Gt(Yt(o,es(t,n,s+1)),a)),Qn(n,null,s,a),new x(a)}function es(r,e,t){let n=[];if(Qn(null,r,t,n),r.depth>t){let s=Vi(r,e,t+1);Gt(Yt(s,es(r,e,t+1)),n)}return Qn(e,null,t,n),new x(n)}function Kh(r,e){let t=e.depth-r.openStart,s=e.node(t).copy(r.content);for(let i=t-1;i>=0;i--)s=e.node(i).copy(x.from(s));return{start:s.resolveNoCache(r.openStart+t),end:s.resolveNoCache(s.content.size-r.openEnd-t)}}class ur{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],s=e.child(t);return n?e.child(t).cut(n):s}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):e==0?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[t*3],s=t==0?0:this.path[t*3-1]+1;for(let i=0;i<e;i++)s+=n.child(i).nodeSize;return s}marks(){let e=this.parent,t=this.index();if(e.content.size==0)return q.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),s=e.maybeChild(t);if(!n){let a=n;n=s,s=a}let i=n.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<n.length;i++)n[i].type.spec.inclusive===!1&&(!s||!n[i].isInSet(s.marks))&&(n=n[i--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new ts(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],s=0,i=t;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),c=i-l;if(n.push(o,a,s+l),!c||(o=o.child(a),o.isText))break;i=c-1,s+=l+1}return new ur(t,n,i)}static resolveCached(e,t){let n=va.get(e);if(n)for(let i=0;i<n.elts.length;i++){let o=n.elts[i];if(o.pos==t)return o}else va.set(e,n=new Jh);let s=n.elts[n.i]=ur.resolve(e,t);return n.i=(n.i+1)%Gh,s}}class Jh{constructor(){this.elts=[],this.i=0}}const Gh=12,va=new WeakMap;class ts{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Yh=Object.create(null);class He{constructor(e,t,n,s=q.none){this.type=e,this.attrs=t,this.marks=s,this.content=n||x.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,s=0){this.content.nodesBetween(e,t,n,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,s){return this.content.textBetween(e,t,n,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&Xr(this.attrs,t||e.defaultAttrs||Yh)&&q.sameSet(this.marks,n||q.none)}copy(e=null){return e==this.content?this:new He(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new He(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return _.empty;let s=this.resolve(e),i=this.resolve(t),o=n?0:s.sharedDepth(t),a=s.start(o),c=s.node(o).content.cut(s.pos-a,i.pos-a);return new _(c,s.depth-o,i.depth-o)}replace(e,t,n){return qh(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:s}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(s==e||t.isText)return t;e-=s+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let s=this.content.child(t-1);return{node:s,index:t-1,offset:n-s.nodeSize}}resolve(e){return ur.resolveCached(this,e)}resolveNoCache(e){return ur.resolve(this,e)}rangeHasMark(e,t,n){let s=!1;return t>e&&this.nodesBetween(e,t,i=>(n.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),vc(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=x.empty,s=0,i=n.childCount){let o=this.contentMatchAt(e).matchFragment(n,s,i),a=o&&o.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0}canReplaceWith(e,t,n,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(n),o=i&&i.matchFragment(this.content,t);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=q.none;for(let t=0;t<this.marks.length;t++){let n=this.marks[t];n.type.checkAttrs(n.attrs),e=n.addToSet(e)}if(!q.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(t=>t.type.name)}`);this.content.forEach(t=>t.check())}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(t=>t.toJSON())),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let s=x.fromJSON(e,t.content),i=e.nodeType(t.type).create(t.attrs,s,n);return i.type.checkAttrs(i.attrs),i}}He.prototype.text=void 0;class ns extends He{constructor(e,t,n,s){if(super(e,t,null,s),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):vc(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new ns(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new ns(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return e==0&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function vc(r,e){for(let t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}class en{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new Qh(e,t);if(n.next==null)return en.empty;let s=wc(n);n.next&&n.err("Unexpected trailing text");let i=sf(rf(s));return of(i,n),i}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let s=this;for(let i=t;s&&i<n;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!(t.isText||t.hasRequiredAttrs()))return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let s=[this];function i(o,a){let l=o.matchFragment(e,n);if(l&&(!t||l.validEnd))return x.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&s.indexOf(d)==-1){s.push(d);let h=i(d,a.concat(u));if(h)return h}}return null}return i(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let s=n.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in t)&&(!s.type||l.validEnd)&&(n.push({match:a.contentMatch,type:a,via:s}),t[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let s=0;s<n.next.length;s++)e.indexOf(n.next[s].next)==-1&&t(n.next[s].next)}return t(this),e.map((n,s)=>{let i=s+(n.validEnd?"*":" ")+" ";for(let o=0;o<n.next.length;o++)i+=(o?", ":"")+n.next[o].type.name+"->"+e.indexOf(n.next[o].next);return i}).join(`
`)}}en.empty=new en(!0);class Qh{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function wc(r){let e=[];do e.push(Xh(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Xh(r){let e=[];do e.push(Zh(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Zh(r){let e=nf(r);for(;;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=ef(r,e);else break;return e}function wa(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let e=Number(r.next);return r.pos++,e}function ef(r,e){let t=wa(r),n=t;return r.eat(",")&&(r.next!="}"?n=wa(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function tf(r,e){let t=r.nodeTypes,n=t[e];if(n)return[n];let s=[];for(let i in t){let o=t[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&r.err("No node type or group '"+e+"' found"),s}function nf(r){if(r.eat("(")){let e=wc(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let e=tf(r,r.next).map(t=>(r.inline==null?r.inline=t.isInline:r.inline!=t.isInline&&r.err("Mixing inline and block content"),{type:"name",value:t}));return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function rf(r){let e=[[]];return s(i(r,0),t()),e;function t(){return e.push([])-1}function n(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(i(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=i(o.exprs[l],a);if(l==o.exprs.length-1)return c;s(c,a=t())}else if(o.type=="star"){let l=t();return n(a,l),s(i(o.expr,l),l),[n(l)]}else if(o.type=="plus"){let l=t();return s(i(o.expr,a),l),s(i(o.expr,l),l),[n(l)]}else{if(o.type=="opt")return[n(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=t();s(i(o.expr,l),u),l=u}if(o.max==-1)s(i(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=t();n(l,u),s(i(o.expr,l),u),l=u}return[n(l)]}else{if(o.type=="name")return[n(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function kc(r,e){return e-r}function ka(r,e){let t=[];return n(e),t.sort(kc);function n(s){let i=r[s];if(i.length==1&&!i[0].term)return n(i[0].to);t.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&t.indexOf(l)==-1&&n(l)}}}function sf(r){let e=Object.create(null);return t(ka(r,0));function t(n){let s=[];n.forEach(o=>{r[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<s.length;u++)s[u][0]==a&&(c=s[u][1]);ka(r,l).forEach(u=>{c||s.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let i=e[n.join(",")]=new en(n.indexOf(r.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(kc);i.next.push({type:s[o][0],next:e[a.join(",")]||t(a)})}return i}}function of(r,e){for(let t=0,n=[r];t<n.length;t++){let s=n[t],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:c}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),n.indexOf(c)==-1&&n.push(c)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function xc(r){let e=Object.create(null);for(let t in r){let n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function Sc(r,e){let t=Object.create(null);for(let n in r){let s=e&&e[n];if(s===void 0){let i=r[n];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=s}return t}function Tc(r,e,t,n){for(let s in e)if(!(s in r))throw new RangeError(`Unsupported attribute ${s} for ${t} of type ${s}`);for(let s in r){let i=r[s];i.validate&&i.validate(e[s])}}function Cc(r,e){let t=Object.create(null);if(e)for(let n in e)t[n]=new lf(r,n,e[n]);return t}let xa=class _c{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Cc(e,n.attrs),this.defaultAttrs=xc(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==en.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Sc(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new He(this,this.computeAttrs(e),x.from(t),q.setFrom(n))}createChecked(e=null,t,n){return t=x.from(t),this.checkContent(t),new He(this,this.computeAttrs(e),t,q.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=x.from(t),t.size){let o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}let s=this.contentMatch.matchFragment(t),i=s&&s.fillBefore(x.empty,!0);return i?new He(this,e,t.append(i),q.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Tc(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:q.none:e}static compile(e,t){let n=Object.create(null);e.forEach((i,o)=>n[i]=new _c(i,t,o));let s=t.spec.topNode||"doc";if(!n[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let i in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}};function af(r,e,t){let n=t.split("|");return s=>{let i=s===null?"null":typeof s;if(n.indexOf(i)<0)throw new RangeError(`Expected value of type ${n} for attribute ${e} on type ${r}, got ${i}`)}}class lf{constructor(e,t,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate=typeof n.validate=="string"?af(e,t,n.validate):n.validate}get isRequired(){return!this.hasDefault}}class Vs{constructor(e,t,n,s){this.name=e,this.rank=t,this.schema=n,this.spec=s,this.attrs=Cc(e,s.attrs),this.excluded=null;let i=xc(this.attrs);this.instance=i?new q(this,i):null}create(e=null){return!e&&this.instance?this.instance:new q(this,Sc(this.attrs,e))}static compile(e,t){let n=Object.create(null),s=0;return e.forEach((i,o)=>n[i]=new Vs(i,s++,t,o)),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}checkAttrs(e){Tc(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Ec{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let t=this.spec={};for(let s in e)t[s]=e[s];t.nodes=fe.from(e.nodes),t.marks=fe.from(e.marks||{}),this.nodes=xa.compile(this.spec.nodes,this),this.marks=Vs.compile(this.spec.marks,this);let n=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=n[o]||(n[o]=en.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?Sa(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:Sa(this,o.split(" "))}this.nodeFromJSON=s=>He.fromJSON(this,s),this.markFromJSON=s=>q.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof xa){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,s)}text(e,t){let n=this.nodes.text;return new ns(n,n.defaultAttrs,e,q.setFrom(t))}mark(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function Sa(r,e){let t=[];for(let n=0;n<e.length;n++){let s=e[n],i=r.marks[s],o=i;if(i)t.push(i);else for(let a in r.marks){let l=r.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&t.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}function cf(r){return r.tag!=null}function uf(r){return r.style!=null}class Ot{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[];let n=this.matchedStyles=[];t.forEach(s=>{if(cf(s))this.tags.push(s);else if(uf(s)){let i=/[^=]*/.exec(s.style)[0];n.indexOf(i)<0&&n.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,t={}){let n=new Ca(this,t,!1);return n.addAll(e,q.none,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new Ca(this,t,!0);return n.addAll(e,q.none,t.from,t.to),_.maxOpen(n.finish())}matchTag(e,t,n){for(let s=n?this.tags.indexOf(n)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(ff(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,t,n,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!n.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=t))){if(o.getAttrs){let l=o.getAttrs(t);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let t=[];function n(s){let i=s.priority==null?50:s.priority,o=0;for(;o<t.length;o++){let a=t[o];if((a.priority==null?50:a.priority)<i)break}t.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{n(o=_a(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{n(o=_a(o)),o.node||o.ignore||o.mark||(o.node=s)})}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ot(e,Ot.schemaRules(e)))}}const Oc={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},df={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Ac={ol:!0,ul:!0},dr=1,Hi=2,Xn=4;function Ta(r,e,t){return e!=null?(e?dr:0)|(e==="full"?Hi:0):r&&r.whitespace=="pre"?dr|Hi:t&~Xn}class Mr{constructor(e,t,n,s,i,o){this.type=e,this.attrs=t,this.marks=n,this.solid=s,this.options=o,this.content=[],this.activeMarks=q.none,this.match=i||(o&Xn?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(x.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{let n=this.type.contentMatch,s;return(s=n.findWrapping(e.type))?(this.match=n,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&dr)){let n=this.content[this.content.length-1],s;if(n&&n.isText&&(s=/[ \t\r\n\u000c]+$/.exec(n.text))){let i=n;n.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let t=x.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(x.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Oc.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Ca{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0,this.localPreserveWS=!1;let s=t.topNode,i,o=Ta(null,t.preserveWhitespace,0)|(n?Xn:0);s?i=new Mr(s.type,s.attrs,q.none,!0,t.topMatch||s.type.contentMatch,o):n?i=new Mr(null,null,q.none,!0,null,o):i=new Mr(e.schema.topNodeType,null,q.none,!0,null,o),this.nodes=[i],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,t){e.nodeType==3?this.addTextNode(e,t):e.nodeType==1&&this.addElement(e,t)}addTextNode(e,t){let n=e.nodeValue,s=this.top,i=s.options&Hi?"full":this.localPreserveWS||(s.options&dr)>0;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(n)){if(i)i!=="full"?n=n.replace(/\r?\n|\r/g," "):n=n.replace(/\r\n?/g,`
`);else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){let o=s.content[s.content.length-1],a=e.previousSibling;(!o||a&&a.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(n=n.slice(1))}n&&this.insertNode(this.parser.schema.text(n),t,!/\S/.test(n)),this.findInText(e)}else this.findInside(e)}addElement(e,t,n){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Ac.hasOwnProperty(o)&&this.parser.normalizeLists&&hf(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,n));e:if(l?l.ignore:df.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,t);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(Oc.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,t);break e}let d=l&&l.skip?t:this.readStyles(e,t);d&&this.addAll(e,d),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,t);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,t){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),t)}ignoreFallback(e,t){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),t,!0)}readStyles(e,t){let n=e.style;if(n&&n.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=n.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?t=t.filter(c=>!l.clearMark(c)):t=t.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return t}addElementByRule(e,t,n,s){let i,o;if(t.node)if(o=this.parser.schema.nodes[t.node],o.isLeaf)this.insertNode(o.create(t.attrs),n,e.nodeName=="BR")||this.leafFallback(e,n);else{let l=this.enter(o,t.attrs||null,n,t.preserveWhitespace);l&&(i=!0,n=l)}else{let l=this.parser.schema.marks[t.mark];n=n.concat(l.create(t.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,n,s);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,n,!1));else{let l=e;typeof t.contentElement=="string"?l=e.querySelector(t.contentElement):typeof t.contentElement=="function"?l=t.contentElement(e):t.contentElement&&(l=t.contentElement),this.findAround(e,l,!0),this.addAll(l,n),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,t,n,s){let i=n||0;for(let o=n?e.childNodes[n]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,t);this.findAtPoint(e,i)}findPlace(e,t,n){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!s||s.length>c.length+a)&&(s=c,i=l,!c.length))break;if(l.solid){if(n)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)t=this.enterInner(s[o],null,t,!1);return t}insertNode(e,t,n){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(t=this.enterInner(i,null,t))}let s=this.findPlace(e,t,n);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=q.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):Ea(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,t,n,s){let i=this.findPlace(e.create(t),n,!1);return i&&(i=this.enterInner(e,t,n,!0,s)),i}enterInner(e,t,n,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=Ta(e,i,o.options);o.options&Xn&&o.content.length==0&&(a|=Xn);let l=q.none;return n=n.filter(c=>(o.type?o.type.allowsMarkType(c.type):Ea(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Mr(e,t,l,s,null,a)),this.open++,n}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let t=this.open;t>=0;t--){if(this.nodes[t]==e)return this.open=t,!0;this.localPreserveWS&&(this.nodes[t].options|=dr)}return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let s=n.length-1;s>=0;s--)e+=n[s].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&t.compareDocumentPosition(this.find[s].node)&(n?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,s=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),i=-(n?n.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let c=t[a];if(c==""){if(a==t.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&s?this.nodes[l].type:n&&l>=i?n.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let n=this.parser.schema.nodes[t];if(n.isTextblock&&n.defaultAttrs)return n}}}function hf(r){for(let e=r.firstChild,t=null;e;e=e.nextSibling){let n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Ac.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function ff(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function _a(r){let e={};for(let t in r)e[t]=r[t];return e}function Ea(r,e){let t=e.schema.nodes;for(let n in t){let s=t[n];if(!s.allowsMarkType(r))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&o(u))return!0}};if(o(s.contentMatch))return!0}}class on{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=ci(t).createDocumentFragment());let s=n,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,t);u&&(i.push([c,s]),s.appendChild(u.dom),s=u.contentDOM||u.dom)}}s.appendChild(this.serializeNodeInner(o,t))}),n}serializeNodeInner(e,t){let{dom:n,contentDOM:s}=Wr(ci(t),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,s)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(e,t,n={}){let s=this.marks[e.type.name];return s&&Wr(ci(n),s(e,t),null,e.attrs)}static renderSpec(e,t,n=null,s){return Wr(e,t,n,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new on(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=Oa(e.nodes);return t.text||(t.text=n=>n.text),t}static marksFromSchema(e){return Oa(e.marks)}}function Oa(r){let e={};for(let t in r){let n=r[t].spec.toDOM;n&&(e[t]=n)}return e}function ci(r){return r.document||window.document}const Aa=new WeakMap;function pf(r){let e=Aa.get(r);return e===void 0&&Aa.set(r,e=mf(r)),e}function mf(r){let e=null;function t(n){if(n&&typeof n=="object")if(Array.isArray(n))if(typeof n[0]=="string")e||(e=[]),e.push(n);else for(let s=0;s<n.length;s++)t(n[s]);else for(let s in n)t(n[s])}return t(r),e}function Wr(r,e,t,n){if(typeof e=="string")return{dom:r.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(n&&(i=pf(n))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(t=s.slice(0,o),s=s.slice(o+1));let a,l=t?r.createElementNS(t,s):r.createElement(s),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let h=e[d];if(h===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:p}=Wr(r,h,t,n);if(l.appendChild(f),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const Mc=65535,Pc=Math.pow(2,16);function gf(r,e){return r+e*Pc}function Ma(r){return r&Mc}function yf(r){return(r-(r&Mc))/Pc}const Ic=1,Nc=2,qr=4,Rc=8;class Wi{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&Rc)>0}get deletedBefore(){return(this.delInfo&(Ic|qr))>0}get deletedAfter(){return(this.delInfo&(Nc|qr))>0}get deletedAcross(){return(this.delInfo&qr)>0}}class Me{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&Me.empty)return Me.empty}recover(e){let t=0,n=Ma(e);if(!this.inverted)for(let s=0;s<n;s++)t+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[n*3]+t+yf(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:t:t,f=l+s+(h<0?0:u);if(n)return f;let p=e==(t<0?l:d)?null:gf(a/3,e-l),m=e==l?Nc:e==d?Ic:qr;return(t<0?e!=l:e!=d)&&(m|=Rc),new Wi(f,m,p)}s+=u-c}return n?e+s:new Wi(e+s,0,null)}touches(e,t){let n=0,s=Ma(t),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==s*3)return!0;n+=this.ranges[a+o]-c}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),c=this.ranges[s+t],u=this.ranges[s+n];e(a,a+c,l,l+u),i+=u-c}}invert(){return new Me(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Me.empty:new Me(e<0?[0,-e,0]:[0,0,e])}}Me.empty=new Me([]);class hr{constructor(e,t,n=0,s=e?e.length:0){this.mirror=t,this.from=n,this.to=s,this._maps=e||[],this.ownData=!(e||t)}get maps(){return this._maps}slice(e=0,t=this.maps.length){return new hr(this._maps,this.mirror,e,t)}appendMap(e,t){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),t!=null&&this.setMirror(this._maps.length-1,t)}appendMapping(e){for(let t=0,n=this._maps.length;t<e._maps.length;t++){let s=e.getMirror(t);this.appendMap(e._maps[t],s!=null&&s<t?n+s:void 0)}}getMirror(e){if(this.mirror){for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this._maps.length+e._maps.length;t>=0;t--){let s=e.getMirror(t);this.appendMap(e._maps[t].invert(),s!=null&&s>t?n-s-1:void 0)}}invert(){let e=new hr;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this._maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,t);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return n?e:new Wi(e,s,null)}}const ui=Object.create(null);class ve{getMap(){return Me.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=ui[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in ui)throw new RangeError("Duplicate use of step JSON ID "+e);return ui[e]=t,t.prototype.jsonID=e,t}}class re{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new re(e,null)}static fail(e){return new re(null,e)}static fromReplace(e,t,n,s){try{return re.ok(e.replace(t,n,s))}catch(i){if(i instanceof Zr)return re.fail(i.message);throw i}}}function Po(r,e,t){let n=[];for(let s=0;s<r.childCount;s++){let i=r.child(s);i.content.size&&(i=i.copy(Po(i.content,e,i))),i.isInline&&(i=e(i,t,s)),n.push(i)}return x.fromArray(n)}class Tt extends ve{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),i=new _(Po(t.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),t.openStart,t.openEnd);return re.fromReplace(e,this.from,this.to,i)}invert(){return new Ve(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Tt(t.pos,n.pos,this.mark)}merge(e){return e instanceof Tt&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Tt(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Tt(t.from,t.to,e.markFromJSON(t.mark))}}ve.jsonID("addMark",Tt);class Ve extends ve{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new _(Po(t.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),t.openStart,t.openEnd);return re.fromReplace(e,this.from,this.to,n)}invert(){return new Tt(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new Ve(t.pos,n.pos,this.mark)}merge(e){return e instanceof Ve&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ve(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ve(t.from,t.to,e.markFromJSON(t.mark))}}ve.jsonID("removeMark",Ve);class Ct extends ve{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return re.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return re.fromReplace(e,this.pos,this.pos+1,new _(x.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let n=this.mark.addToSet(t.marks);if(n.length==t.marks.length){for(let s=0;s<t.marks.length;s++)if(!t.marks[s].isInSet(n))return new Ct(this.pos,t.marks[s]);return new Ct(this.pos,this.mark)}}return new tn(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Ct(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Ct(t.pos,e.markFromJSON(t.mark))}}ve.jsonID("addNodeMark",Ct);class tn extends ve{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return re.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return re.fromReplace(e,this.pos,this.pos+1,new _(x.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return!t||!this.mark.isInSet(t.marks)?this:new Ct(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new tn(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new tn(t.pos,e.markFromJSON(t.mark))}}ve.jsonID("removeNodeMark",tn);class ce extends ve{constructor(e,t,n,s=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=s}apply(e){return this.structure&&qi(e,this.from,this.to)?re.fail("Structure replace would overwrite content"):re.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Me([this.from,this.to-this.from,this.slice.size])}invert(e){return new ce(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new ce(t.pos,Math.max(t.pos,n.pos),this.slice,this.structure)}merge(e){if(!(e instanceof ce)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let t=this.slice.size+e.slice.size==0?_.empty:new _(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new ce(this.from,this.to+(e.to-e.from),t,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let t=this.slice.size+e.slice.size==0?_.empty:new _(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new ce(e.from,this.to,t,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ce(t.from,t.to,_.fromJSON(e,t.slice),!!t.structure)}}ve.jsonID("replace",ce);class ue extends ve{constructor(e,t,n,s,i,o,a=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(qi(e,this.from,this.gapFrom)||qi(e,this.gapTo,this.to)))return re.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return re.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?re.fromReplace(e,this.from,this.to,n):re.fail("Content does not fit in gap")}getMap(){return new Me([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new ue(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),s=this.from==this.gapFrom?t.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?n.pos:e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||s<t.pos||i>n.pos?null:new ue(t.pos,n.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if(typeof t.from!="number"||typeof t.to!="number"||typeof t.gapFrom!="number"||typeof t.gapTo!="number"||typeof t.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ue(t.from,t.to,t.gapFrom,t.gapTo,_.fromJSON(e,t.slice),t.insert,!!t.structure)}}ve.jsonID("replaceAround",ue);function qi(r,e,t){let n=r.resolve(e),s=t-e,i=n.depth;for(;s>0&&i>0&&n.indexAfter(i)==n.node(i).childCount;)i--,s--;if(s>0){let o=n.node(i).maybeChild(n.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function bf(r,e,t,n){let s=[],i=[],o,a;r.doc.nodesBetween(e,t,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!n.isInSet(d)&&u.type.allowsMarkType(n.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,t),p=n.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:s.push(o=new Ve(h,f,d[m])));a&&a.to==h?a.to=f:i.push(a=new Tt(h,f,n))}}),s.forEach(l=>r.step(l)),i.forEach(l=>r.step(l))}function vf(r,e,t,n){let s=[],i=0;r.doc.nodesBetween(e,t,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(n instanceof Vs){let c=o.marks,u;for(;u=n.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else n?n.isInSet(o.marks)&&(l=[n]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,t);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<s.length;f++){let p=s[f];p.step==i-1&&d.eq(s[f].style)&&(h=p)}h?(h.to=c,h.step=i):s.push({style:d,from:Math.max(a,e),to:c,step:i})}}}),s.forEach(o=>r.step(new Ve(o.from,o.to,o.style)))}function Io(r,e,t,n=t.contentMatch,s=!0){let i=r.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let c=i.child(l),u=a+c.nodeSize,d=n.matchType(c.type);if(!d)o.push(new ce(a,u,_.empty));else{n=d;for(let h=0;h<c.marks.length;h++)t.allowsMarkType(c.marks[h].type)||r.step(new Ve(a,u,c.marks[h]));if(s&&c.isText&&t.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new _(x.from(t.schema.text(" ",t.allowedMarks(c.marks))),0,0)),o.push(new ce(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!n.validEnd){let l=n.fillBefore(x.empty,!0);r.replace(a,a,new _(l,0,0))}for(let l=o.length-1;l>=0;l--)r.step(o[l])}function wf(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function Fn(r){let t=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let n=r.depth;;--n){let s=r.$from.node(n),i=r.$from.index(n),o=r.$to.indexAfter(n);if(n<r.depth&&s.canReplace(i,o,t))return n;if(n==0||s.type.spec.isolating||!wf(s,i,o))break}return null}function kf(r,e,t){let{$from:n,$to:s,depth:i}=e,o=n.before(i+1),a=s.after(i+1),l=o,c=a,u=x.empty,d=0;for(let p=i,m=!1;p>t;p--)m||n.index(p)>0?(m=!0,u=x.from(n.node(p).copy(u)),d++):l--;let h=x.empty,f=0;for(let p=i,m=!1;p>t;p--)m||s.after(p+1)<s.end(p)?(m=!0,h=x.from(s.node(p).copy(h)),f++):c++;r.step(new ue(l,c,o,a,new _(u.append(h),d,f),u.size-d,!0))}function No(r,e,t=null,n=r){let s=xf(r,e),i=s&&Sf(n,e);return i?s.map(Pa).concat({type:e,attrs:t}).concat(i.map(Pa)):null}function Pa(r){return{type:r,attrs:null}}function xf(r,e){let{parent:t,startIndex:n,endIndex:s}=r,i=t.contentMatchAt(n).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return t.canReplaceWith(n,s,o)?i:null}function Sf(r,e){let{parent:t,startIndex:n,endIndex:s}=r,i=t.child(n),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=n;l&&c<s;c++)l=l.matchType(t.child(c).type);return!l||!l.validEnd?null:o}function Tf(r,e,t){let n=x.empty;for(let o=t.length-1;o>=0;o--){if(n.size){let a=t[o].type.contentMatch.matchFragment(n);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}n=x.from(t[o].type.create(t[o].attrs,n))}let s=e.start,i=e.end;r.step(new ue(s,i,s,i,new _(n,0,0),t.length,!0))}function Cf(r,e,t,n,s){if(!n.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=r.steps.length;r.doc.nodesBetween(e,t,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(n,l)&&_f(r.doc,r.mapping.slice(i).map(a),n)){let c=null;if(n.schema.linebreakReplacement){let f=n.whitespace=="pre",p=!!n.contentMatch.matchType(n.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&$c(r,o,a,i),Io(r,r.mapping.slice(i).map(a,1),n,void 0,c===null);let u=r.mapping.slice(i),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return r.step(new ue(d,h,d+1,h-1,new _(x.from(n.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Dc(r,o,a,i),!1}})}function Dc(r,e,t,n){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=r.mapping.slice(n).map(t+1+i+o.index);r.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function $c(r,e,t,n){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=r.mapping.slice(n).map(t+1+i);r.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function _f(r,e,t){let n=r.resolve(e),s=n.index();return n.parent.canReplaceWith(s,s+1,t)}function Ef(r,e,t,n,s){let i=r.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");t||(t=i.type);let o=t.create(n,null,s||i.marks);if(i.isLeaf)return r.replaceWith(e,e+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);r.step(new ue(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new _(x.from(o),0,0),1,!0))}function ct(r,e,t=1,n){let s=r.resolve(e),i=s.depth-t,o=n&&n[n.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let c=s.depth-1,u=t-2;c>i;c--,u--){let d=s.node(c),h=s.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=n&&n[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=n&&n[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=s.indexAfter(i),l=n&&n[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function Of(r,e,t=1,n){let s=r.doc.resolve(e),i=x.empty,o=x.empty;for(let a=s.depth,l=s.depth-t,c=t-1;a>l;a--,c--){i=x.from(s.node(a).copy(i));let u=n&&n[c];o=x.from(u?u.type.create(u.attrs,o):s.node(a).copy(o))}r.step(new ce(e,e,new _(i.append(o),t,t),!0))}function Rt(r,e){let t=r.resolve(e),n=t.index();return Lc(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function Af(r,e){e.content.size||r.type.compatibleContent(e.type);let t=r.contentMatchAt(r.childCount),{linebreakReplacement:n}=r.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==n?r.type.schema.nodes.text:i.type;if(t=t.matchType(o),!t||!r.type.allowsMarks(i.marks))return!1}return t.validEnd}function Lc(r,e){return!!(r&&e&&!r.isLeaf&&Af(r,e))}function Hs(r,e,t=-1){let n=r.resolve(e);for(let s=n.depth;;s--){let i,o,a=n.index(s);if(s==n.depth?(i=n.nodeBefore,o=n.nodeAfter):t>0?(i=n.node(s+1),a++,o=n.node(s).maybeChild(a)):(i=n.node(s).maybeChild(a-1),o=n.node(s+1)),i&&!i.isTextblock&&Lc(i,o)&&n.node(s).canReplace(a,a+1))return e;if(s==0)break;e=t<0?n.before(s):n.after(s)}}function Mf(r,e,t){let n=null,{linebreakReplacement:s}=r.doc.type.schema,i=r.doc.resolve(e-t),o=i.node().type;if(s&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(s);u&&!d?n=!1:!u&&d&&(n=!0)}let a=r.steps.length;if(n===!1){let u=r.doc.resolve(e+t);$c(r,u.node(),u.before(),a)}o.inlineContent&&Io(r,e+t-1,o,i.node().contentMatchAt(i.index()),n==null);let l=r.mapping.slice(a),c=l.map(e-t);if(r.step(new ce(c,l.map(e+t,-1),_.empty,!0)),n===!0){let u=r.doc.resolve(c);Dc(r,u.node(),u.before(),r.steps.length)}return r}function Pf(r,e,t){let n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(let s=n.depth-1;s>=0;s--){let i=n.index(s);if(n.node(s).canReplaceWith(i,i,t))return n.before(s+1);if(i>0)return null}if(n.parentOffset==n.parent.content.size)for(let s=n.depth-1;s>=0;s--){let i=n.indexAfter(s);if(n.node(s).canReplaceWith(i,i,t))return n.after(s+1);if(i<n.node(s).childCount)return null}return null}function jc(r,e,t){let n=r.resolve(e);if(!t.content.size)return e;let s=t.content;for(let i=0;i<t.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(t.openStart==0&&t.size?2:1);i++)for(let o=n.depth;o>=0;o--){let a=o==n.depth?0:n.pos<=(n.start(o+1)+n.end(o+1))/2?-1:1,l=n.index(o)+(a>0?1:0),c=n.node(o),u=!1;if(i==1)u=c.canReplace(l,l,s);else{let d=c.contentMatchAt(l).findWrapping(s.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?n.pos:a<0?n.before(o+1):n.after(o+1)}return null}function Ws(r,e,t=e,n=_.empty){if(e==t&&!n.size)return null;let s=r.resolve(e),i=r.resolve(t);return Bc(s,i,n)?new ce(e,t,n):new If(s,i,n).fit()}function Bc(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}class If{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=x.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=x.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,s=this.close(e<0?this.$to:n.doc.resolve(e));if(!s)return null;let i=this.placed,o=n.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new _(i,o,a);return e>-1?new ue(n.pos,e,this.$to.pos,this.$to.end(),l,t):l.size||n.pos!=this.$to.pos?new ce(n.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,s=this.unplaced.openEnd;n<e;n++){let i=t.firstChild;if(t.childCount>1&&(s=0),i.type.spec.isolating&&s<=n){e=n;break}t=i.content}for(let t=1;t<=2;t++)for(let n=t==1?e:this.unplaced.openStart;n>=0;n--){let s,i=null;n?(i=di(this.unplaced.content,n-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(t==1&&(o?c.matchType(o.type)||(d=c.fillBefore(x.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:a,parent:i,inject:d};if(t==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:n,frontierDepth:a,parent:i,wrap:u};if(i&&c.matchType(i.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=di(e,t);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new _(e,t+1,Math.max(n,s.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=di(e,t);if(s.childCount<=1&&t>0){let i=e.size-t<=t+s.size;this.unplaced=new _(Wn(e,t-1,1),t-1,i?t-1:n)}else this.unplaced=new _(Wn(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:s,wrap:i}){for(;this.depth>t;)this.closeFrontierNode();if(i)for(let m=0;m<i.length;m++)this.openFrontierNode(i[m]);let o=this.unplaced,a=n?n.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[t];if(s){for(let m=0;m<s.childCount;m++)u.push(s.child(m));d=d.matchFragment(s)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(Fc(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=qn(this.placed,t,x.from(u)),this.frontier[t].match=d,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?_.empty:new _(Wn(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new _(Wn(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],t;if(!e.type.isTextblock||!hi(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,s=this.$to.after(n);for(;n>1&&s==this.$to.end(--n);)++s;return s}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:s}=this.frontier[t],i=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),o=hi(e,t,s,n,i);if(o){for(let a=t-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=hi(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:t,fit:o,move:i?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=qn(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let s=e.node(n),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(n));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,t=null,n){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=qn(this.placed,this.depth,x.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(x.empty,!0);t.childCount&&(this.placed=qn(this.placed,this.frontier.length,t))}}function Wn(r,e,t){return e==0?r.cutByIndex(t,r.childCount):r.replaceChild(0,r.firstChild.copy(Wn(r.firstChild.content,e-1,t)))}function qn(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(qn(r.lastChild.content,e-1,t)))}function di(r,e){for(let t=0;t<e;t++)r=r.firstChild.content;return r}function Fc(r,e,t){if(e<=0)return r;let n=r.content;return e>1&&(n=n.replaceChild(0,Fc(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(x.empty,!0)))),r.copy(n)}function hi(r,e,t,n,s){let i=r.node(e),o=s?r.indexAfter(e):r.index(e);if(o==i.childCount&&!t.compatibleContent(i.type))return null;let a=n.fillBefore(i.content,!0,o);return a&&!Nf(t,i.content,o)?a:null}function Nf(r,e,t){for(let n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function Rf(r){return r.spec.defining||r.spec.definingForContent}function Df(r,e,t,n){if(!n.size)return r.deleteRange(e,t);let s=r.doc.resolve(e),i=r.doc.resolve(t);if(Bc(s,i,n))return r.step(new ce(e,t,n));let o=Uc(s,r.doc.resolve(t));o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let h=s.depth,f=s.pos-1;h>0;h--,f--){let p=s.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:s.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=n.openStart;for(let h=n.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==n.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=Rf(f.type);if(p&&!f.sameMarkup(s.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=n.openStart;h>=0;h--){let f=(h+u+1)%(n.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let v=s.node(g-1),k=s.index(g-1);if(v.canReplaceWith(k,k,p.type,p.marks))return r.replace(s.before(g),y?i.after(g):t,new _(zc(n.content,0,n.openStart,f),f,n.openEnd))}}let d=r.steps.length;for(let h=o.length-1;h>=0&&(r.replace(e,t,n),!(r.steps.length>d));h--){let f=o[h];f<0||(e=s.before(f),t=i.after(f))}}function zc(r,e,t,n,s){if(e<t){let i=r.firstChild;r=r.replaceChild(0,i.copy(zc(i.content,e+1,t,n,i)))}if(e>n){let i=s.contentMatchAt(0),o=i.fillBefore(r).append(r);r=o.append(i.matchFragment(o).fillBefore(x.empty,!0))}return r}function $f(r,e,t,n){if(!n.isInline&&e==t&&r.doc.resolve(e).parent.content.size){let s=Pf(r.doc,e,n.type);s!=null&&(e=t=s)}r.replaceRange(e,t,new _(x.from(n),0,0))}function Lf(r,e,t){let n=r.doc.resolve(e),s=r.doc.resolve(t),i=Uc(n,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||n.node(a).type.contentMatch.validEnd)return r.delete(n.start(a),s.end(a));if(a>0&&(l||n.node(a-1).canReplace(n.index(a-1),s.indexAfter(a-1))))return r.delete(n.before(a),s.after(a))}for(let o=1;o<=n.depth&&o<=s.depth;o++)if(e-n.start(o)==n.depth-o&&t>n.end(o)&&s.end(o)-t!=s.depth-o&&n.start(o-1)==s.start(o-1)&&n.node(o-1).canReplace(n.index(o-1),s.index(o-1)))return r.delete(n.before(o),t);r.delete(e,t)}function Uc(r,e){let t=[],n=Math.min(r.depth,e.depth);for(let s=n;s>=0;s--){let i=r.start(s);if(i<r.pos-(r.depth-s)||e.end(s)>e.pos+(e.depth-s)||r.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==r.depth&&s==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&t.push(s)}return t}class Mn extends ve{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return re.fail("No node at attribute step's position");let n=Object.create(null);for(let i in t.attrs)n[i]=t.attrs[i];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return re.fromReplace(e,this.pos,this.pos+1,new _(x.from(s),0,t.isLeaf?0:1))}getMap(){return Me.empty}invert(e){return new Mn(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new Mn(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.pos!="number"||typeof t.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Mn(t.pos,t.attr,t.value)}}ve.jsonID("attr",Mn);class fr extends ve{constructor(e,t){super(),this.attr=e,this.value=t}apply(e){let t=Object.create(null);for(let s in e.attrs)t[s]=e.attrs[s];t[this.attr]=this.value;let n=e.type.create(t,e.content,e.marks);return re.ok(n)}getMap(){return Me.empty}invert(e){return new fr(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,t){if(typeof t.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new fr(t.attr,t.value)}}ve.jsonID("docAttr",fr);let In=class extends Error{};In=function r(e){let t=Error.call(this,e);return t.__proto__=r.prototype,t};In.prototype=Object.create(Error.prototype);In.prototype.constructor=In;In.prototype.name="TransformError";class Vc{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new hr}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new In(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=_.empty){let s=Ws(this.doc,e,t,n);return s&&this.step(s),this}replaceWith(e,t,n){return this.replace(e,t,new _(x.from(n),0,0))}delete(e,t){return this.replace(e,t,_.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return Df(this,e,t,n),this}replaceRangeWith(e,t,n){return $f(this,e,t,n),this}deleteRange(e,t){return Lf(this,e,t),this}lift(e,t){return kf(this,e,t),this}join(e,t=1){return Mf(this,e,t),this}wrap(e,t){return Tf(this,e,t),this}setBlockType(e,t=e,n,s=null){return Cf(this,e,t,n,s),this}setNodeMarkup(e,t,n=null,s){return Ef(this,e,t,n,s),this}setNodeAttribute(e,t,n){return this.step(new Mn(e,t,n)),this}setDocAttribute(e,t){return this.step(new fr(e,t)),this}addNodeMark(e,t){return this.step(new Ct(e,t)),this}removeNodeMark(e,t){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t instanceof q)t.isInSet(n.marks)&&this.step(new tn(e,t));else{let s=n.marks,i,o=[];for(;i=t.isInSet(s);)o.push(new tn(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,t=1,n){return Of(this,e,t,n),this}addMark(e,t,n){return bf(this,e,t,n),this}removeMark(e,t,n){return vf(this,e,t,n),this}clearIncompatible(e,t,n){return Io(this,e,t,n),this}}const fi=Object.create(null);class j{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new jf(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=_.empty){let n=t.content.lastChild,s=null;for(let a=0;a<t.openEnd;a++)s=n,n=n.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?_.empty:t),a==0&&Ra(e,i,(n?n.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(n),c=l.map(o.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,t),Ra(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let s=e.parent.inlineContent?new D(e):xn(e.node(0),e.parent,e.pos,e.index(),t,n);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=t<0?xn(e.node(0),e.node(i),e.before(i+1),e.index(i),t,n):xn(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,n);if(o)return o}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new Pe(e.node(0))}static atStart(e){return xn(e,e,0,0,1)||new Pe(e)}static atEnd(e){return xn(e,e,e.content.size,e.childCount,-1)||new Pe(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=fi[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in fi)throw new RangeError("Duplicate use of selection JSON ID "+e);return fi[e]=t,t.prototype.jsonID=e,t}getBookmark(){return D.between(this.$anchor,this.$head).getBookmark()}}j.prototype.visible=!0;class jf{constructor(e,t){this.$from=e,this.$to=t}}let Ia=!1;function Na(r){!Ia&&!r.parent.inlineContent&&(Ia=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class D extends j{constructor(e,t=e){Na(e),Na(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return j.near(n);let s=e.resolve(t.map(this.anchor));return new D(s.parent.inlineContent?s:n,n)}replace(e,t=_.empty){if(super.replace(e,t),t==_.empty){let n=this.$from.marksAcross(this.$to);n&&e.ensureMarks(n)}}eq(e){return e instanceof D&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new qs(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if(typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new D(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let s=e.resolve(t);return new this(s,n==t?s:e.resolve(n))}static between(e,t,n){let s=e.pos-t.pos;if((!n||s)&&(n=s>=0?1:-1),!t.parent.inlineContent){let i=j.findFrom(t,n,!0)||j.findFrom(t,-n,!0);if(i)t=i.$head;else return j.near(t,n)}return e.parent.inlineContent||(s==0?e=t:(e=(j.findFrom(e,-n,!0)||j.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=s<0&&(e=t))),new D(e,t)}}j.jsonID("text",D);class qs{constructor(e,t){this.anchor=e,this.head=t}map(e){return new qs(e.map(this.anchor),e.map(this.head))}resolve(e){return D.between(e.resolve(this.anchor),e.resolve(this.head))}}class N extends j{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:s}=t.mapResult(this.anchor),i=e.resolve(s);return n?j.near(i):new N(i)}content(){return new _(x.from(this.node),0,0)}eq(e){return e instanceof N&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Ro(this.anchor)}static fromJSON(e,t){if(typeof t.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new N(e.resolve(t.anchor))}static create(e,t){return new N(e.resolve(t))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}N.prototype.visible=!1;j.jsonID("node",N);class Ro{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new qs(n,n):new Ro(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&N.isSelectable(n)?new N(t):j.near(t)}}class Pe extends j{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=_.empty){if(t==_.empty){e.delete(0,e.doc.content.size);let n=j.atStart(e.doc);n.eq(e.selection)||e.setSelection(n)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new Pe(e)}map(e){return new Pe(e)}eq(e){return e instanceof Pe}getBookmark(){return Bf}}j.jsonID("all",Pe);const Bf={map(){return this},resolve(r){return new Pe(r)}};function xn(r,e,t,n,s,i=!1){if(e.inlineContent)return D.create(r,t);for(let o=n-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&N.isSelectable(a))return N.create(r,t-(s<0?a.nodeSize:0))}else{let l=xn(r,a,t+s,s<0?a.childCount:0,s,i);if(l)return l}t+=a.nodeSize*s}return null}function Ra(r,e,t){let n=r.steps.length-1;if(n<e)return;let s=r.steps[n];if(!(s instanceof ce||s instanceof ue))return;let i=r.mapping.maps[n],o;i.forEach((a,l,c,u)=>{o==null&&(o=u)}),r.setSelection(j.near(r.doc.resolve(o),t))}const Da=1,Pr=2,$a=4;class Ff extends Vc{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Da)&~Pr,this.storedMarks=null,this}get selectionSet(){return(this.updated&Da)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Pr,this}ensureMarks(e){return q.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Pr)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~Pr,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||q.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let s=this.doc.type.schema;if(t==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(n==null&&(n=t),n=n??t,!e)return this.deleteRange(t,n);let i=this.storedMarks;if(!i){let o=this.doc.resolve(t);i=n==t?o.marks():o.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,s.text(e,i)),this.selection.empty||this.setSelection(j.near(this.selection.$to)),this}}setMeta(e,t){return this.meta[typeof e=="string"?e:e.key]=t,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=$a,this}get scrolledIntoView(){return(this.updated&$a)>0}}function La(r,e){return!e||!r?r:r.bind(e)}class Kn{constructor(e,t,n){this.name=e,this.init=La(t.init,n),this.apply=La(t.apply,n)}}const zf=[new Kn("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new Kn("selection",{init(r,e){return r.selection||j.atStart(e.doc)},apply(r){return r.selection}}),new Kn("storedMarks",{init(r){return r.storedMarks||null},apply(r,e,t,n){return n.selection.$cursor?r.storedMarks:null}}),new Kn("scrollToSelection",{init(){return 0},apply(r,e){return r.scrolledIntoView?e+1:e}})];class pi{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=zf.slice(),t&&t.forEach(n=>{if(this.pluginsByKey[n.key])throw new RangeError("Adding different instances of a keyed plugin ("+n.key+")");this.plugins.push(n),this.pluginsByKey[n.key]=n,n.spec.state&&this.fields.push(new Kn(n.key,n.spec.state,n))})}}class An{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let s=this.config.plugins[n];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,c=s?s[o].state:this,u=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,c,n);if(u&&n.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!s){s=[];for(let d=0;d<this.config.plugins.length;d++)s.push(d<o?{state:n,n:t.length}:{state:this,n:0})}t.push(u),n=n.applyInner(u),i=!0}s&&(s[o]={state:n,n:t.length})}}if(!i)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new An(this.config),n=this.config.fields;for(let s=0;s<n.length;s++){let i=n[s];t[i.name]=i.apply(e,this[i.name],this,t)}return t}get tr(){return new Ff(this)}static create(e){let t=new pi(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new An(t);for(let s=0;s<t.fields.length;s++)n[t.fields[s].name]=t.fields[s].init(e,n);return n}reconfigure(e){let t=new pi(this.schema,e.plugins),n=t.fields,s=new An(t);for(let i=0;i<n.length;i++){let o=n[i].name;s[o]=this.hasOwnProperty(o)?this[o]:n[i].init(e,s)}return s}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(n=>n.toJSON())),e&&typeof e=="object")for(let n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[n],i=s.spec.state;i&&i.toJSON&&(t[n]=i.toJSON.call(s,this[s.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new pi(e.schema,e.plugins),i=new An(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=He.fromJSON(e.schema,t.doc);else if(o.name=="selection")i.selection=j.fromJSON(i.doc,t.selection);else if(o.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let a in n){let l=n[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){i[o.name]=c.fromJSON.call(l,e,t[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function Hc(r,e,t){for(let n in r){let s=r[n];s instanceof Function?s=s.bind(e):n=="handleDOMEvents"&&(s=Hc(s,e,{})),t[n]=s}return t}class te{constructor(e){this.spec=e,this.props={},e.props&&Hc(e.props,this,this.props),this.key=e.key?e.key.key:Wc("plugin")}getState(e){return e[this.key]}}const mi=Object.create(null);function Wc(r){return r in mi?r+"$"+ ++mi[r]:(mi[r]=0,r+"$")}class he{constructor(e="key"){this.key=Wc(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const pe=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},Nn=function(r){let e=r.assignedSlot||r.parentNode;return e&&e.nodeType==11?e.host:e};let Ki=null;const ot=function(r,e,t){let n=Ki||(Ki=document.createRange());return n.setEnd(r,t??r.nodeValue.length),n.setStart(r,e||0),n},Uf=function(){Ki=null},nn=function(r,e,t,n){return t&&(ja(r,e,t,n,-1)||ja(r,e,t,n,1))},Vf=/^(img|br|input|textarea|hr)$/i;function ja(r,e,t,n,s){for(var i;;){if(r==t&&e==n)return!0;if(e==(s<0?0:$e(r))){let o=r.parentNode;if(!o||o.nodeType!=1||Tr(r)||Vf.test(r.nodeName)||r.contentEditable=="false")return!1;e=pe(r)+(s<0?0:1),r=o}else if(r.nodeType==1){let o=r.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else r=o,e=s<0?$e(r):0}else return!1}}function $e(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function Hf(r,e){for(;;){if(r.nodeType==3&&e)return r;if(r.nodeType==1&&e>0){if(r.contentEditable=="false")return null;r=r.childNodes[e-1],e=$e(r)}else if(r.parentNode&&!Tr(r))e=pe(r),r=r.parentNode;else return null}}function Wf(r,e){for(;;){if(r.nodeType==3&&e<r.nodeValue.length)return r;if(r.nodeType==1&&e<r.childNodes.length){if(r.contentEditable=="false")return null;r=r.childNodes[e],e=0}else if(r.parentNode&&!Tr(r))e=pe(r)+1,r=r.parentNode;else return null}}function qf(r,e,t){for(let n=e==0,s=e==$e(r);n||s;){if(r==t)return!0;let i=pe(r);if(r=r.parentNode,!r)return!1;n=n&&i==0,s=s&&i==$e(r)}}function Tr(r){let e;for(let t=r;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}const Ks=function(r){return r.focusNode&&nn(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function Ut(r,e){let t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=r,t.key=t.code=e,t}function Kf(r){let e=r.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Jf(r,e,t){if(r.caretPositionFromPoint)try{let n=r.caretPositionFromPoint(e,t);if(n)return{node:n.offsetNode,offset:Math.min($e(n.offsetNode),n.offset)}}catch{}if(r.caretRangeFromPoint){let n=r.caretRangeFromPoint(e,t);if(n)return{node:n.startContainer,offset:Math.min($e(n.startContainer),n.startOffset)}}}const Ze=typeof navigator<"u"?navigator:null,Ba=typeof document<"u"?document:null,Dt=Ze&&Ze.userAgent||"",Ji=/Edge\/(\d+)/.exec(Dt),qc=/MSIE \d/.exec(Dt),Gi=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Dt),Ee=!!(qc||Gi||Ji),At=qc?document.documentMode:Gi?+Gi[1]:Ji?+Ji[1]:0,We=!Ee&&/gecko\/(\d+)/i.test(Dt);We&&+(/Firefox\/(\d+)/.exec(Dt)||[0,0])[1];const Yi=!Ee&&/Chrome\/(\d+)/.exec(Dt),be=!!Yi,Kc=Yi?+Yi[1]:0,Se=!Ee&&!!Ze&&/Apple Computer/.test(Ze.vendor),Rn=Se&&(/Mobile\/\w+/.test(Dt)||!!Ze&&Ze.maxTouchPoints>2),De=Rn||(Ze?/Mac/.test(Ze.platform):!1),Gf=Ze?/Win/.test(Ze.platform):!1,lt=/Android \d/.test(Dt),Cr=!!Ba&&"webkitFontSmoothing"in Ba.documentElement.style,Yf=Cr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Qf(r){let e=r.defaultView&&r.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function tt(r,e){return typeof r=="number"?r:r[e]}function Xf(r){let e=r.getBoundingClientRect(),t=e.width/r.offsetWidth||1,n=e.height/r.offsetHeight||1;return{left:e.left,right:e.left+r.clientWidth*t,top:e.top,bottom:e.top+r.clientHeight*n}}function Fa(r,e,t){let n=r.someProp("scrollThreshold")||0,s=r.someProp("scrollMargin")||5,i=r.dom.ownerDocument;for(let o=t||r.dom;o;){if(o.nodeType!=1){o=Nn(o);continue}let a=o,l=a==i.body,c=l?Qf(i):Xf(a),u=0,d=0;if(e.top<c.top+tt(n,"top")?d=-(c.top-e.top+tt(s,"top")):e.bottom>c.bottom-tt(n,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+tt(s,"top")-c.top:e.bottom-c.bottom+tt(s,"bottom")),e.left<c.left+tt(n,"left")?u=-(c.left-e.left+tt(s,"left")):e.right>c.right-tt(n,"right")&&(u=e.right-c.right+tt(s,"right")),u||d)if(l)i.defaultView.scrollBy(u,d);else{let f=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-f,g=a.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:Nn(o)}}function Zf(r){let e=r.dom.getBoundingClientRect(),t=Math.max(0,e.top),n,s;for(let i=(e.left+e.right)/2,o=t+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=r.root.elementFromPoint(i,o);if(!a||a==r.dom||!r.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=t-20){n=a,s=l.top;break}}return{refDOM:n,refTop:s,stack:Jc(r.dom)}}function Jc(r){let e=[],t=r.ownerDocument;for(let n=r;n&&(e.push({dom:n,top:n.scrollTop,left:n.scrollLeft}),r!=t);n=Nn(n));return e}function ep({refDOM:r,refTop:e,stack:t}){let n=r?r.getBoundingClientRect().top:0;Gc(t,n==0?0:n-e)}function Gc(r,e){for(let t=0;t<r.length;t++){let{dom:n,top:s,left:i}=r[t];n.scrollTop!=s+e&&(n.scrollTop=s+e),n.scrollLeft!=i&&(n.scrollLeft=i)}}let un=null;function tp(r){if(r.setActive)return r.setActive();if(un)return r.focus(un);let e=Jc(r);r.focus(un==null?{get preventScroll(){return un={preventScroll:!0},!0}}:void 0),un||(un=!1,Gc(e,0))}function Yc(r,e){let t,n=2e8,s,i=0,o=e.top,a=e.top,l,c;for(let u=r.firstChild,d=0;u;u=u.nextSibling,d++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=ot(u).getClientRects();else continue;for(let f=0;f<h.length;f++){let p=h[f];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<n){t=u,n=m,s=m&&t.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&m&&(i=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!t&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(i=d+1)}}return!t&&l&&(t=l,s=c,n=0),t&&t.nodeType==3?np(t,s):!t||n&&t.nodeType==1?{node:r,offset:i}:Yc(t,s)}function np(r,e){let t=r.nodeValue.length,n=document.createRange();for(let s=0;s<t;s++){n.setEnd(r,s+1),n.setStart(r,s);let i=gt(n,1);if(i.top!=i.bottom&&Do(e,i))return{node:r,offset:s+(e.left>=(i.left+i.right)/2?1:0)}}return{node:r,offset:0}}function Do(r,e){return r.left>=e.left-1&&r.left<=e.right+1&&r.top>=e.top-1&&r.top<=e.bottom+1}function rp(r,e){let t=r.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<r.getBoundingClientRect().left?t:r}function sp(r,e,t){let{node:n,offset:s}=Yc(e,t),i=-1;if(n.nodeType==1&&!n.firstChild){let o=n.getBoundingClientRect();i=o.left!=o.right&&t.left>(o.left+o.right)/2?1:-1}return r.docView.posFromDOM(n,s,i)}function ip(r,e,t,n){let s=-1;for(let i=e,o=!1;i!=r.dom;){let a=r.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>n.left||l.top>n.top?s=a.posBefore:(!o&&l.right<n.left||l.bottom<n.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?n.top<(l.top+l.bottom)/2:n.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:r.docView.posFromDOM(e,t,-1)}function Qc(r,e,t){let n=r.childNodes.length;if(n&&t.top<t.bottom)for(let s=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-t.top)/(t.bottom-t.top))-2)),i=s;;){let o=r.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(Do(e,c))return Qc(o,e,c)}}if((i=(i+1)%n)==s)break}return r}function op(r,e){let t=r.dom.ownerDocument,n,s=0,i=Jf(t,e.left,e.top);i&&({node:n,offset:s}=i);let o=(r.root.elementFromPoint?r.root:t).elementFromPoint(e.left,e.top),a;if(!o||!r.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=r.dom.getBoundingClientRect();if(!Do(e,c)||(o=Qc(r.dom,e,c),!o))return null}if(Se)for(let c=o;n&&c;c=Nn(c))c.draggable&&(n=void 0);if(o=rp(o,e),n){if(We&&n.nodeType==1&&(s=Math.min(s,n.childNodes.length),s<n.childNodes.length)){let u=n.childNodes[s],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&s++}let c;Cr&&s&&n.nodeType==1&&(c=n.childNodes[s-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&s--,n==r.dom&&s==n.childNodes.length-1&&n.lastChild.nodeType==1&&e.top>n.lastChild.getBoundingClientRect().bottom?a=r.state.doc.content.size:(s==0||n.nodeType!=1||n.childNodes[s-1].nodeName!="BR")&&(a=ip(r,n,s,e))}a==null&&(a=sp(r,o,e));let l=r.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function za(r){return r.top<r.bottom||r.left<r.right}function gt(r,e){let t=r.getClientRects();if(t.length){let n=t[e<0?0:t.length-1];if(za(n))return n}return Array.prototype.find.call(t,za)||r.getBoundingClientRect()}const ap=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Xc(r,e,t){let{node:n,offset:s,atom:i}=r.docView.domFromPos(e,t<0?-1:1),o=Cr||We;if(n.nodeType==3)if(o&&(ap.test(n.nodeValue)||(t<0?!s:s==n.nodeValue.length))){let l=gt(ot(n,s,s),t);if(We&&s&&/\s/.test(n.nodeValue[s-1])&&s<n.nodeValue.length){let c=gt(ot(n,s-1,s-1),-1);if(c.top==l.top){let u=gt(ot(n,s,s+1),-1);if(u.top!=l.top)return Vn(u,u.left<c.left)}}return l}else{let l=s,c=s,u=t<0?1:-1;return t<0&&!s?(c++,u=-1):t>=0&&s==n.nodeValue.length?(l--,u=1):t<0?l--:c++,Vn(gt(ot(n,l,c),u),u<0)}if(!r.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(t<0||s==$e(n))){let l=n.childNodes[s-1];if(l.nodeType==1)return gi(l.getBoundingClientRect(),!1)}if(i==null&&s<$e(n)){let l=n.childNodes[s];if(l.nodeType==1)return gi(l.getBoundingClientRect(),!0)}return gi(n.getBoundingClientRect(),t>=0)}if(i==null&&s&&(t<0||s==$e(n))){let l=n.childNodes[s-1],c=l.nodeType==3?ot(l,$e(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Vn(gt(c,1),!1)}if(i==null&&s<$e(n)){let l=n.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?ot(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Vn(gt(c,-1),!0)}return Vn(gt(n.nodeType==3?ot(n):n,-t),t>=0)}function Vn(r,e){if(r.width==0)return r;let t=e?r.left:r.right;return{top:r.top,bottom:r.bottom,left:t,right:t}}function gi(r,e){if(r.height==0)return r;let t=e?r.top:r.bottom;return{top:t,bottom:t,left:r.left,right:r.right}}function Zc(r,e,t){let n=r.state,s=r.root.activeElement;n!=e&&r.updateState(e),s!=r.dom&&r.focus();try{return t()}finally{n!=e&&r.updateState(n),s!=r.dom&&s&&s.focus()}}function lp(r,e,t){let n=e.selection,s=t=="up"?n.$from:n.$to;return Zc(r,e,()=>{let{node:i}=r.docView.domFromPos(s.pos,t=="up"?-1:1);for(;;){let a=r.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=Xc(r,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=ot(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(t=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const cp=/[\u0590-\u08ac]/;function up(r,e,t){let{$head:n}=e.selection;if(!n.parent.isTextblock)return!1;let s=n.parentOffset,i=!s,o=s==n.parent.content.size,a=r.domSelection();return a?!cp.test(n.parent.textContent)||!a.modify?t=="left"||t=="backward"?i:o:Zc(r,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=r.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",t,"character");let f=n.depth?r.docView.domAfterPos(n.before()):r.dom,{focusNode:p,focusOffset:m}=r.domSelectionRange(),g=p&&!f.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return h!=null&&(a.caretBidiLevel=h),g}):n.pos==n.start()||n.pos==n.end()}let Ua=null,Va=null,Ha=!1;function dp(r,e,t){return Ua==e&&Va==t?Ha:(Ua=e,Va=t,Ha=t=="up"||t=="down"?lp(r,e,t):up(r,e,t))}const Le=0,Wa=1,Ht=2,et=3;class _r{constructor(e,t,n,s){this.parent=e,this.children=t,this.dom=n,this.contentDOM=s,this.dirty=Le,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let s=this.children[t];if(s==e)return n;n+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){let i,o;if(e==this.contentDOM)i=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=t>pe(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&t==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??n>0?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!t||i.node))if(n&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))n=!1;else return i}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let s=this.children[t],i=n+s.size;if(n==e&&i!=n){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-n-s.border);n=i}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,s=0;for(let i=0;n<this.children.length;n++){let o=this.children[n],a=i+o.size;if(a>e||o instanceof tu){s=e-i;break}i=a}if(s)return this.children[n].domFromPos(s-this.children[n].border,t);for(let i;n&&!(i=this.children[n-1]).size&&i instanceof eu&&i.side>=0;n--);if(t<=0){let i,o=!0;for(;i=n?this.children[n-1]:null,!(!i||i.dom.parentNode==this.contentDOM);n--,o=!1);return i&&t&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,t):{node:this.contentDOM,offset:i?pe(i.dom)+1:0}}else{let i,o=!0;for(;i=n<this.children.length?this.children[n]:null,!(!i||i.dom.parentNode==this.contentDOM);n++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,t):{node:this.contentDOM,offset:i?pe(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=n,a=0;;a++){let l=this.children[a],c=o+l.size;if(s==-1&&e<=c){let u=o+l.border;if(e>=u&&t<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,u);e=o;for(let d=a;d>0;d--){let h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){s=pe(h.dom)+1;break}e-=h.size}s==-1&&(s=0)}if(s>-1&&(c>t||a==this.children.length-1)){t=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){i=pe(d.dom);break}t+=d.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:t,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(t.nodeType!=1||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,s=!1){let i=Math.min(e,t),o=Math.max(e,t);for(let f=0,p=0;f<this.children.length;f++){let m=this.children[f],g=p+m.size;if(i>p&&o<g)return m.setSelection(e-p-m.border,t-p-m.border,n,s);p=g}let a=this.domFromPos(e,e?-1:1),l=t==e?a:this.domFromPos(t,t?-1:1),c=n.root.getSelection(),u=n.domSelectionRange(),d=!1;if((We||Se)&&e==t){let{node:f,offset:p}=a;if(f.nodeType==3){if(d=!!(p&&f.nodeValue[p-1]==`
`),d&&p==f.nodeValue.length)for(let m=f,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:pe(g)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=f.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(We&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(s=!0)}if(!(s||d&&Se)&&nn(a.node,a.offset,u.anchorNode,u.anchorOffset)&&nn(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||e==t)&&!d){c.collapse(a.node,a.offset);try{e!=t&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>t){let p=a;a=l,l=p}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,s=0;s<this.children.length;s++){let i=this.children[s],o=n+i.size;if(n==o?e<=o&&t>=n:e<o&&t>n){let a=n+i.border,l=o-i.border;if(e>=a&&t<=l){this.dirty=e==n||t==o?Ht:Wa,e==a&&t==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=et:i.markDirty(e-a,t-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Ht:et}n=o}this.dirty=Ht}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=e==1?Ht:Wa;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class eu extends _r{constructor(e,t,n,s){let i,o=t.type.toDOM;if(typeof o=="function"&&(o=o(n,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!t.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=t,this.widget=t,i=this}matchesWidget(e){return this.dirty==Le&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return t?t(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class hp extends _r{constructor(e,t,n,s){super(e,[],t,null),this.textDOM=n,this.text=s}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class rn extends _r{constructor(e,t,n,s,i){super(e,[],n,s),this.mark=t,this.spec=i}static create(e,t,n,s){let i=s.nodeViews[t.type.name],o=i&&i(t,s,n);return(!o||!o.dom)&&(o=on.renderSpec(document,t.type.spec.toDOM(t,n),null,t.attrs)),new rn(e,t,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&et||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=et&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=Le){let n=this.parent;for(;!n.node;)n=n.parent;n.dirty<this.dirty&&(n.dirty=this.dirty),this.dirty=Le}}slice(e,t,n){let s=rn.create(this.parent,this.mark,!0,n),i=this.children,o=this.size;t<o&&(i=Xi(i,t,o,n)),e>0&&(i=Xi(i,0,e,n));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Mt extends _r{constructor(e,t,n,s,i,o,a,l,c){super(e,[],i,o),this.node=t,this.outerDeco=n,this.innerDeco=s,this.nodeDOM=a}static create(e,t,n,s,i,o){let a=i.nodeViews[t.type.name],l,c=a&&a(t,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},n,s),u=c&&c.dom,d=c&&c.contentDOM;if(t.isText){if(!u)u=document.createTextNode(t.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=on.renderSpec(document,t.type.spec.toDOM(t),null,t.attrs));!d&&!t.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let h=u;return u=su(u,n,t),c?l=new fp(e,t,n,s,u,d||null,h,c,i,o+1):t.isText?new Js(e,t,n,s,u,h,i):new Mt(e,t,n,s,u,d||null,h,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>x.empty)}return e}matchesNode(e,t,n){return this.dirty==Le&&e.eq(this.node)&&rs(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,s=t,i=e.composing?this.localCompositionInfo(e,t):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new mp(this,o&&o.node,e);bp(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,n,e):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?q.none:this.node.child(u).marks,n,e),l.placeWidget(c,e,s)},(c,u,d,h)=>{l.syncToMarks(c.marks,n,e);let f;l.findNodeMatch(c,u,d,h)||a&&e.state.selection.from>s&&e.state.selection.to<s+c.nodeSize&&(f=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(c,u,d,f,e)||l.updateNextNode(c,u,d,e,h,s)||l.addNode(c,u,d,e,s),s+=c.nodeSize}),l.syncToMarks([],n,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Ht)&&(o&&this.protectLocalComposition(e,o),nu(this.contentDOM,this.children,e),Rn&&vp(this.dom))}localCompositionInfo(e,t){let{from:n,to:s}=e.state.selection;if(!(e.state.selection instanceof D)||n<t||s>t+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=wp(this.node.content,o,n-t,s-t);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:s}){if(this.getDesc(t))return;let i=t;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new hp(this,i,t,s);e.input.compositionNodes.push(o),this.children=Xi(this.children,n,n+s.length,e,o)}update(e,t,n,s){return this.dirty==et||!e.sameMarkup(this.node)?!1:(this.updateInner(e,t,n,s),!0)}updateInner(e,t,n,s){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Le}updateOuterDeco(e){if(rs(e,this.outerDeco))return;let t=this.nodeDOM.nodeType!=1,n=this.dom;this.dom=ru(this.dom,this.nodeDOM,Qi(this.outerDeco,this.node,t),Qi(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function qa(r,e,t,n,s){su(n,e,r);let i=new Mt(void 0,r,e,t,n,n,n,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class Js extends Mt{constructor(e,t,n,s,i,o,a){super(e,t,n,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,t,n,s){return this.dirty==et||this.dirty!=Le&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(t),(this.dirty!=Le||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Le,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,t,n){let s=this.node.cut(e,t),i=document.createTextNode(s.text);return new Js(this.parent,s,this.outerDeco,this.innerDeco,i,i,n)}markDirty(e,t){super.markDirty(e,t),this.dom!=this.nodeDOM&&(e==0||t==this.nodeDOM.nodeValue.length)&&(this.dirty=et)}get domAtom(){return!1}isText(e){return this.node.text==e}}class tu extends _r{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Le&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class fp extends Mt{constructor(e,t,n,s,i,o,a,l,c,u){super(e,t,n,s,i,o,a,c,u),this.spec=l}update(e,t,n,s){if(this.dirty==et)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,t,n);return i&&this.updateInner(e,t,n,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,t,n,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,s){this.spec.setSelection?this.spec.setSelection(e,t,n.root):super.setSelection(e,t,n,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function nu(r,e,t){let n=r.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==r){for(;a!=n;)n=Ka(n),s=!0;n=n.nextSibling}else s=!0,r.insertBefore(a,n);if(o instanceof rn){let l=n?n.previousSibling:r.lastChild;nu(o.contentDOM,o.children,t),n=l?l.nextSibling:r.firstChild}}for(;n;)n=Ka(n),s=!0;s&&t.trackWrites==r&&(t.trackWrites=null)}const Zn=function(r){r&&(this.nodeName=r)};Zn.prototype=Object.create(null);const Wt=[new Zn];function Qi(r,e,t){if(r.length==0)return Wt;let n=t?Wt[0]:new Zn,s=[n];for(let i=0;i<r.length;i++){let o=r[i].type.attrs;if(o){o.nodeName&&s.push(n=new Zn(o.nodeName));for(let a in o){let l=o[a];l!=null&&(t&&s.length==1&&s.push(n=new Zn(e.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return s}function ru(r,e,t,n){if(t==Wt&&n==Wt)return e;let s=e;for(let i=0;i<n.length;i++){let o=n[i],a=t[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=r&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=Wt[0]),s=l}pp(s,a||Wt[0],o)}return s}function pp(r,e,t){for(let n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in t)&&r.removeAttribute(n);for(let n in t)n!="class"&&n!="style"&&n!="nodeName"&&t[n]!=e[n]&&r.setAttribute(n,t[n]);if(e.class!=t.class){let n=e.class?e.class.split(" ").filter(Boolean):[],s=t.class?t.class.split(" ").filter(Boolean):[];for(let i=0;i<n.length;i++)s.indexOf(n[i])==-1&&r.classList.remove(n[i]);for(let i=0;i<s.length;i++)n.indexOf(s[i])==-1&&r.classList.add(s[i]);r.classList.length==0&&r.removeAttribute("class")}if(e.style!=t.style){if(e.style){let n=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=n.exec(e.style);)r.style.removeProperty(s[1])}t.style&&(r.style.cssText+=t.style)}}function su(r,e,t){return ru(r,r,Wt,Qi(e,t,r.nodeType!=1))}function rs(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(!r[t].type.eq(e[t].type))return!1;return!0}function Ka(r){let e=r.nextSibling;return r.parentNode.removeChild(r),e}class mp{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=gp(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Le,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[i])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=rn.create(this.top,e[i],t,n);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,t,n,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,t,n))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,t,n)&&!this.preMatch.matched.has(c)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,s,i){let o=this.top.children[s];return o.dirty==et&&o.dom==o.contentDOM&&(o.dirty=Ht),o.update(e,t,n,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let n=e.pmViewDesc;if(n){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==n)return s}return-1}e=t}}updateNextNode(e,t,n,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Mt){let c=this.preMatch.matched.get(l);if(c!=null&&c!=i)return!1;let u=l.dom,d,h=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=et&&rs(t,l.outerDeco));if(!h&&l.update(e,t,n,s))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(d=this.recreateWrapper(l,e,t,n,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=Ht,d.updateChildren(s,o+1),d.dirty=Le),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,t,n,s,i,o){if(e.dirty||t.isAtom||!e.children.length||!e.node.content.eq(t.content)||!rs(n,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=Mt.create(this.top,t,n,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,t,n,s,i){let o=Mt.create(this.top,e,t,n,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,t,n){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new eu(this.top,e,t,n);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;for(;e instanceof rn;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Js)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Se||be)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");let s=new tu(this.top,[],n,null);t!=this.top?t.children.push(s):t.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function gp(r,e){let t=e,n=t.children.length,s=r.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(n){let c=t.children[n-1];if(c instanceof rn)t=c,n=c.children.length;else{a=c,n--;break}}else{if(t==e)break e;n=t.parent.children.indexOf(t),t=t.parent}let l=a.node;if(l){if(l!=r.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function yp(r,e){return r.type.side-e.type.side}function bp(r,e,t,n){let s=e.locals(r),i=0;if(s.length==0){for(let c=0;c<r.childCount;c++){let u=r.child(c);n(u,s,e.forChild(i,u),c),i+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<s.length&&s[o].to==i;){let g=s[o++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort(yp);for(let g=0;g<d.length;g++)t(d[g],c,!!l)}else t(u,c,!!l);let h,f;if(l)f=-1,h=l,l=null;else if(c<r.childCount)f=c,h=r.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=i&&a.splice(g--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let p=i+h.nodeSize;if(h.isText){let g=p;o<s.length&&s[o].from<g&&(g=s[o].from);for(let y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<p&&(l=h.cut(g-i),h=h.cut(0,g-i),p=g,f=-1)}else for(;o<s.length&&s[o].to<p;)o++;let m=h.isInline&&!h.isLeaf?a.filter(g=>!g.inline):a.slice();n(h,m,e.forChild(i,h),f),i=p}}function vp(r){if(r.nodeName=="UL"||r.nodeName=="OL"){let e=r.style.cssText;r.style.cssText=e+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=e}}function wp(r,e,t,n){for(let s=0,i=0;s<r.childCount&&i<=n;){let o=r.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<r.childCount;){let c=r.child(s++);if(i+=c.nodeSize,!c.isText)break;l+=c.text}if(i>=t){if(i>=n&&l.slice(n-e.length-a,n-a)==e)return n-e.length;let c=a<n?l.lastIndexOf(e,n-a-1):-1;if(c>=0&&c+e.length+a>=t)return a+c;if(t==n&&l.length>=n+e.length-a&&l.slice(n-a,n-a+e.length)==e)return n}}return-1}function Xi(r,e,t,n,s){let i=[];for(let o=0,a=0;o<r.length;o++){let l=r[o],c=a,u=a+=l.size;c>=t||u<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,n)),s&&(i.push(s),s=void 0),u>t&&i.push(l.slice(t-c,l.size,n)))}return i}function $o(r,e=null){let t=r.domSelectionRange(),n=r.state.doc;if(!t.focusNode)return null;let s=r.docView.nearestDesc(t.focusNode),i=s&&s.size==0,o=r.docView.posFromDOM(t.focusNode,t.focusOffset,1);if(o<0)return null;let a=n.resolve(o),l,c;if(Ks(t)){for(l=o;s&&!s.node;)s=s.parent;let d=s.node;if(s&&d.isAtom&&N.isSelectable(d)&&s.parent&&!(d.isInline&&qf(t.focusNode,t.focusOffset,s.dom))){let h=s.posBefore;c=new N(o==h?a:n.resolve(h))}}else{if(t instanceof r.dom.ownerDocument.defaultView.Selection&&t.rangeCount>1){let d=o,h=o;for(let f=0;f<t.rangeCount;f++){let p=t.getRangeAt(f);d=Math.min(d,r.docView.posFromDOM(p.startContainer,p.startOffset,1)),h=Math.max(h,r.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=h==r.state.selection.anchor?[h,d]:[d,h],a=n.resolve(o)}else l=r.docView.posFromDOM(t.anchorNode,t.anchorOffset,1);if(l<0)return null}let u=n.resolve(l);if(!c){let d=e=="pointer"||r.state.selection.head<a.pos&&!i?1:-1;c=Lo(r,u,a,d)}return c}function iu(r){return r.editable?r.hasFocus():au(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function ut(r,e=!1){let t=r.state.selection;if(ou(r,t),!!iu(r)){if(!e&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&be){let n=r.domSelectionRange(),s=r.domObserver.currentSelection;if(n.anchorNode&&s.anchorNode&&nn(n.anchorNode,n.anchorOffset,s.anchorNode,s.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)xp(r);else{let{anchor:n,head:s}=t,i,o;Ja&&!(t instanceof D)&&(t.$from.parent.inlineContent||(i=Ga(r,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(o=Ga(r,t.to))),r.docView.setSelection(n,s,r,e),Ja&&(i&&Ya(i),o&&Ya(o)),t.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&kp(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const Ja=Se||be&&Kc<63;function Ga(r,e){let{node:t,offset:n}=r.docView.domFromPos(e,0),s=n<t.childNodes.length?t.childNodes[n]:null,i=n?t.childNodes[n-1]:null;if(Se&&s&&s.contentEditable=="false")return yi(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return yi(s);if(i)return yi(i)}}function yi(r){return r.contentEditable="true",Se&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function Ya(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function kp(r){let e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.input.hideSelectionGuard);let t=r.domSelectionRange(),n=t.anchorNode,s=t.anchorOffset;e.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(t.anchorNode!=n||t.anchorOffset!=s)&&(e.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!iu(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function xp(r){let e=r.domSelection(),t=document.createRange();if(!e)return;let n=r.cursorWrapper.dom,s=n.nodeName=="IMG";s?t.setStart(n.parentNode,pe(n)+1):t.setStart(n,0),t.collapse(!0),e.removeAllRanges(),e.addRange(t),!s&&!r.state.selection.visible&&Ee&&At<=11&&(n.disabled=!0,n.disabled=!1)}function ou(r,e){if(e instanceof N){let t=r.docView.descAt(e.from);t!=r.lastSelectedViewDesc&&(Qa(r),t&&t.selectNode(),r.lastSelectedViewDesc=t)}else Qa(r)}function Qa(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function Lo(r,e,t,n){return r.someProp("createSelectionBetween",s=>s(r,e,t))||D.between(e,t,n)}function Xa(r){return r.editable&&!r.hasFocus()?!1:au(r)}function au(r){let e=r.domSelectionRange();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Sp(r){let e=r.docView.domFromPos(r.state.selection.anchor,0),t=r.domSelectionRange();return nn(e.node,e.offset,t.anchorNode,t.anchorOffset)}function Zi(r,e){let{$anchor:t,$head:n}=r.selection,s=e>0?t.max(n):t.min(n),i=s.parent.inlineContent?s.depth?r.doc.resolve(e>0?s.after():s.before()):null:s;return i&&j.findFrom(i,e)}function bt(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function Za(r,e,t){let n=r.state.selection;if(n instanceof D)if(t.indexOf("s")>-1){let{$head:s}=n,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=r.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return bt(r,new D(n.$anchor,o))}else if(n.empty){if(r.endOfTextblock(e>0?"forward":"backward")){let s=Zi(r.state,e);return s&&s instanceof N?bt(r,s):!1}else if(!(De&&t.indexOf("m")>-1)){let s=n.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=r.docView.descAt(a))&&!o.contentDOM?N.isSelectable(i)?bt(r,new N(e<0?r.state.doc.resolve(s.pos-i.nodeSize):s)):Cr?bt(r,new D(r.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(n instanceof N&&n.node.isInline)return bt(r,new D(e>0?n.$to:n.$from));{let s=Zi(r.state,e);return s?bt(r,s):!1}}}function ss(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function er(r,e){let t=r.pmViewDesc;return t&&t.size==0&&(e<0||r.nextSibling||r.nodeName!="BR")}function dn(r,e){return e<0?Tp(r):Cp(r)}function Tp(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let s,i,o=!1;for(We&&t.nodeType==1&&n<ss(t)&&er(t.childNodes[n],-1)&&(o=!0);;)if(n>0){if(t.nodeType!=1)break;{let a=t.childNodes[n-1];if(er(a,-1))s=t,i=--n;else if(a.nodeType==3)t=a,n=t.nodeValue.length;else break}}else{if(lu(t))break;{let a=t.previousSibling;for(;a&&er(a,-1);)s=t.parentNode,i=pe(a),a=a.previousSibling;if(a)t=a,n=ss(t);else{if(t=t.parentNode,t==r.dom)break;n=0}}}o?eo(r,t,n):s&&eo(r,s,i)}function Cp(r){let e=r.domSelectionRange(),t=e.focusNode,n=e.focusOffset;if(!t)return;let s=ss(t),i,o;for(;;)if(n<s){if(t.nodeType!=1)break;let a=t.childNodes[n];if(er(a,1))i=t,o=++n;else break}else{if(lu(t))break;{let a=t.nextSibling;for(;a&&er(a,1);)i=a.parentNode,o=pe(a)+1,a=a.nextSibling;if(a)t=a,n=0,s=ss(t);else{if(t=t.parentNode,t==r.dom)break;n=s=0}}}i&&eo(r,i,o)}function lu(r){let e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function _p(r,e){for(;r&&e==r.childNodes.length&&!Tr(r);)e=pe(r)+1,r=r.parentNode;for(;r&&e<r.childNodes.length;){let t=r.childNodes[e];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=0}}function Ep(r,e){for(;r&&!e&&!Tr(r);)e=pe(r),r=r.parentNode;for(;r&&e;){let t=r.childNodes[e-1];if(t.nodeType==3)return t;if(t.nodeType==1&&t.contentEditable=="false")break;r=t,e=r.childNodes.length}}function eo(r,e,t){if(e.nodeType!=3){let i,o;(o=_p(e,t))?(e=o,t=0):(i=Ep(e,t))&&(e=i,t=i.nodeValue.length)}let n=r.domSelection();if(!n)return;if(Ks(n)){let i=document.createRange();i.setEnd(e,t),i.setStart(e,t),n.removeAllRanges(),n.addRange(i)}else n.extend&&n.extend(e,t);r.domObserver.setCurSelection();let{state:s}=r;setTimeout(()=>{r.state==s&&ut(r)},50)}function el(r,e){let t=r.state.doc.resolve(e);if(!(be||Gf)&&t.parent.inlineContent){let s=r.coordsAtPos(e);if(e>t.start()){let i=r.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<t.end()){let i=r.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function tl(r,e,t){let n=r.state.selection;if(n instanceof D&&!n.empty||t.indexOf("s")>-1||De&&t.indexOf("m")>-1)return!1;let{$from:s,$to:i}=n;if(!s.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){let o=Zi(r.state,e);if(o&&o instanceof N)return bt(r,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=n instanceof Pe?j.near(o,e):j.findFrom(o,e);return a?bt(r,a):!1}return!1}function nl(r,e){if(!(r.state.selection instanceof D))return!0;let{$head:t,$anchor:n,empty:s}=r.state.selection;if(!t.sameParent(n))return!0;if(!s)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!t.textOffset&&(e<0?t.nodeBefore:t.nodeAfter);if(i&&!i.isText){let o=r.state.tr;return e<0?o.delete(t.pos-i.nodeSize,t.pos):o.delete(t.pos,t.pos+i.nodeSize),r.dispatch(o),!0}return!1}function rl(r,e,t){r.domObserver.stop(),e.contentEditable=t,r.domObserver.start()}function Op(r){if(!Se||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:t}=r.domSelectionRange();if(e&&e.nodeType==1&&t==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let n=e.firstChild;rl(r,n,"true"),setTimeout(()=>rl(r,n,"false"),20)}return!1}function Ap(r){let e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function Mp(r,e){let t=e.keyCode,n=Ap(e);if(t==8||De&&t==72&&n=="c")return nl(r,-1)||dn(r,-1);if(t==46&&!e.shiftKey||De&&t==68&&n=="c")return nl(r,1)||dn(r,1);if(t==13||t==27)return!0;if(t==37||De&&t==66&&n=="c"){let s=t==37?el(r,r.state.selection.from)=="ltr"?-1:1:-1;return Za(r,s,n)||dn(r,s)}else if(t==39||De&&t==70&&n=="c"){let s=t==39?el(r,r.state.selection.from)=="ltr"?1:-1:1;return Za(r,s,n)||dn(r,s)}else{if(t==38||De&&t==80&&n=="c")return tl(r,-1,n)||dn(r,-1);if(t==40||De&&t==78&&n=="c")return Op(r)||tl(r,1,n)||dn(r,1);if(n==(De?"m":"c")&&(t==66||t==73||t==89||t==90))return!0}return!1}function jo(r,e){r.someProp("transformCopied",f=>{e=f(e,r)});let t=[],{content:n,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&n.childCount==1&&n.firstChild.childCount==1;){s--,i--;let f=n.firstChild;t.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),n=f.content}let o=r.someProp("clipboardSerializer")||on.fromSchema(r.state.schema),a=pu(),l=a.createElement("div");l.appendChild(o.serializeFragment(n,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=fu[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let p=a.createElement(u[f]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${i}${d?` -${d}`:""} ${JSON.stringify(t)}`);let h=r.someProp("clipboardTextSerializer",f=>f(e,r))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function cu(r,e,t,n,s){let i=s.parent.type.spec.code,o,a;if(!t&&!e)return null;let l=e&&(n||i||!t);if(l){if(r.someProp("transformPastedText",h=>{e=h(e,i||n,r)}),i)return e?new _(x.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):_.empty;let d=r.someProp("clipboardTextParser",h=>h(e,s,n,r));if(d)a=d;else{let h=s.marks(),{schema:f}=r.state,p=on.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(f.text(m,h)))})}}else r.someProp("transformPastedHTML",d=>{t=d(t,r)}),o=Rp(t),Cr&&Dp(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(r.someProp("clipboardParser")||r.someProp("domParser")||Ot.fromSchema(r.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:s,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!Pp.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=$p(sl(a,+u[1],+u[2]),u[4]);else if(a=_.maxOpen(Ip(a.content,s),!0),a.openStart||a.openEnd){let d=0,h=0;for(let f=a.content.firstChild;d<a.openStart&&!f.type.spec.isolating;d++,f=f.firstChild);for(let f=a.content.lastChild;h<a.openEnd&&!f.type.spec.isolating;h++,f=f.lastChild);a=sl(a,d,h)}return r.someProp("transformPasted",d=>{a=d(a,r)}),a}const Pp=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Ip(r,e){if(r.childCount<2)return r;for(let t=e.depth;t>=0;t--){let s=e.node(t).contentMatchAt(e.index(t)),i,o=[];if(r.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&i.length&&du(l,i,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=hu(o[o.length-1],i.length));let u=uu(a,l);o.push(u),s=s.matchType(u.type),i=l}}),o)return x.from(o)}return r}function uu(r,e,t=0){for(let n=e.length-1;n>=t;n--)r=e[n].create(null,x.from(r));return r}function du(r,e,t,n,s){if(s<r.length&&s<e.length&&r[s]==e[s]){let i=du(r,e,t,n.lastChild,s+1);if(i)return n.copy(n.content.replaceChild(n.childCount-1,i));if(n.contentMatchAt(n.childCount).matchType(s==r.length-1?t.type:r[s+1]))return n.copy(n.content.append(x.from(uu(t,r,s+1))))}}function hu(r,e){if(e==0)return r;let t=r.content.replaceChild(r.childCount-1,hu(r.lastChild,e-1)),n=r.contentMatchAt(r.childCount).fillBefore(x.empty,!0);return r.copy(t.append(n))}function to(r,e,t,n,s,i){let o=e<0?r.firstChild:r.lastChild,a=o.content;return r.childCount>1&&(i=0),s<n-1&&(a=to(a,e,t,n,s+1,i)),s>=t&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(x.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,o.copy(a))}function sl(r,e,t){return e<r.openStart&&(r=new _(to(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),t<r.openEnd&&(r=new _(to(r.content,1,t,r.openEnd,0,0),r.openStart,t)),r}const fu={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let il=null;function pu(){return il||(il=document.implementation.createHTMLDocument("title"))}let bi=null;function Np(r){let e=window.trustedTypes;return e?(bi||(bi=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:t=>t})),bi.createHTML(r)):r}function Rp(r){let e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));let t=pu().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(r),s;if((s=n&&fu[n[1].toLowerCase()])&&(r=s.map(i=>"<"+i+">").join("")+r+s.map(i=>"</"+i+">").reverse().join("")),t.innerHTML=Np(r),s)for(let i=0;i<s.length;i++)t=t.querySelector(s[i])||t;return t}function Dp(r){let e=r.querySelectorAll(be?"span:not([class]):not([style])":"span.Apple-converted-space");for(let t=0;t<e.length;t++){let n=e[t];n.childNodes.length==1&&n.textContent==""&&n.parentNode&&n.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),n)}}function $p(r,e){if(!r.size)return r;let t=r.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch{return r}let{content:s,openStart:i,openEnd:o}=r;for(let a=n.length-2;a>=0;a-=2){let l=t.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;s=x.from(l.create(n[a+1],s)),i++,o++}return new _(s,i,o)}const Te={},Ce={},Lp={touchstart:!0,touchmove:!0};class jp{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Bp(r){for(let e in Te){let t=Te[e];r.dom.addEventListener(e,r.input.eventHandlers[e]=n=>{zp(r,n)&&!Bo(r,n)&&(r.editable||!(n.type in Ce))&&t(r,n)},Lp[e]?{passive:!0}:void 0)}Se&&r.dom.addEventListener("input",()=>null),no(r)}function _t(r,e){r.input.lastSelectionOrigin=e,r.input.lastSelectionTime=Date.now()}function Fp(r){r.domObserver.stop();for(let e in r.input.eventHandlers)r.dom.removeEventListener(e,r.input.eventHandlers[e]);clearTimeout(r.input.composingTimeout),clearTimeout(r.input.lastIOSEnterFallbackTimeout)}function no(r){r.someProp("handleDOMEvents",e=>{for(let t in e)r.input.eventHandlers[t]||r.dom.addEventListener(t,r.input.eventHandlers[t]=n=>Bo(r,n))})}function Bo(r,e){return r.someProp("handleDOMEvents",t=>{let n=t[e.type];return n?n(r,e)||e.defaultPrevented:!1})}function zp(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target;t!=r.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function Up(r,e){!Bo(r,e)&&Te[e.type]&&(r.editable||!(e.type in Ce))&&Te[e.type](r,e)}Ce.keydown=(r,e)=>{let t=e;if(r.input.shiftKey=t.keyCode==16||t.shiftKey,!gu(r,t)&&(r.input.lastKeyCode=t.keyCode,r.input.lastKeyCodeTime=Date.now(),!(lt&&be&&t.keyCode==13)))if(t.keyCode!=229&&r.domObserver.forceFlush(),Rn&&t.keyCode==13&&!t.ctrlKey&&!t.altKey&&!t.metaKey){let n=Date.now();r.input.lastIOSEnter=n,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==n&&(r.someProp("handleKeyDown",s=>s(r,Ut(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",n=>n(r,t))||Mp(r,t)?t.preventDefault():_t(r,"key")};Ce.keyup=(r,e)=>{e.keyCode==16&&(r.input.shiftKey=!1)};Ce.keypress=(r,e)=>{let t=e;if(gu(r,t)||!t.charCode||t.ctrlKey&&!t.altKey||De&&t.metaKey)return;if(r.someProp("handleKeyPress",s=>s(r,t))){t.preventDefault();return}let n=r.state.selection;if(!(n instanceof D)||!n.$from.sameParent(n.$to)){let s=String.fromCharCode(t.charCode),i=()=>r.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!r.someProp("handleTextInput",o=>o(r,n.$from.pos,n.$to.pos,s,i))&&r.dispatch(i()),t.preventDefault()}};function Gs(r){return{left:r.clientX,top:r.clientY}}function Vp(r,e){let t=e.x-r.clientX,n=e.y-r.clientY;return t*t+n*n<100}function Fo(r,e,t,n,s){if(n==-1)return!1;let i=r.state.doc.resolve(n);for(let o=i.depth+1;o>0;o--)if(r.someProp(e,a=>o>i.depth?a(r,t,i.nodeAfter,i.before(o),s,!0):a(r,t,i.node(o),i.before(o),s,!1)))return!0;return!1}function Pn(r,e,t){if(r.focused||r.focus(),r.state.selection.eq(e))return;let n=r.state.tr.setSelection(e);n.setMeta("pointer",!0),r.dispatch(n)}function Hp(r,e){if(e==-1)return!1;let t=r.state.doc.resolve(e),n=t.nodeAfter;return n&&n.isAtom&&N.isSelectable(n)?(Pn(r,new N(t)),!0):!1}function Wp(r,e){if(e==-1)return!1;let t=r.state.selection,n,s;t instanceof N&&(n=t.node);let i=r.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(N.isSelectable(a)){n&&t.$from.depth>0&&o>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?s=i.before(t.$from.depth):s=i.before(o);break}}return s!=null?(Pn(r,N.create(r.state.doc,s)),!0):!1}function qp(r,e,t,n,s){return Fo(r,"handleClickOn",e,t,n)||r.someProp("handleClick",i=>i(r,e,n))||(s?Wp(r,t):Hp(r,t))}function Kp(r,e,t,n){return Fo(r,"handleDoubleClickOn",e,t,n)||r.someProp("handleDoubleClick",s=>s(r,e,n))}function Jp(r,e,t,n){return Fo(r,"handleTripleClickOn",e,t,n)||r.someProp("handleTripleClick",s=>s(r,e,n))||Gp(r,t,n)}function Gp(r,e,t){if(t.button!=0)return!1;let n=r.state.doc;if(e==-1)return n.inlineContent?(Pn(r,D.create(n,0,n.content.size)),!0):!1;let s=n.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)Pn(r,D.create(n,a+1,a+1+o.content.size));else if(N.isSelectable(o))Pn(r,N.create(n,a));else continue;return!0}}function zo(r){return is(r)}const mu=De?"metaKey":"ctrlKey";Te.mousedown=(r,e)=>{let t=e;r.input.shiftKey=t.shiftKey;let n=zo(r),s=Date.now(),i="singleClick";s-r.input.lastClick.time<500&&Vp(t,r.input.lastClick)&&!t[mu]&&r.input.lastClick.button==t.button&&(r.input.lastClick.type=="singleClick"?i="doubleClick":r.input.lastClick.type=="doubleClick"&&(i="tripleClick")),r.input.lastClick={time:s,x:t.clientX,y:t.clientY,type:i,button:t.button};let o=r.posAtCoords(Gs(t));o&&(i=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new Yp(r,o,t,!!n)):(i=="doubleClick"?Kp:Jp)(r,o.pos,o.inside,t)?t.preventDefault():_t(r,"pointer"))};class Yp{constructor(e,t,n,s){this.view=e,this.pos=t,this.event=n,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[mu],this.allowDefault=n.shiftKey;let i,o;if(t.inside>-1)i=e.state.doc.nodeAt(t.inside),o=t.inside;else{let u=e.state.doc.resolve(t.pos);i=u.parent,o=u.depth?u.before():0}const a=s?null:n.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=e.state;(n.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof N&&c.from<=o&&c.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&We&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),_t(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ut(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Gs(e))),this.updateAllowDefault(e),this.allowDefault||!t?_t(this.view,"pointer"):qp(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Se&&this.mightDrag&&!this.mightDrag.node.isAtom||be&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Pn(this.view,j.near(this.view.state.doc.resolve(t.pos))),e.preventDefault()):_t(this.view,"pointer")}move(e){this.updateAllowDefault(e),_t(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Te.touchstart=r=>{r.input.lastTouch=Date.now(),zo(r),_t(r,"pointer")};Te.touchmove=r=>{r.input.lastTouch=Date.now(),_t(r,"pointer")};Te.contextmenu=r=>zo(r);function gu(r,e){return r.composing?!0:Se&&Math.abs(e.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const Qp=lt?5e3:-1;Ce.compositionstart=Ce.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:e}=r,t=e.selection.$to;if(e.selection instanceof D&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(n=>n.type.spec.inclusive===!1)))r.markCursor=r.state.storedMarks||t.marks(),is(r,!0),r.markCursor=null;else if(is(r,!e.selection.empty),We&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length){let n=r.domSelectionRange();for(let s=n.focusNode,i=n.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=r.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}r.input.composing=!0}yu(r,Qp)};Ce.compositionend=(r,e)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=e.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,yu(r,20))};function yu(r,e){clearTimeout(r.input.composingTimeout),e>-1&&(r.input.composingTimeout=setTimeout(()=>is(r),e))}function bu(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=Zp());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function Xp(r){let e=r.domSelectionRange();if(!e.focusNode)return null;let t=Hf(e.focusNode,e.focusOffset),n=Wf(e.focusNode,e.focusOffset);if(t&&n&&t!=n){let s=n.pmViewDesc,i=r.domObserver.lastChangedTextNode;if(t==i||n==i)return i;if(!s||!s.isText(n.nodeValue))return n;if(r.input.compositionNode==n){let o=t.pmViewDesc;if(!(!o||!o.isText(t.nodeValue)))return n}}return t||n}function Zp(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function is(r,e=!1){if(!(lt&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),bu(r),e||r.docView&&r.docView.dirty){let t=$o(r),n=r.state.selection;return t&&!t.eq(n)?r.dispatch(r.state.tr.setSelection(t)):(r.markCursor||e)&&!n.$from.node(n.$from.sharedDepth(n.to)).inlineContent?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function em(r,e){if(!r.dom.parentNode)return;let t=r.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";let n=getSelection(),s=document.createRange();s.selectNodeContents(e),r.dom.blur(),n.removeAllRanges(),n.addRange(s),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),r.focus()},50)}const pr=Ee&&At<15||Rn&&Yf<604;Te.copy=Ce.cut=(r,e)=>{let t=e,n=r.state.selection,s=t.type=="cut";if(n.empty)return;let i=pr?null:t.clipboardData,o=n.content(),{dom:a,text:l}=jo(r,o);i?(t.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):em(r,a),s&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function tm(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function nm(r,e){if(!r.dom.parentNode)return;let t=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,n=r.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus();let s=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),n.parentNode&&n.parentNode.removeChild(n),t?mr(r,n.value,null,s,e):mr(r,n.textContent,n.innerHTML,s,e)},50)}function mr(r,e,t,n,s){let i=cu(r,e,t,n,r.state.selection.$from);if(r.someProp("handlePaste",l=>l(r,s,i||_.empty)))return!0;if(!i)return!1;let o=tm(i),a=o?r.state.tr.replaceSelectionWith(o,n):r.state.tr.replaceSelection(i);return r.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function vu(r){let e=r.getData("text/plain")||r.getData("Text");if(e)return e;let t=r.getData("text/uri-list");return t?t.replace(/\r?\n/g," "):""}Ce.paste=(r,e)=>{let t=e;if(r.composing&&!lt)return;let n=pr?null:t.clipboardData,s=r.input.shiftKey&&r.input.lastKeyCode!=45;n&&mr(r,vu(n),n.getData("text/html"),s,t)?t.preventDefault():nm(r,t)};class wu{constructor(e,t,n){this.slice=e,this.move=t,this.node=n}}const rm=De?"altKey":"ctrlKey";function ku(r,e){let t=r.someProp("dragCopies",n=>!n(e));return t??!e[rm]}Te.dragstart=(r,e)=>{let t=e,n=r.input.mouseDown;if(n&&n.done(),!t.dataTransfer)return;let s=r.state.selection,i=s.empty?null:r.posAtCoords(Gs(t)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof N?s.to-1:s.to))){if(n&&n.mightDrag)o=N.create(r.state.doc,n.mightDrag.pos);else if(t.target&&t.target.nodeType==1){let d=r.docView.nearestDesc(t.target,!0);d&&d.node.type.spec.draggable&&d!=r.docView&&(o=N.create(r.state.doc,d.posBefore))}}let a=(o||r.state.selection).content(),{dom:l,text:c,slice:u}=jo(r,a);(!t.dataTransfer.files.length||!be||Kc>120)&&t.dataTransfer.clearData(),t.dataTransfer.setData(pr?"Text":"text/html",l.innerHTML),t.dataTransfer.effectAllowed="copyMove",pr||t.dataTransfer.setData("text/plain",c),r.dragging=new wu(u,ku(r,t),o)};Te.dragend=r=>{let e=r.dragging;window.setTimeout(()=>{r.dragging==e&&(r.dragging=null)},50)};Ce.dragover=Ce.dragenter=(r,e)=>e.preventDefault();Ce.drop=(r,e)=>{let t=e,n=r.dragging;if(r.dragging=null,!t.dataTransfer)return;let s=r.posAtCoords(Gs(t));if(!s)return;let i=r.state.doc.resolve(s.pos),o=n&&n.slice;o?r.someProp("transformPasted",p=>{o=p(o,r)}):o=cu(r,vu(t.dataTransfer),pr?null:t.dataTransfer.getData("text/html"),!1,i);let a=!!(n&&ku(r,t));if(r.someProp("handleDrop",p=>p(r,t,o||_.empty,a))){t.preventDefault();return}if(!o)return;t.preventDefault();let l=o?jc(r.state.doc,i.pos,o):i.pos;l==null&&(l=i.pos);let c=r.state.tr;if(a){let{node:p}=n;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,h=c.doc;if(d?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(h))return;let f=c.doc.resolve(u);if(d&&N.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new N(f));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((m,g,y,v)=>p=v),c.setSelection(Lo(r,f,c.doc.resolve(p)))}r.focus(),r.dispatch(c.setMeta("uiEvent","drop"))};Te.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&ut(r)},20))};Te.blur=(r,e)=>{let t=e;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),t.relatedTarget&&r.dom.contains(t.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};Te.beforeinput=(r,e)=>{if(be&&lt&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:n}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=n||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",i=>i(r,Ut(8,"Backspace")))))return;let{$cursor:s}=r.state.selection;s&&s.pos>0&&r.dispatch(r.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let r in Ce)Te[r]=Ce[r];function gr(r,e){if(r==e)return!0;for(let t in r)if(r[t]!==e[t])return!1;for(let t in e)if(!(t in r))return!1;return!0}class as{constructor(e,t){this.toDOM=e,this.spec=t||Qt,this.side=this.spec.side||0}map(e,t,n,s){let{pos:i,deleted:o}=e.mapResult(t.from+s,this.side<0?-1:1);return o?null:new xe(i-n,i-n,this)}valid(){return!0}eq(e){return this==e||e instanceof as&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&gr(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Pt{constructor(e,t){this.attrs=e,this.spec=t||Qt}map(e,t,n,s){let i=e.map(t.from+s,this.spec.inclusiveStart?-1:1)-n,o=e.map(t.to+s,this.spec.inclusiveEnd?1:-1)-n;return i>=o?null:new xe(i,o,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof Pt&&gr(this.attrs,e.attrs)&&gr(this.spec,e.spec)}static is(e){return e.type instanceof Pt}destroy(){}}class Uo{constructor(e,t){this.attrs=e,this.spec=t||Qt}map(e,t,n,s){let i=e.mapResult(t.from+s,1);if(i.deleted)return null;let o=e.mapResult(t.to+s,-1);return o.deleted||o.pos<=i.pos?null:new xe(i.pos-n,o.pos-n,this)}valid(e,t){let{index:n,offset:s}=e.content.findIndex(t.from),i;return s==t.from&&!(i=e.child(n)).isText&&s+i.nodeSize==t.to}eq(e){return this==e||e instanceof Uo&&gr(this.attrs,e.attrs)&&gr(this.spec,e.spec)}destroy(){}}class xe{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new xe(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new xe(e,e,new as(t,n))}static inline(e,t,n,s){return new xe(e,t,new Pt(n,s))}static node(e,t,n,s){return new xe(e,t,new Uo(n,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof Pt}get widget(){return this.type instanceof as}}const Sn=[],Qt={};class Q{constructor(e,t){this.local=e.length?e:Sn,this.children=t.length?t:Sn}static create(e,t){return t.length?ls(t,e,0,Qt):ge}find(e,t,n){let s=[];return this.findInner(e??0,t??1e9,s,0,n),s}findInner(e,t,n,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=t&&a.to>=e&&(!i||i(a.spec))&&n.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<t&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,t-a,n,s+a,i)}}map(e,t,n){return this==ge||e.maps.length==0?this:this.mapInner(e,t,0,0,n||Qt)}mapInner(e,t,n,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,n,s);l&&l.type.valid(t,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?sm(this.children,o||[],e,t,n,s,i):o?new Q(o.sort(Xt),Sn):ge}add(e,t){return t.length?this==ge?Q.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let s,i=0;e.forEach((a,l)=>{let c=l+n,u;if(u=Su(t,a,c)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,u,c+1):s.splice(i,0,l,l+a.nodeSize,ls(u,a,c+1,Qt)),i+=3}});let o=xu(i?Tu(t):t,-n);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new Q(o.length?this.local.concat(o).sort(Xt):this.local,s||this.children)}remove(e){return e.length==0||this==ge?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,s=this.local;for(let i=0;i<n.length;i+=3){let o,a=n[i]+t,l=n[i+1]+t;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;n==this.children&&(n=this.children.slice());let c=n[i+2].removeInner(o,a+1);c!=ge?n[i+2]=c:(n.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,t)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return n==this.children&&s==this.local?this:s.length||n.length?new Q(s,n):ge}forChild(e,t){if(this==ge)return this;if(t.isLeaf)return Q.empty;let n,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(n=this.children[a+2]);break}let i=e+1,o=i+t.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof Pt){let c=Math.max(i,l.from)-i,u=Math.min(o,l.to)-i;c<u&&(s||(s=[])).push(l.copy(c,u))}}if(s){let a=new Q(s.sort(Xt),Sn);return n?new kt([a,n]):a}return n||ge}eq(e){if(this==e)return!0;if(!(e instanceof Q)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Vo(this.localsInner(e))}localsInner(e){if(this==ge)return Sn;if(e.inlineContent||!this.local.some(Pt.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof Pt||t.push(this.local[n]);return t}forEachSet(e){e(this)}}Q.empty=new Q([],[]);Q.removeOverlap=Vo;const ge=Q.empty;class kt{constructor(e){this.members=e}map(e,t){const n=this.members.map(s=>s.map(e,t,Qt));return kt.from(n)}forChild(e,t){if(t.isLeaf)return Q.empty;let n=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,t);i!=ge&&(i instanceof kt?n=n.concat(i.members):n.push(i))}return kt.from(n)}eq(e){if(!(e instanceof kt)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!t)t=i;else{n&&(t=t.slice(),n=!1);for(let o=0;o<i.length;o++)t.push(i[o])}}return t?Vo(n?t:t.sort(Xt)):Sn}static from(e){switch(e.length){case 0:return ge;case 1:return e[0];default:return new kt(e.every(t=>t instanceof Q)?e:e.reduce((t,n)=>t.concat(n instanceof Q?n:n.members),[]))}}forEachSet(e){for(let t=0;t<this.members.length;t++)this.members[t].forEachSet(e)}}function sm(r,e,t,n,s,i,o){let a=r.slice();for(let c=0,u=i;c<t.maps.length;c++){let d=0;t.maps[c].forEach((h,f,p,m)=>{let g=m-p-(f-h);for(let y=0;y<a.length;y+=3){let v=a[y+1];if(v<0||h>v+u-d)continue;let k=a[y]+u-d;f>=k?a[y+1]=h<=k?-2:-1:h>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=t.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=t.map(r[c]+i),d=u-s;if(d<0||d>=n.content.size){l=!0;continue}let h=t.map(r[c+1]+i,-1),f=h-s,{index:p,offset:m}=n.content.findIndex(d),g=n.maybeChild(p);if(g&&m==d&&m+g.nodeSize==f){let y=a[c+2].mapInner(t,g,u+1,r[c]+i+1,o);y!=ge?(a[c]=d,a[c+1]=f,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=im(a,r,e,t,s,i,o),u=ls(c,n,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let f=u.children[d];for(;h<a.length&&a[h]<f;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new Q(e.sort(Xt),a)}function xu(r,e){if(!e||!r.length)return r;let t=[];for(let n=0;n<r.length;n++){let s=r[n];t.push(new xe(s.from+e,s.to+e,s.type))}return t}function im(r,e,t,n,s,i,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(n,s,c);d?t.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<r.length;l+=3)r[l+1]==-1&&a(r[l+2],e[l]+i+1);return t}function Su(r,e,t){if(e.isLeaf)return null;let n=t+e.nodeSize,s=null;for(let i=0,o;i<r.length;i++)(o=r[i])&&o.from>t&&o.to<n&&((s||(s=[])).push(o),r[i]=null);return s}function Tu(r){let e=[];for(let t=0;t<r.length;t++)r[t]!=null&&e.push(r[t]);return e}function ls(r,e,t,n){let s=[],i=!1;e.forEach((a,l)=>{let c=Su(r,a,l+t);if(c){i=!0;let u=ls(c,a,t+l+1,n);u!=ge&&s.push(l,l+a.nodeSize,u)}});let o=xu(i?Tu(r):r,-t).sort(Xt);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(n.onRemove&&n.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new Q(o,s):ge}function Xt(r,e){return r.from-e.from||r.to-e.to}function Vo(r){let e=r;for(let t=0;t<e.length-1;t++){let n=e[t];if(n.from!=n.to)for(let s=t+1;s<e.length;s++){let i=e[s];if(i.from==n.from){i.to!=n.to&&(e==r&&(e=r.slice()),e[s]=i.copy(i.from,n.to),ol(e,s+1,i.copy(n.to,i.to)));continue}else{i.from<n.to&&(e==r&&(e=r.slice()),e[t]=n.copy(n.from,i.from),ol(e,s,n.copy(i.from,n.to)));break}}}return e}function ol(r,e,t){for(;e<r.length&&Xt(t,r[e])>0;)e++;r.splice(e,0,t)}function vi(r){let e=[];return r.someProp("decorations",t=>{let n=t(r.state);n&&n!=ge&&e.push(n)}),r.cursorWrapper&&e.push(Q.create(r.state.doc,[r.cursorWrapper.deco])),kt.from(e)}const om={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},am=Ee&&At<=11;class lm{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class cm{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new lm,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(n=>{for(let s=0;s<n.length;s++)this.queue.push(n[s]);Ee&&At<=11&&n.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),am&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,om)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Xa(this.view)){if(this.suppressingSelectionUpdates)return ut(this.view);if(Ee&&At<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&nn(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t=new Set,n;for(let i=e.focusNode;i;i=Nn(i))t.add(i);for(let i=e.anchorNode;i;i=Nn(i))if(t.has(i)){n=i;break}let s=n&&this.view.docView.nearestDesc(n);if(s&&s.ignoreMutation({type:"selection",target:n.nodeType==3?n.parentNode:n}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.pendingRecords();t.length&&(this.queue=[]);let n=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Xa(e)&&!this.ignoreSelectionChange(n),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<t.length;u++){let d=this.registerMutation(t[u],l);d&&(i=i<0?d.from:Math.min(d.from,i),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(We&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,h]=u;d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let h of u){let f=h.parentNode;f&&f.nodeName=="LI"&&(!d||hm(e,d)!=f)&&h.remove()}}}let c=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Ks(n)&&(c=$o(e))&&c.eq(j.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ut(e),this.currentSelection.set(n),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),um(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||ut(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];t.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let s=e.previousSibling,i=e.nextSibling;if(Ee&&At<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:h}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(s=d),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h)}let o=s&&s.parentNode==e.target?pe(s)+1:0,a=n.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?pe(i):e.target.childNodes.length,c=n.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=e.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let al=new WeakMap,ll=!1;function um(r){if(!al.has(r)&&(al.set(r,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(r.dom).whiteSpace)!==-1)){if(r.requiresGeckoHackNode=We,ll)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),ll=!0}}function cl(r,e){let t=e.startContainer,n=e.startOffset,s=e.endContainer,i=e.endOffset,o=r.domAtPos(r.state.selection.anchor);return nn(o.node,o.offset,s,i)&&([t,n,s,i]=[s,i,t,n]),{anchorNode:t,anchorOffset:n,focusNode:s,focusOffset:i}}function dm(r,e){if(e.getComposedRanges){let s=e.getComposedRanges(r.root)[0];if(s)return cl(r,s)}let t;function n(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return r.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),r.dom.removeEventListener("beforeinput",n,!0),t?cl(r,t):null}function hm(r,e){for(let t=e.parentNode;t&&t!=r.dom;t=t.parentNode){let n=r.docView.nearestDesc(t,!0);if(n&&n.node.isBlock)return t}return null}function fm(r,e,t){let{node:n,fromOffset:s,toOffset:i,from:o,to:a}=r.docView.parseRange(e,t),l=r.domSelectionRange(),c,u=l.anchorNode;if(u&&r.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Ks(l)||c.push({node:l.focusNode,offset:l.focusOffset})),be&&r.input.lastKeyCode===8)for(let g=i;g>s;g--){let y=n.childNodes[g-1],v=y.pmViewDesc;if(y.nodeName=="BR"&&!v){i=g;break}if(!v||v.size)break}let d=r.state.doc,h=r.someProp("domParser")||Ot.fromSchema(r.state.schema),f=d.resolve(o),p=null,m=h.parse(n,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:s,to:i,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:pm,context:f});if(c&&c[0].pos!=null){let g=c[0].pos,y=c[1]&&c[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:a}}function pm(r){let e=r.pmViewDesc;if(e)return e.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(Se&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(r.parentNode.lastChild==r||Se&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0};return null}const mm=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function gm(r,e,t,n,s){let i=r.input.compositionPendingChanges||(r.composing?r.input.compositionID:0);if(r.input.compositionPendingChanges=0,e<0){let M=r.input.lastSelectionTime>Date.now()-50?r.input.lastSelectionOrigin:null,H=$o(r,M);if(H&&!r.state.selection.eq(H)){if(be&&lt&&r.input.lastKeyCode===13&&Date.now()-100<r.input.lastKeyCodeTime&&r.someProp("handleKeyDown",Ke=>Ke(r,Ut(13,"Enter"))))return;let Y=r.state.tr.setSelection(H);M=="pointer"?Y.setMeta("pointer",!0):M=="key"&&Y.scrollIntoView(),i&&Y.setMeta("composition",i),r.dispatch(Y)}return}let o=r.state.doc.resolve(e),a=o.sharedDepth(t);e=o.before(a+1),t=r.state.doc.resolve(t).after(a+1);let l=r.state.selection,c=fm(r,e,t),u=r.state.doc,d=u.slice(c.from,c.to),h,f;r.input.lastKeyCode===8&&Date.now()-100<r.input.lastKeyCodeTime?(h=r.state.selection.to,f="end"):(h=r.state.selection.from,f="start"),r.input.lastKeyCode=null;let p=vm(d.content,c.doc.content,c.from,h,f);if(p&&r.input.domChangeCount++,(Rn&&r.input.lastIOSEnter>Date.now()-225||lt)&&s.some(M=>M.nodeType==1&&!mm.test(M.nodeName))&&(!p||p.endA>=p.endB)&&r.someProp("handleKeyDown",M=>M(r,Ut(13,"Enter")))){r.input.lastIOSEnter=0;return}if(!p)if(n&&l instanceof D&&!l.empty&&l.$head.sameParent(l.$anchor)&&!r.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let M=ul(r,r.state.doc,c.sel);if(M&&!M.eq(r.state.selection)){let H=r.state.tr.setSelection(M);i&&H.setMeta("composition",i),r.dispatch(H)}}return}r.state.selection.from<r.state.selection.to&&p.start==p.endB&&r.state.selection instanceof D&&(p.start>r.state.selection.from&&p.start<=r.state.selection.from+2&&r.state.selection.from>=c.from?p.start=r.state.selection.from:p.endA<r.state.selection.to&&p.endA>=r.state.selection.to-2&&r.state.selection.to<=c.to&&(p.endB+=r.state.selection.to-p.endA,p.endA=r.state.selection.to)),Ee&&At<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" "&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),y=u.resolve(p.start),v=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=p.endA,k;if((Rn&&r.input.lastIOSEnter>Date.now()-225&&(!v||s.some(M=>M.nodeName=="DIV"||M.nodeName=="P"))||!v&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"",""))&&(k=j.findFrom(c.doc.resolve(m.pos+1),1,!0))&&k.head>m.pos)&&r.someProp("handleKeyDown",M=>M(r,Ut(13,"Enter")))){r.input.lastIOSEnter=0;return}if(r.state.selection.anchor>p.start&&bm(u,p.start,p.endA,m,g)&&r.someProp("handleKeyDown",M=>M(r,Ut(8,"Backspace")))){lt&&be&&r.domObserver.suppressSelectionUpdates();return}be&&p.endB==p.start&&(r.input.lastChromeDelete=Date.now()),lt&&!v&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{r.someProp("handleKeyDown",function(M){return M(r,Ut(13,"Enter"))})},20));let C=p.start,E=p.endA,O=M=>{let H=M||r.state.tr.replace(C,E,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let Y=ul(r,H.doc,c.sel);Y&&!(be&&r.composing&&Y.empty&&(p.start!=p.endB||r.input.lastChromeDelete<Date.now()-100)&&(Y.head==C||Y.head==H.mapping.map(E)-1)||Ee&&Y.empty&&Y.head==C)&&H.setSelection(Y)}return i&&H.setMeta("composition",i),H.scrollIntoView()},L;if(v){if(m.pos==g.pos){Ee&&At<=11&&m.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(()=>ut(r),20));let M=O(r.state.tr.delete(C,E)),H=u.resolve(p.start).marksAcross(u.resolve(p.endA));H&&M.ensureMarks(H),r.dispatch(M)}else if(p.endA==p.endB&&(L=ym(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let M=O(r.state.tr);L.type=="add"?M.addMark(C,E,L.mark):M.removeMark(C,E,L.mark),r.dispatch(M)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let M=m.parent.textBetween(m.parentOffset,g.parentOffset),H=()=>O(r.state.tr.insertText(M,C,E));r.someProp("handleTextInput",Y=>Y(r,C,E,M,H))||r.dispatch(H())}}else r.dispatch(O())}function ul(r,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:Lo(r,e.resolve(t.anchor),e.resolve(t.head))}function ym(r,e){let t=r.firstChild.marks,n=e.firstChild.marks,s=t,i=n,o,a,l;for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);for(let u=0;u<t.length;u++)i=t[u].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(x.from(c).eq(r))return{mark:a,type:o}}function bm(r,e,t,n,s){if(t-e<=s.pos-n.pos||wi(n,!0,!1)<s.pos)return!1;let i=r.resolve(e);if(!n.parent.isTextblock){let a=i.nodeAfter;return a!=null&&t==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=r.resolve(wi(i,!0,!0));return!o.parent.isTextblock||o.pos>t||wi(o,!0,!1)<t?!1:n.parent.content.cut(n.parentOffset).eq(o.parent.content)}function wi(r,e,t){let n=r.depth,s=e?r.end():r.pos;for(;n>0&&(e||r.indexAfter(n)==r.node(n).childCount);)n--,s++,e=!1;if(t){let i=r.node(n).maybeChild(r.indexAfter(n));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function vm(r,e,t,n,s){let i=r.findDiffStart(e,t);if(i==null)return null;let{a:o,b:a}=r.findDiffEnd(e,t+r.size,t+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));n-=o+l-i}if(o<i&&r.size<e.size){let l=n<=i&&n>=o?i-n:0;i-=l,i&&i<e.size&&dl(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=n<=i&&n>=a?i-n:0;i-=l,i&&i<r.size&&dl(r.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function dl(r){if(r.length!=2)return!1;let e=r.charCodeAt(0),t=r.charCodeAt(1);return e>=56320&&e<=57343&&t>=55296&&t<=56319}class Cu{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new jp,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(gl),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=pl(this),fl(this),this.nodeViews=ml(this),this.docView=qa(this.state.doc,hl(this),vi(this),this.dom,this),this.domObserver=new cm(this,(n,s,i,o)=>gm(this,n,s,i,o)),this.domObserver.start(),Bp(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&no(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(gl),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){var n;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(bu(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=t.plugins;if(a||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let f=ml(this);km(f,this.nodeViews)&&(this.nodeViews=f,i=!0)}(a||t.handleDOMEvents!=this._props.handleDOMEvents)&&no(this),this.editable=pl(this),fl(this);let l=vi(this),c=hl(this),u=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",d=i||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(s.selection))&&(o=!0);let h=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&Zf(this);if(o){this.domObserver.stop();let f=d&&(Ee||be)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&wm(s.selection,e.selection);if(d){let p=be?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Xp(this)),(i||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=qa(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Sp(this))?ut(this,f):(ou(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((n=this.dragging)===null||n===void 0)&&n.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&ep(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",t=>t(this)))if(this.state.selection instanceof N){let t=this.docView.domAfterPos(this.state.selection.from);t.nodeType==1&&Fa(this,t.getBoundingClientRect(),e)}else Fa(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let n=this.directPlugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let n=this.state.plugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}}else for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}}updateDraggedNode(e,t){let n=e.node,s=-1;if(this.state.doc.nodeAt(n.from)==n.node)s=n.from;else{let i=n.from+(this.state.doc.content.size-t.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==n.node&&(s=i)}this.dragging=new wu(e.slice,e.move,s<0?void 0:N.create(this.state.doc,s))}someProp(e,t){let n=this._props&&this._props[e],s;if(n!=null&&(s=t?t(n):n))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=t?t(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=t?t(a):a))return s}}hasFocus(){if(Ee){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&tp(this.dom),ut(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let t=this.dom.parentNode;t;t=t.parentNode)if(t.nodeType==9||t.nodeType==11&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t}return e||document}updateRoot(){this._root=null}posAtCoords(e){return op(this,e)}coordsAtPos(e,t=1){return Xc(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let s=this.docView.posFromDOM(e,t,n);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,t){return dp(this,t||this.state,e)}pasteHTML(e,t){return mr(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return mr(this,e,null,!0,t||new ClipboardEvent("paste"))}serializeForClipboard(e){return jo(this,e)}destroy(){this.docView&&(Fp(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],vi(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Uf())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Up(this,e)}domSelectionRange(){let e=this.domSelection();return e?Se&&this.root.nodeType===11&&Kf(this.dom.ownerDocument)==this.dom&&dm(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}Cu.prototype.dispatch=function(r){let e=this._props.dispatchTransaction;e?e.call(this,r):this.updateState(this.state.apply(r))};function hl(r){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(r.editable),r.someProp("attributes",t=>{if(typeof t=="function"&&(t=t(r.state)),t)for(let n in t)n=="class"?e.class+=" "+t[n]:n=="style"?e.style=(e.style?e.style+";":"")+t[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(t[n]))}),e.translate||(e.translate="no"),[xe.node(0,r.state.doc.content.size,e)]}function fl(r){if(r.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),r.cursorWrapper={dom:e,deco:xe.widget(r.state.selection.from,e,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function pl(r){return!r.someProp("editable",e=>e(r.state)===!1)}function wm(r,e){let t=Math.min(r.$anchor.sharedDepth(r.head),e.$anchor.sharedDepth(e.head));return r.$anchor.start(t)!=e.$anchor.start(t)}function ml(r){let e=Object.create(null);function t(n){for(let s in n)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=n[s])}return r.someProp("nodeViews",t),r.someProp("markViews",t),e}function km(r,e){let t=0,n=0;for(let s in r){if(r[s]!=e[s])return!0;t++}for(let s in e)n++;return t!=n}function gl(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var It={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},cs={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},xm=typeof navigator<"u"&&/Mac/.test(navigator.platform),Sm=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var me=0;me<10;me++)It[48+me]=It[96+me]=String(me);for(var me=1;me<=24;me++)It[me+111]="F"+me;for(var me=65;me<=90;me++)It[me]=String.fromCharCode(me+32),cs[me]=String.fromCharCode(me);for(var ki in It)cs.hasOwnProperty(ki)||(cs[ki]=It[ki]);function Tm(r){var e=xm&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||Sm&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",t=!e&&r.key||(r.shiftKey?cs:It)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}const Cm=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),_m=typeof navigator<"u"&&/Win/.test(navigator.platform);function Em(r){let e=r.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");let n,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Cm?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(t="Alt-"+t),s&&(t="Ctrl-"+t),o&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function Om(r){let e=Object.create(null);for(let t in r)e[Em(t)]=r[t];return e}function xi(r,e,t=!0){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t&&e.shiftKey&&(r="Shift-"+r),r}function Am(r){return new te({props:{handleKeyDown:_u(r)}})}function _u(r){let e=Om(r);return function(t,n){let s=Tm(n),i,o=e[xi(s,n)];if(o&&o(t.state,t.dispatch,t))return!0;if(s.length==1&&s!=" "){if(n.shiftKey){let a=e[xi(s,n,!1)];if(a&&a(t.state,t.dispatch,t))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(_m&&n.ctrlKey&&n.altKey)&&(i=It[n.keyCode])&&i!=s){let a=e[xi(i,n)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}const Ho=(r,e)=>r.selection.empty?!1:(e&&e(r.tr.deleteSelection().scrollIntoView()),!0);function Eu(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("backward",r):t.parentOffset>0)?null:t}const Ou=(r,e,t)=>{let n=Eu(r,t);if(!n)return!1;let s=Wo(n);if(!s){let o=n.blockRange(),a=o&&Fn(o);return a==null?!1:(e&&e(r.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(Lu(r,s,e,-1))return!0;if(n.parent.content.size==0&&(Dn(i,"end")||N.isSelectable(i)))for(let o=n.depth;;o--){let a=Ws(r.doc,n.before(o),n.after(o),_.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=r.tr.step(a);l.setSelection(Dn(i,"end")?j.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):N.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||n.node(o-1).childCount>1)break}return i.isAtom&&s.depth==n.depth-1?(e&&e(r.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},Mm=(r,e,t)=>{let n=Eu(r,t);if(!n)return!1;let s=Wo(n);return s?Au(r,s,e):!1},Pm=(r,e,t)=>{let n=Pu(r,t);if(!n)return!1;let s=qo(n);return s?Au(r,s,e):!1};function Au(r,e,t){let n=e.nodeBefore,s=n,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let u=s.lastChild;if(!u)return!1;s=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=Ws(r.doc,i,l,_.empty);if(!c||c.from!=i||c instanceof ce&&c.slice.size>=l-i)return!1;if(t){let u=r.tr.step(c);u.setSelection(D.create(u.doc,i)),t(u.scrollIntoView())}return!0}function Dn(r,e,t=!1){for(let n=r;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(t&&n.childCount!=1)return!1}return!1}const Mu=(r,e,t)=>{let{$head:n,empty:s}=r.selection,i=n;if(!s)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("backward",r):n.parentOffset>0)return!1;i=Wo(n)}let o=i&&i.nodeBefore;return!o||!N.isSelectable(o)?!1:(e&&e(r.tr.setSelection(N.create(r.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function Wo(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){if(r.index(e)>0)return r.doc.resolve(r.before(e+1));if(r.node(e).type.spec.isolating)break}return null}function Pu(r,e){let{$cursor:t}=r.selection;return!t||(e?!e.endOfTextblock("forward",r):t.parentOffset<t.parent.content.size)?null:t}const Iu=(r,e,t)=>{let n=Pu(r,t);if(!n)return!1;let s=qo(n);if(!s)return!1;let i=s.nodeAfter;if(Lu(r,s,e,1))return!0;if(n.parent.content.size==0&&(Dn(i,"start")||N.isSelectable(i))){let o=Ws(r.doc,n.before(),n.after(),_.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=r.tr.step(o);a.setSelection(Dn(i,"start")?j.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):N.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==n.depth-1?(e&&e(r.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},Nu=(r,e,t)=>{let{$head:n,empty:s}=r.selection,i=n;if(!s)return!1;if(n.parent.isTextblock){if(t?!t.endOfTextblock("forward",r):n.parentOffset<n.parent.content.size)return!1;i=qo(n)}let o=i&&i.nodeAfter;return!o||!N.isSelectable(o)?!1:(e&&e(r.tr.setSelection(N.create(r.doc,i.pos)).scrollIntoView()),!0)};function qo(r){if(!r.parent.type.spec.isolating)for(let e=r.depth-1;e>=0;e--){let t=r.node(e);if(r.index(e)+1<t.childCount)return r.doc.resolve(r.after(e+1));if(t.type.spec.isolating)break}return null}const Im=(r,e)=>{let t=r.selection,n=t instanceof N,s;if(n){if(t.node.isTextblock||!Rt(r.doc,t.from))return!1;s=t.from}else if(s=Hs(r.doc,t.from,-1),s==null)return!1;if(e){let i=r.tr.join(s);n&&i.setSelection(N.create(i.doc,s-r.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},Nm=(r,e)=>{let t=r.selection,n;if(t instanceof N){if(t.node.isTextblock||!Rt(r.doc,t.to))return!1;n=t.to}else if(n=Hs(r.doc,t.to,1),n==null)return!1;return e&&e(r.tr.join(n).scrollIntoView()),!0},Rm=(r,e)=>{let{$from:t,$to:n}=r.selection,s=t.blockRange(n),i=s&&Fn(s);return i==null?!1:(e&&e(r.tr.lift(s,i).scrollIntoView()),!0)},Ru=(r,e)=>{let{$head:t,$anchor:n}=r.selection;return!t.parent.type.spec.code||!t.sameParent(n)?!1:(e&&e(r.tr.insertText(`
`).scrollIntoView()),!0)};function Ko(r){for(let e=0;e<r.edgeCount;e++){let{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}const Dm=(r,e)=>{let{$head:t,$anchor:n}=r.selection;if(!t.parent.type.spec.code||!t.sameParent(n))return!1;let s=t.node(-1),i=t.indexAfter(-1),o=Ko(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=t.after(),l=r.tr.replaceWith(a,a,o.createAndFill());l.setSelection(j.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},Du=(r,e)=>{let t=r.selection,{$from:n,$to:s}=t;if(t instanceof Pe||n.parent.inlineContent||s.parent.inlineContent)return!1;let i=Ko(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!n.parentOffset&&s.index()<s.parent.childCount?n:s).pos,a=r.tr.insert(o,i.createAndFill());a.setSelection(D.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},$u=(r,e)=>{let{$cursor:t}=r.selection;if(!t||t.parent.content.size)return!1;if(t.depth>1&&t.after()!=t.end(-1)){let i=t.before();if(ct(r.doc,i))return e&&e(r.tr.split(i).scrollIntoView()),!0}let n=t.blockRange(),s=n&&Fn(n);return s==null?!1:(e&&e(r.tr.lift(n,s).scrollIntoView()),!0)};function $m(r){return(e,t)=>{let{$from:n,$to:s}=e.selection;if(e.selection instanceof N&&e.selection.node.isBlock)return!n.parentOffset||!ct(e.doc,n.pos)?!1:(t&&t(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.depth)return!1;let i=[],o,a,l=!1,c=!1;for(let f=n.depth;;f--)if(n.node(f).isBlock){l=n.end(f)==n.pos+(n.depth-f),c=n.start(f)==n.pos-(n.depth-f),a=Ko(n.node(f-1).contentMatchAt(n.indexAfter(f-1))),i.unshift(l&&a?{type:a}:null),o=f;break}else{if(f==1)return!1;i.unshift(null)}let u=e.tr;(e.selection instanceof D||e.selection instanceof Pe)&&u.deleteSelection();let d=u.mapping.map(n.pos),h=ct(u.doc,d,i.length,i);if(h||(i[0]=a?{type:a}:null,h=ct(u.doc,d,i.length,i)),!h)return!1;if(u.split(d,i.length,i),!l&&c&&n.node(o).type!=a){let f=u.mapping.map(n.before(o)),p=u.doc.resolve(f);a&&n.node(o-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(n.before(o)),a)}return t&&t(u.scrollIntoView()),!0}}const Lm=$m(),jm=(r,e)=>{let{$from:t,to:n}=r.selection,s,i=t.sharedDepth(n);return i==0?!1:(s=t.before(i),e&&e(r.tr.setSelection(N.create(r.doc,s))),!0)};function Bm(r,e,t){let n=e.nodeBefore,s=e.nodeAfter,i=e.index();return!n||!s||!n.type.compatibleContent(s.type)?!1:!n.content.size&&e.parent.canReplace(i-1,i)?(t&&t(r.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||Rt(r.doc,e.pos))?!1:(t&&t(r.tr.join(e.pos).scrollIntoView()),!0)}function Lu(r,e,t,n){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&Bm(r,e,t))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(t){let f=e.pos+i.nodeSize,p=x.empty;for(let y=o.length-1;y>=0;y--)p=x.from(o[y].create(null,p));p=x.from(s.copy(p));let m=r.tr.step(new ue(e.pos-1,f,e.pos,f,new _(p,1,0),o.length,!0)),g=m.doc.resolve(f+2*o.length);g.nodeAfter&&g.nodeAfter.type==s.type&&Rt(m.doc,g.pos)&&m.join(g.pos),t(m.scrollIntoView())}return!0}let u=i.type.spec.isolating||n>0&&l?null:j.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),h=d&&Fn(d);if(h!=null&&h>=e.depth)return t&&t(r.tr.lift(d,h).scrollIntoView()),!0;if(c&&Dn(i,"start",!0)&&Dn(s,"end")){let f=s,p=[];for(;p.push(f),!f.isTextblock;)f=f.lastChild;let m=i,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(f.canReplace(f.childCount,f.childCount,m.content)){if(t){let y=x.empty;for(let k=p.length-1;k>=0;k--)y=x.from(p[k].copy(y));let v=r.tr.step(new ue(e.pos-p.length,e.pos+i.nodeSize,e.pos+g,e.pos+i.nodeSize-g,new _(y,p.length,0),0,!0));t(v.scrollIntoView())}return!0}}return!1}function ju(r){return function(e,t){let n=e.selection,s=r<0?n.$from:n.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(t&&t(e.tr.setSelection(D.create(e.doc,r<0?s.start(i):s.end(i)))),!0):!1}}const Fm=ju(-1),zm=ju(1);function Um(r,e=null){return function(t,n){let{$from:s,$to:i}=t.selection,o=s.blockRange(i),a=o&&No(o,r,e);return a?(n&&n(t.tr.wrap(o,a).scrollIntoView()),!0):!1}}function yl(r,e=null){return function(t,n){let s=!1;for(let i=0;i<t.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=t.selection.ranges[i];t.doc.nodesBetween(o,a,(l,c)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(r,e)))if(l.type==r)s=!0;else{let u=t.doc.resolve(c),d=u.index();s=u.parent.canReplaceWith(d,d+1,r)}})}if(!s)return!1;if(n){let i=t.tr;for(let o=0;o<t.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=t.selection.ranges[o];i.setBlockType(a,l,r,e)}n(i.scrollIntoView())}return!0}}function Jo(...r){return function(e,t,n){for(let s=0;s<r.length;s++)if(r[s](e,t,n))return!0;return!1}}Jo(Ho,Ou,Mu);Jo(Ho,Iu,Nu);Jo(Ru,Du,$u,Lm);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Vm(r,e=null){return function(t,n){let{$from:s,$to:i}=t.selection,o=s.blockRange(i);if(!o)return!1;let a=n?t.tr:null;return Hm(a,o,r,e)?(n&&n(a.scrollIntoView()),!0):!1}}function Hm(r,e,t,n=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(t)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new ts(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new ts(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=No(i,t,n,e);return a?(r&&Wm(r,e,a,s,t),!0):!1}function Wm(r,e,t,n,s){let i=x.empty;for(let u=t.length-1;u>=0;u--)i=x.from(t[u].type.create(t[u].attrs,i));r.step(new ue(e.start-(n?2:0),e.end,e.start,e.end,new _(i,0,0),t.length,!0));let o=0;for(let u=0;u<t.length;u++)t[u].type==s&&(o=u+1);let a=t.length-o,l=e.start+t.length-(n?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,h=!0;u<d;u++,h=!1)!h&&ct(r.doc,l,a)&&(r.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return r}function qm(r){return function(e,t){let{$from:n,$to:s}=e.selection,i=n.blockRange(s,o=>o.childCount>0&&o.firstChild.type==r);return i?t?n.node(i.depth-1).type==r?Km(e,t,r,i):Jm(e,t,i):!0:!1}}function Km(r,e,t,n){let s=r.tr,i=n.end,o=n.$to.end(n.depth);i<o&&(s.step(new ue(i-1,o,i,o,new _(x.from(t.create(null,n.parent.copy())),1,0),1,!0)),n=new ts(s.doc.resolve(n.$from.pos),s.doc.resolve(o),n.depth));const a=Fn(n);if(a==null)return!1;s.lift(n,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return Rt(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function Jm(r,e,t){let n=r.tr,s=t.parent;for(let f=t.end,p=t.endIndex-1,m=t.startIndex;p>m;p--)f-=s.child(p).nodeSize,n.delete(f-1,f+1);let i=n.doc.resolve(t.start),o=i.nodeAfter;if(n.mapping.map(t.end)!=t.start+i.nodeAfter.nodeSize)return!1;let a=t.startIndex==0,l=t.endIndex==s.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?x.empty:x.from(s))))return!1;let d=i.pos,h=d+o.nodeSize;return n.step(new ue(d-(a?1:0),h+(l?1:0),d+1,h-1,new _((a?x.empty:x.from(s.copy(x.empty))).append(l?x.empty:x.from(s.copy(x.empty))),a?0:1,l?0:1),a?0:1)),e(n.scrollIntoView()),!0}function Gm(r){return function(e,t){let{$from:n,$to:s}=e.selection,i=n.blockRange(s,c=>c.childCount>0&&c.firstChild.type==r);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=r)return!1;if(t){let c=l.lastChild&&l.lastChild.type==a.type,u=x.from(c?r.create():null),d=new _(x.from(r.create(null,x.from(a.type.create(null,u)))),c?3:1,0),h=i.start,f=i.end;t(e.tr.step(new ue(h-(c?3:1),f,h,f,d,1,!0)).scrollIntoView())}return!0}}var Ym=Object.defineProperty,Bu=(r,e)=>{for(var t in e)Ym(r,t,{get:e[t],enumerable:!0})};function Ys(r){const{state:e,transaction:t}=r;let{selection:n}=t,{doc:s}=t,{storedMarks:i}=t;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return n},get doc(){return s},get tr(){return n=t.selection,s=t.doc,i=t.storedMarks,t}}}var Qs=class{constructor(r){this.editor=r.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=r.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:r,editor:e,state:t}=this,{view:n}=e,{tr:s}=t,i=this.buildProps(s);return Object.fromEntries(Object.entries(r).map(([o,a])=>[o,(...c)=>{const u=a(...c)(i);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&n.dispatch(s),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(r,e=!0){const{rawCommands:t,editor:n,state:s}=this,{view:i}=n,o=[],a=!!r,l=r||s.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),o.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(t).map(([d,h])=>[d,(...p)=>{const m=this.buildProps(l,e),g=h(...p)(m);return o.push(g),u}])),run:c};return u}createCan(r){const{rawCommands:e,state:t}=this,n=!1,s=r||t.tr,i=this.buildProps(s,n);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...i,dispatch:void 0})])),chain:()=>this.createChain(s,n)}}buildProps(r,e=!0){const{rawCommands:t,editor:n,state:s}=this,{view:i}=n,o={tr:r,editor:n,view:i,state:Ys({state:s,transaction:r}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(r,e),can:()=>this.createCan(r),get commands(){return Object.fromEntries(Object.entries(t).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},Qm=class{constructor(){this.callbacks={}}on(r,e){return this.callbacks[r]||(this.callbacks[r]=[]),this.callbacks[r].push(e),this}emit(r,...e){const t=this.callbacks[r];return t&&t.forEach(n=>n.apply(this,e)),this}off(r,e){const t=this.callbacks[r];return t&&(e?this.callbacks[r]=t.filter(n=>n!==e):delete this.callbacks[r]),this}once(r,e){const t=(...n)=>{this.off(r,t),e.apply(this,n)};return this.on(r,t)}removeAllListeners(){this.callbacks={}}};function Fu(r,e){const t=new Vc(r);return e.forEach(n=>{n.steps.forEach(s=>{t.step(s)})}),t}var zu=r=>{const e=r.childNodes;for(let t=e.length-1;t>=0;t-=1){const n=e[t];n.nodeType===3&&n.nodeValue&&/^(\n\s\s|\n)$/.test(n.nodeValue)?r.removeChild(n):n.nodeType===1&&zu(n)}return r};function Ir(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${r}</body>`,t=new window.DOMParser().parseFromString(e,"text/html").body;return zu(t)}function yr(r,e,t){if(r instanceof He||r instanceof x)return r;t={slice:!0,parseOptions:{},...t};const n=typeof r=="object"&&r!==null,s=typeof r=="string";if(n)try{if(Array.isArray(r)&&r.length>0)return x.fromArray(r.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(r);return t.errorOnInvalidContent&&o.check(),o}catch(i){if(t.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",i),yr("",e,t)}if(s){if(t.errorOnInvalidContent){let o=!1,a="";const l=new Ec({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(t.slice?Ot.fromSchema(l).parseSlice(Ir(r),t.parseOptions):Ot.fromSchema(l).parse(Ir(r),t.parseOptions),t.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=Ot.fromSchema(e);return t.slice?i.parseSlice(Ir(r),t.parseOptions).content:i.parse(Ir(r),t.parseOptions)}return yr("",e,t)}function ro(r,e,t={},n={}){return yr(r,e,{slice:!1,parseOptions:t,errorOnInvalidContent:n.errorOnInvalidContent})}function Xm(r){for(let e=0;e<r.edgeCount;e+=1){const{type:t}=r.edge(e);if(t.isTextblock&&!t.hasRequiredAttrs())return t}return null}function Zm(r,e,t){const n=[];return r.nodesBetween(e.from,e.to,(s,i)=>{t(s)&&n.push({node:s,pos:i})}),n}function eg(r,e){for(let t=r.depth;t>0;t-=1){const n=r.node(t);if(e(n))return{pos:t>0?r.before(t):0,start:r.start(t),depth:t,node:n}}}function Xs(r){return e=>eg(e.$from,r)}function I(r,e,t){return r.config[e]===void 0&&r.parent?I(r.parent,e,t):typeof r.config[e]=="function"?r.config[e].bind({...t,parent:r.parent?I(r.parent,e,t):null}):r.config[e]}function Go(r){return r.map(e=>{const t={name:e.name,options:e.options,storage:e.storage},n=I(e,"addExtensions",t);return n?[e,...Go(n())]:e}).flat(10)}function Yo(r,e){const t=on.fromSchema(e).serializeFragment(r),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(t),s.innerHTML}function Uu(r){return typeof r=="function"}function W(r,e=void 0,...t){return Uu(r)?e?r.bind(e)(...t):r(...t):r}function tg(r={}){return Object.keys(r).length===0&&r.constructor===Object}function br(r){const e=r.filter(s=>s.type==="extension"),t=r.filter(s=>s.type==="node"),n=r.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:t,markExtensions:n}}function Vu(r){const e=[],{nodeExtensions:t,markExtensions:n}=br(r),s=[...t,...n],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return r.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=I(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,f])=>{e.push({type:d,name:h,attribute:{...i,...f}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=I(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const h={...i,...d};typeof h?.default=="function"&&(h.default=h.default()),h?.isRequired&&h?.default===void 0&&delete h.default,e.push({type:o.name,name:u,attribute:h})})}),e}function ne(...r){return r.filter(e=>!!e).reduce((e,t)=>{const n={...e};return Object.entries(t).forEach(([s,i])=>{if(!n[s]){n[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=n[s]?n[s].split(" "):[],c=a.filter(u=>!l.includes(u));n[s]=[...l,...c].join(" ")}else if(s==="style"){const a=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],l=n[s]?n[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),n[s]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else n[s]=i}),n},{})}function us(r,e){return e.filter(t=>t.type===r.type.name).filter(t=>t.attribute.rendered).map(t=>t.attribute.renderHTML?t.attribute.renderHTML(r.attrs)||{}:{[t.name]:r.attrs[t.name]}).reduce((t,n)=>ne(t,n),{})}function ng(r){return typeof r!="string"?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):r==="true"?!0:r==="false"?!1:r}function bl(r,e){return"style"in r?r:{...r,getAttrs:t=>{const n=r.getAttrs?r.getAttrs(t):r.attrs;if(n===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(t):ng(t.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...n,...s}}}}function vl(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>e==="attrs"&&tg(t)?!1:t!=null))}function rg(r,e){var t;const n=Vu(r),{nodeExtensions:s,markExtensions:i}=br(r),o=(t=s.find(c=>I(c,"topNode")))==null?void 0:t.name,a=Object.fromEntries(s.map(c=>{const u=n.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=r.reduce((y,v)=>{const k=I(v,"extendNodeSchema",d);return{...y,...k?k(c):{}}},{}),f=vl({...h,content:W(I(c,"content",d)),marks:W(I(c,"marks",d)),group:W(I(c,"group",d)),inline:W(I(c,"inline",d)),atom:W(I(c,"atom",d)),selectable:W(I(c,"selectable",d)),draggable:W(I(c,"draggable",d)),code:W(I(c,"code",d)),whitespace:W(I(c,"whitespace",d)),linebreakReplacement:W(I(c,"linebreakReplacement",d)),defining:W(I(c,"defining",d)),isolating:W(I(c,"isolating",d)),attrs:Object.fromEntries(u.map(y=>{var v,k;return[y.name,{default:(v=y?.attribute)==null?void 0:v.default,validate:(k=y?.attribute)==null?void 0:k.validate}]}))}),p=W(I(c,"parseHTML",d));p&&(f.parseDOM=p.map(y=>bl(y,u)));const m=I(c,"renderHTML",d);m&&(f.toDOM=y=>m({node:y,HTMLAttributes:us(y,u)}));const g=I(c,"renderText",d);return g&&(f.toText=g),[c.name,f]})),l=Object.fromEntries(i.map(c=>{const u=n.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=r.reduce((g,y)=>{const v=I(y,"extendMarkSchema",d);return{...g,...v?v(c):{}}},{}),f=vl({...h,inclusive:W(I(c,"inclusive",d)),excludes:W(I(c,"excludes",d)),group:W(I(c,"group",d)),spanning:W(I(c,"spanning",d)),code:W(I(c,"code",d)),attrs:Object.fromEntries(u.map(g=>{var y,v;return[g.name,{default:(y=g?.attribute)==null?void 0:y.default,validate:(v=g?.attribute)==null?void 0:v.validate}]}))}),p=W(I(c,"parseHTML",d));p&&(f.parseDOM=p.map(g=>bl(g,u)));const m=I(c,"renderHTML",d);return m&&(f.toDOM=g=>m({mark:g,HTMLAttributes:us(g,u)})),[c.name,f]}));return new Ec({topNode:o,nodes:a,marks:l})}function sg(r){const e=r.filter((t,n)=>r.indexOf(t)!==n);return Array.from(new Set(e))}function Qo(r){return r.sort((t,n)=>{const s=I(t,"priority")||100,i=I(n,"priority")||100;return s>i?-1:s<i?1:0})}function Hu(r){const e=Qo(Go(r)),t=sg(e.map(n=>n.name));return t.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${t.map(n=>`'${n}'`).join(", ")}]. This can lead to issues.`),e}function Wu(r,e,t){const{from:n,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=t||{};let a="";return r.nodesBetween(n,s,(l,c,u,d)=>{var h;l.isBlock&&c>n&&(a+=i);const f=o?.[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l?.text)==null?void 0:h.slice(Math.max(n,c)-c,s-c))}),a}function ig(r,e){const t={from:0,to:r.content.size};return Wu(r,t,e)}function qu(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,e])=>e.spec.toText).map(([e,t])=>[e,t.spec.toText]))}function ht(r,e){if(typeof r=="string"){if(!e.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return e.marks[r]}return r}function Ku(r,e){const t=ht(e,r.schema),{from:n,to:s,empty:i}=r.selection,o=[];i?(r.storedMarks&&o.push(...r.storedMarks),o.push(...r.selection.$head.marks())):r.doc.nodesBetween(n,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===t.name);return a?{...a.attrs}:{}}function se(r,e){if(typeof r=="string"){if(!e.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return e.nodes[r]}return r}function og(r,e){const t=se(e,r.schema),{from:n,to:s}=r.selection,i=[];r.doc.nodesBetween(n,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===t.name);return o?{...o.attrs}:{}}function Zs(r,e){return e.nodes[r]?"node":e.marks[r]?"mark":null}function Ju(r,e){const t=Zs(typeof e=="string"?e:e.name,r.schema);return t==="node"?og(r,e):t==="mark"?Ku(r,e):{}}function ag(r,e=JSON.stringify){const t={};return r.filter(n=>{const s=e(n);return Object.prototype.hasOwnProperty.call(t,s)?!1:t[s]=!0})}function lg(r){const e=ag(r);return e.length===1?e:e.filter((t,n)=>!e.filter((i,o)=>o!==n).some(i=>t.oldRange.from>=i.oldRange.from&&t.oldRange.to<=i.oldRange.to&&t.newRange.from>=i.newRange.from&&t.newRange.to<=i.newRange.to))}function Gu(r){const{mapping:e,steps:t}=r,n=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=t[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(i).map(a,-1),u=e.slice(i).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);n.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),lg(n)}function Xo(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function ds(r,e,t={strict:!0}){const n=Object.keys(e);return n.length?n.every(s=>t.strict?e[s]===r[s]:Xo(e[s])?e[s].test(r[s]):e[s]===r[s]):!0}function Yu(r,e,t={}){return r.find(n=>n.type===e&&ds(Object.fromEntries(Object.keys(t).map(s=>[s,n.attrs[s]])),t))}function wl(r,e,t={}){return!!Yu(r,e,t)}function Zo(r,e,t){var n;if(!r||!e)return;let s=r.parent.childAfter(r.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=r.parent.childBefore(r.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(t=t||((n=s.node.marks[0])==null?void 0:n.attrs),!Yu([...s.node.marks],e,t)))return;let o=s.index,a=r.start()+s.offset,l=o+1,c=a+s.node.nodeSize;for(;o>0&&wl([...r.parent.child(o-1).marks],e,t);)o-=1,a-=r.parent.child(o).nodeSize;for(;l<r.parent.childCount&&wl([...r.parent.child(l).marks],e,t);)c+=r.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function ea(r,e,t){const n=[];return r===e?t.resolve(r).marks().forEach(s=>{const i=t.resolve(r),o=Zo(i,s.type);o&&n.push({mark:s,...o})}):t.nodesBetween(r,e,(s,i)=>{!s||s?.nodeSize===void 0||n.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),n}var cg=(r,e,t,n=20)=>{const s=r.doc.resolve(t);let i=n,o=null;for(;i>0&&o===null;){const a=s.node(i);a?.type.name===e?o=a:i-=1}return[o,i]};function Si(r,e){return e.nodes[r]||e.marks[r]||null}function Kr(r,e,t){return Object.fromEntries(Object.entries(t).filter(([n])=>{const s=r.find(i=>i.type===e&&i.name===n);return s?s.attribute.keepOnSplit:!1}))}var ug=(r,e=500)=>{let t="";const n=r.parentOffset;return r.parent.nodesBetween(Math.max(0,n-e),n,(s,i,o,a)=>{var l,c;const u=((c=(l=s.type.spec).toText)==null?void 0:c.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";t+=s.isAtom&&!s.isText?u:u.slice(0,Math.max(0,n-i))}),t};function so(r,e,t={}){const{empty:n,ranges:s}=r.selection,i=e?ht(e,r.schema):null;if(n)return!!(r.storedMarks||r.selection.$from.marks()).filter(d=>i?i.name===d.type.name:!0).find(d=>ds(d.attrs,t,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;r.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),v=Math.min(p,g+m.nodeSize),k=v-y;o+=k,a.push(...m.marks.map(C=>({mark:C,from:y,to:v})))})}),o===0)return!1;const l=a.filter(d=>i?i.name===d.mark.type.name:!0).filter(d=>ds(d.mark.attrs,t,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>i?d.mark.type!==i&&d.mark.type.excludes(i):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function Nt(r,e,t={}){const{from:n,to:s,empty:i}=r.selection,o=e?se(e,r.schema):null,a=[];r.doc.nodesBetween(n,s,(d,h)=>{if(d.isText)return;const f=Math.max(n,h),p=Math.min(s,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=s-n,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>ds(d.node.attrs,t,{strict:!1}));return i?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}function dg(r,e,t={}){if(!e)return Nt(r,null,t)||so(r,null,t);const n=Zs(e,r.schema);return n==="node"?Nt(r,e,t):n==="mark"?so(r,e,t):!1}var hg=(r,e)=>{const{$from:t,$to:n,$anchor:s}=r.selection;if(e){const i=Xs(a=>a.type.name===e)(r.selection);if(!i)return!1;const o=r.doc.resolve(i.pos+1);return s.pos+1===o.end()}return!(n.parentOffset<n.parent.nodeSize-2||t.pos!==n.pos)},fg=r=>{const{$from:e,$to:t}=r.selection;return!(e.parentOffset>0||e.pos!==t.pos)};function kl(r,e){return Array.isArray(e)?e.some(t=>(typeof t=="string"?t:t.name)===r.name):e}function xl(r,e){const{nodeExtensions:t}=br(e),n=t.find(o=>o.name===r);if(!n)return!1;const s={name:n.name,options:n.options,storage:n.storage},i=W(I(n,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function ei(r,{checkChildren:e=!0,ignoreWhitespace:t=!1}={}){var n;if(t){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((n=r.text)!=null?n:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(e){let s=!0;return r.content.forEach(i=>{s!==!1&&(ei(i,{ignoreWhitespace:t,checkChildren:e})||(s=!1))}),s}return!1}function Qu(r){return r instanceof N}function Xu(r){return r instanceof D}function qt(r=0,e=0,t=0){return Math.min(Math.max(r,e),t)}function Zu(r,e=null){if(!e)return null;const t=j.atStart(r),n=j.atEnd(r);if(e==="start"||e===!0)return t;if(e==="end")return n;const s=t.from,i=n.to;return e==="all"?D.create(r,qt(0,s,i),qt(r.content.size,s,i)):D.create(r,qt(e,s,i),qt(e,s,i))}function pg(r,e,t){const n=r.steps.length-1;if(n<e)return;const s=r.steps[n];if(!(s instanceof ce||s instanceof ue))return;const i=r.mapping.maps[n];let o=0;i.forEach((a,l,c,u)=>{o===0&&(o=u)}),r.setSelection(j.near(r.doc.resolve(o),t))}var ti=class{constructor(r){this.find=r.find,this.handler=r.handler}},mg=(r,e)=>{if(Xo(e))return e.exec(r);const t=e(r);if(!t)return null;const n=[t.text];return n.index=t.index,n.input=r,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),n.push(t.replaceWith)),n};function Nr(r){var e;const{editor:t,from:n,to:s,text:i,rules:o,plugin:a}=r,{view:l}=t;if(l.composing)return!1;const c=l.state.doc.resolve(n);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(h=>h.type.spec.code))return!1;let u=!1;const d=ug(c)+i;return o.forEach(h=>{if(u)return;const f=mg(d,h.find);if(!f)return;const p=l.state.tr,m=Ys({state:l.state,transaction:p}),g={from:n-(f[0].length-i.length),to:s},{commands:y,chain:v,can:k}=new Qs({editor:t,state:m});h.handler({state:m,range:g,match:f,commands:y,chain:v,can:k})===null||!p.steps.length||(p.setMeta(a,{transform:p,from:n,to:s,text:i}),l.dispatch(p),u=!0)}),u}function gg(r){const{editor:e,rules:t}=r,n=new te({state:{init(){return null},apply(s,i,o){const a=s.getMeta(n);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=Yo(x.from(u),o.schema);const{from:d}=l,h=d+u.length;Nr({editor:e,from:d,to:h,text:u,rules:t,plugin:n})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return Nr({editor:e,from:i,to:o,text:a,rules:t,plugin:n})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Nr({editor:e,from:i.pos,to:i.pos,text:"",rules:t,plugin:n})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?Nr({editor:e,from:o.pos,to:o.pos,text:`
`,rules:t,plugin:n}):!1}},isInputRules:!0});return n}function yg(r){return Object.prototype.toString.call(r).slice(8,-1)}function Rr(r){return yg(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function ed(r,e){const t={...r};return Rr(r)&&Rr(e)&&Object.keys(e).forEach(n=>{Rr(e[n])&&Rr(r[n])?t[n]=ed(r[n],e[n]):t[n]=e[n]}),t}var ta=class{constructor(r={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...r},this.name=this.config.name}get options(){return{...W(I(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...W(I(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(r={}){const e=this.extend({...this.config,addOptions:()=>ed(this.options,r)});return e.name=this.name,e.parent=this.parent,e}extend(r={}){const e=new this.constructor({...this.config,...r});return e.parent=this,this.child=e,e.name="name"in r?r.name:e.parent.name,e}},an=class td extends ta{constructor(){super(...arguments),this.type="mark"}static create(e={}){const t=typeof e=="function"?e():e;return new td(t)}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(c=>c?.type.name===t.name))return!1;const l=o.find(c=>c?.type.name===t.name);return l&&n.removeStoredMark(l),n.insertText(" ",s.pos),e.view.dispatch(n),!0}return!1}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function bg(r){return typeof r=="number"}var vg=class{constructor(r){this.find=r.find,this.handler=r.handler}},wg=(r,e,t)=>{if(Xo(e))return[...r.matchAll(e)];const n=e(r,t);return n?n.map(s=>{const i=[s.text];return i.index=s.index,i.input=r,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function kg(r){const{editor:e,state:t,from:n,to:s,rule:i,pasteEvent:o,dropEvent:a}=r,{commands:l,chain:c,can:u}=new Qs({editor:e,state:t}),d=[];return t.doc.nodesBetween(n,s,(f,p)=>{var m,g,y,v,k;if((g=(m=f.type)==null?void 0:m.spec)!=null&&g.code||!(f.isText||f.isTextblock||f.isInline))return;const C=(k=(v=(y=f.content)==null?void 0:y.size)!=null?v:f.nodeSize)!=null?k:0,E=Math.max(n,p),O=Math.min(s,p+C);if(E>=O)return;const L=f.isText?f.text||"":f.textBetween(E-p,O-p,void 0,"");wg(L,i.find,o).forEach(H=>{if(H.index===void 0)return;const Y=E+H.index+1,Ke=Y+H[0].length,Lt={from:t.tr.mapping.map(Y),to:t.tr.mapping.map(Ke)},cn=i.handler({state:t,range:Lt,match:H,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(cn)})}),d.every(f=>f!==null)}var Dr=null,xg=r=>{var e;const t=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=t.clipboardData)==null||e.setData("text/html",r),t};function Sg(r){const{editor:e,rules:t}=r;let n=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:h,rule:f,pasteEvt:p})=>{const m=u.tr,g=Ys({state:u,transaction:m});if(!(!kg({editor:e,state:g,from:Math.max(d-1,0),to:h.b-1,rule:f,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return t.map(u=>new te({view(d){const h=p=>{var m;n=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,n&&(Dr=e)},f=()=>{Dr&&(Dr=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(d,h)=>{if(i=n===d.dom.parentElement,a=h,!i){const f=Dr;f?.isEditable&&setTimeout(()=>{const p=f.state.selection;p&&f.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,h)=>{var f;const p=(f=h.clipboardData)==null?void 0:f.getData("text/html");return o=h,s=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(d,h,f)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!s,g=p.getMeta("uiEvent")==="drop"&&!i,y=p.getMeta("applyPasteRules"),v=!!y;if(!m&&!g&&!v)return;if(v){let{text:E}=y;typeof E=="string"?E=E:E=Yo(x.from(E),f.schema);const{from:O}=y,L=O+E.length,M=xg(E);return l({rule:u,state:f,from:O,to:{b:L},pasteEvt:M})}const k=h.doc.content.findDiffStart(f.doc.content),C=h.doc.content.findDiffEnd(f.doc.content);if(!(!bg(k)||!C||k===C.b))return l({rule:u,state:f,from:k,to:C,pasteEvt:o})}}))}var ni=class{constructor(r,e){this.splittableMarks=[],this.editor=e,this.extensions=Hu(r),this.schema=rg(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((r,e)=>{const t={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Si(e.name,this.schema)},n=I(e,"addCommands",t);return n?{...r,...n()}:r},{})}get plugins(){const{editor:r}=this;return Qo([...this.extensions].reverse()).map(n=>{const s={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:r,type:Si(n.name,this.schema)},i=[],o=I(n,"addKeyboardShortcuts",s);let a={};if(n.type==="mark"&&I(n,"exitable",s)&&(a.ArrowRight=()=>an.handleExit({editor:r,mark:n})),o){const h=Object.fromEntries(Object.entries(o()).map(([f,p])=>[f,()=>p({editor:r})]));a={...a,...h}}const l=Am(a);i.push(l);const c=I(n,"addInputRules",s);if(kl(n,r.options.enableInputRules)&&c){const h=c();if(h&&h.length){const f=gg({editor:r,rules:h}),p=Array.isArray(f)?f:[f];i.push(...p)}}const u=I(n,"addPasteRules",s);if(kl(n,r.options.enablePasteRules)&&u){const h=u();if(h&&h.length){const f=Sg({editor:r,rules:h});i.push(...f)}}const d=I(n,"addProseMirrorPlugins",s);if(d){const h=d();i.push(...h)}return i}).flat()}get attributes(){return Vu(this.extensions)}get nodeViews(){const{editor:r}=this,{nodeExtensions:e}=br(this.extensions);return Object.fromEntries(e.filter(t=>!!I(t,"addNodeView")).map(t=>{const n=this.attributes.filter(a=>a.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:r,type:se(t.name,this.schema)},i=I(t,"addNodeView",s);if(!i)return[];const o=(a,l,c,u,d)=>{const h=us(a,n);return i()({node:a,view:l,getPos:c,decorations:u,innerDecorations:d,editor:r,extension:t,HTMLAttributes:h})};return[t.name,o]}))}get markViews(){const{editor:r}=this,{markExtensions:e}=br(this.extensions);return Object.fromEntries(e.filter(t=>!!I(t,"addMarkView")).map(t=>{const n=this.attributes.filter(a=>a.type===t.name),s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:r,type:ht(t.name,this.schema)},i=I(t,"addMarkView",s);if(!i)return[];const o=(a,l,c)=>{const u=us(a,n);return i()({mark:a,view:l,inline:c,editor:r,extension:t,HTMLAttributes:u,updateAttributes:d=>{jy(a,r,d)}})};return[t.name,o]}))}setupExtensions(){const r=this.extensions;this.editor.extensionStorage=Object.fromEntries(r.map(e=>[e.name,e.storage])),r.forEach(e=>{var t;const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Si(e.name,this.schema)};e.type==="mark"&&((t=W(I(e,"keepOnSplit",n)))==null||t)&&this.splittableMarks.push(e.name);const s=I(e,"onBeforeCreate",n),i=I(e,"onCreate",n),o=I(e,"onUpdate",n),a=I(e,"onSelectionUpdate",n),l=I(e,"onTransaction",n),c=I(e,"onFocus",n),u=I(e,"onBlur",n),d=I(e,"onDestroy",n);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};ni.resolve=Hu;ni.sort=Qo;ni.flatten=Go;var Tg={};Bu(Tg,{ClipboardTextSerializer:()=>rd,Commands:()=>od,Delete:()=>ad,Drop:()=>ld,Editable:()=>cd,FocusEvents:()=>dd,Keymap:()=>hd,Paste:()=>fd,Tabindex:()=>pd,focusEventsPluginKey:()=>ud});var ie=class nd extends ta{constructor(){super(...arguments),this.type="extension"}static create(e={}){const t=typeof e=="function"?e():e;return new nd(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}},rd=ie.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new te({key:new he("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:e,schema:t}=r,{doc:n,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(u=>u.$from.pos)),a=Math.max(...i.map(u=>u.$to.pos)),l=qu(t);return Wu(n,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),sd={};Bu(sd,{blur:()=>Cg,clearContent:()=>_g,clearNodes:()=>Eg,command:()=>Og,createParagraphNear:()=>Ag,cut:()=>Mg,deleteCurrentNode:()=>Pg,deleteNode:()=>Ig,deleteRange:()=>Ng,deleteSelection:()=>Rg,enter:()=>Dg,exitCode:()=>$g,extendMarkRange:()=>Lg,first:()=>jg,focus:()=>Fg,forEach:()=>zg,insertContent:()=>Ug,insertContentAt:()=>Hg,joinBackward:()=>Kg,joinDown:()=>qg,joinForward:()=>Jg,joinItemBackward:()=>Gg,joinItemForward:()=>Yg,joinTextblockBackward:()=>Qg,joinTextblockForward:()=>Xg,joinUp:()=>Wg,keyboardShortcut:()=>ey,lift:()=>ty,liftEmptyBlock:()=>ny,liftListItem:()=>ry,newlineInCode:()=>sy,resetAttributes:()=>iy,scrollIntoView:()=>oy,selectAll:()=>ay,selectNodeBackward:()=>ly,selectNodeForward:()=>cy,selectParentNode:()=>uy,selectTextblockEnd:()=>dy,selectTextblockStart:()=>hy,setContent:()=>fy,setMark:()=>my,setMeta:()=>gy,setNode:()=>yy,setNodeSelection:()=>by,setTextSelection:()=>vy,sinkListItem:()=>wy,splitBlock:()=>ky,splitListItem:()=>xy,toggleList:()=>Sy,toggleMark:()=>Ty,toggleNode:()=>Cy,toggleWrap:()=>_y,undoInputRule:()=>Ey,unsetAllMarks:()=>Oy,unsetMark:()=>Ay,updateAttributes:()=>My,wrapIn:()=>Py,wrapInList:()=>Iy});var Cg=()=>({editor:r,view:e})=>(requestAnimationFrame(()=>{var t;r.isDestroyed||(e.dom.blur(),(t=window?.getSelection())==null||t.removeAllRanges())}),!0),_g=(r=!0)=>({commands:e})=>e.setContent("",{emitUpdate:r}),Eg=()=>({state:r,tr:e,dispatch:t})=>{const{selection:n}=e,{ranges:s}=n;return t&&s.forEach(({$from:i,$to:o})=>{r.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=Fn(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},Og=r=>e=>r(e),Ag=()=>({state:r,dispatch:e})=>Du(r,e),Mg=(r,e)=>({editor:t,tr:n})=>{const{state:s}=t,i=s.doc.slice(r.from,r.to);n.deleteRange(r.from,r.to);const o=n.mapping.map(e);return n.insert(o,i.content),n.setSelection(new D(n.doc.resolve(Math.max(o-1,0)))),!0},Pg=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,n=t.$anchor.node();if(n.content.size>0)return!1;const s=r.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===n.type){if(e){const a=s.before(i),l=s.after(i);r.delete(a,l).scrollIntoView()}return!0}return!1},Ig=r=>({tr:e,state:t,dispatch:n})=>{const s=se(r,t.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(n){const l=i.before(o),c=i.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},Ng=r=>({tr:e,dispatch:t})=>{const{from:n,to:s}=r;return t&&e.delete(n,s),!0},Rg=()=>({state:r,dispatch:e})=>Ho(r,e),Dg=()=>({commands:r})=>r.keyboardShortcut("Enter"),$g=()=>({state:r,dispatch:e})=>Dm(r,e),Lg=(r,e={})=>({tr:t,state:n,dispatch:s})=>{const i=ht(r,n.schema),{doc:o,selection:a}=t,{$from:l,from:c,to:u}=a;if(s){const d=Zo(l,i,e);if(d&&d.from<=c&&d.to>=u){const h=D.create(o,d.from,d.to);t.setSelection(h)}}return!0},jg=r=>e=>{const t=typeof r=="function"?r(e):r;for(let n=0;n<t.length;n+=1)if(t[n](e))return!0;return!1};function Bg(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function na(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Fg=(r=null,e={})=>({editor:t,view:n,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(na()||Bg())&&n.dom.focus(),requestAnimationFrame(()=>{t.isDestroyed||(n.focus(),e?.scrollIntoView&&t.commands.scrollIntoView())})};if(n.hasFocus()&&r===null||r===!1)return!0;if(i&&r===null&&!Xu(t.state.selection))return o(),!0;const a=Zu(s.doc,r)||t.state.selection,l=t.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},zg=(r,e)=>t=>r.every((n,s)=>e(n,{...t,index:s})),Ug=(r,e)=>({tr:t,commands:n})=>n.insertContentAt({from:t.selection.from,to:t.selection.to},r,e),Vg=r=>!("type"in r),Hg=(r,e,t)=>({tr:n,dispatch:s,editor:i})=>{var o;if(s){t={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...t};let a;const{selection:l}=i.state,c=y=>{i.emit("contentError",{editor:i,error:y,disableCollaboration:()=>{"collaboration"in i.storage&&typeof i.storage.collaboration=="object"&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},u={preserveWhitespace:"full",...t.parseOptions};if(!t.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{yr(e,i.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(y){c(y)}try{a=yr(e,i.schema,{parseOptions:u,errorOnInvalidContent:(o=t.errorOnInvalidContent)!=null?o:i.options.enableContentCheck})}catch(y){return c(y),!1}let{from:d,to:h}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},f=!0,p=!0;if((Vg(a)?a:[a]).forEach(y=>{y.check(),f=f?y.isText&&y.marks.length===0:!1,p=p?y.isBlock:!1}),d===h&&p){const{parent:y}=n.doc.resolve(d);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(d-=1,h+=1)}let g;if(f){if(Array.isArray(e))g=e.map(y=>y.text||"").join("");else if(e instanceof x){let y="";e.forEach(v=>{v.text&&(y+=v.text)}),g=y}else typeof e=="object"&&e&&e.text?g=e.text:g=e;n.insertText(g,d,h)}else{g=a;const y=l.$from.parentOffset===0,v=l.$from.node().isText||l.$from.node().isTextblock,k=l.$from.node().content.size>0;y&&v&&k&&(d=Math.max(0,d-1)),n.replaceWith(d,h,g)}t.updateSelection&&pg(n,n.steps.length-1,-1),t.applyInputRules&&n.setMeta("applyInputRules",{from:d,text:g}),t.applyPasteRules&&n.setMeta("applyPasteRules",{from:d,text:g})}return!0},Wg=()=>({state:r,dispatch:e})=>Im(r,e),qg=()=>({state:r,dispatch:e})=>Nm(r,e),Kg=()=>({state:r,dispatch:e})=>Ou(r,e),Jg=()=>({state:r,dispatch:e})=>Iu(r,e),Gg=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Hs(r.doc,r.selection.$from.pos,-1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},Yg=()=>({state:r,dispatch:e,tr:t})=>{try{const n=Hs(r.doc,r.selection.$from.pos,1);return n==null?!1:(t.join(n,2),e&&e(t),!0)}catch{return!1}},Qg=()=>({state:r,dispatch:e})=>Mm(r,e),Xg=()=>({state:r,dispatch:e})=>Pm(r,e);function id(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Zg(r){const e=r.split(/-(?!$)/);let t=e[e.length-1];t==="Space"&&(t=" ");let n,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))na()||id()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return n&&(t=`Alt-${t}`),s&&(t=`Ctrl-${t}`),o&&(t=`Meta-${t}`),i&&(t=`Shift-${t}`),t}var ey=r=>({editor:e,view:t,tr:n,dispatch:s})=>{const i=Zg(r).split(/-(?!$)/),o=i.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{t.someProp("handleKeyDown",c=>c(t,a))});return l?.steps.forEach(c=>{const u=c.map(n.mapping);u&&s&&n.maybeStep(u)}),!0},ty=(r,e={})=>({state:t,dispatch:n})=>{const s=se(r,t.schema);return Nt(t,s,e)?Rm(t,n):!1},ny=()=>({state:r,dispatch:e})=>$u(r,e),ry=r=>({state:e,dispatch:t})=>{const n=se(r,e.schema);return qm(n)(e,t)},sy=()=>({state:r,dispatch:e})=>Ru(r,e);function Sl(r,e){const t=typeof e=="string"?[e]:e;return Object.keys(r).reduce((n,s)=>(t.includes(s)||(n[s]=r[s]),n),{})}var iy=(r,e)=>({tr:t,state:n,dispatch:s})=>{let i=null,o=null;const a=Zs(typeof r=="string"?r:r.name,n.schema);return a?(a==="node"&&(i=se(r,n.schema)),a==="mark"&&(o=ht(r,n.schema)),s&&t.selection.ranges.forEach(l=>{n.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{i&&i===c.type&&t.setNodeMarkup(u,void 0,Sl(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(d=>{o===d.type&&t.addMark(u,u+c.nodeSize,o.create(Sl(d.attrs,e)))})})}),!0):!1},oy=()=>({tr:r,dispatch:e})=>(e&&r.scrollIntoView(),!0),ay=()=>({tr:r,dispatch:e})=>{if(e){const t=new Pe(r.doc);r.setSelection(t)}return!0},ly=()=>({state:r,dispatch:e})=>Mu(r,e),cy=()=>({state:r,dispatch:e})=>Nu(r,e),uy=()=>({state:r,dispatch:e})=>jm(r,e),dy=()=>({state:r,dispatch:e})=>zm(r,e),hy=()=>({state:r,dispatch:e})=>Fm(r,e),fy=(r,{errorOnInvalidContent:e,emitUpdate:t=!0,parseOptions:n={}}={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{const{doc:l}=i;if(n.preserveWhitespace!=="full"){const c=ro(r,s.schema,n,{errorOnInvalidContent:e??s.options.enableContentCheck});return o&&i.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!t),!0}return o&&i.setMeta("preventUpdate",!t),a.insertContentAt({from:0,to:l.content.size},r,{parseOptions:n,errorOnInvalidContent:e??s.options.enableContentCheck})};function py(r,e,t){var n;const{selection:s}=e;let i=null;if(Xu(s)&&(i=s.$cursor),i){const a=(n=r.storedMarks)!=null?n:i.marks();return!!t.isInSet(a)||!a.some(l=>l.type.excludes(t))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(t):!1;return r.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(t),p=!!t.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(t));c=f&&p}return!c}),c})}var my=(r,e={})=>({tr:t,state:n,dispatch:s})=>{const{selection:i}=t,{empty:o,ranges:a}=i,l=ht(r,n.schema);if(s)if(o){const c=Ku(n,l);t.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;n.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&t.addMark(p,m,l.create({...y.attrs,...e}))}):t.addMark(p,m,l.create(e))})});return py(n,t,l)},gy=(r,e)=>({tr:t})=>(t.setMeta(r,e),!0),yy=(r,e={})=>({state:t,dispatch:n,chain:s})=>{const i=se(r,t.schema);let o;return t.selection.$anchor.sameParent(t.selection.$head)&&(o=t.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>yl(i,{...o,...e})(t)?!0:a.clearNodes()).command(({state:a})=>yl(i,{...o,...e})(a,n)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},by=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,s=qt(r,0,n.content.size),i=N.create(n,s);e.setSelection(i)}return!0},vy=r=>({tr:e,dispatch:t})=>{if(t){const{doc:n}=e,{from:s,to:i}=typeof r=="number"?{from:r,to:r}:r,o=D.atStart(n).from,a=D.atEnd(n).to,l=qt(s,o,a),c=qt(i,o,a),u=D.create(n,l,c);e.setSelection(u)}return!0},wy=r=>({state:e,dispatch:t})=>{const n=se(r,e.schema);return Gm(n)(e,t)};function Tl(r,e){const t=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(t){const n=t.filter(s=>e?.includes(s.type.name));r.tr.ensureMarks(n)}}var ky=({keepMarks:r=!0}={})=>({tr:e,state:t,dispatch:n,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,c=s.extensionManager.attributes,u=Kr(c,a.node().type.name,a.node().attrs);if(i instanceof N&&i.node.isBlock)return!a.parentOffset||!ct(o,a.pos)?!1:(n&&(r&&Tl(t,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:Xm(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=ct(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&ct(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),n){if(p&&(i instanceof D&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}r&&Tl(t,s.extensionManager.splittableMarks),e.scrollIntoView()}return p},xy=(r,e={})=>({tr:t,state:n,dispatch:s,editor:i})=>{var o;const a=se(r,n.schema),{$from:l,$to:c}=n.selection,u=n.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let y=x.empty;const v=l.index(-1)?1:l.index(-2)?2:3;for(let M=l.depth-v;M>=l.depth-3;M-=1)y=x.from(l.node(M).copy(y));const k=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,C={...Kr(h,l.node().type.name,l.node().attrs),...e},E=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(C))||void 0;y=y.append(x.from(a.createAndFill(null,E)||void 0));const O=l.before(l.depth-(v-1));t.replace(O,l.after(-k),new _(y,4-v,0));let L=-1;t.doc.nodesBetween(O,t.doc.content.size,(M,H)=>{if(L>-1)return!1;M.isTextblock&&M.content.size===0&&(L=H+1)}),L>-1&&t.setSelection(D.near(t.doc.resolve(L))),t.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Kr(h,d.type.name,d.attrs),...e},m={...Kr(h,l.node().type.name,l.node().attrs),...e};t.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!ct(t.doc,l.pos,2))return!1;if(s){const{selection:y,storedMarks:v}=n,{splittableMarks:k}=i.extensionManager,C=v||y.$to.parentOffset&&y.$from.marks();if(t.split(l.pos,2,g).scrollIntoView(),!C||!s)return!0;const E=C.filter(O=>k.includes(O.type.name));t.ensureMarks(E)}return!0},Ti=(r,e)=>{const t=Xs(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(Math.max(0,t.pos-1)).before(t.depth);if(n===void 0)return!0;const s=r.doc.nodeAt(n);return t.node.type===s?.type&&Rt(r.doc,t.pos)&&r.join(t.pos),!0},Ci=(r,e)=>{const t=Xs(o=>o.type===e)(r.selection);if(!t)return!0;const n=r.doc.resolve(t.start).after(t.depth);if(n===void 0)return!0;const s=r.doc.nodeAt(n);return t.node.type===s?.type&&Rt(r.doc,n)&&r.join(n),!0},Sy=(r,e,t,n={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=s.extensionManager,f=se(r,o.schema),p=se(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:v}=m,k=y.blockRange(v),C=g||m.$to.parentOffset&&m.$from.marks();if(!k)return!1;const E=Xs(O=>xl(O.type.name,d))(m);if(k.depth>=1&&E&&k.depth-E.depth<=1){if(E.node.type===f)return c.liftListItem(p);if(xl(E.node.type.name,d)&&f.validContent(E.node.content)&&a)return l().command(()=>(i.setNodeMarkup(E.pos,f),!0)).command(()=>Ti(i,f)).command(()=>Ci(i,f)).run()}return!t||!C||!a?l().command(()=>u().wrapInList(f,n)?!0:c.clearNodes()).wrapInList(f,n).command(()=>Ti(i,f)).command(()=>Ci(i,f)).run():l().command(()=>{const O=u().wrapInList(f,n),L=C.filter(M=>h.includes(M.type.name));return i.ensureMarks(L),O?!0:c.clearNodes()}).wrapInList(f,n).command(()=>Ti(i,f)).command(()=>Ci(i,f)).run()},Ty=(r,e={},t={})=>({state:n,commands:s})=>{const{extendEmptyMarkRange:i=!1}=t,o=ht(r,n.schema);return so(n,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},Cy=(r,e,t={})=>({state:n,commands:s})=>{const i=se(r,n.schema),o=se(e,n.schema),a=Nt(n,i,t);let l;return n.selection.$anchor.sameParent(n.selection.$head)&&(l=n.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...t})},_y=(r,e={})=>({state:t,commands:n})=>{const s=se(r,t.schema);return Nt(t,s,e)?n.lift(s):n.wrapIn(s,e)},Ey=()=>({state:r,dispatch:e})=>{const t=r.plugins;for(let n=0;n<t.length;n+=1){const s=t[n];let i;if(s.spec.isInputRules&&(i=s.getState(r))){if(e){const o=r.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,r.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},Oy=()=>({tr:r,dispatch:e})=>{const{selection:t}=r,{empty:n,ranges:s}=t;return n||e&&s.forEach(i=>{r.removeMark(i.$from.pos,i.$to.pos)}),!0},Ay=(r,e={})=>({tr:t,state:n,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=t,l=ht(r,n.schema),{$from:c,empty:u,ranges:d}=a;if(!s)return!0;if(u&&o){let{from:h,to:f}=a;const p=(i=c.marks().find(g=>g.type===l))==null?void 0:i.attrs,m=Zo(c,l,p);m&&(h=m.from,f=m.to),t.removeMark(h,f,l)}else d.forEach(h=>{t.removeMark(h.$from.pos,h.$to.pos,l)});return t.removeStoredMark(l),!0},My=(r,e={})=>({tr:t,state:n,dispatch:s})=>{let i=null,o=null;const a=Zs(typeof r=="string"?r:r.name,n.schema);return a?(a==="node"&&(i=se(r,n.schema)),a==="mark"&&(o=ht(r,n.schema)),s&&t.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,h,f,p;t.selection.empty?n.doc.nodesBetween(c,u,(m,g)=>{i&&i===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,h=m)}):n.doc.nodesBetween(c,u,(m,g)=>{g<c&&i&&i===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,h=m),g>=c&&g<=u&&(i&&i===m.type&&t.setNodeMarkup(g,void 0,{...m.attrs,...e}),o&&m.marks.length&&m.marks.forEach(y=>{if(o===y.type){const v=Math.max(g,c),k=Math.min(g+m.nodeSize,u);t.addMark(v,k,o.create({...y.attrs,...e}))}}))}),h&&(d!==void 0&&t.setNodeMarkup(d,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(m=>{o===m.type&&t.addMark(f,p,o.create({...m.attrs,...e}))}))}),!0):!1},Py=(r,e={})=>({state:t,dispatch:n})=>{const s=se(r,t.schema);return Um(s,e)(t,n)},Iy=(r,e={})=>({state:t,dispatch:n})=>{const s=se(r,t.schema);return Vm(s,e)(t,n)},od=ie.create({name:"commands",addCommands(){return{...sd}}}),ad=ie.create({name:"delete",onUpdate({transaction:r,appendedTransactions:e}){var t,n,s;const i=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,r))!=null?c:r.getMeta("y-sync$"))return;const u=Fu(r.before,[r,...e]);Gu(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:r,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof Ve){const y=h.slice(p).map(f.from,-1),v=h.slice(p).map(f.to),k=h.invert().map(y,-1),C=h.invert().map(v),E=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(L=>L.eq(f.mark)),O=(g=u.doc.nodeAt(v))==null?void 0:g.marks.some(L=>L.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:k,to:C},newRange:{from:y,to:v},partial:!!(O||E),editor:this.editor,transaction:r,combinedTransform:u})}})};(s=(n=(t=this.editor.options.coreExtensionOptions)==null?void 0:t.delete)==null?void 0:n.async)==null||s?setTimeout(i,0):i()}}),ld=ie.create({name:"drop",addProseMirrorPlugins(){return[new te({key:new he("tiptapDrop"),props:{handleDrop:(r,e,t,n)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:t,moved:n})}}})]}}),cd=ie.create({name:"editable",addProseMirrorPlugins(){return[new te({key:new he("editable"),props:{editable:()=>this.editor.options.editable}})]}}),ud=new he("focusEvents"),dd=ie.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new te({key:ud,props:{handleDOMEvents:{focus:(e,t)=>{r.isFocused=!0;const n=r.state.tr.setMeta("focus",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1},blur:(e,t)=>{r.isFocused=!1;const n=r.state.tr.setMeta("blur",{event:t}).setMeta("addToHistory",!1);return e.dispatch(n),!1}}}})]}}),hd=ie.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:j.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),n={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...n},i={...n,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return na()||id()?i:s},addProseMirrorPlugins(){return[new te({key:new he("clearDocument"),appendTransaction:(r,e,t)=>{if(r.some(m=>m.getMeta("composition")))return;const n=r.some(m=>m.docChanged)&&!e.doc.eq(t.doc),s=r.some(m=>m.getMeta("preventClearDocument"));if(!n||s)return;const{empty:i,from:o,to:a}=e.selection,l=j.atStart(e.doc).from,c=j.atEnd(e.doc).to;if(i||!(o===l&&a===c)||!ei(t.doc))return;const h=t.tr,f=Ys({state:t,transaction:h}),{commands:p}=new Qs({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),fd=ie.create({name:"paste",addProseMirrorPlugins(){return[new te({key:new he("tiptapPaste"),props:{handlePaste:(r,e,t)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:t})}}})]}}),pd=ie.create({name:"tabindex",addProseMirrorPlugins(){return[new te({key:new he("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),Ny=class Tn{constructor(e,t,n=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=e,this.editor=t,this.currentNode=s}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let t=this.from,n=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}t=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:t,to:n},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),t=this.resolvedPos.doc.resolve(e);return new Tn(t,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Tn(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Tn(e,this.editor)}get children(){const e=[];return this.node.content.forEach((t,n)=>{const s=t.isBlock&&!t.isTextblock,i=t.isAtom&&!t.isText,o=this.pos+n+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new Tn(a,this.editor,s,s?t:null);s&&(l.actualDepth=this.depth+1),e.push(new Tn(a,this.editor,s,s?t:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,t={}){let n=null,s=this.parent;for(;s&&!n;){if(s.node.type.name===e)if(Object.keys(t).length>0){const i=s.node.attrs,o=Object.keys(t);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==t[l])break}}else n=s;s=s.parent}return n}querySelector(e,t={}){return this.querySelectorAll(e,t,!0)[0]||null}querySelectorAll(e,t={},n=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(t);return this.children.forEach(o=>{n&&s.length>0||(o.node.type.name===e&&i.every(l=>t[l]===o.node.attrs[l])&&s.push(o),!(n&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,t,n))))}),s}setAttribute(e){const{tr:t}=this.editor.state;t.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(t)}},Ry=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function Dy(r,e,t){const n=document.querySelector("style[data-tiptap-style]");if(n!==null)return n;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(s),s}var $y=class extends Qm{constructor(e={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:s})=>{throw s},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:s,slice:i,moved:o})=>this.options.onDrop(s,i,o)),this.on("paste",({event:s,slice:i})=>this.options.onPaste(s,i)),this.on("delete",this.options.onDelete);const t=this.createDoc(),n=Zu(t,this.options.autofocus);this.editorState=An.create({doc:t,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;e?.editor&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){console.warn("Failed to remove CSS element:",e)}this.css=null}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=Dy(Ry,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.editorState=this.state.apply(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,t)=>{if(t==="state")return this.editorState;if(t in e)return Reflect.get(e,t);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${t}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,t){const n=Uu(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}unregisterPlugin(e){if(this.isDestroyed)return;const t=this.state.plugins;let n=t;if([].concat(e).forEach(i=>{const o=typeof i=="string"?`${i}$`:i.key;n=n.filter(a=>!a.key.startsWith(o))}),t.length===n.length)return;const s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}createExtensionManager(){var e,t;const s=[...this.options.enableCoreExtensions?[cd,rd.configure({blockSeparator:(t=(e=this.options.coreExtensionOptions)==null?void 0:e.clipboardTextSerializer)==null?void 0:t.blockSeparator}),od,dd,hd,pd,ld,fd,ad].filter(i=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[i.name]!==!1:!0):[],...this.options.extensions].filter(i=>["extension","node","mark"].includes(i?.type));this.extensionManager=new ni(s,this)}createCommandManager(){this.commandManager=new Qs({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=ro(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(n=>n.name!=="collaboration"),this.createExtensionManager()}}),e=ro(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){var t;this.editorView=new Cu(e,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)==null?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews(),this.prependClass(),this.injectCSS();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(u=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(u)});return}const{state:t,transactions:n}=this.state.applyTransaction(e),s=!this.state.selection.eq(t.selection),i=n.includes(e),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:t}),!i)return;this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:n.slice(1)}),s&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=n.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),l=a?.getMeta("focus"),c=a?.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:a}),c&&this.emit("blur",{editor:this,event:c.event,transaction:a}),!(e.getMeta("preventUpdate")||!n.some(u=>u.docChanged)||o.doc.eq(t.doc))&&this.emit("update",{editor:this,transaction:e,appendedTransactions:n.slice(1)})}getAttributes(e){return Ju(this.state,e)}isActive(e,t){const n=typeof e=="string"?e:null,s=typeof e=="string"?t:e;return dg(this.state,n,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Yo(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t=`

`,textSerializers:n={}}=e||{};return ig(this.state.doc,{blockSeparator:t,textSerializers:{...qu(this.schema),...n}})}get isEmpty(){return ei(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,t;return(t=(e=this.editorView)==null?void 0:e.isDestroyed)!=null?t:!0}$node(e,t){var n;return((n=this.$doc)==null?void 0:n.querySelector(e,t))||null}$nodes(e,t){var n;return((n=this.$doc)==null?void 0:n.querySelectorAll(e,t))||null}$pos(e){const t=this.state.doc.resolve(e);return new Ny(t,this)}get $doc(){return this.$pos(0)}};function $n(r){return new ti({find:r.find,handler:({state:e,range:t,match:n})=>{const s=W(r.getAttributes,void 0,n);if(s===!1||s===null)return null;const{tr:i}=e,o=n[n.length-1],a=n[0];if(o){const l=a.search(/\S/),c=t.from+a.indexOf(o),u=c+o.length;if(ea(t.from,t.to,e.doc).filter(f=>f.mark.type.excluded.find(m=>m===r.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;u<t.to&&i.delete(u,t.to),c>t.from&&i.delete(t.from+l,c);const h=t.from+l+o.length;i.addMark(t.from+l,h,r.type.create(s||{})),i.removeStoredMark(r.type)}}})}function md(r){return new ti({find:r.find,handler:({state:e,range:t,match:n})=>{const s=W(r.getAttributes,void 0,n)||{},{tr:i}=e,o=t.from;let a=t.to;const l=r.type.create(s);if(n[1]){const c=n[0].lastIndexOf(n[1]);let u=o+c;u>a?u=a:a=u+n[1].length;const d=n[0][n[0].length-1];i.insertText(d,o+n[0].length-1),i.replaceWith(u,a,l)}else if(n[0]){const c=r.type.isInline?o:o-1;i.insert(c,r.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()}})}function io(r){return new ti({find:r.find,handler:({state:e,range:t,match:n})=>{const s=e.doc.resolve(t.from),i=W(r.getAttributes,void 0,n)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),r.type))return null;e.tr.delete(t.from,t.to).setBlockType(t.from,t.from,r.type,i)}})}function Ln(r){return new ti({find:r.find,handler:({state:e,range:t,match:n,chain:s})=>{const i=W(r.getAttributes,void 0,n)||{},o=e.tr.delete(t.from,t.to),l=o.doc.resolve(t.from).blockRange(),c=l&&No(l,r.type,i);if(!c)return null;if(o.wrap(l,c),r.keepMarks&&r.editor){const{selection:d,storedMarks:h}=e,{splittableMarks:f}=r.editor.extensionManager,p=h||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>f.includes(g.type.name));o.ensureMarks(m)}}if(r.keepAttributes){const d=r.type.name==="bulletList"||r.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(d,i).run()}const u=o.doc.resolve(t.from-1).nodeBefore;u&&u.type===r.type&&Rt(o.doc,t.from-1)&&(!r.joinPredicate||r.joinPredicate(n,u))&&o.join(t.from-1)}})}function Ly(r,e){const{selection:t}=r,{$from:n}=t;if(t instanceof N){const i=n.index();return n.parent.canReplaceWith(i,i+1,e)}let s=n.depth;for(;s>=0;){const i=n.index(s);if(n.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}function jy(r,e,t={}){const{state:n}=e,{doc:s,tr:i}=n,o=r;s.descendants((a,l)=>{const c=i.mapping.map(l),u=i.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(f=>{if(f!==o)return!1;d=f}),!d)return;let h=!1;if(Object.keys(t).forEach(f=>{t[f]!==d.attrs[f]&&(h=!0)}),h){const f=r.type.create({...r.attrs,...t});i.removeMark(c,u,r.type),i.addMark(c,u,f)}}),i.docChanged&&e.view.dispatch(i)}var Oe=class gd extends ta{constructor(){super(...arguments),this.type="node"}static create(e={}){const t=typeof e=="function"?e():e;return new gd(t)}configure(e){return super.configure(e)}extend(e){const t=typeof e=="function"?e():e;return super.extend(t)}};function sn(r){return new vg({find:r.find,handler:({state:e,range:t,match:n,pasteEvent:s})=>{const i=W(r.getAttributes,void 0,n,s);if(i===!1||i===null)return null;const{tr:o}=e,a=n[n.length-1],l=n[0];let c=t.to;if(a){const u=l.search(/\S/),d=t.from+l.indexOf(a),h=d+a.length;if(ea(t.from,t.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===r.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;h<t.to&&o.delete(h,t.to),d>t.from&&o.delete(t.from+u,d),c=t.from+u+a.length,o.addMark(t.from+u,c,r.type.create(i||{})),o.removeStoredMark(r.type)}}})}function Cl(r){return dh((e,t)=>({get(){return e(),r},set(n){r=n,requestAnimationFrame(()=>{requestAnimationFrame(()=>{t()})})}}))}var By=class extends $y{constructor(r={}){return super(r),this.contentComponent=null,this.appContext=null,this.reactiveState=Cl(this.view.state),this.reactiveExtensionStorage=Cl(this.extensionStorage),this.on("beforeTransaction",({nextState:e})=>{this.reactiveState.value=e,this.reactiveExtensionStorage.value=this.extensionStorage}),lh(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(r,e){const t=super.registerPlugin(r,e);return this.reactiveState&&(this.reactiveState.value=t),t}unregisterPlugin(r){const e=super.unregisterPlugin(r);return this.reactiveState&&e&&(this.reactiveState.value=e),e}},Fy=qe({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(r){const e=V(),t=fh();return uh(()=>{const n=r.editor;n&&n.options.element&&e.value&&hh(()=>{var s;if(!e.value||!((s=n.options.element)!=null&&s.firstChild))return;const i=Jt(e.value);e.value.append(...n.options.element.childNodes),n.contentComponent=t.ctx._,t&&(n.appContext={...t.appContext,provides:t.provides}),n.setOptions({element:i}),n.createNodeViews()})}),uc(()=>{const n=r.editor;n&&(n.contentComponent=null,n.appContext=null)}),{rootEl:e}},render(){return ch("div",{ref:r=>{this.rootEl=r}})}}),hs=(r,e)=>{if(r==="slot")return 0;if(r instanceof Function)return r(e);const{children:t,...n}=e??{};if(r==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[r,n,t]},zy=/^\s*>\s$/,Uy=Oe.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:r}){return hs("blockquote",{...ne(this.options.HTMLAttributes,r),children:hs("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:r})=>r.wrapIn(this.name),toggleBlockquote:()=>({commands:r})=>r.toggleWrap(this.name),unsetBlockquote:()=>({commands:r})=>r.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Ln({find:zy,type:this.type})]}}),Vy=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Hy=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Wy=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,qy=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Ky=an.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:r=>r.type.name===this.name},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}]},renderHTML({HTMLAttributes:r}){return hs("strong",{...ne(this.options.HTMLAttributes,r),children:hs("slot",{})})},addCommands(){return{setBold:()=>({commands:r})=>r.setMark(this.name),toggleBold:()=>({commands:r})=>r.toggleMark(this.name),unsetBold:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[$n({find:Vy,type:this.type}),$n({find:Wy,type:this.type})]},addPasteRules(){return[sn({find:Hy,type:this.type}),sn({find:qy,type:this.type})]}}),Jy=/(^|[^`])`([^`]+)`(?!`)$/,Gy=/(^|[^`])`([^`]+)`(?!`)/g,Yy=an.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",ne(this.options.HTMLAttributes,r),0]},addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[$n({find:Jy,type:this.type})]},addPasteRules(){return[sn({find:Gy,type:this.type})]}}),Qy=/^```([a-z]+)?[\s\n]$/,Xy=/^~~~([a-z]+)?[\s\n]$/,Zy=Oe.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:r=>{var e;const{languageClassPrefix:t}=this.options,i=[...((e=r.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(t)).map(o=>o.replace(t,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:r,HTMLAttributes:e}){return["pre",ne(this.options.HTMLAttributes,e),["code",{class:r.attrs.language?this.options.languageClassPrefix+r.attrs.language:null},0]]},addCommands(){return{setCodeBlock:r=>({commands:e})=>e.setNode(this.name,r),toggleCodeBlock:r=>({commands:e})=>e.toggleNode(this.name,"paragraph",r)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:r,$anchor:e}=this.editor.state.selection,t=e.pos===1;return!r||e.parent.type.name!==this.name?!1:t||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:r})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=r,{selection:t}=e,{$from:n,empty:s}=t;if(!s||n.parent.type!==this.type)return!1;const i=n.parentOffset===n.parent.nodeSize-2,o=n.parent.textContent.endsWith(`

`);return!i||!o?!1:r.chain().command(({tr:a})=>(a.delete(n.pos-2,n.pos),!0)).exitCode().run()},ArrowDown:({editor:r})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=r,{selection:t,doc:n}=e,{$from:s,empty:i}=t;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:n.nodeAt(a)?r.commands.command(({tr:c})=>(c.setSelection(j.near(n.resolve(a))),!0)):r.commands.exitCode()}}},addInputRules(){return[io({find:Qy,type:this.type,getAttributes:r=>({language:r[1]})}),io({find:Xy,type:this.type,getAttributes:r=>({language:r[1]})})]},addProseMirrorPlugins(){return[new te({key:new he("codeBlockVSCodeHandler"),props:{handlePaste:(r,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const t=e.clipboardData.getData("text/plain"),n=e.clipboardData.getData("vscode-editor-data"),s=n?JSON.parse(n):void 0,i=s?.mode;if(!t||!i)return!1;const{tr:o,schema:a}=r.state,l=a.text(t.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(D.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),r.dispatch(o),!0}}})]}}),e0=Oe.create({name:"doc",topNode:!0,content:"block+"}),t0=Oe.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:r}){return["br",ne(this.options.HTMLAttributes,r)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:r,chain:e,state:t,editor:n})=>r.first([()=>r.exitCode(),()=>r.command(()=>{const{selection:s,storedMarks:i}=t;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=n.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(h=>a.includes(h.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),n0=Oe.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(r=>({tag:`h${r}`,attrs:{level:r}}))},renderHTML({node:r,HTMLAttributes:e}){return[`h${this.options.levels.includes(r.attrs.level)?r.attrs.level:this.options.levels[0]}`,ne(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.setNode(this.name,r):!1,toggleHeading:r=>({commands:e})=>this.options.levels.includes(r.level)?e.toggleNode(this.name,"paragraph",r):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((r,e)=>({...r,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(r=>io({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${r}})\\s$`),type:this.type,getAttributes:{level:r}}))}}),r0=Oe.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:r}){return["hr",ne(this.options.HTMLAttributes,r)]},addCommands(){return{setHorizontalRule:()=>({chain:r,state:e})=>{if(!Ly(e,e.schema.nodes[this.name]))return!1;const{selection:t}=e,{$to:n}=t,s=r();return Qu(t)?s.insertContentAt(n.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:i,dispatch:o})=>{var a;if(o){const{$to:l}=i.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?i.setSelection(D.create(i.doc,l.pos+1)):l.nodeAfter.isBlock?i.setSelection(N.create(i.doc,l.pos)):i.setSelection(D.create(i.doc,l.pos));else{const u=(a=l.parent.type.contentMatch.defaultType)==null?void 0:a.create();u&&(i.insert(c,u),i.setSelection(D.create(i.doc,c+1)))}i.scrollIntoView()}return!0}).run()}}},addInputRules(){return[md({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),s0=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,i0=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,o0=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,a0=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,l0=an.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:r=>r.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:r=>r.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:r}){return["em",ne(this.options.HTMLAttributes,r),0]},addCommands(){return{setItalic:()=>({commands:r})=>r.setMark(this.name),toggleItalic:()=>({commands:r})=>r.toggleMark(this.name),unsetItalic:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[$n({find:s0,type:this.type}),$n({find:o0,type:this.type})]},addPasteRules(){return[sn({find:i0,type:this.type}),sn({find:a0,type:this.type})]}});const c0="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",u0="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",oo="numeric",ao="ascii",lo="alpha",tr="asciinumeric",Jn="alphanumeric",co="domain",yd="emoji",d0="scheme",h0="slashscheme",_i="whitespace";function f0(r,e){return r in e||(e[r]=[]),e[r]}function Kt(r,e,t){e[oo]&&(e[tr]=!0,e[Jn]=!0),e[ao]&&(e[tr]=!0,e[lo]=!0),e[tr]&&(e[Jn]=!0),e[lo]&&(e[Jn]=!0),e[Jn]&&(e[co]=!0),e[yd]&&(e[co]=!0);for(const n in e){const s=f0(n,t);s.indexOf(r)<0&&s.push(r)}}function p0(r,e){const t={};for(const n in e)e[n].indexOf(r)>=0&&(t[n]=!0);return t}function _e(r=null){this.j={},this.jr=[],this.jd=null,this.t=r}_e.groups={};_e.prototype={accepts(){return!!this.t},go(r){const e=this,t=e.j[r];if(t)return t;for(let n=0;n<e.jr.length;n++){const s=e.jr[n][0],i=e.jr[n][1];if(i&&s.test(r))return i}return e.jd},has(r,e=!1){return e?r in this.j:!!this.go(r)},ta(r,e,t,n){for(let s=0;s<r.length;s++)this.tt(r[s],e,t,n)},tr(r,e,t,n){n=n||_e.groups;let s;return e&&e.j?s=e:(s=new _e(e),t&&n&&Kt(e,t,n)),this.jr.push([r,s]),s},ts(r,e,t,n){let s=this;const i=r.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(r[o]);return s.tt(r[i-1],e,t,n)},tt(r,e,t,n){n=n||_e.groups;const s=this;if(e&&e.j)return s.j[r]=e,e;const i=e;let o,a=s.go(r);if(a?(o=new _e,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new _e,i){if(n)if(o.t&&typeof o.t=="string"){const l=Object.assign(p0(o.t,n),t);Kt(i,l,n)}else t&&Kt(i,t,n);o.t=i}return s.j[r]=o,o}};const B=(r,e,t,n,s)=>r.ta(e,t,n,s),Z=(r,e,t,n,s)=>r.tr(e,t,n,s),_l=(r,e,t,n,s)=>r.ts(e,t,n,s),S=(r,e,t,n,s)=>r.tt(e,t,n,s),st="WORD",uo="UWORD",bd="ASCIINUMERICAL",vd="ALPHANUMERICAL",vr="LOCALHOST",ho="TLD",fo="UTLD",Jr="SCHEME",Cn="SLASH_SCHEME",ra="NUM",po="WS",sa="NL",nr="OPENBRACE",rr="CLOSEBRACE",fs="OPENBRACKET",ps="CLOSEBRACKET",ms="OPENPAREN",gs="CLOSEPAREN",ys="OPENANGLEBRACKET",bs="CLOSEANGLEBRACKET",vs="FULLWIDTHLEFTPAREN",ws="FULLWIDTHRIGHTPAREN",ks="LEFTCORNERBRACKET",xs="RIGHTCORNERBRACKET",Ss="LEFTWHITECORNERBRACKET",Ts="RIGHTWHITECORNERBRACKET",Cs="FULLWIDTHLESSTHAN",_s="FULLWIDTHGREATERTHAN",Es="AMPERSAND",Os="APOSTROPHE",As="ASTERISK",vt="AT",Ms="BACKSLASH",Ps="BACKTICK",Is="CARET",xt="COLON",ia="COMMA",Ns="DOLLAR",Je="DOT",Rs="EQUALS",oa="EXCLAMATION",Re="HYPHEN",sr="PERCENT",Ds="PIPE",$s="PLUS",Ls="POUND",ir="QUERY",aa="QUOTE",wd="FULLWIDTHMIDDLEDOT",la="SEMI",Ge="SLASH",or="TILDE",js="UNDERSCORE",kd="EMOJI",Bs="SYM";var xd=Object.freeze({__proto__:null,ALPHANUMERICAL:vd,AMPERSAND:Es,APOSTROPHE:Os,ASCIINUMERICAL:bd,ASTERISK:As,AT:vt,BACKSLASH:Ms,BACKTICK:Ps,CARET:Is,CLOSEANGLEBRACKET:bs,CLOSEBRACE:rr,CLOSEBRACKET:ps,CLOSEPAREN:gs,COLON:xt,COMMA:ia,DOLLAR:Ns,DOT:Je,EMOJI:kd,EQUALS:Rs,EXCLAMATION:oa,FULLWIDTHGREATERTHAN:_s,FULLWIDTHLEFTPAREN:vs,FULLWIDTHLESSTHAN:Cs,FULLWIDTHMIDDLEDOT:wd,FULLWIDTHRIGHTPAREN:ws,HYPHEN:Re,LEFTCORNERBRACKET:ks,LEFTWHITECORNERBRACKET:Ss,LOCALHOST:vr,NL:sa,NUM:ra,OPENANGLEBRACKET:ys,OPENBRACE:nr,OPENBRACKET:fs,OPENPAREN:ms,PERCENT:sr,PIPE:Ds,PLUS:$s,POUND:Ls,QUERY:ir,QUOTE:aa,RIGHTCORNERBRACKET:xs,RIGHTWHITECORNERBRACKET:Ts,SCHEME:Jr,SEMI:la,SLASH:Ge,SLASH_SCHEME:Cn,SYM:Bs,TILDE:or,TLD:ho,UNDERSCORE:js,UTLD:fo,UWORD:uo,WORD:st,WS:po});const nt=/[a-z]/,Hn=new RegExp("\\p{L}","u"),Ei=new RegExp("\\p{Emoji}","u"),rt=/\d/,Oi=/\s/,El="\r",Ai=`
`,m0="",g0="",Mi="";let $r=null,Lr=null;function y0(r=[]){const e={};_e.groups=e;const t=new _e;$r==null&&($r=Ol(c0)),Lr==null&&(Lr=Ol(u0)),S(t,"'",Os),S(t,"{",nr),S(t,"}",rr),S(t,"[",fs),S(t,"]",ps),S(t,"(",ms),S(t,")",gs),S(t,"<",ys),S(t,">",bs),S(t,"",vs),S(t,"",ws),S(t,"",ks),S(t,"",xs),S(t,"",Ss),S(t,"",Ts),S(t,"",Cs),S(t,"",_s),S(t,"&",Es),S(t,"*",As),S(t,"@",vt),S(t,"`",Ps),S(t,"^",Is),S(t,":",xt),S(t,",",ia),S(t,"$",Ns),S(t,".",Je),S(t,"=",Rs),S(t,"!",oa),S(t,"-",Re),S(t,"%",sr),S(t,"|",Ds),S(t,"+",$s),S(t,"#",Ls),S(t,"?",ir),S(t,'"',aa),S(t,"/",Ge),S(t,";",la),S(t,"~",or),S(t,"_",js),S(t,"\\",Ms),S(t,"",wd);const n=Z(t,rt,ra,{[oo]:!0});Z(n,rt,n);const s=Z(n,nt,bd,{[tr]:!0}),i=Z(n,Hn,vd,{[Jn]:!0}),o=Z(t,nt,st,{[ao]:!0});Z(o,rt,s),Z(o,nt,o),Z(s,rt,s),Z(s,nt,s);const a=Z(t,Hn,uo,{[lo]:!0});Z(a,nt),Z(a,rt,i),Z(a,Hn,a),Z(i,rt,i),Z(i,nt),Z(i,Hn,i);const l=S(t,Ai,sa,{[_i]:!0}),c=S(t,El,po,{[_i]:!0}),u=Z(t,Oi,po,{[_i]:!0});S(t,Mi,u),S(c,Ai,l),S(c,Mi,u),Z(c,Oi,u),S(u,El),S(u,Ai),Z(u,Oi,u),S(u,Mi,u);const d=Z(t,Ei,kd,{[yd]:!0});S(d,"#"),Z(d,Ei,d),S(d,m0,d);const h=S(d,g0);S(h,"#"),Z(h,Ei,d);const f=[[nt,o],[rt,s]],p=[[nt,null],[Hn,a],[rt,i]];for(let m=0;m<$r.length;m++)pt(t,$r[m],ho,st,f);for(let m=0;m<Lr.length;m++)pt(t,Lr[m],fo,uo,p);Kt(ho,{tld:!0,ascii:!0},e),Kt(fo,{utld:!0,alpha:!0},e),pt(t,"file",Jr,st,f),pt(t,"mailto",Jr,st,f),pt(t,"http",Cn,st,f),pt(t,"https",Cn,st,f),pt(t,"ftp",Cn,st,f),pt(t,"ftps",Cn,st,f),Kt(Jr,{scheme:!0,ascii:!0},e),Kt(Cn,{slashscheme:!0,ascii:!0},e),r=r.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<r.length;m++){const g=r[m][0],v=r[m][1]?{[d0]:!0}:{[h0]:!0};g.indexOf("-")>=0?v[co]=!0:nt.test(g)?rt.test(g)?v[tr]=!0:v[ao]=!0:v[oo]=!0,_l(t,g,g,v)}return _l(t,"localhost",vr,{ascii:!0}),t.jd=new _e(Bs),{start:t,tokens:Object.assign({groups:e},xd)}}function Sd(r,e){const t=b0(e.replace(/[A-Z]/g,a=>a.toLowerCase())),n=t.length,s=[];let i=0,o=0;for(;o<n;){let a=r,l=null,c=0,u=null,d=-1,h=-1;for(;o<n&&(l=a.go(t[o]));)a=l,a.accepts()?(d=0,h=0,u=a):d>=0&&(d+=t[o].length,h++),c+=t[o].length,i+=t[o].length,o++;i-=d,o-=h,c-=d,s.push({t:u.t,v:e.slice(i-c,i),s:i-c,e:i})}return s}function b0(r){const e=[],t=r.length;let n=0;for(;n<t;){let s=r.charCodeAt(n),i,o=s<55296||s>56319||n+1===t||(i=r.charCodeAt(n+1))<56320||i>57343?r[n]:r.slice(n,n+2);e.push(o),n+=o.length}return e}function pt(r,e,t,n,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];r.j[l]?i=r.j[l]:(i=new _e(n),i.jr=s.slice(),r.j[l]=i),r=i}return i=new _e(t),i.jr=s.slice(),r.j[e[o-1]]=i,i}function Ol(r){const e=[],t=[];let n=0,s="0123456789";for(;n<r.length;){let i=0;for(;s.indexOf(r[n+i])>=0;)i++;if(i>0){e.push(t.join(""));for(let o=parseInt(r.substring(n,n+i),10);o>0;o--)t.pop();n+=i}else t.push(r[n]),n++}return e}const wr={defaultProtocol:"http",events:null,format:Al,formatHref:Al,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function ca(r,e=null){let t=Object.assign({},wr);r&&(t=Object.assign(t,r instanceof ca?r.o:r));const n=t.ignoreTags,s=[];for(let i=0;i<n.length;i++)s.push(n[i].toUpperCase());this.o=t,e&&(this.defaultRender=e),this.ignoreTags=s}ca.prototype={o:wr,ignoreTags:[],defaultRender(r){return r},check(r){return this.get("validate",r.toString(),r)},get(r,e,t){const n=e!=null;let s=this.o[r];return s&&(typeof s=="object"?(s=t.t in s?s[t.t]:wr[r],typeof s=="function"&&n&&(s=s(e,t))):typeof s=="function"&&n&&(s=s(e,t.t,t)),s)},getObj(r,e,t){let n=this.o[r];return typeof n=="function"&&e!=null&&(n=n(e,t.t,t)),n},render(r){const e=r.render(this);return(this.get("render",null,r)||this.defaultRender)(e,r.t,r)}};function Al(r){return r}function Td(r,e){this.t="token",this.v=r,this.tk=e}Td.prototype={isLink:!1,toString(){return this.v},toHref(r){return this.toString()},toFormattedString(r){const e=this.toString(),t=r.get("truncate",e,this),n=r.get("format",e,this);return t&&n.length>t?n.substring(0,t)+"":n},toFormattedHref(r){return r.get("formatHref",this.toHref(r.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(r=wr.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(r),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(r){return{type:this.t,value:this.toFormattedString(r),isLink:this.isLink,href:this.toFormattedHref(r),start:this.startIndex(),end:this.endIndex()}},validate(r){return r.get("validate",this.toString(),this)},render(r){const e=this,t=this.toHref(r.get("defaultProtocol")),n=r.get("formatHref",t,this),s=r.get("tagName",t,e),i=this.toFormattedString(r),o={},a=r.get("className",t,e),l=r.get("target",t,e),c=r.get("rel",t,e),u=r.getObj("attributes",t,e),d=r.getObj("events",t,e);return o.href=n,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:s,attributes:o,content:i,eventListeners:d}}};function ri(r,e){class t extends Td{constructor(s,i){super(s,i),this.t=r}}for(const n in e)t.prototype[n]=e[n];return t.t=r,t}const Ml=ri("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Pl=ri("text"),v0=ri("nl"),jr=ri("url",{isLink:!0,toHref(r=wr.defaultProtocol){return this.hasProtocol()?this.v:`${r}://${this.v}`},hasProtocol(){const r=this.tk;return r.length>=2&&r[0].t!==vr&&r[1].t===xt}}),Ne=r=>new _e(r);function w0({groups:r}){const e=r.domain.concat([Es,As,vt,Ms,Ps,Is,Ns,Rs,Re,ra,sr,Ds,$s,Ls,Ge,Bs,or,js]),t=[Os,xt,ia,Je,oa,sr,ir,aa,la,ys,bs,nr,rr,ps,fs,ms,gs,vs,ws,ks,xs,Ss,Ts,Cs,_s],n=[Es,Os,As,Ms,Ps,Is,Ns,Rs,Re,nr,rr,sr,Ds,$s,Ls,ir,Ge,Bs,or,js],s=Ne(),i=S(s,or);B(i,n,i),B(i,r.domain,i);const o=Ne(),a=Ne(),l=Ne();B(s,r.domain,o),B(s,r.scheme,a),B(s,r.slashscheme,l),B(o,n,i),B(o,r.domain,o);const c=S(o,vt);S(i,vt,c),S(a,vt,c),S(l,vt,c);const u=S(i,Je);B(u,n,i),B(u,r.domain,i);const d=Ne();B(c,r.domain,d),B(d,r.domain,d);const h=S(d,Je);B(h,r.domain,d);const f=Ne(Ml);B(h,r.tld,f),B(h,r.utld,f),S(c,vr,f);const p=S(d,Re);S(p,Re,p),B(p,r.domain,d),B(f,r.domain,d),S(f,Je,h),S(f,Re,p);const m=S(f,xt);B(m,r.numeric,Ml);const g=S(o,Re),y=S(o,Je);S(g,Re,g),B(g,r.domain,o),B(y,n,i),B(y,r.domain,o);const v=Ne(jr);B(y,r.tld,v),B(y,r.utld,v),B(v,r.domain,o),B(v,n,i),S(v,Je,y),S(v,Re,g),S(v,vt,c);const k=S(v,xt),C=Ne(jr);B(k,r.numeric,C);const E=Ne(jr),O=Ne();B(E,e,E),B(E,t,O),B(O,e,E),B(O,t,O),S(v,Ge,E),S(C,Ge,E);const L=S(a,xt),M=S(l,xt),H=S(M,Ge),Y=S(H,Ge);B(a,r.domain,o),S(a,Je,y),S(a,Re,g),B(l,r.domain,o),S(l,Je,y),S(l,Re,g),B(L,r.domain,E),S(L,Ge,E),S(L,ir,E),B(Y,r.domain,E),B(Y,e,E),S(Y,Ge,E);const Ke=[[nr,rr],[fs,ps],[ms,gs],[ys,bs],[vs,ws],[ks,xs],[Ss,Ts],[Cs,_s]];for(let Lt=0;Lt<Ke.length;Lt++){const[cn,Un]=Ke[Lt],ft=S(E,cn);S(O,cn,ft),S(ft,Un,E);const Ie=Ne(jr);B(ft,e,Ie);const T=Ne();B(ft,t),B(Ie,e,Ie),B(Ie,t,T),B(T,e,Ie),B(T,t,T),S(Ie,Un,E),S(T,Un,E)}return S(s,vr,v),S(s,sa,v0),{start:s,tokens:xd}}function k0(r,e,t){let n=t.length,s=0,i=[],o=[];for(;s<n;){let a=r,l=null,c=null,u=0,d=null,h=-1;for(;s<n&&!(l=a.go(t[s].t));)o.push(t[s++]);for(;s<n&&(c=l||a.go(t[s].t));)l=null,a=c,a.accepts()?(h=0,d=a):h>=0&&h++,s++,u++;if(h<0)s-=u,s<n&&(o.push(t[s]),s++);else{o.length>0&&(i.push(Pi(Pl,e,o)),o=[]),s-=h,u-=h;const f=d.t,p=t.slice(s-u,s);i.push(Pi(f,e,p))}}return o.length>0&&i.push(Pi(Pl,e,o)),i}function Pi(r,e,t){const n=t[0].s,s=t[t.length-1].e,i=e.slice(n,s);return new r(i,t)}const x0=typeof console<"u"&&console&&console.warn||(()=>{}),S0="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",J={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function T0(){return _e.groups={},J.scanner=null,J.parser=null,J.tokenQueue=[],J.pluginQueue=[],J.customSchemes=[],J.initialized=!1,J}function Il(r,e=!1){if(J.initialized&&x0(`linkifyjs: already initialized - will not register custom scheme "${r}" ${S0}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(r))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);J.customSchemes.push([r,e])}function C0(){J.scanner=y0(J.customSchemes);for(let r=0;r<J.tokenQueue.length;r++)J.tokenQueue[r][1]({scanner:J.scanner});J.parser=w0(J.scanner.tokens);for(let r=0;r<J.pluginQueue.length;r++)J.pluginQueue[r][1]({scanner:J.scanner,parser:J.parser});return J.initialized=!0,J}function ua(r){return J.initialized||C0(),k0(J.parser.start,r,Sd(J.scanner.start,r))}ua.scan=Sd;function Cd(r,e=null,t=null){if(e&&typeof e=="object"){if(t)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);t=e,e=null}const n=new ca(t),s=ua(r),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&n.check(a)&&i.push(a.toFormattedObject(n))}return i}var da="[\0- -\u2029]",_0=new RegExp(da),E0=new RegExp(`${da}$`),O0=new RegExp(da,"g");function A0(r){return r.length===1?r[0].isLink:r.length===3&&r[1].isLink?["()","[]"].includes(r[0].value+r[2].value):!1}function M0(r){return new te({key:new he("autolink"),appendTransaction:(e,t,n)=>{const s=e.some(c=>c.docChanged)&&!t.doc.eq(n.doc),i=e.some(c=>c.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=n,a=Fu(t.doc,[...e]);if(Gu(a).forEach(({newRange:c})=>{const u=Zm(n.doc,c,f=>f.isTextblock);let d,h;if(u.length>1)d=u[0],h=n.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const f=n.doc.textBetween(c.from,c.to," "," ");if(!E0.test(f))return;d=u[0],h=n.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&h){const f=h.split(_0).filter(Boolean);if(f.length<=0)return!1;const p=f[f.length-1],m=d.pos+h.lastIndexOf(p);if(!p)return!1;const g=ua(p).map(y=>y.toObject(r.defaultProtocol));if(!A0(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:m+y.start+1,to:m+y.end+1})).filter(y=>n.schema.marks.code?!n.doc.rangeHasMark(y.from,y.to,n.schema.marks.code):!0).filter(y=>r.validate(y.value)).filter(y=>r.shouldAutoLink(y.value)).forEach(y=>{ea(y.from,y.to,n.doc).some(v=>v.mark.type===r.type)||o.addMark(y.from,y.to,r.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function P0(r){return new te({key:new he("handleClickLink"),props:{handleClick:(e,t,n)=>{var s,i;if(n.button!==0||!e.editable)return!1;let o=null;if(n.target instanceof HTMLAnchorElement)o=n.target;else{let u=n.target;const d=[];for(;u.nodeName!=="DIV";)d.push(u),u=u.parentNode;o=d.find(h=>h.nodeName==="A")}if(!o)return!1;const a=Ju(e.state,r.type.name),l=(s=o?.href)!=null?s:a.href,c=(i=o?.target)!=null?i:a.target;return r.enableClickSelection&&r.editor.commands.extendMarkRange(r.type.name),o&&l?(window.open(l,c),!0):!1}}})}function I0(r){return new te({key:new he("handlePasteLink"),props:{handlePaste:(e,t,n)=>{const{state:s}=e,{selection:i}=s,{empty:o}=i;if(o)return!1;let a="";n.content.forEach(c=>{a+=c.textContent});const l=Cd(a,{defaultProtocol:r.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:r.editor.commands.setMark(r.type,{href:l.href})}}})}function jt(r,e){const t=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(n=>{const s=typeof n=="string"?n:n.scheme;s&&t.push(s)}),!r||r.replace(O0,"").match(new RegExp(`^(?:(?:${t.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var N0=an.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(r=>{if(typeof r=="string"){Il(r);return}Il(r.scheme,r.optionalSlashes)})},onDestroy(){T0()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(r,e)=>!!jt(r,e.protocols),validate:r=>!!r,shouldAutoLink:r=>!!r}},addAttributes(){return{href:{default:null,parseHTML(r){return r.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:r=>{const e=r.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:t=>!!jt(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:r}){return this.options.isAllowedUri(r.href,{defaultValidate:e=>!!jt(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",ne(this.options.HTMLAttributes,r),0]:["a",ne(this.options.HTMLAttributes,{...r,href:""}),0]},addCommands(){return{setLink:r=>({chain:e})=>{const{href:t}=r;return this.options.isAllowedUri(t,{defaultValidate:n=>!!jt(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,r).setMeta("preventAutolink",!0).run():!1},toggleLink:r=>({chain:e})=>{const{href:t}=r||{};return t&&!this.options.isAllowedUri(t,{defaultValidate:n=>!!jt(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,r,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:r})=>r().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[sn({find:r=>{const e=[];if(r){const{protocols:t,defaultProtocol:n}=this.options,s=Cd(r).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:o=>!!jt(o,t),protocols:t,defaultProtocol:n}));s.length&&s.forEach(i=>e.push({text:i.value,data:{href:i.href},index:i.start}))}return e},type:this.type,getAttributes:r=>{var e;return{href:(e=r.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const r=[],{protocols:e,defaultProtocol:t}=this.options;return this.options.autolink&&r.push(M0({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:n=>this.options.isAllowedUri(n,{defaultValidate:s=>!!jt(s,e),protocols:e,defaultProtocol:t}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&r.push(P0({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&r.push(I0({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),r}}),R0=Object.defineProperty,D0=(r,e)=>{for(var t in e)R0(r,t,{get:e[t],enumerable:!0})},$0="listItem",Nl="textStyle",Rl=/^\s*([-+*])\s$/,_d=Oe.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:r}){return["ul",ne(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleBulletList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes($0,this.editor.getAttributes(Nl)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let r=Ln({find:Rl,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Ln({find:Rl,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Nl),editor:this.editor})),[r]}}),Ed=Oe.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:r}){return["li",ne(this.options.HTMLAttributes,r),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),L0={};D0(L0,{findListItemPos:()=>Er,getNextListDepth:()=>ha,handleBackspace:()=>mo,handleDelete:()=>go,hasListBefore:()=>Od,hasListItemAfter:()=>j0,hasListItemBefore:()=>Ad,listItemHasSubList:()=>Md,nextListIsDeeper:()=>Pd,nextListIsHigher:()=>Id});var Er=(r,e)=>{const{$from:t}=e.selection,n=se(r,e.schema);let s=null,i=t.depth,o=t.pos,a=null;for(;i>0&&a===null;)s=t.node(i),s.type===n?a=i:(i-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},ha=(r,e)=>{const t=Er(r,e);if(!t)return!1;const[,n]=cg(e,r,t.$pos.pos+4);return n},Od=(r,e,t)=>{const{$anchor:n}=r.selection,s=Math.max(0,n.pos-2),i=r.doc.resolve(s).node();return!(!i||!t.includes(i.type.name))},Ad=(r,e)=>{var t;const{$anchor:n}=e.selection,s=e.doc.resolve(n.pos-2);return!(s.index()===0||((t=s.nodeBefore)==null?void 0:t.type.name)!==r)},Md=(r,e,t)=>{if(!t)return!1;const n=se(r,e.schema);let s=!1;return t.descendants(i=>{i.type===n&&(s=!0)}),s},mo=(r,e,t)=>{if(r.commands.undoInputRule())return!0;if(r.state.selection.from!==r.state.selection.to)return!1;if(!Nt(r.state,e)&&Od(r.state,e,t)){const{$anchor:a}=r.state.selection,l=r.state.doc.resolve(a.before()-1),c=[];l.node().descendants((h,f)=>{h.type.name===e&&c.push({node:h,pos:f})});const u=c.at(-1);if(!u)return!1;const d=r.state.doc.resolve(l.start()+u.pos+1);return r.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!Nt(r.state,e)||!fg(r.state))return!1;const n=Er(e,r.state);if(!n)return!1;const i=r.state.doc.resolve(n.$pos.pos-2).node(n.depth),o=Md(e,r.state,i);return Ad(e,r.state)&&!o?r.commands.joinItemBackward():r.chain().liftListItem(e).run()},Pd=(r,e)=>{const t=ha(r,e),n=Er(r,e);return!n||!t?!1:t>n.depth},Id=(r,e)=>{const t=ha(r,e),n=Er(r,e);return!n||!t?!1:t<n.depth},go=(r,e)=>{if(!Nt(r.state,e)||!hg(r.state,e))return!1;const{selection:t}=r.state,{$from:n,$to:s}=t;return!t.empty&&n.sameParent(s)?!1:Pd(e,r.state)?r.chain().focus(r.state.selection.from+4).lift(e).joinBackward().run():Id(e,r.state)?r.chain().joinForward().joinBackward().run():r.commands.joinItemForward()},j0=(r,e)=>{var t;const{$anchor:n}=e.selection,s=e.doc.resolve(n.pos-n.parentOffset-2);return!(s.index()===s.parent.childCount-1||((t=s.nodeAfter)==null?void 0:t.type.name)!==r)},Nd=ie.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{r.state.schema.nodes[t]!==void 0&&go(r,t)&&(e=!0)}),e},"Mod-Delete":({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t})=>{r.state.schema.nodes[t]!==void 0&&go(r,t)&&(e=!0)}),e},Backspace:({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:n})=>{r.state.schema.nodes[t]!==void 0&&mo(r,t,n)&&(e=!0)}),e},"Mod-Backspace":({editor:r})=>{let e=!1;return this.options.listTypes.forEach(({itemName:t,wrapperNames:n})=>{r.state.schema.nodes[t]!==void 0&&mo(r,t,n)&&(e=!0)}),e}}}}),B0="listItem",Dl="textStyle",$l=/^(\d+)\.\s$/,Rd=Oe.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:r=>r.hasAttribute("start")?parseInt(r.getAttribute("start")||"",10):1},type:{default:null,parseHTML:r=>r.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:r}){const{start:e,...t}=r;return e===1?["ol",ne(this.options.HTMLAttributes,t),0]:["ol",ne(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleOrderedList:()=>({commands:r,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(B0,this.editor.getAttributes(Dl)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let r=Ln({find:$l,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Ln({find:$l,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Dl)}),joinPredicate:(e,t)=>t.childCount+t.attrs.start===+e[1],editor:this.editor})),[r]}}),F0=/^\s*(\[([( |x])?\])\s$/,z0=Oe.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:r=>{const e=r.getAttribute("data-checked");return e===""||e==="true"},renderHTML:r=>({"data-checked":r.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:r,HTMLAttributes:e}){return["li",ne(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:r.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const r={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...r,Tab:()=>this.editor.commands.sinkListItem(this.name)}:r},addNodeView(){return({node:r,HTMLAttributes:e,getPos:t,editor:n})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,h;a.ariaLabel=((h=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:h.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(r),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!n.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;n.isEditable&&typeof t=="function"&&n.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{const f=t();if(typeof f!="number")return!1;const p=h.doc.nodeAt(f);return h.setNodeMarkup(f,void 0,{...p?.attrs,checked:d}),!0}).run(),!n.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(r,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{s.setAttribute(u,d)}),s.dataset.checked=r.attrs.checked,a.checked=r.attrs.checked,i.append(a,o),s.append(i,l),Object.entries(e).forEach(([u,d])=>{s.setAttribute(u,d)}),{dom:s,contentDOM:l,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[Ln({find:F0,type:this.type,getAttributes:r=>({checked:r[r.length-1]==="x"})})]}}),U0=Oe.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:r}){return["ul",ne(this.options.HTMLAttributes,r,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:r})=>r.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});ie.create({name:"listKit",addExtensions(){const r=[];return this.options.bulletList!==!1&&r.push(_d.configure(this.options.bulletList)),this.options.listItem!==!1&&r.push(Ed.configure(this.options.listItem)),this.options.listKeymap!==!1&&r.push(Nd.configure(this.options.listKeymap)),this.options.orderedList!==!1&&r.push(Rd.configure(this.options.orderedList)),this.options.taskItem!==!1&&r.push(z0.configure(this.options.taskItem)),this.options.taskList!==!1&&r.push(U0.configure(this.options.taskList)),r}});var V0=Oe.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:r}){return["p",ne(this.options.HTMLAttributes,r),0]},addCommands(){return{setParagraph:()=>({commands:r})=>r.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),H0=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,W0=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,q0=an.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["s",ne(this.options.HTMLAttributes,r),0]},addCommands(){return{setStrike:()=>({commands:r})=>r.setMark(this.name),toggleStrike:()=>({commands:r})=>r.toggleMark(this.name),unsetStrike:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[$n({find:H0,type:this.type})]},addPasteRules(){return[sn({find:W0,type:this.type})]}}),K0=Oe.create({name:"text",group:"inline"}),J0=an.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["u",ne(this.options.HTMLAttributes,r),0]},addCommands(){return{setUnderline:()=>({commands:r})=>r.setMark(this.name),toggleUnderline:()=>({commands:r})=>r.toggleMark(this.name),unsetUnderline:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function G0(r={}){return new te({view(e){return new Y0(e,r)}})}class Y0{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(n=t.width)!==null&&n!==void 0?n:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),t=!e.parent.inlineContent,n,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(t){let d=e.nodeBefore,h=e.nodeAfter;if(d||h){let f=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(f){let p=f.getBoundingClientRect(),m=d?p.bottom:p.top;d&&h&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*a;n={left:p.left,right:p.right,top:m-g,bottom:m+g}}}}if(!n){let d=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;n={left:d.left-h,right:d.left+h,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",t),this.element.classList.toggle("prosemirror-dropcursor-inline",!t);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),h=d.width/l.offsetWidth,f=d.height/l.offsetHeight;c=d.left-l.scrollLeft*h,u=d.top-l.scrollTop*f}this.element.style.left=(n.left-c)/o+"px",this.element.style.top=(n.top-u)/a+"px",this.element.style.width=(n.right-n.left)/o+"px",this.element.style.height=(n.bottom-n.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),s=n&&n.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,t,e):s;if(t&&!i){let o=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=jc(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class ee extends j{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return ee.valid(n)?new ee(n):j.near(n)}content(){return _.empty}eq(e){return e instanceof ee&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new ee(e.resolve(t.pos))}getBookmark(){return new fa(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!Q0(e)||!X0(e))return!1;let n=t.type.spec.allowGapCursor;if(n!=null)return n;let s=t.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&ee.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(t>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(t>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=t;let l=e.doc.resolve(s);if(ee.valid(l))return l}for(;;){let o=t>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!N.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*t),n=!1;continue e}break}i=o,s+=t;let a=e.doc.resolve(s);if(ee.valid(a))return a}return null}}}ee.prototype.visible=!1;ee.findFrom=ee.findGapCursorFrom;j.jsonID("gapcursor",ee);class fa{constructor(e){this.pos=e}map(e){return new fa(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return ee.valid(t)?new ee(t):j.near(t)}}function Q0(r){for(let e=r.depth;e>=0;e--){let t=r.index(e),n=r.node(e);if(t==0){if(n.type.spec.isolating)return!0;continue}for(let s=n.child(t-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function X0(r){for(let e=r.depth;e>=0;e--){let t=r.indexAfter(e),n=r.node(e);if(t==n.childCount){if(n.type.spec.isolating)return!0;continue}for(let s=n.child(t);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function Z0(){return new te({props:{decorations:rb,createSelectionBetween(r,e,t){return e.pos==t.pos&&ee.valid(t)?new ee(t):null},handleClick:tb,handleKeyDown:eb,handleDOMEvents:{beforeinput:nb}}})}const eb=_u({ArrowLeft:Br("horiz",-1),ArrowRight:Br("horiz",1),ArrowUp:Br("vert",-1),ArrowDown:Br("vert",1)});function Br(r,e){const t=r=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,s,i){let o=n.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof D){if(!i.endOfTextblock(t)||a.depth==0)return!1;l=!1,a=n.doc.resolve(e>0?a.after():a.before())}let c=ee.findGapCursorFrom(a,e,l);return c?(s&&s(n.tr.setSelection(new ee(c))),!0):!1}}function tb(r,e,t){if(!r||!r.editable)return!1;let n=r.state.doc.resolve(e);if(!ee.valid(n))return!1;let s=r.posAtCoords({left:t.clientX,top:t.clientY});return s&&s.inside>-1&&N.isSelectable(r.state.doc.nodeAt(s.inside))?!1:(r.dispatch(r.state.tr.setSelection(new ee(n))),!0)}function nb(r,e){if(e.inputType!="insertCompositionText"||!(r.state.selection instanceof ee))return!1;let{$from:t}=r.state.selection,n=t.parent.contentMatchAt(t.index()).findWrapping(r.state.schema.nodes.text);if(!n)return!1;let s=x.empty;for(let o=n.length-1;o>=0;o--)s=x.from(n[o].createAndFill(null,s));let i=r.state.tr.replace(t.pos,t.pos,new _(s,0,0));return i.setSelection(D.near(i.doc.resolve(t.pos+1))),r.dispatch(i),!1}function rb(r){if(!(r.selection instanceof ee))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Q.create(r.doc,[xe.widget(r.selection.head,e,{key:"gapcursor"})])}var Fs=200,de=function(){};de.prototype.append=function(e){return e.length?(e=de.from(e),!this.length&&e||e.length<Fs&&this.leafAppend(e)||this.length<Fs&&e.leafPrepend(this)||this.appendInner(e)):this};de.prototype.prepend=function(e){return e.length?de.from(e).append(this):this};de.prototype.appendInner=function(e){return new sb(this,e)};de.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?de.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};de.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};de.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)};de.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},t,n),s};de.from=function(e){return e instanceof de?e:e&&e.length?new Dd(e):de.empty};var Dd=(function(r){function e(n){r.call(this),this.values=n}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=Fs)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=Fs)return new e(s.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e})(de);de.empty=new Dd([]);var sb=(function(r){function e(t,n){r.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(n,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(n,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(n,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(n,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(n,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(n,s){if(n==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(n,s):n>=i?this.right.slice(n-i,s-i):this.left.slice(n,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(n){var s=this.right.leafAppend(n);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(n){var s=this.left.leafPrepend(n);if(s)return new e(s,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e})(de);const ib=500;class Ue{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let n=this.items.length;for(;;n--)if(this.items.get(n-1).selection){--n;break}let s,i;t&&(s=this.remapping(n,this.items.length),i=s.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,h)=>{if(!d.step){s||(s=this.remapping(n,h+1),i=s.maps.length),i--,u.push(d);return}if(s){u.push(new Ye(d.map));let f=d.step.map(s.slice(i)),p;f&&o.maybeStep(f).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Ye(p,void 0,void 0,c.length+u.length))),i--,p&&s.appendMap(p,i)}else o.maybeStep(d.step);if(d.selection)return a=s?d.selection.map(s.slice(i)):d.selection,l=new Ue(this.items.slice(0,n).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,t,n,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),h=new Ye(e.mapping.maps[u],d,t),f;(f=l&&l.merge(h))&&(h=f,u?i.pop():a=a.slice(0,a.length-1)),i.push(h),t&&(o++,t=void 0),s||(l=h)}let c=o-n.depth;return c>ab&&(a=ob(a,c),o-=c),new Ue(a.append(i),o)}remapping(e,t){let n=new hr;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?n.maps.length-s.mirrorOffset:void 0;n.appendMap(s.map,o)},e,t),n}addMaps(e){return this.eventCount==0?this:new Ue(this.items.append(e.map(t=>new Ye(t))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],s=Math.max(0,this.items.length-t),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},s);let l=t;this.items.forEach(h=>{let f=i.getMirror(--l);if(f==null)return;o=Math.min(o,f);let p=i.maps[f];if(h.step){let m=e.steps[f].invert(e.docs[f]),g=h.selection&&h.selection.map(i.slice(l+1,f));g&&a++,n.push(new Ye(p,m,g))}else n.push(new Ye(p))},s);let c=[];for(let h=t;h<o;h++)c.push(new Ye(i.maps[h]));let u=this.items.slice(0,s).append(c).append(n),d=new Ue(u,a);return d.emptyItemCount()>ib&&(d=d.compress(this.items.length-n.length)),d}emptyItemCount(){let e=0;return this.items.forEach(t=>{t.step||e++}),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(t.slice(n)),c=l&&l.getMap();if(n--,c&&t.appendMap(c,n),l){let u=o.selection&&o.selection.map(t.slice(n));u&&i++;let d=new Ye(c.invert(),l,u),h,f=s.length-1;(h=s.length&&s[f].merge(d))?s[f]=h:s.push(d)}}else o.map&&n--},this.items.length,0),new Ue(de.from(s.reverse()),i)}}Ue.empty=new Ue(de.empty,0);function ob(r,e){let t;return r.forEach((n,s)=>{if(n.selection&&e--==0)return t=s,!1}),r.slice(t)}class Ye{constructor(e,t,n,s){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new Ye(t.getMap().invert(),t,this.selection)}}}class wt{constructor(e,t,n,s,i){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=s,this.prevComposition=i}}const ab=20;function lb(r,e,t,n){let s=t.getMeta(Zt),i;if(s)return s.historyState;t.getMeta(db)&&(r=new wt(r.done,r.undone,null,0,-1));let o=t.getMeta("appendedTransaction");if(t.steps.length==0)return r;if(o&&o.getMeta(Zt))return o.getMeta(Zt).redo?new wt(r.done.addTransform(t,void 0,n,Gr(e)),r.undone,Ll(t.mapping.maps),r.prevTime,r.prevComposition):new wt(r.done,r.undone.addTransform(t,void 0,n,Gr(e)),null,r.prevTime,r.prevComposition);if(t.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=t.getMeta("composition"),l=r.prevTime==0||!o&&r.prevComposition!=a&&(r.prevTime<(t.time||0)-n.newGroupDelay||!cb(t,r.prevRanges)),c=o?Ii(r.prevRanges,t.mapping):Ll(t.mapping.maps);return new wt(r.done.addTransform(t,l?e.selection.getBookmark():void 0,n,Gr(e)),Ue.empty,c,t.time,a??r.prevComposition)}else return(i=t.getMeta("rebased"))?new wt(r.done.rebased(t,i),r.undone.rebased(t,i),Ii(r.prevRanges,t.mapping),r.prevTime,r.prevComposition):new wt(r.done.addMaps(t.mapping.maps),r.undone.addMaps(t.mapping.maps),Ii(r.prevRanges,t.mapping),r.prevTime,r.prevComposition)}function cb(r,e){if(!e)return!1;if(!r.docChanged)return!0;let t=!1;return r.mapping.maps[0].forEach((n,s)=>{for(let i=0;i<e.length;i+=2)n<=e[i+1]&&s>=e[i]&&(t=!0)}),t}function Ll(r){let e=[];for(let t=r.length-1;t>=0&&e.length==0;t--)r[t].forEach((n,s,i,o)=>e.push(i,o));return e}function Ii(r,e){if(!r)return null;let t=[];for(let n=0;n<r.length;n+=2){let s=e.map(r[n],1),i=e.map(r[n+1],-1);s<=i&&t.push(s,i)}return t}function ub(r,e,t){let n=Gr(e),s=Zt.get(e).spec.config,i=(t?r.undone:r.done).popEvent(e,n);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(t?r.done:r.undone).addTransform(i.transform,e.selection.getBookmark(),s,n),l=new wt(t?a:i.remaining,t?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Zt,{redo:t,historyState:l})}let Ni=!1,jl=null;function Gr(r){let e=r.plugins;if(jl!=e){Ni=!1,jl=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Ni=!0;break}}return Ni}const Zt=new he("history"),db=new he("closeHistory");function hb(r={}){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new te({key:Zt,state:{init(){return new wt(Ue.empty,Ue.empty,null,0,-1)},apply(e,t,n){return lb(t,n,e,r)}},config:r,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,s=n=="historyUndo"?Ld:n=="historyRedo"?jd:null;return s?(t.preventDefault(),s(e.state,e.dispatch)):!1}}}})}function $d(r,e){return(t,n)=>{let s=Zt.getState(t);if(!s||(r?s.undone:s.done).eventCount==0)return!1;if(n){let i=ub(s,t,r);i&&n(e?i.scrollIntoView():i)}return!0}}const Ld=$d(!1,!0),jd=$d(!0,!0);ie.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:r=>r.length,wordCounter:r=>r.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=r=>{const e=r?.node||this.editor.state.doc;if((r?.mode||this.options.mode)==="textSize"){const n=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(n)}return e.nodeSize},this.storage.words=r=>{const e=r?.node||this.editor.state.doc,t=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(t)}},addProseMirrorPlugins(){let r=!1;return[new te({key:new he("characterCount"),appendTransaction:(e,t,n)=>{if(r)return;const s=this.options.limit;if(s==null||s===0){r=!0;return}const i=this.storage.characters({node:n.doc});if(i>s){const o=i-s,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const c=n.tr.deleteRange(a,l);return r=!0,c}r=!0},filterTransaction:(e,t)=>{const n=this.options.limit;if(!e.docChanged||n===0||n===null||n===void 0)return!0;const s=this.storage.characters({node:t.doc}),i=this.storage.characters({node:e.doc});if(i<=n||s>n&&i>n&&i<=s)return!0;if(s>n&&i>n&&i>s||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=i-n,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>n)}})]}});var fb=ie.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[G0(this.options)]}});ie.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new te({key:new he("focus"),props:{decorations:({doc:r,selection:e})=>{const{isEditable:t,isFocused:n}=this.editor,{anchor:s}=e,i=[];if(!t||!n)return Q.create(r,[]);let o=0;this.options.mode==="deepest"&&r.descendants((l,c)=>{if(l.isText)return;if(!(s>=c&&s<=c+l.nodeSize-1))return!1;o+=1});let a=0;return r.descendants((l,c)=>{if(l.isText||!(s>=c&&s<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";i.push(xe.node(c,c+l.nodeSize,{class:this.options.className}))}),Q.create(r,i)}}})]}});var pb=ie.create({name:"gapCursor",addProseMirrorPlugins(){return[Z0()]},extendNodeSchema(r){var e;const t={name:r.name,options:r.options,storage:r.storage};return{allowGapCursor:(e=W(I(r,"allowGapCursor",t)))!=null?e:null}}});ie.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new te({key:new he("placeholder"),props:{decorations:({doc:r,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:n}=e,s=[];if(!t)return null;const i=this.editor.isEmpty;return r.descendants((o,a)=>{const l=n>=a&&n<=a+o.nodeSize,c=!o.isLeaf&&ei(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];i&&u.push(this.options.emptyEditorClass);const d=xe.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});s.push(d)}return this.options.includeChildren}),Q.create(r,s)}}})]}});ie.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:r,options:e}=this;return[new te({key:new he("selection"),props:{decorations(t){return t.selection.empty||r.isFocused||!r.isEditable||Qu(t.selection)||r.view.dragging?null:Q.create(t.doc,[xe.inline(t.selection.from,t.selection.to,{class:e.className})])}}})]}});function Bl({types:r,node:e}){return e&&Array.isArray(r)&&r.includes(e.type)||e?.type===r}var mb=ie.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const r=new he(this.name),e=Object.entries(this.editor.schema.nodes).map(([,t])=>t).filter(t=>(this.options.notAfter||[]).concat(this.options.node).includes(t.name));return[new te({key:r,appendTransaction:(t,n,s)=>{const{doc:i,tr:o,schema:a}=s,l=r.getState(s),c=i.content.size,u=a.nodes[this.options.node];if(l)return o.insert(c,u.create())},state:{init:(t,n)=>{const s=n.tr.doc.lastChild;return!Bl({node:s,types:e})},apply:(t,n)=>{if(!t.docChanged)return n;const s=t.doc.lastChild;return!Bl({node:s,types:e})}}})]}}),gb=ie.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:e})=>Ld(r,e),redo:()=>({state:r,dispatch:e})=>jd(r,e)}},addProseMirrorPlugins(){return[hb(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),yb=ie.create({name:"starterKit",addExtensions(){var r,e,t,n;const s=[];return this.options.bold!==!1&&s.push(Ky.configure(this.options.bold)),this.options.blockquote!==!1&&s.push(Uy.configure(this.options.blockquote)),this.options.bulletList!==!1&&s.push(_d.configure(this.options.bulletList)),this.options.code!==!1&&s.push(Yy.configure(this.options.code)),this.options.codeBlock!==!1&&s.push(Zy.configure(this.options.codeBlock)),this.options.document!==!1&&s.push(e0.configure(this.options.document)),this.options.dropcursor!==!1&&s.push(fb.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&s.push(pb.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&s.push(t0.configure(this.options.hardBreak)),this.options.heading!==!1&&s.push(n0.configure(this.options.heading)),this.options.undoRedo!==!1&&s.push(gb.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&s.push(r0.configure(this.options.horizontalRule)),this.options.italic!==!1&&s.push(l0.configure(this.options.italic)),this.options.listItem!==!1&&s.push(Ed.configure(this.options.listItem)),this.options.listKeymap!==!1&&s.push(Nd.configure((r=this.options)==null?void 0:r.listKeymap)),this.options.link!==!1&&s.push(N0.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&s.push(Rd.configure(this.options.orderedList)),this.options.paragraph!==!1&&s.push(V0.configure(this.options.paragraph)),this.options.strike!==!1&&s.push(q0.configure(this.options.strike)),this.options.text!==!1&&s.push(K0.configure(this.options.text)),this.options.underline!==!1&&s.push(J0.configure((t=this.options)==null?void 0:t.underline)),this.options.trailingNode!==!1&&s.push(mb.configure((n=this.options)==null?void 0:n.trailingNode)),s}}),bb=yb,vb=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,wb=Oe.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:r}){return["img",ne(this.options.HTMLAttributes,r)]},addCommands(){return{setImage:r=>({commands:e})=>e.insertContent({type:this.name,attrs:r})}},addInputRules(){return[md({find:vb,type:this.type,getAttributes:r=>{const[,,e,t,n]=r;return{src:t,alt:e,title:n}}})]}}),kb=wb;const xb=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Sr(async()=>{const{default:n}=await Promise.resolve().then(()=>zn);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class pa extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class Sb extends pa{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Fl extends pa{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class zl extends pa{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var yo;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(yo||(yo={}));var Tb=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class Cb{constructor(e,{headers:t={},customFetch:n,region:s=yo.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=xb(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return Tb(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);l&&l!=="any"&&(a["x-region"]=l,c.searchParams.set("forceFunctionRegion",l));let u;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(a["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(a["Content-Type"]="application/json",u=JSON.stringify(o)));const d=yield this.fetch(c.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:u}).catch(m=>{throw new Sb(m)}),h=d.headers.get("x-relay-error");if(h&&h==="true")throw new Fl(d);if(!d.ok)throw new zl(d);let f=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),p;return f==="application/json"?p=yield d.json():f==="application/octet-stream"?p=yield d.blob():f==="text/event-stream"?p=d:f==="multipart/form-data"?p=yield d.formData():p=yield d.text(),{data:p,error:null,response:d}}catch(s){return{data:null,error:s,response:s instanceof zl||s instanceof Fl?s.context:void 0}}})}}var le={},hn={},fn={},pn={},mn={},gn={},_b=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},jn=_b();const Eb=jn.fetch,Bd=jn.fetch.bind(jn),Fd=jn.Headers,Ob=jn.Request,Ab=jn.Response,zn=Object.freeze(Object.defineProperty({__proto__:null,Headers:Fd,Request:Ob,Response:Ab,default:Bd,fetch:Eb},Symbol.toStringTag,{value:"Module"})),Mb=ph(zn);var Fr={},Ul;function zd(){if(Ul)return Fr;Ul=1,Object.defineProperty(Fr,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Fr.default=r,Fr}var Vl;function Ud(){if(Vl)return gn;Vl=1;var r=gn&&gn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(gn,"__esModule",{value:!0});const e=r(Mb),t=r(zd());class n{constructor(i){var o,a;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(o=i.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=i.signal,this.isMaybeSingle=(a=i.isMaybeSingle)!==null&&a!==void 0?a:!1,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=new Headers(this.headers),this.headers.set(i,o),this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,h,f;let p=null,m=null,g=null,y=c.status,v=c.statusText;if(c.ok){if(this.method!=="HEAD"){const O=await c.text();O===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?m=O:m=JSON.parse(O))}const C=(d=this.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),E=(h=c.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");C&&E&&E.length>1&&(g=parseInt(E[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(p={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,g=null,y=406,v="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const C=await c.text();try{p=JSON.parse(C),Array.isArray(p)&&c.status===404&&(m=[],p=null,y=200,v="OK")}catch{c.status===404&&C===""?(y=204,v="No Content"):p={message:C}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,y=200,v="OK"),p&&this.shouldThrowOnError)throw new t.default(p)}return{error:p,data:m,count:g,status:y,statusText:v}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,h;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(h=c?.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,o)}returns(){return this}overrideTypes(){return this}}return gn.default=n,gn}var Hl;function Vd(){if(Hl)return mn;Hl=1;var r=mn&&mn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(mn,"__esModule",{value:!0});const e=r(Ud());class t extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${h}"; options=${d};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return mn.default=t,mn}var Wl;function ma(){if(Wl)return pn;Wl=1;var r=pn&&pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(pn,"__esModule",{value:!0});const e=r(Vd());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${l}fts${c}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return pn.default=t,pn}var ql;function Hd(){if(ql)return fn;ql=1;var r=fn&&fn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(fn,"__esModule",{value:!0});const e=r(ma());class t{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=new Headers(i),this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let l=!1;const c=(s??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:o=!0}={}){var a;const l="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){var c;const u="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),a&&this.headers.append("Prefer",`count=${a}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const d=s.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(d.length>0){const h=[...new Set(d)].map(f=>`"${f}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(s,{count:i}={}){var o;const a="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:s}={}){var i;const o="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return fn.default=t,fn}var Kl;function Pb(){if(Kl)return hn;Kl=1;var r=hn&&hn.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(hn,"__esModule",{value:!0});const e=r(Hd()),t=r(ma());class n{constructor(i,{headers:o={},schema:a,fetch:l}={}){this.url=i,this.headers=new Headers(o),this.schemaName=a,this.fetch=l}from(i){const o=new URL(`${this.url}/${i}`);return new e.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new n(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:a=!1,get:l=!1,count:c}={}){var u;let d;const h=new URL(`${this.url}/rpc/${i}`);let f;a||l?(d=a?"HEAD":"GET",Object.entries(o).filter(([m,g])=>g!==void 0).map(([m,g])=>[m,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([m,g])=>{h.searchParams.append(m,g)})):(d="POST",f=o);const p=new Headers(this.headers);return c&&p.set("Prefer",`count=${c}`),new t.default({method:d,url:h,headers:p,schema:this.schemaName,body:f,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return hn.default=n,hn}var Jl;function Ib(){if(Jl)return le;Jl=1;var r=le&&le.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(le,"__esModule",{value:!0}),le.PostgrestError=le.PostgrestBuilder=le.PostgrestTransformBuilder=le.PostgrestFilterBuilder=le.PostgrestQueryBuilder=le.PostgrestClient=void 0;const e=r(Pb());le.PostgrestClient=e.default;const t=r(Hd());le.PostgrestQueryBuilder=t.default;const n=r(ma());le.PostgrestFilterBuilder=n.default;const s=r(Vd());le.PostgrestTransformBuilder=s.default;const i=r(Ud());le.PostgrestBuilder=i.default;const o=r(zd());return le.PostgrestError=o.default,le.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},le}var Nb=Ib();const Rb=mh(Nb),{PostgrestClient:Db,PostgrestQueryBuilder:Nx,PostgrestFilterBuilder:Rx,PostgrestTransformBuilder:Dx,PostgrestBuilder:$x,PostgrestError:Lx}=Rb;class $b{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Lb="2.15.4",jb=`realtime-js/${Lb}`,Bb="1.0.0",bo=1e4,Fb=1e3,zb=100;var ar;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(ar||(ar={}));var oe;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(oe||(oe={}));var Fe;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(Fe||(Fe={}));var vo;(function(r){r.websocket="websocket"})(vo||(vo={}));var Vt;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Vt||(Vt={}));class Ub{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+s));o=o+s;const l=n.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class Wd{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var K;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(K||(K={}));const Gl=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((i,o)=>(i[o]=Vb(o,r,e,s),i),{})},Vb=(r,e,t,n)=>{const s=e.find(a=>a.name===r),i=s?.type,o=t[r];return i&&!n.includes(i)?qd(i,o):wo(o)},qd=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Kb(e,t)}switch(r){case K.bool:return Hb(e);case K.float4:case K.float8:case K.int2:case K.int4:case K.int8:case K.numeric:case K.oid:return Wb(e);case K.json:case K.jsonb:return qb(e);case K.timestamp:return Jb(e);case K.abstime:case K.date:case K.daterange:case K.int4range:case K.int8range:case K.money:case K.reltime:case K.text:case K.time:case K.timestamptz:case K.timetz:case K.tsrange:case K.tstzrange:return wo(e);default:return wo(e)}},wo=r=>r,Hb=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Wb=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},qb=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Kb=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let i;const o=r.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>qd(e,a))}return r},Jb=r=>typeof r=="string"?r.replace(" ","T"):r,Kd=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Ri{constructor(e,t,n={},s=bo){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Yl;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Yl||(Yl={}));class lr{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=lr.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=lr.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=lr.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=i[c];if(d){const h=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),p=u.filter(g=>f.indexOf(g.presence_ref)<0),m=d.filter(g=>h.indexOf(g.presence_ref)<0);p.length>0&&(a[c]=p),m.length>0&&(l[c]=m)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(f=>f.presence_ref),h=u.filter(f=>d.indexOf(f.presence_ref)<0);e[a].unshift(...h)}n(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ql;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ql||(Ql={}));var cr;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(cr||(cr={}));var at;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(at||(at={}));class ga{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=oe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ri(this,Fe.join,this.params,this.timeout),this.rejoinTimer=new Wd(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=oe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=oe.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=oe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=oe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=oe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Fe.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new lr(this),this.broadcastEndpointURL=Kd(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==oe.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,c=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(f=>f.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[cr.PRESENCE]&&this.bindings[cr.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(at.CHANNEL_ERROR,f)),this._onClose(()=>e?.(at.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var p;if(this.socket.setAuth(),f===void 0){e?.(at.SUBSCRIBED);return}else{const m=this.bindings.postgres_changes,g=(p=m?.length)!==null&&p!==void 0?p:0,y=[];for(let v=0;v<g;v++){const k=m[v],{filter:{event:C,schema:E,table:O,filter:L}}=k,M=f&&f[v];if(M&&M.event===C&&M.schema===E&&M.table===O&&M.filter===L)y.push(Object.assign(Object.assign({},k),{id:M.id}));else{this.unsubscribe(),this.state=oe.errored,e?.(at.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(at.SUBSCRIBED);return}}).receive("error",f=>{this.state=oe.errored,e?.(at.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(at.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===oe.joined&&e===cr.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=oe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Fe.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Ri(this,Fe.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=oe.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ri(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>zb){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Fe;if(n&&[a,l,c,u].indexOf(o)>=0&&n!==this._joinRef())return;let h=this._onMessage(o,t,n);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var p,m,g;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((g=(m=f.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===o}).map(f=>f.callback(h,n)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var p,m,g,y,v,k;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const C=f.id,E=(p=f.filter)===null||p===void 0?void 0:p.event;return C&&((m=t.ids)===null||m===void 0?void 0:m.includes(C))&&(E==="*"||E?.toLocaleLowerCase()===((g=t.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{const C=(v=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return C==="*"||C===((k=t?.event)===null||k===void 0?void 0:k.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof h=="object"&&"ids"in h){const p=h.data,{schema:m,table:g,commit_timestamp:y,type:v,errors:k}=p;h=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:y,eventType:v,new:{},old:{},errors:k}),this._getPayloadRecords(p))}f.callback(h,n)})}_isClosed(){return this.state===oe.closed}_isJoined(){return this.state===oe.joined}_isJoining(){return this.state===oe.joining}_isLeaving(){return this.state===oe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&ga.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Fe.close,{},e)}_onError(e){this._on(Fe.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=oe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Gl(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Gl(e.columns,e.old_record)),t}}const Di=()=>{},zr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Gb=[1e3,2e3,5e3,1e4],Yb=1e4,Qb=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Xb{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=bo,this.transport=null,this.heartbeatIntervalMs=zr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Di,this.ref=0,this.reconnectTimer=null,this.logger=Di,this.conn=null,this.sendBuffer=[],this.serializer=new Ub,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...o)=>Sr(async()=>{const{default:a}=await Promise.resolve().then(()=>zn);return{default:a}},void 0).then(({default:a})=>a(...o)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${vo.websocket}`,this.httpEndpoint=Kd(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=$b.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Bb}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ar.connecting:return Vt.Connecting;case ar.open:return Vt.Open;case ar.closing:return Vt.Closing;default:return Vt.Closed}}isConnected(){return this.connectionState()===Vt.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new ga(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${n} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Fb,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},zr.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:o}=t,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${a}`.trim(),i),this.channels.filter(c=>c._isMember(n)).forEach(c=>c._trigger(s,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Fe.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([Qb],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:jb};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(Fe.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Wd(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},zr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,i,o,a,l,c,u;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:bo,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:zr.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:Di,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e?.reconnectAfterMs)!==null&&l!==void 0?l:(d=>Gb[d-1]||Yb),this.encode=(c=e?.encode)!==null&&c!==void 0?c:((d,h)=>h(JSON.stringify(d))),this.decode=(u=e?.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class ya extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ae(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Zb extends ya{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class ko extends ya{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ev=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const Jd=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Sr(async()=>{const{default:n}=await Promise.resolve().then(()=>zn);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},tv=()=>ev(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Sr(()=>Promise.resolve().then(()=>zn),void 0)).Response:Response}),xo=r=>{if(Array.isArray(r))return r.map(t=>xo(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=xo(n)}),e},nv=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)};var ln=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const $i=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),rv=(r,e,t)=>ln(void 0,void 0,void 0,function*(){const n=yield tv();r instanceof n&&!t?.noResolveJson?r.json().then(s=>{const i=r.status||500,o=s?.statusCode||i+"";e(new Zb($i(s),i,o))}).catch(s=>{e(new ko($i(s),s))}):e(new ko($i(r),r))}),sv=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"||!n?s:(nv(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(n)):s.body=n,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Or(r,e,t,n,s,i){return ln(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,sv(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>rv(l,a,n))})})}function zs(r,e,t,n){return ln(this,void 0,void 0,function*(){return Or(r,"GET",e,t,n)})}function Qe(r,e,t,n,s){return ln(this,void 0,void 0,function*(){return Or(r,"POST",e,n,s,t)})}function So(r,e,t,n,s){return ln(this,void 0,void 0,function*(){return Or(r,"PUT",e,n,s,t)})}function iv(r,e,t,n){return ln(this,void 0,void 0,function*(){return Or(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function Gd(r,e,t,n,s){return ln(this,void 0,void 0,function*(){return Or(r,"DELETE",e,n,s,t)})}var we=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const ov={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Xl={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class av{constructor(e,t={},n,s){this.url=e,this.headers=t,this.bucketId=n,this.fetch=Jd(s)}uploadOrUpdate(e,t,n,s){return we(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Xl),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),d=yield(e=="PUT"?So:Qe)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:a},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(ae(i))return{data:null,error:i};throw i}})}upload(e,t,n){return we(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return we(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:Xl.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield So(this.fetch,a.toString(),l,{headers:u});return{data:{path:i,fullPath:d.Key},error:null}}catch(l){if(ae(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return we(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield Qe(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new ya("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}})}update(e,t,n){return we(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return we(this,void 0,void 0,function*(){try{return{data:yield Qe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(ae(s))return{data:null,error:s};throw s}})}copy(e,t,n){return we(this,void 0,void 0,function*(){try{return{data:{path:(yield Qe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(ae(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return we(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Qe(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(ae(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return we(this,void 0,void 0,function*(){try{const s=yield Qe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(ae(s))return{data:null,error:s};throw s}})}download(e,t){return we(this,void 0,void 0,function*(){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield zs(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(ae(a))return{data:null,error:a};throw a}})}info(e){return we(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield zs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:xo(n),error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}})}exists(e){return we(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield iv(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(ae(n)&&n instanceof ko){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return we(this,void 0,void 0,function*(){try{return{data:yield Gd(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(ae(t))return{data:null,error:t};throw t}})}list(e,t,n){return we(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},ov),t),{prefix:e||""});return{data:yield Qe(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(ae(s))return{data:null,error:s};throw s}})}listV2(e,t){return we(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield Qe(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const lv="2.11.0",cv={"X-Client-Info":`storage-js/${lv}`};var yn=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class uv{constructor(e,t={},n,s){const i=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},cv),t),this.fetch=Jd(n)}listBuckets(){return yn(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(ae(e))return{data:null,error:e};throw e}})}getBucket(e){return yn(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(ae(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return yn(this,void 0,void 0,function*(){try{return{data:yield Qe(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return yn(this,void 0,void 0,function*(){try{return{data:yield So(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}})}emptyBucket(e){return yn(this,void 0,void 0,function*(){try{return{data:yield Qe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(ae(t))return{data:null,error:t};throw t}})}deleteBucket(e){return yn(this,void 0,void 0,function*(){try{return{data:yield Gd(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(ae(t))return{data:null,error:t};throw t}})}}class dv extends uv{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new av(this.url,this.headers,e,this.fetch)}}const hv="2.57.0";let Gn="";typeof Deno<"u"?Gn="deno":typeof document<"u"?Gn="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Gn="react-native":Gn="node";const fv={"X-Client-Info":`supabase-js-${Gn}/${hv}`},pv={headers:fv},mv={schema:"public"},gv={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},yv={};var bv=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};const vv=r=>{let e;return r?e=r:typeof fetch>"u"?e=Bd:e=fetch,(...t)=>e(...t)},wv=()=>typeof Headers>"u"?Fd:Headers,kv=(r,e,t)=>{const n=vv(t),s=wv();return(i,o)=>bv(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:r;let c=new s(o?.headers);return c.has("apikey")||c.set("apikey",r),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},o),{headers:c}))})};var xv=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};function Sv(r){return r.endsWith("/")?r:r+"/"}function Tv(r,e){var t,n;const{db:s,auth:i,realtime:o,global:a}=r,{db:l,auth:c,realtime:u,global:d}=e,h={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d?.headers)!==null&&t!==void 0?t:{}),(n=a?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>xv(this,void 0,void 0,function*(){return""})};return r.accessToken?h.accessToken=r.accessToken:delete h.accessToken,h}const Yd="2.71.1",_n=30*1e3,To=3,Li=To*_n,Cv="http://localhost:9999",_v="supabase.auth.token",Ev={"X-Client-Info":`gotrue-js/${Yd}`},Co="X-Supabase-Api-Version",Qd={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Ov=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Av=600*1e3;class ba extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function $(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Mv extends ba{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function Pv(r){return $(r)&&r.name==="AuthApiError"}class Xd extends ba{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class $t extends ba{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class yt extends $t{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Iv(r){return $(r)&&r.name==="AuthSessionMissingError"}class Ur extends $t{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Vr extends $t{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Hr extends $t{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Nv(r){return $(r)&&r.name==="AuthImplicitGrantRedirectError"}class Zl extends $t{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class _o extends $t{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ji(r){return $(r)&&r.name==="AuthRetryableFetchError"}class ec extends $t{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Eo extends $t{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Us="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),tc=` 	
\r=`.split(""),Rv=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<tc.length;e+=1)r[tc[e].charCodeAt(0)]=-2;for(let e=0;e<Us.length;e+=1)r[Us[e].charCodeAt(0)]=e;return r})();function nc(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Us[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Us[n]),e.queuedBits-=6}}function Zd(r,e,t){const n=Rv[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function rc(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Lv(o,n,t)};for(let o=0;o<r.length;o+=1)Zd(r.charCodeAt(o),s,i);return e.join("")}function Dv(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function $v(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}Dv(n,e)}}function Lv(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if((r>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function jv(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)Zd(r.charCodeAt(s),t,n);return new Uint8Array(e)}function Bv(r){const e=[];return $v(r,t=>e.push(t)),new Uint8Array(e)}function Fv(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>nc(s,t,n)),nc(null,t,n),e.join("")}function zv(r){return Math.round(Date.now()/1e3)+r}function Uv(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Be=()=>typeof window<"u"&&typeof document<"u",Bt={tested:!1,writable:!1},eh=()=>{if(!Be())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Bt.tested)return Bt.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Bt.tested=!0,Bt.writable=!0}catch{Bt.tested=!0,Bt.writable=!1}return Bt.writable};function Vv(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const th=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Sr(async()=>{const{default:n}=await Promise.resolve().then(()=>zn);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},Hv=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",En=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Ft=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},mt=async(r,e)=>{await r.removeItem(e)};class si{constructor(){this.promise=new si.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}si.promiseConstructor=Promise;function Bi(r){const e=r.split(".");if(e.length!==3)throw new Eo("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!Ov.test(e[n]))throw new Eo("JWT not in base64url format");return{header:JSON.parse(rc(e[0])),payload:JSON.parse(rc(e[1])),signature:jv(e[2]),raw:{header:e[0],payload:e[1]}}}async function Wv(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function qv(r,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await r(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function Kv(r){return("0"+r.toString(16)).substr(-2)}function Jv(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,Kv).join("")}async function Gv(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function Yv(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Gv(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function bn(r,e,t=!1){const n=Jv();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await En(r,`${e}-code-verifier`,s);const i=await Yv(n);return[i,n===i?"plain":"s256"]}const Qv=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Xv(r){const e=r.headers.get(Co);if(!e||!e.match(Qv))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Zv(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function ew(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const tw=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function vn(r){if(!tw.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Fi(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function sc(r){return JSON.parse(JSON.stringify(r))}var nw=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};const zt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),rw=[502,503,504];async function ic(r){var e;if(!Hv(r))throw new _o(zt(r),0);if(rw.includes(r.status))throw new _o(zt(r),r.status);let t;try{t=await r.json()}catch(i){throw new Xd(zt(i),i)}let n;const s=Xv(r);if(s&&s.getTime()>=Qd["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new ec(zt(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new yt}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new ec(zt(t),r.status,t.weak_password.reasons);throw new Mv(zt(t),r.status||500,n)}const sw=(r,e,t,n)=>{const s={method:r,headers:e?.headers||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function F(r,e,t,n){var s;const i=Object.assign({},n?.headers);i[Co]||(i[Co]=Qd["2024-01-01"].name),n?.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await iw(r,e,t+a,{headers:i,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function iw(r,e,t,n,s,i){const o=sw(e,n,s,i);let a;try{a=await r(t,Object.assign({},o))}catch(l){throw console.error(l),new _o(zt(l),0)}if(a.ok||await ic(a),n?.noResolveJson)return a;try{return await a.json()}catch(l){await ic(l)}}function it(r){var e;let t=null;cw(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=zv(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function oc(r){const e=it(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function St(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ow(r){return{data:r,error:null}}function aw(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i}=r,o=nw(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function lw(r){return r}function cw(r){return r.access_token&&r.refresh_token&&r.expires_in}const zi=["global","local","others"];var uw=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t};class dw{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=th(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=zi[0]){if(zi.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${zi.join(", ")}`);try{return await F(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if($(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await F(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:St})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=uw(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await F(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:aw,redirectTo:t?.redirectTo})}catch(t){if($(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await F(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:St})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await F(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:lw});if(u.error)throw u.error;const d=await u.json(),h=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(p.split(";")[1].split("=")[1]);c[`${g}Page`]=m}),c.total=parseInt(h)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if($(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){vn(e);try{return await F(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:St})}catch(t){if($(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){vn(e);try{return await F(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:St})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){vn(e);try{return await F(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:St})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){vn(e.userId);try{const{data:t,error:n}=await F(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if($(t))return{data:null,error:t};throw t}}async _deleteFactor(e){vn(e.userId),vn(e.id);try{return{data:await F(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}}function ac(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function hw(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const wn={debug:!!(globalThis&&eh()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class nh extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class fw extends nh{}async function pw(r,e,t){wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),wn.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw wn.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new fw(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(wn.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}hw();const mw={url:Cv,storageKey:_v,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ev,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function lc(r,e,t){return await t()}const kn={};class kr{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=kr.nextInstanceID,kr.nextInstanceID+=1,this.instanceID>0&&Be()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},mw),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new dw({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=th(s.fetch),this.lock=s.lock||lc,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Be()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=pw:this.lock=lc,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:eh()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ac(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=ac(this.memoryStorage)),Be()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=kn[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){kn[this.storageKey]=Object.assign(Object.assign({},kn[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=kn[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){kn[this.storageKey]=Object.assign(Object.assign({},kn[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Yd}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Vv(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),Be()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Nv(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return $(t)?{error:t}:{error:new Xd("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const i=await F(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:it}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,n,s;try{let i;if("email"in e){const{email:u,password:d,options:h}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await bn(this.storage,this.storageKey)),i=await F(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h?.emailRedirectTo,body:{email:u,password:d,data:(t=h?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:f,code_challenge_method:p},xform:it})}else if("phone"in e){const{phone:u,password:d,options:h}=e;i=await F(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=h?.data)!==null&&n!==void 0?n:{},channel:(s=h?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h?.captchaToken}},xform:it})}else throw new Vr("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:a}=e;t=await F(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:oc})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=await F(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:oc})}else throw new Vr("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Ur}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,i,o,a,l,c,u,d,h,f;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:g,wallet:y,statement:v,options:k}=e;let C;if(Be())if(typeof y=="object")C=y;else{const O=window;if("solana"in O&&typeof O.solana=="object"&&("signIn"in O.solana&&typeof O.solana.signIn=="function"||"signMessage"in O.solana&&typeof O.solana.signMessage=="function"))C=O.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!k?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=y}const E=new URL((t=k?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in C&&C.signIn){const O=await C.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},k?.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),v?{statement:v}:null));let L;if(Array.isArray(O)&&O[0]&&typeof O[0]=="object")L=O[0];else if(O&&typeof O=="object"&&"signedMessage"in O&&"signature"in O)L=O;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in L&&"signature"in L&&(typeof L.signedMessage=="string"||L.signedMessage instanceof Uint8Array)&&L.signature instanceof Uint8Array)p=typeof L.signedMessage=="string"?L.signedMessage:new TextDecoder().decode(L.signedMessage),m=L.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in C)||typeof C.signMessage!="function"||!("publicKey"in C)||typeof C!="object"||!C.publicKey||!("toBase58"in C.publicKey)||typeof C.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${E.host} wants you to sign in with your Solana account:`,C.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(s=(n=k?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=k?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${k.signInWithSolana.notBefore}`]:[],...!((o=k?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${k.signInWithSolana.expirationTime}`]:[],...!((a=k?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${k.signInWithSolana.chainId}`]:[],...!((l=k?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${k.signInWithSolana.nonce}`]:[],...!((c=k?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${k.signInWithSolana.requestId}`]:[],...!((d=(u=k?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...k.signInWithSolana.resources.map(L=>`- ${L}`)]:[]].join(`
`);const O=await C.signMessage(new TextEncoder().encode(p),"utf8");if(!O||!(O instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=O}}try{const{data:g,error:y}=await F(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Fv(m)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:it});if(y)throw y;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new Ur}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:y})}catch(g){if($(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await Ft(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:i,error:o}=await F(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:it});if(await mt(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Ur}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if($(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:i,nonce:o}=e,a=await F(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:it}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Ur}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await bn(this.storage,this.storageKey));const{error:d}=await F(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await F(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l?.data)!==null&&s!==void 0?s:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new Vr("You must provide either an email or phone number.")}catch(a){if($(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,n;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await F(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:it});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if($(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await bn(this.storage,this.storageKey)),await F(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:ow})}catch(i){if($(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new yt;const{error:s}=await F(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if($(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:o}=await F(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:o,error:a}=await F(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Vr("You must provide either an email or phone number and a type")}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ft(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Li:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await Ft(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=Fi()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await F(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:St}):await this._useSession(async t=>{var n,s,i;const{data:o,error:a}=t;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new yt}:await F(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:St})})}catch(t){if($(t))return Iv(t)&&(await this._removeSession(),await mt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new yt;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await bn(this.storage,this.storageKey));const{data:c,error:u}=await F(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:St});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new yt;const t=Date.now()/1e3;let n=t,s=!0,i=null;const{payload:o}=Bi(e.access_token);if(o.exp&&(n=o.exp,s=n<=t),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if($(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new yt;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if($(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Be())throw new Hr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Hr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Zl("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Hr("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Zl("No code detected.");const{data:v,error:k}=await this._exchangeCodeForSession(e.code);if(k)throw k;const C=new URL(window.location.href);return C.searchParams.delete("code"),window.history.replaceState(window.history.state,"",C.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new Hr("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let h=u+d;l&&(h=parseInt(l));const f=h-u;f*1e3<=_n&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${d}s`);const p=h-d;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,h,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,h,u);const{data:m,error:g}=await this._getUser(i);if(g)throw g;const y={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:h,refresh_token:o,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(n){if($(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ft(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{error:i};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Pv(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await mt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Uv(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await bn(this.storage,this.storageKey,!0));try{return await F(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if($(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if($(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async i=>{var o,a,l,c,u;const{data:d,error:h}=i;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await F(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return Be()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if($(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)throw o;return await F(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await qv(async s=>(s>0&&await Wv(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await F(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:it})),(s,i)=>{const o=200*Math.pow(2,s);return i&&ji(i)&&Date.now()+o-n<_n})}catch(n){if(this._debug(t,"error",n),$(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Be()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Ft(this.storage,this.storageKey);if(s&&this.userStorage){let o=await Ft(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await En(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o?.user)!==null&&e!==void 0?e:Fi()}else if(s&&!s.user&&!s.user){const o=await Ft(this.storage,this.storageKey+"-user");o&&o?.user?(s.user=o.user,await mt(this.storage,this.storageKey+"-user"),await En(this.storage,this.storageKey,s)):s.user=Fi()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Li;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${Li}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),ji(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&o?.user?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new yt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new si;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new yt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),$(i)){const o={session:null,error:i};return ji(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await En(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const i=sc(s);await En(this.storage,this.storageKey,i)}else{const s=sc(t);await En(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await mt(this.storage,this.storageKey),await mt(this.storage,this.storageKey+"-code-verifier"),await mt(this.storage,this.storageKey+"-user"),this.userStorage&&await mt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Be()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),_n);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/_n);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${_n}ms, refresh threshold is ${To} ticks`),s<=To&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof nh)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Be()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await bn(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n?.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await F(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await F(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l?.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if($(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:a}=await F(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?{data:null,error:i}:await F(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if($(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=e?.factors||[],s=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Bi(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(a=>a.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+Av>s)return n;const{data:i,error:o}=await F(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:f,error:p}=await this.getSession();if(p||!f.session)return{data:null,error:p};n=f.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=Bi(n);t?.allowExpired||Zv(i.exp);const c=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!c){const{error:f}=await this.getUser(n);if(f)throw f;return{data:{claims:i,header:s,signature:o},error:null}}const u=ew(s.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,o,Bv(`${a}.${l}`)))throw new Eo("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(n){if($(n))return{data:null,error:n};throw n}}}kr.nextInstanceID=0;const gw=kr;class yw extends gw{constructor(e){super(e)}}var bw=function(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(r,e||[])).next())})};class vw{constructor(e,t,n){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=Sv(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:mv,realtime:yv,auth:Object.assign(Object.assign({},gv),{storageKey:c}),global:pv},d=Tv(n??{},u);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=kv(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new Db(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new dv(this.storageUrl.href,this.headers,this.fetch,n?.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new Cb(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return bw(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:i,storageKey:o,flowType:a,lock:l,debug:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new yw({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),u),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:i,flowType:a,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Xb(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n?.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ww=(r,e,t)=>new vw(r,e,t);function kw(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}kw()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const xw="https://isprmebbahzjnrekkvxv.supabase.co",Sw="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlzcHJtZWJiYWh6am5yZWtrdnh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDgxMTcxOTQsImV4cCI6MjAyMzY5MzE5NH0.KQTIMSGTyNruxx1VQw8cY67ipbh1mABhjJ9tIhxClHE",Oo=ww(xw,Sw);async function Tw(r){const e=r.name.split(".").pop(),n=`todos/${`${Date.now()}-${Math.random().toString(36).slice(2)}.${e}`}`,{error:s}=await Oo.storage.from("taskit").upload(n,r,{cacheControl:"3600",upsert:!1,contentType:r.type});if(s)throw s;const{data:i}=Oo.storage.from("taskit").getPublicUrl(n);return i.publicUrl}function Cw(r){try{const e="/storage/v1/object/public/taskit/",t=r.indexOf(e);return t===-1?null:r.substring(t+e.length)}catch{return null}}async function _w(r){const e=Cw(r);e&&await Oo.storage.from("taskit").remove([e])}async function Ew(r){if(!r)return;const t=(r.match(/<img[^>]*src=["']([^"']+)["'][^>]*>/gi)||[]).map(n=>{const s=n.match(/src=["']([^"']+)["']/i);return s?s[1]:null}).filter(Boolean);t.length!==0&&await Promise.all(t.map(n=>_w(n)))}const Ow={class:"flex gap-2 p-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"},Aw=qe({__name:"TipTapEditor",props:{modelValue:{}},emits:["update:modelValue"],setup(r,{emit:e}){const t=r,n=e,s=V(null),i=new By({extensions:[bb,kb],content:t.modelValue||"",onUpdate:({editor:d})=>n("update:modelValue",d.getHTML())});Qr(()=>t.modelValue,d=>{d!==i.getHTML()&&i.commands.setContent(d||"",!1)}),uc(()=>i.destroy());function o(d){const h={bold:"toggleBold",italic:"toggleItalic",underline:"toggleUnderline"};i.chain().focus()[h[d]]().run()}function a(){i.chain().focus().toggleBulletList().run()}function l(){s.value?.click()}async function c(d){const f=d.target.files?.[0];if(f)try{const p=await Tw(f);i.chain().focus().setImage({src:p}).run()}catch(p){console.error("Image upload failed",p)}finally{s.value&&(s.value.value="")}}function u(){i&&!i.isFocused&&i.chain().focus().run()}return(d,h)=>(A(),P("div",{class:"border border-gray-300 dark:border-gray-600 rounded-md",onClick:u,style:{cursor:"text"}},[b("div",Ow,[b("button",{type:"button",class:"px-2 py-1 text-sm",onClick:h[0]||(h[0]=Ae(f=>o("bold"),["prevent"]))},h[3]||(h[3]=[b("strong",null,"B",-1)])),b("button",{type:"button",class:"px-2 py-1 text-sm italic",onClick:h[1]||(h[1]=Ae(f=>o("italic"),["prevent"]))},"I"),b("button",{type:"button",class:"px-2 py-1 text-sm underline",onClick:h[2]||(h[2]=Ae(f=>o("underline"),["prevent"]))},"U"),b("button",{type:"button",class:"px-2 py-1 text-sm",onClick:Ae(a,["prevent"])}," List"),b("button",{type:"button",class:"px-2 py-1 text-sm",onClick:Ae(l,["prevent"])},"Image"),b("input",{ref_key:"fileInput",ref:s,type:"file",accept:"image/*",class:"hidden",onChange:c},null,544)]),U(Jt(Fy),{editor:Jt(i),class:"editor bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 w-full"},null,8,["editor"])]))}}),Mw=Ao(Aw,[["__scopeId","data-v-56cd60c6"]]),Pw={class:"relative"},Iw={class:"flex items-center gap-2"},Nw={key:0,class:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg"},Rw={class:"py-1"},Dw=["onClick"],$w=qe({__name:"TypeSelector",props:{modelValue:{}},emits:["update:modelValue"],setup(r,{emit:e}){const t=r,n=e,s=V(!1),i=[{value:"Bug",label:"Bug",icon:"Bug"},{value:"Feature",label:"Feature",icon:"Zap"},{value:"Task",label:"Task",icon:"CheckSquare"},{value:"Story",label:"Story",icon:"BookOpen"},{value:"Epic",label:"Epic",icon:"Layers"}],o=Et(()=>t.modelValue),a=d=>({Bug:"Bug",Feature:"Zap",Task:"CheckSquare",Story:"BookOpen",Epic:"Layers"})[d]||"Circle",l=()=>{s.value=!s.value},c=d=>{n("update:modelValue",d),s.value=!1},u=d=>{d.target.closest(".relative")||(s.value=!1)};return Bn(()=>{document.addEventListener("click",u)}),Mo(()=>{document.removeEventListener("click",u)}),(d,h)=>(A(),P("div",Pw,[b("button",{type:"button",onClick:l,class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-left flex items-center justify-between"},[b("div",Iw,[o.value?(A(),xr(G,{key:0,name:a(o.value),class:"w-4 h-4"},null,8,["name"])):X("",!0),b("span",null,z(o.value||"Select type"),1)]),U(G,{name:"ChevronDown",class:"w-4 h-4 text-gray-400"})]),s.value?(A(),P("div",Nw,[b("div",Rw,[b("button",{type:"button",onClick:h[0]||(h[0]=f=>c("")),class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center gap-2"},h[1]||(h[1]=[b("span",{class:"text-gray-400"},"Select type",-1)])),(A(),P(Xe,null,dt(i,f=>b("button",{key:f.value,type:"button",onClick:p=>c(f.value),class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center gap-2"},[U(G,{name:f.icon,class:"w-4 h-4"},null,8,["name"]),b("span",null,z(f.label),1)],8,Dw)),64))])])):X("",!0)]))}}),Lw={class:"mt-6"},jw=["disabled"],Bw={key:0,class:"text-sm text-gray-500"},Fw={key:1},zw={key:0,class:"text-sm text-gray-500"},Uw={class:"space-y-3"},Vw={class:"flex items-start justify-between gap-3"},Hw={class:"flex-1"},Ww={class:"mb-1 text-xs text-gray-600 dark:text-gray-400"},qw={class:"font-medium text-gray-800 dark:text-gray-200"},Kw={key:0,class:"flex gap-2"},Jw=["onClick"],Gw={key:1,class:"text-sm text-gray-800 dark:text-gray-100 whitespace-pre-line"},Yw={class:"flex gap-2"},Qw=["onClick"],Xw=["onClick"],Zw=qe({__name:"TodoComments",props:{todoId:{}},setup(r){const e=r,n=dc().props?.auth?.user||null,s=V(!1),i=V(!1),o=V(""),a=V([]),l=V(null),c=V(""),u=async()=>{try{s.value=!0,a.value=await ke.getComments(e.todoId)}catch(y){console.error("Failed to load comments",y)}finally{s.value=!1}},d=async()=>{if(o.value.trim())try{i.value=!0;const y=await ke.addComment(e.todoId,o.value.trim());!y.user&&n&&(y.user={id:n.id,name:n.name,email:n.email}),a.value.push(y),o.value="",window.$notify?.({type:"success",title:"Comment Added",message:"Your comment was added."})}catch(y){console.error("Failed to add comment",y),window.$notify?.({type:"error",title:"Add Failed",message:"Could not add comment."})}finally{i.value=!1}},h=y=>{l.value=y.id,c.value=y.content},f=()=>{l.value=null,c.value=""},p=async y=>{if(c.value.trim())try{const v=await ke.updateComment(e.todoId,y.id,c.value.trim()),k=a.value.findIndex(C=>String(C.id)===String(y.id));k!==-1&&(a.value[k]=v,a.value=[...a.value]),l.value=null,c.value="",window.$notify?.({type:"success",title:"Comment Updated",message:"Your comment was updated."})}catch(v){console.error("Failed to update comment",v),window.$notify?.({type:"error",title:"Update Failed",message:"Could not update comment."})}},m=async y=>{if(confirm("Delete this comment?"))try{await ke.deleteComment(e.todoId,y.id),a.value=a.value.filter(v=>String(v.id)!==String(y.id)),window.$notify?.({type:"success",title:"Comment Deleted",message:"Your comment was deleted."})}catch(v){console.error("Failed to delete comment",v),window.$notify?.({type:"error",title:"Delete Failed",message:"Could not delete comment."})}},g=y=>{try{return new Date(y).toLocaleString()}catch{return y}};return Bn(u),(y,v)=>(A(),P("div",Lw,[v[3]||(v[3]=b("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3"},"Comments",-1)),b("form",{onSubmit:Ae(d,["prevent"]),class:"flex gap-2 mb-4"},[ye(b("input",{"onUpdate:modelValue":v[0]||(v[0]=k=>o.value=k),type:"text",placeholder:"Write a comment...",class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},null,512),[[ze,o.value]]),b("button",{type:"submit",disabled:i.value||!o.value.trim(),class:"px-3 py-2 bg-blue-600 text-white rounded-md disabled:opacity-50 disabled:cursor-not-allowed"},z(i.value?"Adding...":"Add"),9,jw)],32),s.value?(A(),P("div",Bw,"Loading comments...")):(A(),P("div",Fw,[a.value.length===0?(A(),P("div",zw,"No comments yet.")):X("",!0),b("ul",Uw,[(A(!0),P(Xe,null,dt(a.value,k=>(A(),P("li",{key:k.id,class:"p-3 rounded-md border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800"},[b("div",Vw,[b("div",Hw,[b("div",Ww,[b("span",qw,z(k.user?.name||"User"),1),v[2]||(v[2]=b("span",{class:"mx-1"},"",-1)),b("span",null,z(g(k.created_at)),1)]),l.value===k.id?(A(),P("div",Kw,[ye(b("input",{"onUpdate:modelValue":v[1]||(v[1]=C=>c.value=C),type:"text",class:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},null,512),[[ze,c.value]]),b("button",{onClick:C=>p(k),class:"px-3 py-2 bg-green-600 text-white rounded-md"},"Save",8,Jw),b("button",{onClick:f,class:"px-3 py-2 bg-gray-300 text-gray-800 rounded-md"},"Cancel")])):(A(),P("div",Gw,z(k.content),1))]),b("div",Yw,[l.value!==k.id?(A(),P("button",{key:0,onClick:C=>h(k),class:"text-gray-500 hover:text-blue-600 text-sm"},"Edit",8,Qw)):X("",!0),b("button",{onClick:C=>m(k),class:"text-gray-500 hover:text-red-600 text-sm"},"Delete",8,Xw)])])]))),128))])]))]))}}),ek={class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},tk={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},nk={class:"p-6"},rk={class:"flex items-center justify-between mb-6"},sk={class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},ik={key:0},ok={class:"px-3 py-2 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-gray-900 dark:text-gray-100"},ak={class:"grid grid-cols-2 gap-4"},lk={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ck=["value"],uk=["value"],dk=["onKeydown"],hk={key:1,class:"flex flex-wrap gap-2"},fk=["onClick"],pk={class:"flex justify-end gap-3 pt-4"},mk={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"},gk=qe({__name:"TodoForm",props:{todo:{},isEditing:{type:Boolean,default:!1},currentProject:{}},emits:["close","save"],setup(r,{emit:e}){const t=r,n=e,i=dc().props?.auth?.user||null,o=i?.name||"",a=V([]),l=async()=>{i?a.value=[{id:i.id,name:i.name,email:i.email}]:a.value=[]},c=V({id:"",title:"",description:"",priority:"Medium",type:"",tags:[],assignee:"",due_date:"",story_points:void 0,status:"todo"}),u=V(""),d=()=>{c.value={id:"",title:"",description:"",priority:"Medium",type:"",tags:[],assignee:"",due_date:"",story_points:void 0,status:"todo"},u.value=""};Bn(()=>{l()}),Qr(()=>t.todo,m=>{m?c.value={...m}:(d(),o&&(c.value.assignee=o))},{immediate:!0});const h=()=>{const m=u.value.trim();m&&!c.value.tags?.includes(m)&&(c.value.tags||(c.value.tags=[]),c.value.tags.push(m),u.value="")},f=m=>{c.value.tags&&(c.value.tags=c.value.tags.filter(g=>g!==m))},p=async()=>{try{if(!t.currentProject){console.error("No current project selected");return}const m={...c.value,project_id:t.currentProject.id,due_date:c.value.due_date||null,story_points:c.value.story_points||null};t.isEditing&&(m.id=parseInt(c.value.id)),n("save",m),d()}catch(m){console.error("Failed to submit todo:",m)}};return(m,g)=>(A(),P("div",ek,[b("div",tk,[b("div",nk,[b("div",rk,[b("h2",sk,z(m.isEditing?"Edit Todo":"Add New Todo"),1),b("button",{onClick:g[0]||(g[0]=y=>m.$emit("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[U(G,{name:"X",class:"w-6 h-6"})])]),b("form",{onSubmit:Ae(p,["prevent"]),class:"space-y-4"},[b("div",null,[g[9]||(g[9]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Title * ",-1)),ye(b("input",{"onUpdate:modelValue":g[1]||(g[1]=y=>c.value.title=y),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter todo title"},null,512),[[ze,c.value.title]])]),b("div",null,[g[10]||(g[10]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Description ",-1)),U(Mw,{modelValue:c.value.description,"onUpdate:modelValue":g[2]||(g[2]=y=>c.value.description=y)},null,8,["modelValue"])]),m.currentProject?(A(),P("div",ik,[g[11]||(g[11]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Project ",-1)),b("div",ok,z(m.currentProject.key)+" - "+z(m.currentProject.name),1)])):X("",!0),b("div",ak,[b("div",null,[g[13]||(g[13]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Priority * ",-1)),ye(b("select",{"onUpdate:modelValue":g[3]||(g[3]=y=>c.value.priority=y),required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},g[12]||(g[12]=[b("option",{value:"Low"},"Low",-1),b("option",{value:"Medium"},"Medium",-1),b("option",{value:"High"},"High",-1),b("option",{value:"Critical"},"Critical",-1)]),512),[[Yn,c.value.priority]])]),b("div",null,[g[14]||(g[14]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Type ",-1)),U($w,{modelValue:c.value.type,"onUpdate:modelValue":g[4]||(g[4]=y=>c.value.type=y)},null,8,["modelValue"])])]),b("div",lk,[b("div",null,[g[15]||(g[15]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Assignee ",-1)),ye(b("select",{"onUpdate:modelValue":g[5]||(g[5]=y=>c.value.assignee=y),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},[Jt(o)?(A(),P("option",{key:0,value:Jt(o)},z(Jt(o))+" (You)",9,ck)):X("",!0),(A(!0),P(Xe,null,dt(a.value,y=>(A(),P("option",{key:y.id,value:y.name},z(y.name),9,uk))),128))],512),[[Yn,c.value.assignee]])]),b("div",null,[g[16]||(g[16]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Due Date ",-1)),ye(b("input",{"onUpdate:modelValue":g[6]||(g[6]=y=>c.value.due_date=y),type:"date",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white"},null,512),[[ze,c.value.due_date]])]),b("div",null,[g[17]||(g[17]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Tags ",-1)),ye(b("input",{"onUpdate:modelValue":g[7]||(g[7]=y=>u.value=y),type:"text",onKeydown:gh(Ae(h,["prevent"]),["enter"]),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Type and press Enter to add tags"},null,40,dk),[[ze,u.value]])])]),c.value.tags&&c.value.tags.length>0?(A(),P("div",hk,[(A(!0),P(Xe,null,dt(c.value.tags,y=>(A(),P("span",{key:y,class:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},[Yr(z(y)+" ",1),b("button",{type:"button",onClick:v=>f(y),class:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200"},[U(G,{name:"X",class:"w-3 h-3"})],8,fk)]))),128))])):X("",!0),b("div",pk,[b("button",{type:"button",onClick:g[8]||(g[8]=y=>m.$emit("close")),class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"}," Cancel "),b("button",mk,z(m.isEditing?"Update":"Create"),1)])],32),m.isEditing&&c.value.id?(A(),xr(Zw,{key:0,"todo-id":Number(c.value.id)},null,8,["todo-id"])):X("",!0)])])]))}}),yk={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},bk={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},vk={class:"flex items-center"},wk={class:"flex-shrink-0"},kk={class:"w-8 h-8 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center"},xk={class:"ml-4"},Sk={class:"text-2xl font-semibold text-gray-900 dark:text-gray-100"},Tk={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},Ck={class:"flex items-center"},_k={class:"flex-shrink-0"},Ek={class:"w-8 h-8 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center"},Ok={class:"ml-4"},Ak={class:"text-2xl font-semibold text-gray-900 dark:text-gray-100"},Mk={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},Pk={class:"flex items-center"},Ik={class:"flex-shrink-0"},Nk={class:"w-8 h-8 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center"},Rk={class:"ml-4"},Dk={class:"text-2xl font-semibold text-gray-900 dark:text-gray-100"},$k={class:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4"},Lk={class:"flex items-center"},jk={class:"flex-shrink-0"},Bk={class:"w-8 h-8 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center"},Fk={class:"ml-4"},zk={class:"text-2xl font-semibold text-gray-900 dark:text-gray-100"},Uk=qe({__name:"TodoStats",props:{todos:{}},setup(r){const e=r,t=Et(()=>{const n=new Date,s=new Date(n.getFullYear(),n.getMonth(),n.getDate()),i=e.todos.filter(a=>a.due_date?new Date(a.due_date)<s&&a.status!=="done":!1).length,o=e.todos.filter(a=>a.due_date?new Date(a.due_date).getTime()===s.getTime():!1).length;return{total:e.todos.length,todo:e.todos.filter(a=>a.status==="todo").length,inProgress:e.todos.filter(a=>a.status==="in-progress").length,done:e.todos.filter(a=>a.status==="done").length,overdue:i,dueToday:o}});return(n,s)=>(A(),P("div",yk,[b("div",bk,[b("div",vk,[b("div",wk,[b("div",kk,[U(G,{name:"List",class:"w-5 h-5 text-blue-600 dark:text-blue-400"})])]),b("div",xk,[s[0]||(s[0]=b("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Total Todos",-1)),b("p",Sk,z(t.value.total),1)])])]),b("div",Tk,[b("div",Ck,[b("div",_k,[b("div",Ek,[U(G,{name:"Clock",class:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})])]),b("div",Ok,[s[1]||(s[1]=b("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"In Progress",-1)),b("p",Ak,z(t.value.inProgress),1)])])]),b("div",Mk,[b("div",Pk,[b("div",Ik,[b("div",Nk,[U(G,{name:"CheckCircle",class:"w-5 h-5 text-green-600 dark:text-green-400"})])]),b("div",Rk,[s[2]||(s[2]=b("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Completed",-1)),b("p",Dk,z(t.value.done),1)])])]),b("div",$k,[b("div",Lk,[b("div",jk,[b("div",Bk,[U(G,{name:"AlertTriangle",class:"w-5 h-5 text-red-600 dark:text-red-400"})])]),b("div",Fk,[s[3]||(s[3]=b("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Overdue",-1)),b("p",zk,z(t.value.overdue),1)])])])]))}}),Vk={class:"relative"},Hk={class:"flex items-center gap-2"},Wk={key:0,class:"absolute z-10 w-full mt-1 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg"},qk={class:"py-1"},Kk=["onClick"],Jk=qe({__name:"TypeFilter",props:{modelValue:{}},emits:["update:modelValue"],setup(r,{emit:e}){const t=r,n=e,s=V(!1),i=[{value:"Bug",label:"Bug",icon:"Bug"},{value:"Feature",label:"Feature",icon:"Zap"},{value:"Task",label:"Task",icon:"CheckSquare"},{value:"Story",label:"Story",icon:"BookOpen"},{value:"Epic",label:"Epic",icon:"Layers"}],o=Et(()=>t.modelValue),a=d=>({Bug:"Bug",Feature:"Zap",Task:"CheckSquare",Story:"BookOpen",Epic:"Layers"})[d]||"Circle",l=()=>{s.value=!s.value},c=d=>{n("update:modelValue",d),s.value=!1},u=d=>{d.target.closest(".relative")||(s.value=!1)};return Bn(()=>{document.addEventListener("click",u)}),Mo(()=>{document.removeEventListener("click",u)}),(d,h)=>(A(),P("div",Vk,[b("button",{type:"button",onClick:l,class:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-left flex items-center justify-between min-w-[120px]"},[b("div",Hk,[o.value?(A(),xr(G,{key:0,name:a(o.value),class:"w-4 h-4"},null,8,["name"])):X("",!0),b("span",null,z(o.value||"All Types"),1)]),U(G,{name:"ChevronDown",class:"w-4 h-4 text-gray-400"})]),s.value?(A(),P("div",Wk,[b("div",qk,[b("button",{type:"button",onClick:h[0]||(h[0]=f=>c("")),class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center gap-2"},h[1]||(h[1]=[b("span",{class:"text-gray-500 dark:text-gray-400"},"All Types",-1)])),(A(),P(Xe,null,dt(i,f=>b("button",{key:f.value,type:"button",onClick:p=>c(f.value),class:"w-full px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center gap-2"},[U(G,{name:f.icon,class:"w-4 h-4"},null,8,["name"]),b("span",null,z(f.label),1)],8,Kk)),64))])])):X("",!0)]))}}),Gk={class:"h-full flex flex-col"},Yk={class:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"},Qk={class:"flex-1"},Xk={class:"flex items-center gap-3 mb-2"},Zk={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},ex={class:"text-gray-600 dark:text-gray-400"},tx={key:0,class:"mt-4"},nx={class:"flex items-center gap-3"},rx={class:"relative flex items-center gap-2"},sx={key:1,class:"w-4 h-4 rounded-full flex-shrink-0 bg-gray-300"},ix=["value"],ox=["disabled"],ax={class:"mt-4 flex flex-col lg:flex-row gap-4"},lx={class:"flex-1 relative"},cx={class:"flex gap-2"},ux=["value"],dx={class:"flex-1 flex gap-6 overflow-x-auto pb-4"},hx={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},fx={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full"},px={class:"p-6"},mx={class:"flex items-center justify-between mb-6"},gx={class:"flex items-center gap-3"},yx={class:"text-sm text-gray-600 dark:text-gray-400"},bx={class:"flex gap-3 pt-4"},vx={key:2,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"},wx={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full"},kx={class:"p-6"},xx={class:"flex items-center justify-between mb-6"},Sx={class:"flex gap-3 pt-4"},Tx=qe({__name:"TodoBoard",setup(r){const e=V([]),t=V([]),n=V(!1),s=V(!1),i=V(!1),o=V(null),a=V(""),l=V(null),c=V(""),u=V(""),d=V(""),h=V(""),f=V(""),p=V({name:"",description:"",key:"",color:"#3B82F6"}),m=V(!1),g=Et(()=>{let T=e.value.filter(w=>{const R=!u.value||w.title.toLowerCase().includes(u.value.toLowerCase())||w.description?.toLowerCase().includes(u.value.toLowerCase())||w.tags?.some(sh=>sh.toLowerCase().includes(u.value.toLowerCase())),je=!d.value||w.priority===d.value,ii=!h.value||w.type===h.value,rh=!f.value||w.assignee===f.value;return R&&je&&ii&&rh});return{todo:T.filter(w=>w.status==="todo"),inProgress:T.filter(w=>w.status==="in-progress"),done:T.filter(w=>w.status==="done")}}),y=Et(()=>{const T=e.value.map(w=>w.assignee).filter(Boolean);return[...new Set(T)]}),v=Et(()=>t.value||[]),k=T=>{l.value={...T},n.value=!0},C=async T=>{try{if(!o.value){window.$notify&&window.$notify({type:"error",title:"Project Required",message:"Please select a project first before creating a todo."});return}if(l.value){const w=await ke.updateTodo(T.id,T),R=e.value.findIndex(je=>je.id===T.id);R!==-1&&(e.value[R]=w),l.value=null,window.$notify&&window.$notify({type:"success",title:"Todo Updated",message:`Todo "${w.title}" has been updated successfully.`})}else{const w=await ke.createTodo({...T,project_id:o.value.id});e.value.push(w),window.$notify&&window.$notify({type:"success",title:"Todo Created",message:`Todo "${w.title}" has been created successfully.`})}n.value=!1,window.dispatchEvent(new CustomEvent("projectCreated")),window.dispatchEvent(new CustomEvent("todoChanged"))}catch(w){console.error("Failed to save todo:",w),window.$notify&&window.$notify({type:"error",title:"Save Failed",message:"Failed to save todo. Please try again."})}},E=async T=>{const w=e.value.find(R=>R.id===T);if(w&&confirm(`Are you sure you want to delete "${w.title}"?

This action cannot be undone.`))try{const R=e.value.find(je=>je.id===T);await ke.deleteTodo(T),R?.description&&Ew(R.description).catch(()=>{}),e.value=e.value.filter(je=>je.id!==T),window.dispatchEvent(new CustomEvent("todoChanged")),window.$notify&&window.$notify({type:"success",title:"Todo Deleted",message:`Todo "${w.title}" has been deleted successfully.`})}catch(R){console.error("Failed to delete todo:",R),window.$notify&&window.$notify({type:"error",title:"Delete Failed",message:"Failed to delete todo. Please try again."})}},O=async(T,w)=>{if(console.log("TodoBoard received drop event:",T.title,"->",w),!o.value){window.$notify&&window.$notify({type:"error",title:"Project Required",message:"Please select a project before moving todos."});return}if(T.project_id!==o.value.id){window.$notify&&window.$notify({type:"error",title:"Invalid Move",message:`Cannot move todo "${T.title}" - it belongs to a different project.`});return}try{const R=await ke.updateTodoStatus(T.id,w);console.log("API response:",R);const je=e.value.findIndex(ii=>String(ii.id)===String(T.id));console.log("Looking for todo with ID:",T.id,"Found at index:",je),je!==-1?(e.value[je]=R,console.log("Todo updated in local state:",R),e.value=[...e.value],window.dispatchEvent(new CustomEvent("todoChanged")),window.$notify&&window.$notify({type:"success",title:"Status Updated",message:`Todo "${R.title}" moved to ${w.replace("-"," ")}.`})):(console.error("Todo not found in local state for ID:",T.id),await Ie())}catch(R){console.error("Failed to update todo status:",R),window.$notify&&window.$notify({type:"error",title:"Update Failed",message:"Failed to update todo status. Please try again."})}},L=()=>{n.value=!1,l.value=null},M=()=>{if(!o.value){window.$notify&&window.$notify({type:"warning",title:"Project Required",message:"Please select a project first before creating a todo."});return}n.value=!0},H=()=>{o.value&&(c.value=o.value.name,i.value=!0)},Y=async()=>{if(!(!o.value||!c.value.trim()))try{const T=await ke.updateProject(o.value.id,{name:c.value.trim()});o.value={...o.value,...T},window.$notify&&window.$notify({type:"success",title:"Project Updated",message:`Project "${T.name}" has been updated successfully.`}),i.value=!1,c.value="",window.dispatchEvent(new CustomEvent("todoChanged")),console.log("Project updated successfully:",T.name)}catch(T){console.error("Failed to update project:",T),window.$notify&&window.$notify({type:"error",title:"Update Failed",message:"Failed to update project. Please try again."})}},Ke=()=>{p.value={name:"",description:"",key:"",color:"#3B82F6"}},Lt=async()=>{try{const T={name:p.value.name,description:p.value.description||void 0,key:p.value.key||void 0,color:p.value.color},w=await ke.createProject(T);o.value=w,localStorage.setItem("currentProjectId",w.id.toString()),s.value=!1,Ke(),await Ie(),window.dispatchEvent(new CustomEvent("projectCreated")),window.dispatchEvent(new CustomEvent("todoChanged")),window.$notify&&window.$notify({type:"success",title:"Project Created",message:`Project "${w.name}" has been created successfully.`}),console.log("Project created successfully:",w.name)}catch(T){console.error("Failed to create project:",T),window.$notify&&window.$notify({type:"error",title:"Creation Failed",message:"Failed to create project. Please try again."})}},cn=async()=>{try{console.log("Loading projects...");try{const T=await ke.getProjectsWithStats();if(console.log("Projects with stats response:",T),T&&Array.isArray(T))t.value=T,console.log("Projects loaded with stats:",t.value.length,"projects");else if(T&&T.data&&Array.isArray(T.data))t.value=T.data,console.log("Projects loaded with stats:",t.value.length,"projects");else throw console.error("Unexpected response structure from getProjectsWithStats:",T),new Error("Invalid response structure")}catch(T){console.log("Failed to load projects with stats, trying regular getProjects:",T);const w=await ke.getProjects();console.log("Regular projects response:",w),w&&Array.isArray(w)?(t.value=w,console.log("Projects loaded with regular method:",t.value.length,"projects")):w&&w.data&&Array.isArray(w.data)?(t.value=w.data,console.log("Projects loaded with regular method:",t.value.length,"projects")):(console.error("Unexpected response structure from getProjects:",w),t.value=[])}o.value&&(a.value=o.value.id.toString(),console.log("Set selected project ID to:",a.value))}catch(T){console.error("Failed to load projects completely:",T),t.value=[]}},Un=async()=>{if(console.log("Project selection changed to:",a.value),!a.value){console.log("No project selected, clearing current project"),o.value=null,localStorage.removeItem("currentProjectId"),e.value=[];return}if(m.value){console.log("Skipping project change - already updating");return}try{m.value=!0;const T=parseInt(a.value);console.log("Loading project with ID:",T);const w=await ke.getProject(T);console.log("Project loaded:",w),o.value=w,localStorage.setItem("currentProjectId",T.toString()),window.dispatchEvent(new CustomEvent("projectSelected",{detail:{projectId:T}})),await Ie(),window.$notify&&window.$notify({type:"success",title:"Project Selected",message:`Switched to project "${w.name}".`})}catch(T){console.error("Failed to load project:",T),window.$notify&&window.$notify({type:"error",title:"Project Load Failed",message:"Failed to load the selected project. Please try again."})}finally{m.value=!1}},ft=async()=>{try{const T=localStorage.getItem("currentProjectId");if(T){const w=await ke.getProject(parseInt(T));o.value=w,a.value=T}}catch(T){console.error("Failed to load current project:",T),localStorage.removeItem("currentProjectId")}},Ie=async()=>{try{const T={};o.value&&(T.project_id=o.value.id);const w=await ke.getTodos(T);e.value=w.data.todo.concat(w.data["in-progress"]).concat(w.data.done)}catch(T){console.error("Failed to load todos:",T)}};return Qr(o,async T=>{T&&(a.value=T.id.toString()),await Ie()}),Qr(s,T=>{T&&Ke()}),Bn(async()=>{await cn(),await ft(),await Ie();const T=w=>{w.key==="currentProjectId"&&ft()};window.addEventListener("storage",T),window.addEventListener("projectSelected",async w=>{if(w.detail?.projectId&&!m.value){m.value=!0;try{localStorage.setItem("currentProjectId",w.detail.projectId.toString()),await ft()}finally{m.value=!1}}}),window.addEventListener("openCreateProjectModal",()=>{s.value=!0,Ke()})}),(T,w)=>(A(),P("div",Gk,[b("div",{class:"mb-6 p-4 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 relative",style:oi(o.value?{borderTop:`4px solid ${o.value.color}`,backgroundColor:`${o.value.color}10`}:{})},[b("div",Yk,[b("div",Qk,[b("div",Xk,[b("h1",Zk,z(o.value?o.value.name:"Todo Board"),1),o.value?(A(),P("button",{key:0,onClick:H,class:"p-1 text-gray-400 hover:text-blue-500 transition-colors",title:"Edit project name"},[U(G,{name:"Edit3",class:"w-5 h-5"})])):X("",!0)]),b("p",ex,z(o.value?`Project: ${o.value.key} - ${o.value.description||"No description"}`:"Select a project to manage todos"),1),o.value?X("",!0):(A(),P("div",tx,[b("button",{onClick:w[0]||(w[0]=R=>s.value=!0),class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"},[U(G,{name:"Plus",class:"w-4 h-4"}),w[15]||(w[15]=Yr(" Create Project ",-1))])]))]),b("div",nx,[b("div",rx,[o.value?(A(),P("div",{key:0,class:"w-4 h-4 rounded-full flex-shrink-0",style:oi({backgroundColor:o.value.color})},null,4)):(A(),P("div",sx)),ye(b("select",{"onUpdate:modelValue":w[1]||(w[1]=R=>a.value=R),onChange:Un,class:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-w-[200px] cursor-pointer",style:oi(o.value?{borderLeftColor:o.value.color,borderLeftWidth:"4px"}:{})},[(A(!0),P(Xe,null,dt(v.value,R=>(A(),P("option",{key:R.id,value:R.id},z(R.name)+" ("+z(R.key)+") ",9,ix))),128))],36),[[Yn,a.value]])]),b("button",{onClick:M,disabled:!o.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:ring-offset-2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[U(G,{name:"Plus",class:"w-4 h-4"}),w[16]||(w[16]=Yr(" Add Todo ",-1))],8,ox)])]),b("div",ax,[b("div",lx,[U(G,{name:"Search",class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),ye(b("input",{"onUpdate:modelValue":w[2]||(w[2]=R=>u.value=R),type:"text",placeholder:"Search todos...",class:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"},null,512),[[ze,u.value]])]),b("div",cx,[ye(b("select",{"onUpdate:modelValue":w[3]||(w[3]=R=>d.value=R),class:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"},w[17]||(w[17]=[yh('<option value="">All Priorities</option><option value="Low">Low</option><option value="Medium">Medium</option><option value="High">High</option><option value="Critical">Critical</option>',5)]),512),[[Yn,d.value]]),U(Jk,{modelValue:h.value,"onUpdate:modelValue":w[4]||(w[4]=R=>h.value=R)},null,8,["modelValue"]),ye(b("select",{"onUpdate:modelValue":w[5]||(w[5]=R=>f.value=R),class:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white text-gray-900"},[w[18]||(w[18]=b("option",{value:""},"All Assignees",-1)),(A(!0),P(Xe,null,dt(y.value,R=>(A(),P("option",{key:R,value:R},z(R),9,ux))),128))],512),[[Yn,f.value]])])])],4),U(Uk,{todos:e.value},null,8,["todos"]),b("div",dx,[U(ai,{title:"To Do",status:"todo",todos:g.value.todo,"show-add-button":!0,"current-project-id":o.value?.id||null,onAdd:M,onEdit:k,onDelete:E,onDrop:O,onMenu:()=>{}},null,8,["todos","current-project-id"]),U(ai,{title:"In Progress",status:"in-progress",todos:g.value.inProgress,"current-project-id":o.value?.id||null,onEdit:k,onDelete:E,onDrop:O,onMenu:()=>{}},null,8,["todos","current-project-id"]),U(ai,{title:"Done",status:"done",todos:g.value.done,"current-project-id":o.value?.id||null,onEdit:k,onDelete:E,onDrop:O,onMenu:()=>{}},null,8,["todos","current-project-id"])]),n.value?(A(),xr(gk,{key:0,todo:l.value,"is-editing":!!l.value,"current-project":o.value,onClose:L,onSave:C},null,8,["todo","is-editing","current-project"])):X("",!0),s.value?(A(),P("div",hx,[b("div",fx,[b("div",px,[b("div",mx,[w[19]||(w[19]=b("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Create New Project",-1)),b("button",{onClick:w[6]||(w[6]=R=>s.value=!1),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[U(G,{name:"X",class:"w-6 h-6"})])]),b("form",{onSubmit:Ae(Lt,["prevent"]),class:"space-y-4"},[b("div",null,[w[20]||(w[20]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Project Name * ",-1)),ye(b("input",{"onUpdate:modelValue":w[7]||(w[7]=R=>p.value.name=R),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter project name"},null,512),[[ze,p.value.name]])]),b("div",null,[w[21]||(w[21]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Description (Optional) ",-1)),ye(b("textarea",{"onUpdate:modelValue":w[8]||(w[8]=R=>p.value.description=R),rows:"3",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter project description"},null,512),[[ze,p.value.description]])]),b("div",null,[w[22]||(w[22]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Project Key (Optional) ",-1)),ye(b("input",{"onUpdate:modelValue":w[9]||(w[9]=R=>p.value.key=R),type:"text",maxlength:"10",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"e.g., PROJ, FEAT"},null,512),[[ze,p.value.key]]),w[23]||(w[23]=b("p",{class:"text-sm text-gray-500 mt-1"},"Leave empty to auto-generate",-1))]),b("div",null,[w[24]||(w[24]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Color ",-1)),b("div",gx,[ye(b("input",{"onUpdate:modelValue":w[10]||(w[10]=R=>p.value.color=R),type:"color",class:"w-12 h-10 border border-gray-300 dark:border-gray-600 rounded-md cursor-pointer"},null,512),[[ze,p.value.color]]),b("span",yx,z(p.value.color),1)])]),b("div",bx,[w[25]||(w[25]=b("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Create Project ",-1)),b("button",{type:"button",onClick:w[11]||(w[11]=R=>s.value=!1),class:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"}," Cancel ")])],32)])])])):X("",!0),i.value?(A(),P("div",vx,[b("div",wx,[b("div",kx,[b("div",xx,[w[26]||(w[26]=b("h2",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100"},"Edit Project",-1)),b("button",{onClick:w[12]||(w[12]=R=>i.value=!1),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"},[U(G,{name:"X",class:"w-6 h-6"})])]),b("form",{onSubmit:Ae(Y,["prevent"]),class:"space-y-4"},[b("div",null,[w[27]||(w[27]=b("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Project Name * ",-1)),ye(b("input",{"onUpdate:modelValue":w[13]||(w[13]=R=>c.value=R),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter project name"},null,512),[[ze,c.value]])]),b("div",Sx,[w[28]||(w[28]=b("button",{type:"submit",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Save Changes ",-1)),b("button",{type:"button",onClick:w[14]||(w[14]=R=>i.value=!1),class:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"}," Cancel ")])],32)])])])):X("",!0)]))}}),Cx={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},jx=qe({__name:"Dashboard",setup(r){const e=[{title:"Dashboard",href:oh().url}];return(t,n)=>(A(),P(Xe,null,[U(Jt(bh),{title:"Dashboard"}),U(ih,{breadcrumbs:e},{default:cc(()=>[b("div",Cx,[U(Tx)])]),_:1})],64))}});export{jx as default};
