import{d as ue,A as ce,B as y,u as V,k as b,c as i,o,a as t,b as a,h as me,w as l,e as s,i as g,m as A,t as n,j as d,F as K,r as ge,s as w,p as B}from"./app-Ctmi56vy.js";import{_ as F}from"./index-DHWhwBHT.js";import{_ as f,c as v,a as P,b as T}from"./CardTitle.vue_vue_type_script_setup_true_lang-CMjFvtcn.js";import{_ as D}from"./CardDescription.vue_vue_type_script_setup_true_lang-CMWe4Tos.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-B0ycGAeY.js";import{_ as R}from"./Label.vue_vue_type_script_setup_true_lang-CoOTq6XP.js";import{_ as pe}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cai6ia66.js";import{_ as be}from"./Layout.vue_vue_type_script_setup_true_lang-DJMbrNd9.js";import{I as G,E as Z,f as fe,U as ve,g as _e,h as ye}from"./AppSidebarLayout.vue_vue_type_script_setup_true_lang-CQFPFmMa.js";import{C as W}from"./lock-D8R8PVOM.js";import{G as $}from"./globe-CRd5gf4c.js";import{C as Q}from"./users-CsSWIdfs.js";import"./useForwardExpose-QkrgrYsz.js";import"./Heading.vue_vue_type_script_setup_true_lang-ZLGghODw.js";import"./index-8O20627j.js";import"./index-CMWG4mbA.js";import"./index-ObrdfWFb.js";import"./Presence-BXebq-UE.js";import"./check-BRK2h1ZV.js";import"./x-CFZPCXJw.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BCjl6qAf.js";const xe={class:"space-y-6"},ke={key:0,class:"mb-6"},he={class:"flex items-center gap-2 text-amber-700 dark:text-amber-300"},we={key:1,class:"mb-6"},Ce={class:"flex items-center gap-2 text-green-700 dark:text-green-300"},Se={class:"text-sm font-medium"},Ae={key:2,class:"mb-6"},Fe={class:"flex items-center gap-2 text-red-700 dark:text-red-300"},Pe={class:"text-sm font-medium"},Te={key:3,class:"mb-6"},Ie={class:"space-y-3"},Le={class:"text-sm text-blue-700 dark:text-blue-300"},Ee={class:"font-medium mb-2"},Ue={class:"list-decimal list-inside space-y-1"},je={class:"mt-4"},Me={key:0,class:"text-sm text-red-600 dark:text-red-400"},Be={key:1,class:"space-y-2 text-sm"},De={class:"flex items-center gap-2"},$e={key:0,class:"text-xs text-gray-500"},ze={class:"flex items-center gap-2"},Ne={key:0,class:"text-xs text-gray-500"},Ve={key:1,class:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},Re={class:"flex items-center gap-2 text-green-700 dark:text-green-300 mb-2"},Ge={class:"flex items-center gap-2"},Ze=["href"],Ye={key:2,class:"p-4 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg"},qe={class:"flex items-center gap-2 text-gray-600 dark:text-gray-400"},He={key:3},Xe={class:"space-y-4"},Je={class:"relative"},Ke={class:"absolute right-3 top-1/2 transform -translate-y-1/2"},Oe={key:0,class:"animate-spin"},We={key:1,class:"text-green-500"},Qe={key:2,class:"text-red-500"},es={key:0,class:"mt-2"},ss={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},as={class:"font-mono"},ts={class:"flex items-center justify-between p-4 border border-gray-200 dark:border-gray-700 rounded-lg"},ls={class:"flex items-center gap-3"},os={class:"flex items-center justify-center w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded border"},rs=["src","alt"],ns={key:1,class:"flex items-center gap-1 text-xs font-bold text-blue-600 dark:text-blue-400"},is={class:"font-medium text-gray-900 dark:text-gray-100"},ds={class:"text-sm text-gray-600 dark:text-gray-400"},us={class:"flex items-start gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},cs={class:"text-sm text-blue-700 dark:text-blue-300"},ms={class:"space-y-1 text-xs"},gs={key:0,class:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},ps={class:"flex-1"},bs={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},fs={class:"text-xs text-gray-600 dark:text-gray-400"},vs={class:"flex items-center justify-between"},_s={class:"space-y-1"},ys={key:0,class:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},xs={class:"flex items-center gap-2 text-green-700 dark:text-green-300 mb-2"},ks={class:"space-y-2"},hs={class:"flex items-center gap-2"},ws=["href"],Cs={class:"flex items-center gap-2"},Ss=["href"],Hs=ue({__name:"Company",props:{user:{},company:{}},setup(ee){const p=ee,Y=ce(),C=y(()=>p.company&&["MIDI","MAXI"].includes(p.company.subscription_type)),se=V({}),I=V({company_name:p.company?.name||""}),x=V({is_public:p.company?.is_public||!1}),u=b({checking:!1,available:null,message:"",subdomain:"",url:""});let z=null;const N=b(),L=b(!1),E=b(!1),U=b(!1),_=b(null),k=b(""),S=b(""),j=b(!1),c=b(null),ae=r=>{const e=r.target;e.files&&e.files[0]&&(_.value=e.files[0],k.value="")},te=async()=>{if(!(!_.value||!p.company)){L.value=!0,k.value="";try{const r=await ye(_.value,p.company.name,p.company.code);B.post("/settings/company-logo/update-url",{logo_url:r},{onSuccess:()=>{_.value=null,N.value&&(N.value.value=""),B.reload()},onError:e=>{k.value=e.logo||"Failed to update logo URL"}})}catch(r){console.error("Logo upload failed:",r),k.value="Failed to upload logo to storage. Please try again."}finally{L.value=!1}}},le=()=>{E.value=!0,se.delete("/settings/company-logo/remove",{onFinish:()=>{E.value=!1}})},oe=()=>{if(!p.company)return;const r=u.value.subdomain||I.company_name;U.value=!0,S.value="";const e=new FormData;e.append("company_name",r),fetch("/settings/company/subdomain",{method:"POST",body:e,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}}).then(m=>m.json()).then(m=>{m.success?B.reload():S.value=m.message||"Failed to create subdomain"}).catch(m=>{console.error("Error creating subdomain:",m),S.value="Failed to create subdomain"}).finally(()=>{U.value=!1})},re=async()=>{j.value=!0,c.value=null;try{const e=await(await fetch("/settings/company/api-permissions")).json();c.value=e}catch(r){console.error("Error checking API permissions:",r),c.value={error:"Failed to check API permissions"}}finally{j.value=!1}},ne=async r=>{if(r.length<3){u.value={checking:!1,available:null,message:"",subdomain:"",url:""};return}u.value.checking=!0;try{const m=await(await fetch(`/settings/company/check-subdomain?subdomain=${encodeURIComponent(r)}`)).json();u.value={checking:!1,available:m.available,message:m.message,subdomain:m.subdomain||r,url:m.url||""}}catch(e){console.error("Failed to check subdomain availability:",e),u.value={checking:!1,available:!1,message:"Failed to check subdomain availability",subdomain:r,url:""}}},ie=r=>{const m=r.target.value;z&&clearTimeout(z),z=setTimeout(()=>{ne(m)},500)},de=()=>{x.patch("/settings/company/public",{onSuccess:()=>{B.reload()},onError:r=>{console.error("Failed to update public dashboard setting:",r)}})},h=y(()=>Y.props.errors||{}),q=y(()=>Y.props.flash?.success||""),H=y(()=>p.company?.logo_url),M=y(()=>!!H.value),X=y(()=>!!p.company?.subdomain),J=y(()=>p.company?.subdomain_url);return(r,e)=>(o(),i(K,null,[t(a(me),{title:"Company Settings"}),t(pe,null,{default:l(()=>[t(be,null,{default:l(()=>[s("div",xe,[e[34]||(e[34]=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Company Settings"),s("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," Manage your company's branding and subdomain. ")],-1)),C.value?g("",!0):(o(),i("div",ke,[t(a(f),{class:"border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20"},{default:l(()=>[t(a(v),{class:"p-4"},{default:l(()=>[s("div",he,[t(a(W),{class:"w-5 h-5 flex-shrink-0"}),e[1]||(e[1]=s("div",null,[s("p",{class:"font-medium"},"Upgrade Required"),s("p",{class:"text-sm"},"Company features are available for MIDI and MAXI plans only.")],-1))])]),_:1})]),_:1})])),q.value?(o(),i("div",we,[t(a(f),{class:"border-green-200 dark:border-green-800 bg-green-50 dark:bg-green-900/20"},{default:l(()=>[t(a(v),{class:"p-4"},{default:l(()=>[s("div",Ce,[t(a(G),{class:"w-5 h-5 flex-shrink-0"}),s("p",Se,n(q.value),1)])]),_:1})]),_:1})])):g("",!0),h.value.logo||k.value||S.value?(o(),i("div",Ae,[t(a(f),{class:"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"},{default:l(()=>[t(a(v),{class:"p-4"},{default:l(()=>[s("div",Fe,[t(a(W),{class:"w-5 h-5 flex-shrink-0"}),s("p",Pe,n(h.value.logo||k.value||S.value),1)])]),_:1})]),_:1})])):g("",!0),h.value.instructions?(o(),i("div",Te,[t(a(f),{class:"border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/20"},{default:l(()=>[t(a(P),null,{default:l(()=>[t(a(T),{class:"text-blue-700 dark:text-blue-300"},{default:l(()=>[d(n(h.value.instructions.title),1)]),_:1})]),_:1}),t(a(v),null,{default:l(()=>[s("div",Ie,[s("div",Le,[s("p",Ee,n(h.value.instructions.note),1),s("ol",Ue,[(o(!0),i(K,null,ge(h.value.instructions.steps,m=>(o(),i("li",{key:m},n(m),1))),128))])])])]),_:1})]),_:1})])):g("",!0),C.value?(o(),A(a(f),{key:4},{default:l(()=>[t(a(P),null,{default:l(()=>[t(a(T),{class:"flex items-center gap-2"},{default:l(()=>[t(a($),{class:"w-5 h-5"}),e[2]||(e[2]=d(" Company Subdomain ",-1))]),_:1,__:[2]}),t(a(D),null,{default:l(()=>e[3]||(e[3]=[d(" Create a custom subdomain for your company using Cloudflare DNS and Heroku. This will allow guests to access your company's dashboard directly. ",-1)])),_:1,__:[3]}),s("div",je,[t(a(F),{onClick:re,disabled:j.value,variant:"outline",size:"sm"},{default:l(()=>[d(n(j.value?"Checking...":"Check API Permissions"),1)]),_:1},8,["disabled"])])]),_:1}),t(a(v),{class:"space-y-4"},{default:l(()=>[c.value?(o(),i("div",{key:0,class:w(["p-4 border rounded-lg",{"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":!c.value.error,"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":c.value.error}])},[s("div",{class:w(["flex items-center gap-2 mb-2",{"text-green-700 dark:text-green-300":!c.value.error,"text-red-700 dark:text-red-300":c.value.error}])},[t(a(G),{class:"w-5 h-5"}),e[4]||(e[4]=s("span",{class:"font-medium"},"API Permissions Status",-1))],2),c.value.error?(o(),i("div",Me,n(c.value.error),1)):(o(),i("div",Be,[s("div",De,[e[5]||(e[5]=s("span",{class:"font-medium"},"Cloudflare API:",-1)),s("span",{class:w(c.value.cloudflare_api?.accessible?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400")},n(c.value.cloudflare_api?.accessible?"✓ Accessible":"✗ Not Accessible"),3),c.value.cloudflare_api?.accessible?g("",!0):(o(),i("span",$e," ("+n(c.value.cloudflare_api?.message)+") ",1))]),s("div",ze,[e[6]||(e[6]=s("span",{class:"font-medium"},"Heroku API:",-1)),s("span",{class:w(c.value.heroku_api?.accessible?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400")},n(c.value.heroku_api?.accessible?"✓ Accessible":"✗ Not Accessible"),3),c.value.heroku_api?.accessible?g("",!0):(o(),i("span",Ne," ("+n(c.value.heroku_api?.message)+") ",1))])]))],2)):g("",!0),X.value?(o(),i("div",Ve,[s("div",Re,[t(a(Q),{class:"w-5 h-5"}),e[7]||(e[7]=s("span",{class:"font-medium"},"Subdomain Active",-1))]),s("div",Ge,[e[8]||(e[8]=s("span",{class:"text-sm text-green-600 dark:text-green-400"}," Your company subdomain: ",-1)),s("a",{href:J.value,target:"_blank",class:"inline-flex items-center gap-1 text-sm font-medium text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300"},[d(n(J.value)+" ",1),t(a(Z),{class:"w-3 h-3"})],8,Ze)])])):g("",!0),X.value?(o(),i("div",Ye,[s("div",qe,[t(a($),{class:"w-5 h-5"}),e[9]||(e[9]=s("span",{class:"font-medium"},"Sub Domain Linked",-1))]),e[10]||(e[10]=s("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"}," Your company subdomain is already active and linked. ",-1))])):(o(),i("div",He,[s("div",Xe,[s("div",null,[t(a(R),{for:"company-name",class:"text-sm font-medium"},{default:l(()=>e[11]||(e[11]=[d(" Company Name ",-1)])),_:1,__:[11]}),s("div",Je,[t(a(O),{id:"company-name",modelValue:a(I).company_name,"onUpdate:modelValue":e[0]||(e[0]=m=>a(I).company_name=m),onInput:ie,type:"text",placeholder:"Enter your company name",class:w(["mt-1 pr-10",{"border-green-500 focus:border-green-500":u.value.available===!0,"border-red-500 focus:border-red-500":u.value.available===!1}])},null,8,["modelValue","class"]),s("div",Ke,[u.value.checking?(o(),i("div",Oe,e[12]||(e[12]=[s("svg",{class:"w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):u.value.available===!0?(o(),i("div",We,e[13]||(e[13]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):u.value.available===!1?(o(),i("div",Qe,e[14]||(e[14]=[s("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):g("",!0)])]),u.value.message?(o(),i("div",es,[s("p",{class:w([{"text-green-600 dark:text-green-400":u.value.available===!0,"text-red-600 dark:text-red-400":u.value.available===!1},"text-xs"])},n(u.value.message),3),u.value.url?(o(),i("p",ss,[e[15]||(e[15]=d(" Your subdomain will be: ",-1)),s("span",as,n(u.value.url),1)])):g("",!0)])):g("",!0),e[16]||(e[16]=s("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},' This will be converted to a subdomain (e.g., "My Company" → "my-company.zaptask.co.uk") ',-1))]),t(a(F),{onClick:oe,disabled:U.value||!a(I).company_name||u.value.available===!1||u.value.checking,class:"w-full"},{default:l(()=>[t(a($),{class:"w-4 h-4 mr-2"}),d(" "+n(U.value?"Creating Subdomain...":"Create Company Subdomain"),1)]),_:1},8,["disabled"])])]))]),_:1})]),_:1})):g("",!0),C.value?(o(),A(a(f),{key:5},{default:l(()=>[t(a(P),null,{default:l(()=>[t(a(T),null,{default:l(()=>e[17]||(e[17]=[d("Current Logo",-1)])),_:1,__:[17]}),t(a(D),null,{default:l(()=>e[18]||(e[18]=[d(" This is how your logo currently appears in the application. ",-1)])),_:1,__:[18]})]),_:1}),t(a(v),null,{default:l(()=>[s("div",ts,[s("div",ls,[s("div",os,[M.value?(o(),i("img",{key:0,src:H.value,alt:r.company?.name+" logo",class:"object-contain"},null,8,rs)):(o(),i("div",ns,e[19]||(e[19]=[s("div",{class:"w-6 h-6 bg-blue-600 dark:bg-blue-400 rounded text-white dark:text-gray-900 flex items-center justify-center"},[s("img",{src:"/zap_icon.png",alt:"ZapTask",class:"w-4 h-4 dark:hidden"}),s("img",{src:"/zap_icon_white.svg",alt:"ZapTask",class:"w-4 h-4 hidden dark:block"})],-1),s("span",null,"ZapTask",-1)])))]),s("div",null,[s("p",is,n(M.value?"Custom Logo":"Default ZapTask Logo"),1),s("p",ds,n(M.value?"Your company's custom logo":"Standard ZapTask branding"),1)])]),M.value?(o(),A(a(F),{key:0,onClick:le,disabled:E.value,variant:"outline",class:"text-red-600 hover:text-red-700 border-red-200 hover:border-red-300"},{default:l(()=>[t(a(fe),{class:"w-4 h-4 mr-2"}),d(" "+n(E.value?"Removing...":"Remove Logo"),1)]),_:1},8,["disabled"])):g("",!0)])]),_:1})]),_:1})):g("",!0),C.value?(o(),A(a(f),{key:6},{default:l(()=>[t(a(P),null,{default:l(()=>[t(a(T),{class:"flex items-center gap-2"},{default:l(()=>[t(a(ve),{class:"w-5 h-5"}),e[20]||(e[20]=d(" Upload New Logo ",-1))]),_:1,__:[20]}),t(a(D),null,{default:l(()=>e[21]||(e[21]=[d(" Upload a custom logo for your company. The logo will replace the ZapTask branding. ",-1)])),_:1,__:[21]})]),_:1}),t(a(v),{class:"space-y-4"},{default:l(()=>[s("div",us,[t(a(G),{class:"w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0"}),s("div",cs,[e[25]||(e[25]=s("p",{class:"font-medium mb-1"},"Logo Requirements:",-1)),s("ul",ms,[e[22]||(e[22]=s("li",null,"• Recommended size: 216px width × 48px height",-1)),e[23]||(e[23]=s("li",null,"• Supported formats: PNG, JPG, JPEG, SVG",-1)),e[24]||(e[24]=s("li",null,"• Maximum file size: 2MB",-1)),s("li",null,"• Filename will be: "+n(r.company?.name?.replace(/\s+/g,"_"))+"_"+n(r.company?.code)+"_timestamp",1)])])]),s("div",null,[t(a(R),{for:"logo-upload",class:"text-sm font-medium"},{default:l(()=>e[26]||(e[26]=[d(" Select Logo File ",-1)])),_:1,__:[26]}),t(a(O),{id:"logo-upload",ref_key:"fileInput",ref:N,type:"file",accept:"image/png,image/jpg,image/jpeg,image/svg+xml",onChange:ae,class:"mt-1"},null,512)]),_.value?(o(),i("div",gs,[t(a(_e),{class:"w-5 h-5 text-gray-600 dark:text-gray-400"}),s("div",ps,[s("p",bs,n(_.value.name),1),s("p",fs,n((_.value.size/1024).toFixed(1))+" KB ",1)]),t(a(F),{onClick:te,disabled:L.value,class:"ml-auto"},{default:l(()=>[d(n(L.value?"Uploading...":"Upload Logo"),1)]),_:1},8,["disabled"])])):g("",!0)]),_:1})]),_:1})):g("",!0),C.value?(o(),A(a(f),{key:7},{default:l(()=>[t(a(P),null,{default:l(()=>[t(a(T),{class:"flex items-center gap-2"},{default:l(()=>[t(a($),{class:"w-5 h-5"}),e[27]||(e[27]=d(" Public Dashboard ",-1))]),_:1,__:[27]}),t(a(D),null,{default:l(()=>e[28]||(e[28]=[d(" Allow guests to view your company's dashboard without logging in. They can see projects and todos but cannot create, edit, or delete anything. ",-1)])),_:1,__:[28]})]),_:1}),t(a(v),{class:"space-y-4"},{default:l(()=>[s("div",vs,[s("div",_s,[t(a(R),{class:"text-sm font-medium"},{default:l(()=>e[29]||(e[29]=[d("Enable Public Dashboard",-1)])),_:1,__:[29]}),e[30]||(e[30]=s("p",{class:"text-xs text-gray-500 dark:text-gray-400"}," When enabled, anyone can view your dashboard at your subdomain without logging in. ",-1))]),t(a(F),{onClick:de,disabled:a(x).processing,variant:a(x).is_public?"default":"outline",size:"sm"},{default:l(()=>[d(n(a(x).processing?"Updating...":a(x).is_public?"Enabled":"Enable"),1)]),_:1},8,["disabled","variant"])]),a(x).is_public&&r.company?.subdomain_url?(o(),i("div",ys,[s("div",xs,[t(a(Q),{class:"w-5 h-5"}),e[31]||(e[31]=s("span",{class:"font-medium"},"Public Dashboard Active",-1))]),s("div",ks,[s("div",hs,[e[32]||(e[32]=s("span",{class:"text-sm text-green-600 dark:text-green-400"}," Company page: ",-1)),s("a",{href:r.company.subdomain_url,target:"_blank",class:"inline-flex items-center gap-1 text-sm font-medium text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300"},[d(n(r.company.subdomain_url)+" ",1),t(a(Z),{class:"w-3 h-3"})],8,ws)]),s("div",Cs,[e[33]||(e[33]=s("span",{class:"text-sm text-green-600 dark:text-green-400"}," Public dashboard: ",-1)),s("a",{href:`${r.company.subdomain_url}/public`,target:"_blank",class:"inline-flex items-center gap-1 text-sm font-medium text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300"},[d(n(r.company.subdomain_url)+"/public ",1),t(a(Z),{class:"w-3 h-3"})],8,Ss)])])])):g("",!0)]),_:1})]),_:1})):g("",!0)])]),_:1})]),_:1})],64))}});export{Hs as default};
