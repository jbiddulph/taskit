import{d as y,a as p,o as d,n as _,A as s,M as v,r as V,c as E,l as K,f as c,L as G,q as i,b as l,p as h,e as C,g as x,t as m,F as S,j as D,N as O}from"./app-Dv7kFwv0.js";import{C as J,c as Y,d as z,b as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-C58iNuHj.js";import{c as k,_ as N}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BYFbm4zd.js";import{C as L}from"./check-Do_qthHd.js";import"./useForwardExpose-BIFvDiT3.js";import"./index-C61bzdNy.js";const R=y({__name:"Card",props:{class:{}},setup(g){const u=g;return(a,n)=>(d(),p("div",{"data-slot":"card",class:_(s(k)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",u.class))},[v(a.$slots,"default")],2))}}),P=y({__name:"CardContent",props:{class:{}},setup(g){const u=g;return(a,n)=>(d(),p("div",{"data-slot":"card-content",class:_(s(k)("px-6",u.class))},[v(a.$slots,"default")],2))}}),j=y({__name:"CardDescription",props:{class:{}},setup(g){const u=g;return(a,n)=>(d(),p("p",{"data-slot":"card-description",class:_(s(k)("text-muted-foreground text-sm",u.class))},[v(a.$slots,"default")],2))}}),I=y({__name:"CardHeader",props:{class:{}},setup(g){const u=g;return(a,n)=>(d(),p("div",{"data-slot":"card-header",class:_(s(k)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",u.class))},[v(a.$slots,"default")],2))}}),$=y({__name:"CardTitle",props:{class:{}},setup(g){const u=g;return(a,n)=>(d(),p("h3",{"data-slot":"card-title",class:_(s(k)("leading-none font-semibold",u.class))},[v(a.$slots,"default")],2))}}),Z={class:"max-w-6xl mx-auto p-6"},Q={class:"flex items-center justify-between"},ee={class:"text-lg font-semibold"},te={class:"text-gray-600 dark:text-gray-400"},se={key:0,class:"mt-2"},oe={class:"text-sm text-gray-500"},re={class:"flex items-center gap-2"},le={class:"mb-8"},ae={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ne={class:"text-3xl font-bold text-gray-900 dark:text-gray-100"},ce={class:"text-sm text-gray-500"},ie={class:"space-y-2 mb-6"},ue={key:1,class:"text-center"},be=y({__name:"Index",props:{user:{},company:{},plans:{},stripePublicKey:{}},setup(g){const u=g,a=V(!1),n=E(()=>u.company?.subscription_type||"FREE"),w=E(()=>u.company?.subscription_status==="active"),B=E(()=>{if(n.value==="FREE")return u.plans;const e={...u.plans};return delete e.FREE,e});console.log("=== SUBSCRIPTION PAGE LOADED ==="),console.log("Props:",u),console.log("Current plan computed:",n.value),console.log("Loading state:",a.value),console.log("Component initial setup complete"),console.log("Component fully loaded at:",new Date().toISOString());const A=t=>`Â£${(t/100).toFixed(0)}`,X=t=>t===n.value?t==="MAXI"?"border-2 border-yellow-500 bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20":t==="MIDI"?"border-2 border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-2 border-gray-500 bg-gray-50 dark:bg-gray-900/20":"border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",q=t=>{const e=n.value,o=u.plans[t],r={FREE:0,MIDI:1,MAXI:2},f=r[e]||0,b=r[t]||0;return b>f?`Upgrade to ${o.name}`:b<f?`Downgrade to ${o.name}`:`Switch to ${o.name}`},M=t=>{console.log("=== BUTTON CLICKED ==="),console.log("Plan type:",t),console.log("Current time:",new Date().toISOString()),console.log("Loading state:",a.value),console.log("Current plan:",n.value),console.log("Function exists:",typeof F),console.log("About to call changePlan...");try{F(t),console.log("changePlan called successfully")}catch(e){console.error("Error calling changePlan:",e)}},F=async t=>{if(console.log("changePlan called with:",t),console.log("loading.value:",a.value),console.log("currentPlan.value:",n.value),a.value||t===n.value){console.log("Exiting early - either loading or same plan");return}a.value=!0,console.log("Setting loading to true, using Inertia router approach..."),O.post("/subscription/change-plan",{plan:t},{onBefore:()=>(console.log("Inertia request starting..."),!0),onSuccess:e=>{console.log("Inertia request successful:",e),console.log("Full page props:",JSON.stringify(e.props,null,2)),console.log("All page props keys:",Object.keys(e.props)),console.log("Direct redirect_url check:",e.props.redirect_url),console.log("Has redirect_url prop:","redirect_url"in e.props);const o=e.props.flash;console.log("Flash data:",o),console.log("Flash type:",typeof o),console.log("Flash keys:",o?Object.keys(o):"no flash");let r=null;if(o?.redirect_url)r=o.redirect_url,console.log("Found redirect_url in flash.redirect_url");else if(e.props.redirect_url)r=e.props.redirect_url,console.log("Found redirect_url in page.props.redirect_url");else if(o&&typeof o=="object"){for(const[f,b]of Object.entries(o))if(console.log(`Flash ${f}:`,b),f==="redirect_url"||typeof b=="string"&&b.includes("checkout.stripe.com")){r=b,console.log(`Found redirect URL in flash.${f}`);break}}r?(console.log("Redirecting to Stripe checkout:",r),window.location.href=r):(console.log("No redirect URL found, reloading page"),window.location.reload())},onError:e=>{console.error("Inertia request failed:",e),console.log("Error details:",JSON.stringify(e,null,2));let o="An error occurred while changing your plan. Please try again.";e.plan?o=e.plan:e.message&&(o=e.message),alert(o)},onFinish:()=>{console.log("Setting loading to false"),a.value=!1}})},T=()=>{const t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):""},U=async()=>{console.log("=== TESTING CSRF ===");const t=T();console.log("CSRF Token:",t?"Found":"Missing");try{const e=await fetch("/subscription/test-csrf",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(console.log("CSRF Test Response:",e.status,e.statusText),e.ok){const o=await e.json();console.log("CSRF Test Success:",o)}else console.log("CSRF Test Failed:",e.status)}catch(e){console.error("CSRF Test Error:",e)}};K(()=>{console.log("=== COMPONENT MOUNTED ==="),console.log("onMounted hook called at:",new Date().toISOString()),console.log("Final function check:",{handlePlanChange:typeof M,changePlan:typeof F}),console.log("Running automatic CSRF test..."),U()});const H=async()=>{confirm("Are you sure you want to cancel your subscription? Your account will be downgraded to the FREE plan.")&&(a.value=!0,O.post("/subscription/cancel-subscription",{},{onSuccess:()=>{},onError:t=>{console.error("Error cancelling subscription:",t),alert("An error occurred while cancelling your subscription. Please try again.")},onFinish:()=>{a.value=!1}}))};return(t,e)=>(d(),p(S,null,[c(s(G),{title:"Subscription Management"}),c(W,null,{default:i(()=>[l("div",Z,[e[7]||(e[7]=l("div",{class:"mb-8"},[l("h1",{class:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2"}," Subscription Management "),l("p",{class:"text-gray-600 dark:text-gray-400"}," Manage your TaskIT subscription and billing settings ")],-1)),c(s(R),{class:"mb-8"},{default:i(()=>[c(s(I),null,{default:i(()=>[c(s($),{class:"flex items-center gap-2"},{default:i(()=>[c(s(J),{class:"w-5 h-5"}),e[0]||(e[0]=x(" Current Subscription ",-1))]),_:1,__:[0]})]),_:1}),c(s(P),null,{default:i(()=>[l("div",Q,[l("div",null,[l("p",ee,m(t.plans[n.value].name),1),l("p",te,m(n.value==="FREE"?"Free forever":`${A(t.plans[n.value].price)} per month`),1),t.company?.subscription_ends_at?(d(),p("div",se,[l("p",oe,m(w.value?"Renews on":"Expires on")+": "+m(new Date(t.company.subscription_ends_at).toLocaleDateString()),1)])):C("",!0)]),l("div",re,[l("div",{class:_(["px-3 py-1 rounded-full text-sm font-medium",{"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300":w.value,"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":t.company?.subscription_status==="past_due","bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300":t.company?.subscription_status==="canceled","bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300":n.value==="FREE"}])},m(w.value?"Active":t.company?.subscription_status||"Free"),3)])])]),_:1})]),_:1}),l("div",le,[e[2]||(e[2]=l("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6"}," Available Plans ",-1)),l("div",ae,[(d(!0),p(S,null,D(B.value,(o,r)=>(d(),h(s(R),{key:r,class:_(X(r))},{default:i(()=>[c(s(I),{class:"text-center"},{default:i(()=>[c(s($),{class:"flex items-center justify-center gap-2"},{default:i(()=>[r==="MAXI"?(d(),h(s(Y),{key:0,class:"w-5 h-5 text-yellow-500"})):C("",!0),l("span",{class:_({"text-yellow-600 dark:text-yellow-400":r==="MAXI"})},m(o.name),3),r===n.value?(d(),h(s(L),{key:1,class:"w-5 h-5 text-green-500"})):C("",!0)]),_:2},1024),c(s(j),null,{default:i(()=>[l("div",ne,m(r==="FREE"?"Free":A(o.price)),1),l("div",ce,m(r==="FREE"?"Forever":"per month"),1)]),_:2},1024)]),_:2},1024),c(s(P),null,{default:i(()=>[l("ul",ie,[(d(!0),p(S,null,D(o.features,f=>(d(),p("li",{key:f,class:"flex items-start gap-2 text-sm"},[c(s(L),{class:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),l("span",null,m(f),1)]))),128))]),r!==n.value?(d(),h(s(N),{key:0,onClick:f=>M(r),disabled:a.value,variant:r==="MIDI"||r==="MAXI"?"default":"outline",class:"w-full"},{default:i(()=>[x(m(q(r)),1)]),_:2},1032,["onClick","disabled","variant"])):(d(),p("div",ue,e[1]||(e[1]=[l("span",{class:"text-sm text-gray-500"},"Current Plan",-1)])))]),_:2},1024)]),_:2},1032,["class"]))),128))])]),n.value!=="FREE"&&t.company?.stripe_subscription_id?(d(),h(s(R),{key:0,class:"border-red-200 dark:border-red-800"},{default:i(()=>[c(s(I),null,{default:i(()=>[c(s($),{class:"flex items-center gap-2 text-red-600 dark:text-red-400"},{default:i(()=>[c(s(z),{class:"w-5 h-5"}),e[3]||(e[3]=x(" Danger Zone ",-1))]),_:1,__:[3]}),c(s(j),null,{default:i(()=>e[4]||(e[4]=[x(" Cancel your subscription and downgrade to the FREE plan ",-1)])),_:1,__:[4]})]),_:1}),c(s(P),null,{default:i(()=>[c(s(N),{onClick:H,disabled:a.value,variant:"destructive"},{default:i(()=>e[5]||(e[5]=[x(" Cancel Subscription ",-1)])),_:1,__:[5]},8,["disabled"]),e[6]||(e[6]=l("p",{class:"text-xs text-gray-500 mt-2"}," Your subscription will remain active until the end of your current billing period. ",-1))]),_:1,__:[6]})]),_:1})):C("",!0)])]),_:1})],64))}});export{be as default};
