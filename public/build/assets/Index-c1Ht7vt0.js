import{d as h,a as m,o as d,n as _,A as t,L as y,r as X,c as I,l as q,f as a,K as T,q as c,b as r,p as v,e as C,g as b,t as f,F as E,j as N,M as V}from"./app-DbxEgeRi.js";import{C as Y,c as H,b as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-BmDHVWVR.js";import{c as x,_ as O}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CpzX5_7w.js";import{C as M}from"./check-jTb4PoF9.js";import"./useForwardExpose-CfZeQcEt.js";import"./index-C61bzdNy.js";const S=h({__name:"Card",props:{class:{}},setup(p){const g=p;return(s,n)=>(d(),m("div",{"data-slot":"card",class:_(t(x)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",g.class))},[y(s.$slots,"default")],2))}}),F=h({__name:"CardContent",props:{class:{}},setup(p){const g=p;return(s,n)=>(d(),m("div",{"data-slot":"card-content",class:_(t(x)("px-6",g.class))},[y(s.$slots,"default")],2))}}),L=h({__name:"CardDescription",props:{class:{}},setup(p){const g=p;return(s,n)=>(d(),m("p",{"data-slot":"card-description",class:_(t(x)("text-muted-foreground text-sm",g.class))},[y(s.$slots,"default")],2))}}),P=h({__name:"CardHeader",props:{class:{}},setup(p){const g=p;return(s,n)=>(d(),m("div",{"data-slot":"card-header",class:_(t(x)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",g.class))},[y(s.$slots,"default")],2))}}),R=h({__name:"CardTitle",props:{class:{}},setup(p){const g=p;return(s,n)=>(d(),m("h3",{"data-slot":"card-title",class:_(t(x)("leading-none font-semibold",g.class))},[y(s.$slots,"default")],2))}}),z={class:"max-w-6xl mx-auto p-6"},G={class:"flex items-center justify-between"},J={class:"text-lg font-semibold"},Z={class:"text-gray-600 dark:text-gray-400"},Q={key:0,class:"mt-2"},ee={class:"text-sm text-gray-500"},te={class:"flex items-center gap-2"},oe={class:"mb-8"},se={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},re={class:"text-3xl font-bold text-gray-900 dark:text-gray-100"},ae={class:"text-sm text-gray-500"},ne={class:"space-y-2 mb-6"},le={key:1,class:"text-center"},me=h({__name:"Index",props:{user:{},company:{},plans:{},stripePublicKey:{}},setup(p){const g=p,s=X(!1),n=I(()=>g.company?.subscription_type||"FREE"),k=I(()=>g.company?.subscription_status==="active");console.log("=== SUBSCRIPTION PAGE LOADED ==="),console.log("Props:",g),console.log("Current plan computed:",n.value),console.log("Loading state:",s.value),console.log("Component initial setup complete"),console.log("Component fully loaded at:",new Date().toISOString());const $=o=>`Â£${(o/100).toFixed(0)}`,j=o=>{switch(o){case"FREE":return"gray";case"MIDI":return"blue";case"MAXI":return"purple";default:return"gray"}},U=o=>{const e=j(o);return o===n.value?`border-2 border-${e}-500 bg-${e}-50 dark:bg-${e}-900/20`:"border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"},A=o=>{console.log("=== BUTTON CLICKED ==="),console.log("Plan type:",o),console.log("Current time:",new Date().toISOString()),console.log("Loading state:",s.value),console.log("Current plan:",n.value),console.log("Function exists:",typeof w),console.log("About to call changePlan...");try{w(o),console.log("changePlan called successfully")}catch(e){console.error("Error calling changePlan:",e)}},w=async o=>{if(console.log("changePlan called with:",o),console.log("loading.value:",s.value),console.log("currentPlan.value:",n.value),s.value||o===n.value){console.log("Exiting early - either loading or same plan");return}s.value=!0,console.log("Setting loading to true, trying fetch approach...");try{const e=await fetch("/sanctum/csrf-cookie",{credentials:"same-origin"});console.log("CSRF token refresh:",e.status),await new Promise(l=>setTimeout(l,100));let u=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"";if(!u||u.length<10){const D=document.cookie.split(";").find(K=>K.trim().startsWith("XSRF-TOKEN="));D&&(u=decodeURIComponent(D.split("=")[1]),console.log("Using CSRF token from cookie"))}if(console.log("CSRF token found:",u?"YES":"NO"),console.log("CSRF token length:",u.length),!u||u.length<10)throw console.error("Invalid or missing CSRF token after all attempts"),new Error("CSRF token not available");const i=await fetch("/subscription/change-plan",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":u,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify({plan:o})});if(console.log("Response received:",i.status,i.statusText),i.ok){const l=await i.json();if(console.log("Response data:",l),console.log("Checking for redirect_url..."),console.log("data.redirect_url exists:",!!l.redirect_url),console.log("data.redirect_url value:",l.redirect_url),l.redirect_url){console.log("About to redirect to Stripe checkout:",l.redirect_url),console.log("Current window.location.href before redirect:",window.location.href),console.log("Attempting immediate redirect..."),window.top?window.top.location.href=l.redirect_url:window.location.href=l.redirect_url;return}else console.log("No redirect_url found, reloading page"),s.value=!1,window.location.reload()}else{console.log("Response not ok:",i.status);const l=await i.json().catch(()=>({message:"Unknown error"}));throw console.log("Error data:",l),new Error(l.message||"Failed to change plan")}}catch(e){console.error("Error changing plan:",e),alert("An error occurred while changing your plan. Please try again."),s.value=!1}};q(()=>{console.log("=== COMPONENT MOUNTED ==="),console.log("onMounted hook called at:",new Date().toISOString()),console.log("Final function check:",{handlePlanChange:typeof A,changePlan:typeof w})});const B=async()=>{confirm("Are you sure you want to cancel your subscription? Your account will be downgraded to the FREE plan.")&&(s.value=!0,V.post("/subscription/cancel-subscription",{},{onSuccess:()=>{},onError:o=>{console.error("Error cancelling subscription:",o),alert("An error occurred while cancelling your subscription. Please try again.")},onFinish:()=>{s.value=!1}}))};return(o,e)=>(d(),m(E,null,[a(t(T),{title:"Subscription Management"}),a(W,null,{default:c(()=>[r("div",z,[e[7]||(e[7]=r("div",{class:"mb-8"},[r("h1",{class:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2"}," Subscription Management "),r("p",{class:"text-gray-600 dark:text-gray-400"}," Manage your TaskIT subscription and billing settings ")],-1)),a(t(S),{class:"mb-8"},{default:c(()=>[a(t(P),null,{default:c(()=>[a(t(R),{class:"flex items-center gap-2"},{default:c(()=>[a(t(Y),{class:"w-5 h-5"}),e[0]||(e[0]=b(" Current Subscription ",-1))]),_:1,__:[0]})]),_:1}),a(t(F),null,{default:c(()=>[r("div",G,[r("div",null,[r("p",J,f(o.plans[n.value].name),1),r("p",Z,f(n.value==="FREE"?"Free forever":`${$(o.plans[n.value].price)} per month`),1),o.company?.subscription_ends_at?(d(),m("div",Q,[r("p",ee,f(k.value?"Renews on":"Expires on")+": "+f(new Date(o.company.subscription_ends_at).toLocaleDateString()),1)])):C("",!0)]),r("div",te,[r("div",{class:_(["px-3 py-1 rounded-full text-sm font-medium",{"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300":k.value,"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":o.company?.subscription_status==="past_due","bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300":o.company?.subscription_status==="canceled","bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300":n.value==="FREE"}])},f(k.value?"Active":o.company?.subscription_status||"Free"),3)])])]),_:1})]),_:1}),r("div",oe,[e[2]||(e[2]=r("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6"}," Available Plans ",-1)),r("div",se,[(d(!0),m(E,null,N(o.plans,(u,i)=>(d(),v(t(S),{key:i,class:_(U(i))},{default:c(()=>[a(t(P),{class:"text-center"},{default:c(()=>[a(t(R),{class:"flex items-center justify-center gap-2"},{default:c(()=>[b(f(u.name)+" ",1),i===n.value?(d(),v(t(M),{key:0,class:"w-5 h-5 text-green-500"})):C("",!0)]),_:2},1024),a(t(L),null,{default:c(()=>[r("div",re,f(i==="FREE"?"Free":$(u.price)),1),r("div",ae,f(i==="FREE"?"Forever":"per month"),1)]),_:2},1024)]),_:2},1024),a(t(F),null,{default:c(()=>[r("ul",ne,[(d(!0),m(E,null,N(u.features,l=>(d(),m("li",{key:l,class:"flex items-start gap-2 text-sm"},[a(t(M),{class:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),r("span",null,f(l),1)]))),128))]),i!==n.value?(d(),v(t(O),{key:0,onClick:l=>A(i),disabled:s.value,variant:i==="MIDI"?"default":"outline",class:"w-full"},{default:c(()=>[b(f(i==="FREE"?"Downgrade to Free":`Upgrade to ${u.name}`),1)]),_:2},1032,["onClick","disabled","variant"])):(d(),m("div",le,e[1]||(e[1]=[r("span",{class:"text-sm text-gray-500"},"Current Plan",-1)])))]),_:2},1024)]),_:2},1032,["class"]))),128))])]),n.value!=="FREE"&&o.company?.stripe_subscription_id?(d(),v(t(S),{key:0,class:"border-red-200 dark:border-red-800"},{default:c(()=>[a(t(P),null,{default:c(()=>[a(t(R),{class:"flex items-center gap-2 text-red-600 dark:text-red-400"},{default:c(()=>[a(t(H),{class:"w-5 h-5"}),e[3]||(e[3]=b(" Danger Zone ",-1))]),_:1,__:[3]}),a(t(L),null,{default:c(()=>e[4]||(e[4]=[b(" Cancel your subscription and downgrade to the FREE plan ",-1)])),_:1,__:[4]})]),_:1}),a(t(F),null,{default:c(()=>[a(t(O),{onClick:B,disabled:s.value,variant:"destructive"},{default:c(()=>e[5]||(e[5]=[b(" Cancel Subscription ",-1)])),_:1,__:[5]},8,["disabled"]),e[6]||(e[6]=r("p",{class:"text-xs text-gray-500 mt-2"}," Your subscription will remain active until the end of your current billing period. ",-1))]),_:1,__:[6]})]),_:1})):C("",!0)])]),_:1})],64))}});export{me as default};
