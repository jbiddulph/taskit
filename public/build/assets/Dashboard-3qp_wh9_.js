import{d as D,k as y,A as U,c as d,o as i,i as _,e as s,a as n,b as x,t as u,s as w,j as h,F as S,l as P,w as M,B as V,C as H,D as X,g as W,z,r as E,h as O,m as J,E as G}from"./app-qR5kw8zw.js";import{_ as K}from"./AppLayout.vue_vue_type_script_setup_true_lang-BFgX-Rvd.js";import{_ as Q}from"./TodoBoard.vue_vue_type_script_setup_true_lang-DeaSRf3w.js";import{T as L,U as Y,X as R,F as Z,r as ee,_ as j,b as te}from"./AppSidebarLayout.vue_vue_type_script_setup_true_lang-DsoSplZ5.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DhabyVPu.js";import"./useForwardExpose-D5Jm3EI0.js";import"./check-47lVkS5f.js";import"./index-CMWG4mbA.js";const se={class:"space-y-2"},ae={key:0,class:"flex items-center justify-between bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mx-4 mt-4",role:"alert"},oe={class:"flex items-center gap-3"},re={class:"flex items-center gap-2"},ne={class:"text-sm text-red-700 dark:text-red-300"},ie={class:"flex items-center gap-3"},de={class:"flex items-center gap-2"},le={class:"text-sm text-red-700 dark:text-red-300"},ce=D({__name:"LimitWarnings",props:{company:{}},setup($){const r=$,m=y(sessionStorage.getItem(`member-warning-dismissed-${r.company.id}`)==="true"),a=y(sessionStorage.getItem(`project-warning-dismissed-${r.company.id}`)==="true"),p=U(()=>{if(m.value||r.company.subscription_type==="MAXI")return!1;const c=r.company.member_limit-1;return r.company.current_member_count>=c}),v=U(()=>{if(a.value||r.company.subscription_type==="MAXI")return!1;const c=Math.floor(r.company.project_limit*.8);return r.company.current_project_count>=c}),A=()=>{m.value=!0,sessionStorage.setItem(`member-warning-dismissed-${r.company.id}`,"true")},k=()=>{a.value=!0,sessionStorage.setItem(`project-warning-dismissed-${r.company.id}`,"true")},f=()=>r.company.subscription_type==="FREE"?"Upgrade to MIDI (£6/month) or MAXI (£9/month) to add more members.":"Upgrade to MAXI (£9/month) to add more members.",l=()=>r.company.subscription_type==="FREE"?{before:"to create more projects.",hasLinks:!0}:{before:"to create more projects.",hasLinks:!0,singlePlan:"MAXI"};return(c,g)=>(i(),d("div",se,[p.value?(i(),d("div",ae,[s("div",oe,[n(x(L),{class:"w-5 h-5 text-red-600 dark:text-red-400"}),s("div",null,[s("div",re,[n(x(Y),{class:"w-4 h-4 text-red-600 dark:text-red-400"}),g[0]||(g[0]=s("span",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Member Limit Warning ",-1))]),s("p",ne,u(c.company.current_member_count)+"/"+u(c.company.member_limit)+" members used. "+u(f()),1)])]),s("button",{onClick:A,class:"p-1 hover:bg-red-100 dark:hover:bg-red-800/30 rounded transition-colors","aria-label":"Dismiss warning"},[n(x(R),{class:"w-4 h-4 text-red-600 dark:text-red-400"})])])):_("",!0),v.value?(i(),d("div",{key:1,class:w(["flex items-center justify-between bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mx-4",{"mt-4":!p.value}]),role:"alert"},[s("div",ie,[n(x(L),{class:"w-5 h-5 text-red-600 dark:text-red-400"}),s("div",null,[s("div",de,[n(x(Z),{class:"w-4 h-4 text-red-600 dark:text-red-400"}),g[1]||(g[1]=s("span",{class:"text-sm font-medium text-red-800 dark:text-red-200"}," Project Limit Warning ",-1))]),s("p",le,[h(u(c.company.current_project_count)+"/"+u(c.company.project_limit)+" projects used. ",1),c.company.subscription_type==="FREE"?(i(),d(S,{key:0},[n(x(P),{href:"/subscription",class:"font-bold text-red-800 dark:text-red-200 hover:underline"},{default:M(()=>g[2]||(g[2]=[h(" Upgrade to MIDI (£6/month) ",-1)])),_:1,__:[2]}),g[4]||(g[4]=h(" or ",-1)),n(x(P),{href:"/subscription",class:"font-bold text-red-800 dark:text-red-200 hover:underline"},{default:M(()=>g[3]||(g[3]=[h(" MAXI (£9/month) ",-1)])),_:1,__:[3]}),h(" "+u(l().before),1)],64)):(i(),d(S,{key:1},[n(x(P),{href:"/subscription",class:"font-bold text-red-800 dark:text-red-200 hover:underline"},{default:M(()=>g[5]||(g[5]=[h(" Upgrade to MAXI (£9/month) ",-1)])),_:1,__:[5]}),h(" "+u(l().before),1)],64))])])]),s("button",{onClick:k,class:"p-1 hover:bg-red-100 dark:hover:bg-red-800/30 rounded transition-colors","aria-label":"Dismiss warning"},[n(x(R),{class:"w-4 h-4 text-red-600 dark:text-red-400"})])],2)):_("",!0)]))}}),ue={class:"activity-feed"},me={class:"flex items-center justify-between mb-4"},pe={class:"flex items-center gap-2"},ge=["value"],ve={class:"space-y-2 max-h-96 overflow-y-auto"},ye={class:"flex-shrink-0"},fe={class:"flex-1 min-w-0"},xe={class:"mb-1"},be={class:"text-sm text-gray-600 dark:text-gray-400"},he={class:"text-xs text-gray-500 dark:text-gray-400"},_e={key:0,class:"mt-2 text-xs text-gray-600 dark:text-gray-400"},ke={key:0},we={class:"inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs mr-2"},Ae={class:"inline-block px-2 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 rounded text-xs"},je={key:1},Ie={class:"font-medium"},Me={key:2},Se={class:"font-medium"},$e={key:0,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ce={key:0,class:"mt-4 text-center"},Fe=["disabled"],I=20,Pe=D({__name:"ActivityFeed",props:{companyId:{},projectId:{},userId:{},visible:{type:Boolean}},setup($){const r=$,m=y(""),a=y([]),p=y({}),v=y(!1),A=y(1),k=y(!0),f=U(()=>{let e=a.value;return m.value&&(e=e.filter(t=>t.type===m.value)),e}),l=async()=>{try{v.value=!0;const e=new URLSearchParams({page:A.value.toString(),per_page:I.toString()});r.projectId&&e.append("project_id",r.projectId.toString()),r.userId&&e.append("user_id",r.userId.toString());const t=await fetch(`/api/activities?${e}`,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(t.ok){const o=await t.json();A.value===1?a.value=o.data:a.value=[...a.value,...o.data],k.value=o.meta.has_more,console.log("ActivityFeed: Activities loaded:",a.value.length)}else console.error("ActivityFeed: API Error:",t.status,t.statusText)}catch(e){console.error("Failed to load activities:",e)}finally{v.value=!1}},c=async()=>{try{const e=await fetch("/api/activities/types",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});if(e.ok){const t=await e.json();p.value=t.data}}catch(e){console.error("Failed to load activity types:",e)}},g=async()=>{k.value&&!v.value&&(A.value++,await l())},B=e=>p.value[e]||e.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()),q=e=>{const t=new Date(e),b=Math.floor((new Date().getTime()-t.getTime())/(1e3*60));return b<1?"Just now":b<60?`${b}m ago`:b<1440?`${Math.floor(b/60)}h ago`:b<10080?`${Math.floor(b/1440)}d ago`:t.toLocaleDateString()},N=e=>({todo_created:"Plus",todo_updated:"Edit",todo_deleted:"Trash2",todo_commented:"MessageCircle",todo_assigned:"UserCheck",todo_status_changed:"ArrowRight",project_created:"FolderPlus",project_updated:"FolderEdit",project_deleted:"FolderX",user_joined:"UserPlus",mention:"AtSign"})[e]||"Activity",T=e=>({todo_created:"text-green-600",todo_updated:"text-blue-600",todo_deleted:"text-red-600",todo_commented:"text-purple-600",todo_assigned:"text-orange-600",todo_status_changed:"text-indigo-600",project_created:"text-green-600",project_updated:"text-blue-600",project_deleted:"text-red-600",user_joined:"text-green-600",mention:"text-pink-600"})[e]||"text-gray-600";let C=null,F=null;return V(async()=>{console.log("ActivityFeed: Component mounted"),await c(),console.log("ActivityFeed: Subscribing to real-time events..."),C=ee.onActivity(e=>{if(console.log("ActivityFeed: Real-time event received:",e),e.type==="activity_created")(!m.value||e.data.type===m.value)&&(a.value.unshift(e.data),a.value.length>I&&(a.value=a.value.slice(0,I)));else if(e.type==="activity_updated"){const t=!m.value||e.data.type===m.value,o=a.value.findIndex(b=>b.id===e.data.id);t&&o!==-1?a.value[o]=e.data:t&&o===-1?(a.value.unshift(e.data),a.value.length>I&&(a.value=a.value.slice(0,I))):!t&&o!==-1&&a.value.splice(o,1)}else e.type==="activity_deleted"&&(a.value=a.value.filter(t=>t.id!==e.data.id))}),r.visible&&await l(),F=setInterval(async()=>{r.visible&&(console.log("ActivityFeed: Periodic check for new activities..."),await l())},1e4)}),H(()=>{C&&C(),F&&clearInterval(F)}),X(()=>r.visible,async e=>{e&&a.value.length===0&&await l()}),X(()=>a.value.length,(e,t)=>{console.log("ActivityFeed: Activities count changed from",t,"to",e)}),(e,t)=>(i(),d("div",ue,[s("div",me,[t[2]||(t[2]=s("h2",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"Activity Feed",-1)),s("div",pe,[W(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>m.value=o),class:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"},[t[1]||(t[1]=s("option",{value:""},"All Activities",-1)),(i(!0),d(S,null,E(Object.keys(p.value),o=>(i(),d("option",{key:o,value:o},u(B(o)),9,ge))),128))],512),[[z,m.value]])])]),s("div",ve,[(i(!0),d(S,null,E(f.value,o=>(i(),d("div",{key:o.id,class:"flex items-start gap-2 p-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},[s("div",ye,[s("div",{class:w(["w-4 h-4 rounded-full flex items-center justify-center",T(o.type).replace("text-","bg-").replace("-600","-100 dark:bg-")+" dark:bg-"])},[n(j,{name:N(o.type),class:w(["w-2 h-2",T(o.type)])},null,8,["name","class"])],2)]),s("div",fe,[s("div",xe,[s("span",be,u(o.description),1)]),s("div",he,u(q(o.created_at)),1),o.metadata?(i(),d("div",_e,[o.type==="todo_status_changed"&&o.metadata.oldStatus&&o.metadata.newStatus?(i(),d("div",ke,[s("span",we,u(o.metadata.oldStatus),1),n(j,{name:"ArrowRight",class:"w-3 h-3 inline mx-1"}),s("span",Ae,u(o.metadata.newStatus),1)])):_("",!0),o.type==="todo_assigned"&&o.metadata.assignee?(i(),d("div",je,[t[3]||(t[3]=h(" Assigned to: ",-1)),s("span",Ie,u(o.metadata.assignee),1)])):_("",!0),o.type==="mention"&&o.metadata.mentionedUser?(i(),d("div",Me,[t[4]||(t[4]=h(" Mentioned: ",-1)),s("span",Se,u(o.metadata.mentionedUser.name),1)])):_("",!0)])):_("",!0)])]))),128)),f.value.length===0?(i(),d("div",$e,[n(j,{name:"Activity",class:"w-12 h-12 mx-auto mb-4"}),t[5]||(t[5]=s("p",{class:"text-sm"},"No activities found",-1))])):_("",!0)]),k.value?(i(),d("div",Ce,[s("button",{onClick:g,disabled:v.value,class:"px-4 py-2 text-sm bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},u(v.value?"Loading...":"Load More"),9,Fe)])):_("",!0)]))}}),Ue=["title"],De=["title"],Te=["title"],Xe={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},Ee={class:"lg:col-span-1 activity-feed-container"},Le=D({__name:"Dashboard",props:{user:{},company:{}},setup($){const r=[{title:"Dashboard",href:"/dashboard"}],m=y(null),a=y(!1),p=y(!1);y(!1);const v=y(!1),A=f=>{m.value=f?.color||null},k=()=>{v.value=!v.value};return(f,l)=>(i(),d(S,null,[n(x(O),{title:"Dashboard"}),n(K,{breadcrumbs:r,company:f.company,"project-color":m.value},{dashboardActions:M(()=>[s("button",{onClick:l[0]||(l[0]=c=>p.value=!p.value),title:p.value?"Hide Calendar":"Show Calendar",class:w(["inline-flex items-center justify-center p-2 transition-colors",p.value?"text-blue-600 dark:text-blue-400":"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100"])},[n(j,{name:"Calendar",class:"w-5 h-5"})],10,Ue),s("button",{onClick:l[1]||(l[1]=c=>a.value=!a.value),title:a.value?"Hide Activity Feed":"Show Activity Feed",class:w(["inline-flex items-center justify-center p-2 transition-colors",a.value?"text-blue-600 dark:text-blue-400":"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100"])},[n(j,{name:"Activity",class:"w-5 h-5"})],10,De),s("button",{onClick:k,title:v.value?"Exit Select Mode":"Select for Bulk Update",class:w(["inline-flex items-center justify-center p-2 transition-colors",v.value?"text-blue-600 dark:text-blue-400":"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100"])},[n(j,{name:"CheckSquare",class:"w-5 h-5"})],10,Te)]),default:M(()=>[f.company?(i(),J(ce,{key:0,company:f.company},null,8,["company"])):_("",!0),s("div",Xe,[s("div",{class:w(["grid gap-4 h-full",a.value?"grid-cols-1 lg:grid-cols-4":"grid-cols-1"])},[s("div",{class:w(a.value?"lg:col-span-3":"col-span-1")},[n(Q,{onProjectChanged:A,"show-activity-feed":a.value,"show-calendar":p.value,"is-select-mode":v.value,onToggleActivityFeed:l[2]||(l[2]=c=>a.value=!a.value),onToggleCalendar:l[3]||(l[3]=c=>p.value=!p.value),onToggleSelectMode:k},null,8,["show-activity-feed","show-calendar","is-select-mode"])],2),W(s("div",Ee,[n(Pe,{"company-id":f.company?.id||1,visible:a.value,class:"h-full"},null,8,["company-id","visible"])],512),[[G,a.value]])],2)])]),_:1},8,["company","project-color"])],64))}}),Oe=te(Le,[["__scopeId","data-v-5e93e3f5"]]);export{Oe as default};
