import{d as b,a as g,o as c,n as m,A as t,L as x,r as V,c as R,l as j,f as r,K,q as n,b as o,p as v,e as w,g as _,t as p,F as E,j as A,M}from"./app-DDiSPk6m.js";import{C as Y,c as z,b as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-BsZ2jvJH.js";import{c as y,_ as N}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C7luad9r.js";import{C as O}from"./check-BctzNqUL.js";import"./useForwardExpose-D0TUbEB8.js";import"./index-C61bzdNy.js";const P=b({__name:"Card",props:{class:{}},setup(d){const u=d;return(a,l)=>(c(),g("div",{"data-slot":"card",class:m(t(y)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",u.class))},[x(a.$slots,"default")],2))}}),F=b({__name:"CardContent",props:{class:{}},setup(d){const u=d;return(a,l)=>(c(),g("div",{"data-slot":"card-content",class:m(t(y)("px-6",u.class))},[x(a.$slots,"default")],2))}}),B=b({__name:"CardDescription",props:{class:{}},setup(d){const u=d;return(a,l)=>(c(),g("p",{"data-slot":"card-description",class:m(t(y)("text-muted-foreground text-sm",u.class))},[x(a.$slots,"default")],2))}}),S=b({__name:"CardHeader",props:{class:{}},setup(d){const u=d;return(a,l)=>(c(),g("div",{"data-slot":"card-header",class:m(t(y)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",u.class))},[x(a.$slots,"default")],2))}}),$=b({__name:"CardTitle",props:{class:{}},setup(d){const u=d;return(a,l)=>(c(),g("h3",{"data-slot":"card-title",class:m(t(y)("leading-none font-semibold",u.class))},[x(a.$slots,"default")],2))}}),H={class:"max-w-6xl mx-auto p-6"},J={class:"flex items-center justify-between"},X={class:"text-lg font-semibold"},Z={class:"text-gray-600 dark:text-gray-400"},Q={key:0,class:"mt-2"},W={class:"text-sm text-gray-500"},T={class:"flex items-center gap-2"},ee={class:"mb-8"},te={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},se={class:"text-3xl font-bold text-gray-900 dark:text-gray-100"},ae={class:"text-sm text-gray-500"},oe={class:"space-y-2 mb-6"},re={key:1,class:"text-center"},ge=b({__name:"Index",props:{user:{},company:{},plans:{},stripePublicKey:{}},setup(d){const u=d,a=V(!1),l=R(()=>u.company?.subscription_type||"FREE"),h=R(()=>u.company?.subscription_status==="active");console.log("=== SUBSCRIPTION PAGE LOADED ==="),console.log("Props:",u),console.log("Current plan computed:",l.value),console.log("Loading state:",a.value),console.log("Component initial setup complete"),console.log("Component fully loaded at:",new Date().toISOString());const I=s=>`Â£${(s/100).toFixed(0)}`,L=s=>{switch(s){case"FREE":return"gray";case"MIDI":return"blue";case"MAXI":return"purple";default:return"gray"}},q=s=>{const e=L(s);return s===l.value?`border-2 border-${e}-500 bg-${e}-50 dark:bg-${e}-900/20`:"border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"},D=s=>{console.log("=== BUTTON CLICKED ==="),console.log("Plan type:",s),console.log("Current time:",new Date().toISOString()),console.log("Loading state:",a.value),console.log("Current plan:",l.value),console.log("Function exists:",typeof C),console.log("About to call changePlan...");try{C(s),console.log("changePlan called successfully")}catch(e){console.error("Error calling changePlan:",e)}},C=async s=>{if(console.log("changePlan called with:",s),console.log("loading.value:",a.value),console.log("currentPlan.value:",l.value),a.value||s===l.value){console.log("Exiting early - either loading or same plan");return}a.value=!0,console.log("Setting loading to true, using Inertia router approach..."),M.post("/subscription/change-plan",{plan:s},{onBefore:()=>(console.log("Inertia request starting..."),!0),onSuccess:e=>{console.log("Inertia request successful:",e);const i=e.props.flash;console.log("Flash data:",i),i?.redirect_url?(console.log("Redirecting to Stripe checkout from flash:",i.redirect_url),window.location.href=i.redirect_url):(console.log("Plan change successful, reloading page"),window.location.reload())},onError:e=>{console.error("Inertia request failed:",e),console.log("Error details:",JSON.stringify(e,null,2));let i="An error occurred while changing your plan. Please try again.";e.plan?i=e.plan:e.message&&(i=e.message),alert(i)},onFinish:()=>{console.log("Setting loading to false"),a.value=!1}})};j(()=>{console.log("=== COMPONENT MOUNTED ==="),console.log("onMounted hook called at:",new Date().toISOString()),console.log("Final function check:",{handlePlanChange:typeof D,changePlan:typeof C})});const U=async()=>{confirm("Are you sure you want to cancel your subscription? Your account will be downgraded to the FREE plan.")&&(a.value=!0,M.post("/subscription/cancel-subscription",{},{onSuccess:()=>{},onError:s=>{console.error("Error cancelling subscription:",s),alert("An error occurred while cancelling your subscription. Please try again.")},onFinish:()=>{a.value=!1}}))};return(s,e)=>(c(),g(E,null,[r(t(K),{title:"Subscription Management"}),r(G,null,{default:n(()=>[o("div",H,[e[7]||(e[7]=o("div",{class:"mb-8"},[o("h1",{class:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2"}," Subscription Management "),o("p",{class:"text-gray-600 dark:text-gray-400"}," Manage your TaskIT subscription and billing settings ")],-1)),r(t(P),{class:"mb-8"},{default:n(()=>[r(t(S),null,{default:n(()=>[r(t($),{class:"flex items-center gap-2"},{default:n(()=>[r(t(Y),{class:"w-5 h-5"}),e[0]||(e[0]=_(" Current Subscription ",-1))]),_:1,__:[0]})]),_:1}),r(t(F),null,{default:n(()=>[o("div",J,[o("div",null,[o("p",X,p(s.plans[l.value].name),1),o("p",Z,p(l.value==="FREE"?"Free forever":`${I(s.plans[l.value].price)} per month`),1),s.company?.subscription_ends_at?(c(),g("div",Q,[o("p",W,p(h.value?"Renews on":"Expires on")+": "+p(new Date(s.company.subscription_ends_at).toLocaleDateString()),1)])):w("",!0)]),o("div",T,[o("div",{class:m(["px-3 py-1 rounded-full text-sm font-medium",{"bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300":h.value,"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300":s.company?.subscription_status==="past_due","bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300":s.company?.subscription_status==="canceled","bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300":l.value==="FREE"}])},p(h.value?"Active":s.company?.subscription_status||"Free"),3)])])]),_:1})]),_:1}),o("div",ee,[e[2]||(e[2]=o("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6"}," Available Plans ",-1)),o("div",te,[(c(!0),g(E,null,A(s.plans,(i,f)=>(c(),v(t(P),{key:f,class:m(q(f))},{default:n(()=>[r(t(S),{class:"text-center"},{default:n(()=>[r(t($),{class:"flex items-center justify-center gap-2"},{default:n(()=>[_(p(i.name)+" ",1),f===l.value?(c(),v(t(O),{key:0,class:"w-5 h-5 text-green-500"})):w("",!0)]),_:2},1024),r(t(B),null,{default:n(()=>[o("div",se,p(f==="FREE"?"Free":I(i.price)),1),o("div",ae,p(f==="FREE"?"Forever":"per month"),1)]),_:2},1024)]),_:2},1024),r(t(F),null,{default:n(()=>[o("ul",oe,[(c(!0),g(E,null,A(i.features,k=>(c(),g("li",{key:k,class:"flex items-start gap-2 text-sm"},[r(t(O),{class:"w-4 h-4 text-green-500 mt-0.5 flex-shrink-0"}),o("span",null,p(k),1)]))),128))]),f!==l.value?(c(),v(t(N),{key:0,onClick:k=>D(f),disabled:a.value,variant:f==="MIDI"?"default":"outline",class:"w-full"},{default:n(()=>[_(p(f==="FREE"?"Downgrade to Free":`Upgrade to ${i.name}`),1)]),_:2},1032,["onClick","disabled","variant"])):(c(),g("div",re,e[1]||(e[1]=[o("span",{class:"text-sm text-gray-500"},"Current Plan",-1)])))]),_:2},1024)]),_:2},1032,["class"]))),128))])]),l.value!=="FREE"&&s.company?.stripe_subscription_id?(c(),v(t(P),{key:0,class:"border-red-200 dark:border-red-800"},{default:n(()=>[r(t(S),null,{default:n(()=>[r(t($),{class:"flex items-center gap-2 text-red-600 dark:text-red-400"},{default:n(()=>[r(t(z),{class:"w-5 h-5"}),e[3]||(e[3]=_(" Danger Zone ",-1))]),_:1,__:[3]}),r(t(B),null,{default:n(()=>e[4]||(e[4]=[_(" Cancel your subscription and downgrade to the FREE plan ",-1)])),_:1,__:[4]})]),_:1}),r(t(F),null,{default:n(()=>[r(t(N),{onClick:U,disabled:a.value,variant:"destructive"},{default:n(()=>e[5]||(e[5]=[_(" Cancel Subscription ",-1)])),_:1,__:[5]},8,["disabled"]),e[6]||(e[6]=o("p",{class:"text-xs text-gray-500 mt-2"}," Your subscription will remain active until the end of your current billing period. ",-1))]),_:1,__:[6]})]),_:1})):w("",!0)])]),_:1})],64))}});export{ge as default};
